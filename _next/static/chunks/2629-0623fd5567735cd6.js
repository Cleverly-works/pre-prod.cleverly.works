"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2629],{2173:function(n,e,t){t.d(e,{W:function(){return l}});var o=t(47568),r=t(7297),i=t(97582),a=t(75063),u=t(63139),s=t(13777);function c(){var n=(0,r.Z)(["\n  mutation CreateSupplierPpmInvoicePdf($accountEntryId: Int!) {\n    invoice: createSupplierPpmInvoicePdf(accountEntryId: $accountEntryId) {\n      success\n      key\n    }\n  }\n"]);return c=function(){return n},n}var d,l=(d=(0,o.Z)(function(n){var e,t,o,r,a,c,d,l,m,v,f,h;return(0,i.__generator)(this,function(i){switch(i.label){case 0:e=n.client,t=n.accountEntryId,o=n.getUrl,i.label=1;case 1:return i.trys.push([1,3,,4]),a="",(0,u.a)()||o||(r=window.open("/download","_blank")),[4,e.mutate({mutation:p,variables:{accountEntryId:t}})];case 2:return l=i.sent().data.invoice.key,o?a="".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(l):(null==r||null===(m=r.location)||void 0===m||m.assign("".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(l)),(null==window?void 0:null===(v=window.Capacitor)||void 0===v?void 0:null===(f=v.Plugins)||void 0===f?void 0:f.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(l)})),[2,a];case 3:return h=i.sent(),(0,s.Tb)({message:h,section:"fetch"}),[3,4];case 4:return[2]}})}),function(n){return d.apply(this,arguments)}),p=(0,a.Ps)(c())},9489:function(n,e,t){t.d(e,{I:function(){return p}});var o=t(26042),r=t(69396),i=t(99534),a=t(85893),u=t(5616),s=t(51233),c=t(50135),d=t(90948),l=t(15861),p=function(n){var e=n.leftLabel,t=n.rightLabel,u=n.error,c=(0,i.Z)(n,["leftLabel","rightLabel","error"]);return(0,a.jsxs)(s.Z,{direction:"row",alignItems:"center",children:[(0,a.jsx)(m,{sx:{borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"},error:u,children:(0,a.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",whiteSpace:"nowrap"},children:e})}),(0,a.jsx)(v,(0,r.Z)((0,o.Z)({},c),{variant:"outlined",size:"small",error:u})),(0,a.jsx)(m,{sx:{borderTopRightRadius:"5px",borderBottomRightRadius:"5px"},error:u,children:(0,a.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",whiteSpace:"nowrap"},variant:"body2",fontWeight:700,children:t})})]})},m=(0,d.ZP)(u.Z)(function(n){var e=n.theme;return{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:n.error?e.palette.danger.main:"#D9D9D9",minwidth:"28px",height:"28px",padding:"0 5px"}}),v=(0,d.ZP)(c.Z)(function(n){var e=n.theme,t=n.error;return{height:"28px","& .MuiInputBase-root ":{borderRadius:"0px","&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:t?e.palette.danger.main:"#D9D9D9"}},"& .MuiInputBase-input":{padding:"2px 14px",borderColor:t?e.palette.danger.main:"#D9D9D9",borderStyle:"solid",borderBottomWidth:"2.5px",borderTopWidth:"2px"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}}}})},78232:function(n,e,t){t.d(e,{F:function(){return A}});var o=t(14924),r=t(26042),i=t(69396),a=t(85893),u=t(45697),s=t.n(u),c=t(10166),d=t(80482),l=t(23776),p=t(98456),m=t(16143),v=t(50135),f=t(99534),h=t(29815),y=t(74061),b=t(6498),g=t(75438),I=t(15861),x=t(61730),Z=t(67294),j=(0,Z.createContext)({}),_=(0,Z.forwardRef)(function(n,e){var t=(0,Z.useContext)(j);return(0,a.jsx)("div",(0,r.Z)({ref:e},n,t))}),w=(0,Z.forwardRef)(function(n,e){var t=n.children,o=(0,f.Z)(n,["children"]),r=[];t.forEach(function(n){r.push(n),r.push.apply(r,(0,h.Z)(n.children||[]))});var i,u,s=(0,b.u)(),c=(0,x.Z)(s.breakpoints.up("sm"),{noSsr:!0}),d=r.length,l=c?36:48,p=function(n){return n.hasOwnProperty("group")?48:l},m=(u=(0,Z.useRef)(null),(0,Z.useEffect)(function(){null!=u.current&&u.current.resetAfterIndex(0,!0)},[d]),u);return(0,a.jsx)("div",{ref:e,children:(0,a.jsx)(j.Provider,{value:o,children:(0,a.jsx)(y.S_,{itemData:r,height:(d>8?8*l:r.map(p).reduce(function(n,e){return n+e},0))+16,width:"100%",ref:m,outerElementType:_,innerElementType:"ul",itemSize:function(n){return p(r[n])},overscanCount:5,itemCount:d,children:q})})})});function q(n){var e=n.data,t=n.index,o=n.style,u=e[t],s=(0,i.Z)((0,r.Z)({},o),{top:o.top+8});return u.hasOwnProperty("group")?(0,a.jsx)(g.Z,{component:"div",style:s,children:u.group},u.key):(0,a.jsx)(I.Z,(0,i.Z)((0,r.Z)({component:"li"},u[0]),{noWrap:!0,style:s,children:u[1].label}))}var A=function(n){var e=n.label,t=n.loading,o=n.placeholder,u=n.error,s=n.helperText,c=n.inputProps;return(0,a.jsx)($,(0,i.Z)((0,r.Z)({},n),{disableListWrap:!0,PopperComponent:S,ListboxComponent:w,renderInput:function(n){return(0,a.jsx)(v.Z,(0,i.Z)((0,r.Z)({},n,c),{error:u,helperText:s,label:e,placeholder:o,color:"secondary",variant:"standard",InputProps:(0,i.Z)((0,r.Z)({},n.InputProps,(null==c?void 0:c.InputProps)||{}),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[t?(0,a.jsx)(p.Z,{color:"inherit",size:20}):null,n.InputProps.endAdornment]})})}))},renderOption:function(n,e,t){return[n,e,t.index]},renderGroup:function(n){return n}}))};A.defaultProps={value:null,onChange:function(){},label:"",loading:!1,error:!1,onOpen:function(){},options:[],inputProps:{},withoutSelectIcon:!1},A.propTypes={value:s().shape({value:s().any,label:s().string}),onChange:s().func,label:s().string,loading:s().bool,onOpen:s().func,options:s().arrayOf(s().shape({value:s().any,label:s().string})),inputProps:s().object,withoutSelectIcon:s().bool,inputValue:s().string,onInputChange:s().func};var S=(0,c.Z)(m.Z)((0,o.Z)({zIndex:"12000 !important"},"& .".concat(d.Z.listbox),{boxSizing:"border-box","& ul":{padding:0,margin:0}})),$=(0,c.Z)(l.Z)(function(n){var e=n.withoutSelectIcon;return{"& .MuiAutocomplete-root":{cursor:"pointer"},"& .MuiAutocomplete-popper":{zIndex:"12000 "},"& .MuiAutocomplete-endAdornment":{"& .MuiButtonBase-root.MuiIconButton-root.MuiAutocomplete-popupIndicator":{"& .MuiSvgIcon-root":(0,r.Z)({},e&&{display:"none"})}}}})},82058:function(n,e,t){t.d(e,{N:function(){return o}});var o=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[{context:"secondary",icon:["fas","edit"],onClick:e.onEditClick,to:"".concat(n,"manage"),tooltip:"Edit"},{context:"danger",icon:["fas","trash"],onClick:e.onDeleteClick,tooltip:"Delete"}]}},6538:function(n,e,t){t.d(e,{e:function(){return i}});var o=t(29815),r=t(22244),i=function(n,e){var t=(0,o.Z)(null==n?void 0:n.timings).sort(function(n,e){return e.id-n.id});return Array.isArray(e)?t.find(function(n){var t=n.status;return r.yW.find(function(n){return n.value===t&&!e.includes(t)})}):t.find(function(n){var t=n.status;return r.yW.find(function(n){return n.value===t&&t!==e})})}},35381:function(n,e,t){t.d(e,{il:function(){return i},j$:function(){return o},wo:function(){return r}});var o=function(n,e){if(Array.isArray(e)){var t,o,r=null;return e.forEach(function(e){var t,o,i=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});r=(null==i?void 0:null===(o=i.user)||void 0===o?void 0:o.fullName)||r}),r}var i=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});return(null==i?void 0:null===(o=i.user)||void 0===o?void 0:o.fullName)||null},r=function(n,e){if(Array.isArray(e)){var t,o=null;return e.forEach(function(e){var t,r=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});o=(null==r?void 0:r.id)||o}),o}var r=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});return(null==r?void 0:r.id)||null},i=function(n,e){return!n||n>e}},36368:function(n,e,t){t.d(e,{q:function(){return Q}});var o=t(14924),r=t(26042),i=t(69396),a=t(828),u=t(85893),s=t(67294),c=t(45697),d=t(6812),l=t(50319),p=t(26695),m=t(98456),v=t(45416),f=t(96486),h=function(n){var e,t,o,i=n.accountId,a=n.locationId,u=n.jobId,s=[];s.push(a?{locationId:{_eq:a}}:{}),s.push(i?{accountId:{_eq:i}}:{}),s.push(u?{Invoices:{entityId:{_eq:u}}}:{}),s.push({type:{_in:["proformaInvoice","customerPpmInvoice","supplierPpmInvoice","invoice"]},paymentStatus:{_in:["unpaid","partial"]}});var c=s.filter(function(n){return!f.isEmpty(n)});return(0,r.Z)({},c.length>0&&{_and:c})},y=t(20705),b=t(15033),g=t(18586),I=t(30381),x=t.n(I),Z=t(39641),j=t(75832),_=t(87918),w=t(51233),q=t(86886),A=t(50135),S=t(33754),$=t(87109),T=t(72852),P=t(50480),C=t(70452),R=t(93946),D=t(84808),E=t(74231),k=(0,E.Ry)().shape({dateReceived:(0,E.hT)().required("Date Received is required").typeError("Date Received is required"),paymentReference:(0,E.Z_)().required("Payment Reference is required"),amountReceived:(0,E.Rx)().min(0).required("Amount Received is required"),comment:(0,E.Z_)().nullable()}),N=t(97432),Q=function(n){var e,t,c,f,I=n.accountId,E=n.locationId,Q=n.jobId,L=n.refetch,U=n.close,M=(0,Z.D)(),J=(0,g.q)(),B=null===(e=J.admin)||void 0===e?void 0:null===(t=e.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,O=null===(c=J.admin)||void 0===c?void 0:null===(f=c.jobSetting)||void 0===f?void 0:f.jobNumberSuffix,z=(0,y.x)({filters:null}),W=z.initialData,F=z.ref,G=(0,s.useState)(null),V=G[0],Y=G[1],H=(0,s.useState)(null),K=H[0],X=H[1],nn=(0,s.useState)(""),ne=nn[0],nt=nn[1],no=(0,s.useState)(0),nr=no[0],ni=no[1],na=(0,s.useState)(""),nu=na[0],ns=na[1],nc=(0,s.useState)(!1),nd=nc[0],nl=nc[1],np=(0,s.useState)([]),nm=np[0],nv=np[1],nf=(0,s.useState)(0),nh=nf[0],ny=nf[1],nb=(0,s.useMemo)(function(){return h({accountId:I,locationId:E,jobId:Q})},[I,Q,E]),ng=(0,d.a)(p.v8,{variables:{limit:W.limit,offset:W.offset,accountId:I,locationId:E,orderBy:W.orderBy,where:nb},onCompleted:function(n){var e,t=null==n?void 0:null===(e=n.accountEntries)||void 0===e?void 0:e.map(function(n,e){var t,o,r,i,a=null===(t=n.invoices)||void 0===t?void 0:t[0];return{index:e,id:n.id,type:n.type,jobId:null==a?void 0:null===(o=a.Job)||void 0===o?void 0:o.id,locationId:n.locationId,jobNumber:null==a?void 0:null===(r=a.Job)||void 0===r?void 0:r.number,jobType:null==a?void 0:null===(i=a.Job)||void 0===i?void 0:i.type,invoiceNumber:n.invoiceNumber,date:x()(n.createdAt).format("YYYY-MM-DD"),daysOutstanding:n.outstandingdays,outstandingAmount:n.outstandingAmount,amount:0,invoiceId:null==a?void 0:a.id,meta:n.meta}});nv(t||[])}}),nI=ng.data,nx=(void 0===nI?{meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0}}}}:nI).meta,nZ=ng.loading,nj=ng.refetch,n_=(0,a.Z)((0,l.D)(p.Bz,{refetchQueries:["GetAccountEntries","GetJob"],onCompleted:function(){M.show({severity:"success",content:"Payment receipt was added successfully."}),L&&L(),U&&U()},onError:function(n){M.show({severity:"error",content:"Error: ".concat(n.message)})}}),2),nw=n_[0],nq=n_[1].loading,nA=function(n){n.preventDefault();try{k.validateSync({dateReceived:K,paymentReference:ne,amountReceived:nr,comment:nu},{abortEarly:!1})}catch(e){return Y(e.inner.reduce(function(n,e){var t=e.path,a=e.message;return(0,i.Z)((0,r.Z)({},n),(0,o.Z)({},t,a))},{}))}if(Number(nh).toFixed(2)!==Number(nr).toFixed(2))return M.show({severity:"error",content:"Error: The sum of the reconciled amounts does not match the amount received."});nw({variables:{data:{dateReceived:K,paymentReference:ne,amountReceived:nr,comment:nu,accountId:I,payments:nm.filter(function(n){return n.amount>0}).map(function(n){var e;return{id:n.id,amount:n.amount}})}}})},nS=(0,s.useCallback)(function(n){var e=Number(n.target.value);ni(function(){if(!nd)return n.target.value;var t=e,o=0,a=nm.map(function(n){var e=Math.min(n.outstandingAmount,t);return o+=(0,N.l)(e,2),t-=(0,N.l)(e,2),(0,i.Z)((0,r.Z)({},n),{amount:(0,N.l)(e,2)})});return ny((0,N.l)(o,2)),nv(a),e})},[nd,nm]),n$=(0,s.useCallback)(function(n,e){nl(function(){if(!e)return e;var n=nr,t=0,o=nm.map(function(e){var o=Math.min(e.outstandingAmount,n);return t+=(0,N.l)(o,2),n-=(0,N.l)(o,2),(0,i.Z)((0,r.Z)({},e),{amount:(0,N.l)(o,2)})});return ny((0,N.l)(t,2)),nv(o),e})},[nr,nm]),nT=(0,s.useCallback)(function(n,e){nv(function(t){var o=0,a=t.map(function(t){return t.id===n?(o+=(0,N.l)(Number(e),2),(0,i.Z)((0,r.Z)({},t),{amount:e})):(o+=(0,N.l)(Number(t.amount),2),(0,r.Z)({},t))});return ny(o),a})},[nv]),nP=(0,s.useMemo)(function(){return[{flex:1,minWidth:120,sortable:!1,headerName:"Number",field:"number",renderCell:function(n){var e=n.row;return["customerPpmInvoice","supplierPpmInvoice"].includes(e.type)?"PM ".concat(e.invoiceNumber):(0,u.jsx)(v.D,{id:e.jobId,number:e.jobNumber,invoiceNumber:e.invoiceNumber,numberPrefix:B,numberSuffix:O,openCanvas:!0,type:e.jobType})}},{flex:1,minWidth:120,sortable:!0,sortName:"createdAt",headerName:"Date",field:"date"},{flex:1,minWidth:120,sortable:!0,sortName:"outstandingdays",headerName:"Days Outstanding",field:"daysOutstanding"},{flex:1,minWidth:120,sortable:!0,sortName:"outstandingAmount",headerName:"Amount Outstanding",field:"outstandingAmount",renderCell:function(n){var e=n.row;return(0,j.T)(e.outstandingAmount)}},{flex:1,minWidth:250,sortable:!1,headerName:"Reconciled Amount",field:"amount",renderCell:function(n){var e=n.row;return(0,u.jsxs)(w.Z,{direction:"row",children:[(0,u.jsx)(A.Z,{fullWidth:!0,variant:"outlined",color:"secondary",size:"small",type:"number",value:e.amount,onChange:function(n){return nT(e.id,n.target.value)},inputProps:{min:0,step:.01},InputProps:{startAdornment:(0,u.jsx)($.Z,{position:"start",children:"\xa3"})}}),(0,u.jsx)(R.Z,{onClick:function(){return nT(e.id,e.outstandingAmount)},children:(0,u.jsx)(C.Z,{})})]})}}]},[nT,B,O]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(D.Z,{sx:{zIndex:1e5},open:nq,children:(0,u.jsx)(m.Z,{color:"secondary"})}),(0,u.jsx)("form",{id:"offCanvasForm",onSubmit:nA,children:(0,u.jsxs)(w.Z,{width:"100%",children:[(0,u.jsxs)(q.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,u.jsx)(q.ZP,{item:!0,xs:6,children:(0,u.jsx)(S.M,{value:K,onChange:function(n){return X(n)},label:"Date Received",renderInput:function(n){return(0,u.jsx)(A.Z,(0,i.Z)((0,r.Z)({},n),{fullWidth:!0,variant:"outlined",color:"secondary",error:!!(null==V?void 0:V.dateReceived),helperText:null==V?void 0:V.dateReceived}))}})}),(0,u.jsx)(q.ZP,{item:!0,xs:6,children:(0,u.jsx)(A.Z,{label:"Payment Reference",fullWidth:!0,variant:"outlined",color:"secondary",value:ne,onChange:function(n){return nt(n.target.value)},error:!!(null==V?void 0:V.paymentReference),helperText:null==V?void 0:V.paymentReference})}),(0,u.jsx)(q.ZP,{item:!0,xs:6,children:(0,u.jsx)(A.Z,{fullWidth:!0,color:"secondary",type:"number",label:"Amount Received",value:nr,onChange:nS,inputProps:{min:0,step:.01},InputProps:{startAdornment:(0,u.jsx)($.Z,{position:"start",children:"\xa3"})},error:!!(null==V?void 0:V.amountReceived),helperText:null==V?void 0:V.amountReceived})}),(0,u.jsx)(q.ZP,{item:!0,xs:6,children:(0,u.jsx)(A.Z,{multiline:!0,rows:4,label:"Comment",fullWidth:!0,variant:"filled",color:"secondary",value:nu,onChange:function(n){return ns(n.target.value)},error:!!(null==V?void 0:V.comment),helperText:null==V?void 0:V.comment})}),(0,u.jsx)(q.ZP,{item:!0,xs:6,children:(0,u.jsx)(P.Z,{control:(0,u.jsx)(T.Z,{checked:nd,onChange:n$,color:"success"}),label:"Auto Reconcile"})})]}),(0,u.jsx)(b.i,{columns:nP,loading:nZ,history:!1,meta:nx,ref:F,refetch:nj,rows:nm}),(0,u.jsx)(w.Z,{width:"100%",direction:"row",justifyContent:"flex-end",children:(0,u.jsx)(_.Z,{label:"Sum: ".concat((0,j.T)(nh)),color:Number(nh).toFixed(2)===Number(nr).toFixed(2)?"success":"danger"})})]})})]})};Q.propTypes={type:(0,c.oneOf)(["customer","supplier"]).isRequired,accountId:c.number.isRequired,locationId:c.number,jobId:c.number,refetch:c.func.isRequired,close:c.func.isRequired}},26695:function(n,e,t){t.d(e,{BH:function(){return w},Bz:function(){return Z},DI:function(){return $},Dn:function(){return x},L2:function(){return T},UA:function(){return _},Y8:function(){return q},to:function(){return A},v8:function(){return j},yz:function(){return S}});var o=t(7297),r=t(75063);function i(){var n=(0,o.Z)(["\n  query GetFinance($accountId: Int!) {\n    financial: Account_by_pk(id: $accountId) {\n      name\n      website\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n      bankAccounts: BankAccounts {\n        id\n        stripeId\n        bank\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        default\n        createdAt\n      }\n      cards: Cards {\n        id\n        stripeId\n        type\n        last4\n        expYear\n        expMonth\n        status\n        default\n        createdAt\n      }\n    }\n  }\n"]);return i=function(){return n},n}function a(){var n=(0,o.Z)(["\n  mutation AddPaymentReceipt($data: jsonb!) {\n    addPaymentReceived(data: $data) {\n      success\n      data\n    }\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,o.Z)(["\n  mutation UpdateAccountEntry($id: Int!, $changes: AccountEntry_set_input!) {\n    update_AccountEntry_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      meta\n      outstandingAmount\n      balance\n    }\n  }\n"]);return u=function(){return n},n}function s(){var n=(0,o.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n    $locationId: Int\n    $orderBy: [AccountEntry_order_by!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      entryId\n      jobId\n      locationId\n      currencyId\n      createdAt\n      balance\n      debit\n      credit\n      accountId\n      updatedAt\n      status\n      paymentStatus\n      meta\n      invoiceNumber\n      invoices: Invoices {\n        Job {\n          id\n          paid\n          reference\n          type\n          meta\n          number\n          status\n          location: Location {\n            id\n            name\n          }\n          service: Service {\n            name\n            id\n          }\n        }\n        id\n        items\n        status\n        createdAt\n        rebate\n        meta\n        totals\n        invoiceType\n        invoiceNumber\n        invoiceDate\n        expenses\n        entityId\n        entity\n        configs\n        amounts\n        addendum\n        addresses\n        adminId\n      }\n    }\n    meta: getDashboard_AccountEntry_calculatebalance_aggregate(\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        totalCount: count\n      }\n    }\n  }\n"]);return s=function(){return n},n}function c(){var n=(0,o.Z)(["\n  query GetAccountEntries($where: AccountEntry_bool_exp, $accountId: Int, $locationId: Int) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      where: $where\n      args: { location_id: $locationId }\n      order_by: { createdAt: desc }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      entryId\n      jobId\n      locationId\n      currencyId\n      createdAt\n      balance\n      debit\n      credit\n      accountId\n      updatedAt\n      status\n      paymentStatus\n      meta\n      invoices: Invoices {\n        Job {\n          id\n          paid\n          reference\n          type\n          meta\n          number\n          status\n          location: Location {\n            id\n            name\n          }\n          sublocation: Sublocation {\n            id\n            name\n          }\n          service: Service {\n            name\n            id\n          }\n        }\n        id\n        items\n        status\n        createdAt\n        rebate\n        meta\n        totals\n        invoiceType\n        invoiceNumber\n        invoiceDate\n        expenses\n        entityId\n        entity\n        configs\n        amounts\n        addendum\n        addresses\n        adminId\n      }\n      reconciliations: InvoiceReconciliations_aggregate {\n        aggregate {\n          sum {\n            amount\n          }\n        }\n      }\n    }\n  }\n"]);return c=function(){return n},n}function d(){var n=(0,o.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n    $locationId: Int\n    $orderBy: [AccountEntry_order_by!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      createdAt\n      status\n      paymentStatus\n      meta\n      invoices: Invoices {\n        id\n        meta\n        invoiceType\n        invoiceNumber\n        amounts\n        Job {\n          id\n          number\n          type\n          status\n        }\n      }\n    }\n    meta: getDashboard_AccountEntry_calculatebalance_aggregate(\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        totalCount: count\n      }\n    }\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,o.Z)(["\n  query GetAccoutEntrySumByAccounntInJob($jobId: Int!, $accountId: Int!) {\n    accountEntryAggregate: AccountEntry_aggregate(\n      where: { Invoices: { Job: { id: { _eq: $jobId } } }, accountId: { _eq: $accountId } }\n    ) {\n      aggregate {\n        sum {\n          outstandingAmount\n        }\n      }\n    }\n  }\n"]);return l=function(){return n},n}function p(){var n=(0,o.Z)(["\n  query GetJobMeta($id: Int!) {\n    job: Job(where: { id: { _eq: $id } }) {\n      id\n      meta\n    }\n  }\n"]);return p=function(){return n},n}function m(){var n=(0,o.Z)(["\n  mutation UpdateJob($changes: Job_set_input, $ids: [Int]) {\n    update_Job(where: { id: { _in: $ids } }, _set: $changes) {\n      affected_rows\n    }\n  }\n"]);return m=function(){return n},n}function v(){var n=(0,o.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $insertTiming: Boolean!\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_JobTiming(objects: $timing) @include(if: $insertTiming) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return v=function(){return n},n}function f(){var n=(0,o.Z)(["\n  mutation DeleteAccountEntry($id: Int!) {\n    deleteAccountEntry(id: $id) {\n      success\n      data\n    }\n  }\n"]);return f=function(){return n},n}function h(){var n=(0,o.Z)(['\n  query GetRelatedAccountEntries($accountEntryId: Int!) {\n    reconciliations: Reconciliation(\n      where: {\n        creditEntityId: { _eq: $accountEntryId }\n        creditEntity: { _in: ["PaymentReceipt", "CreditNote"] }\n      }\n    ) {\n      id\n      amount\n      createdAt\n      accountEntryInvoice: InvoiceEntry {\n        id\n        type\n        invoiceNumber\n        invoices: Invoices {\n          id\n          invoiceType\n          invoiceNumber\n          job: Job {\n            id\n            number\n            type\n            status\n            timings: JobTimings(order_by: { createdAt: desc }) {\n              id\n              status\n              createdAt\n            }\n          }\n        }\n      }\n    }\n  }\n']);return h=function(){return n},n}function y(){var n=(0,o.Z)(["\n  query GetRelatedInvoces($accountEntryId: Int!) {\n    invoices: Invoice(where: { accountEntryId: { _eq: $accountEntryId } }) {\n      id\n      invoiceNumber\n      Job {\n        id\n        number\n        type\n        status\n      }\n    }\n  }\n"]);return y=function(){return n},n}function b(){var n=(0,o.Z)(['\n  query GetCalendarJobs($customerId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        customerId: { _eq: $customerId }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n']);return b=function(){return n},n}function g(){var n=(0,o.Z)(["\n  mutation AddCreditNote($data: jsonb!) {\n    addCreditNote(data: $data) {\n      success\n      data\n    }\n  }\n"]);return g=function(){return n},n}function I(){var n=(0,o.Z)(['\n  query GetAccountEntryDetails($accountEntryId: Int!) {\n    accountEntry: AccountEntry_by_pk(id: $accountEntryId) {\n      id\n      type\n      debit\n      credit\n      reference: meta(path: "reference")\n      comment: meta(path: "comment")\n      createdAt\n    }\n  }\n']);return I=function(){return n},n}var x=(0,r.Ps)(i()),Z=(0,r.Ps)(a());(0,r.Ps)(u());var j=(0,r.Ps)(s()),_=(0,r.Ps)(c()),w=(0,r.Ps)(d());(0,r.Ps)(l()),(0,r.Ps)(p()),(0,r.Ps)(m()),(0,r.Ps)(v());var q=(0,r.Ps)(f()),A=(0,r.Ps)(h()),S=(0,r.Ps)(y());(0,r.Ps)(b());var $=(0,r.Ps)(g()),T=(0,r.Ps)(I())},25771:function(n,e,t){t.d(e,{By:function(){return m},Rm:function(){return l},WG:function(){return p},Wj:function(){return v},bK:function(){return f}});var o=t(7297),r=t(75063);function i(){var n=(0,o.Z)(['\n  query getInvoices($jobId: Int!) {\n    invoices: Invoice(where: { entityId: { _eq: $jobId }, entity: { _eq: "Job" } }) {\n      id\n      accountEntry: AccountEntry {\n        id\n        type\n        paymentStatus\n        meta\n        dueDate\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      entity\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n    meta: Invoice_aggregate(where: { entityId: { _eq: $jobId }, entity: { _eq: "Job" } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return i=function(){return n},n}function a(){var n=(0,o.Z)(['\n  query getInvoices($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      accountEntry: AccountEntry {\n        id\n        paymentStatus\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']);return a=function(){return n},n}function u(){var n=(0,o.Z)(['\n  query getInvoiceForPdf($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      entityId\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']);return u=function(){return n},n}function s(){var n=(0,o.Z)(['\n  query getInvoiceForPdfByType($jobId: Int!, $invoiceType: String!) {\n    invoices: Invoice(\n      where: {\n        entityId: { _eq: $jobId }\n        entity: { _eq: "Job" }\n        invoiceType: { _eq: $invoiceType }\n      }\n      order_by: { createdAt: desc }\n    ) {\n      id\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        type\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']);return s=function(){return n},n}function c(){var n=(0,o.Z)(["\n  query getAccountEntryForPdfById($accountEntryId: Int!) {\n    accountEntry: AccountEntry_by_pk(id: $accountEntryId) {\n      id\n      meta\n    }\n  }\n"]);return c=function(){return n},n}function d(){var n=(0,o.Z)(["\n  mutation CreateProformaInvoice(\n    $jobId: Int!\n    $invoiceType: String!\n    $dueDate: timestamptz!\n    $description: String\n    $items: [jsonb]\n  ) {\n    createProformaInvoice(\n      jobId: $jobId\n      invoiceType: $invoiceType\n      description: $description\n      dueDate: $dueDate\n      items: $items\n    ) {\n      data\n      success\n    }\n  }\n"]);return d=function(){return n},n}var l=(0,r.Ps)(i());(0,r.Ps)(a());var p=(0,r.Ps)(u()),m=(0,r.Ps)(s()),v=(0,r.Ps)(c()),f=(0,r.Ps)(d())},95465:function(n,e,t){t.d(e,{m:function(){return nh}});var o=t(26042),r=t(85893),i=t(6812),a=t(13640),u=t(47568),s=t(69396),c=t(828),d=t(97582),l=t(67294),p=t(30381),m=t.n(p),v=t(50319),f=t(5481),h=t(42283),y=t(79665),b=t(78289),g=t(77439),I=t(76600),x=t(9270),Z=t(62140),j=t(11587),_=t(55377),w=t(49501),q=t(55563),A=t(95103),S=t(6710),$=t(16551),T=t(21300),P=t(35418),C=t(14924),R=t(52019),D=t(11082),E=t(7297),k=t(45697),N=t(10367),Q=t(68956),L=t(33006),U=t(16540),M=t(82058),J=t(74231),B=t(28497),O=t(51466),z=t(94054),W=t(56815),F=t(15861),G=function(n){var e,t,i=n.editMode,p=n.onSuccess,m=n.rawData,f=n.quotationId,b=(n.setQuote,n.supplierId),j=n.type,$=n.toggleShow,T=(0,l.useContext)(R.Z).hasRole,P=(0,h.cI)({defaultValues:{description:i?m.description:"",qty:i?m.qty:"",qtyUnit:i?m.qtyUnit:"hours",unitRate:i?m.unitRate:"",item:i?m.item:"",total:i?m.total:""},resolver:(0,y.S)(V),context:{isAdmin:T("admin")}}),C=P.control,E=P.errors,k=P.handleSubmit,N=P.register,Q=P.watch,L={control:C,errors:E,register:N},U=Q("qty"),M=Q("unitRate"),J=Q("total"),G=Q("description"),Y=(0,c.Z)((0,v.D)(a.Ih,{onCompleted:function(n){var e=n.insert_SupplierQuoteLineItem.returning[0].id;p&&p(e)}}),2),H=Y[0],K=Y[1].loading,X=(0,c.Z)((0,v.D)(a.EA,{onCompleted:function(n){var e=n.update_SupplierQuoteLineItem_by_pk.id;p&&p(e)}}),2),nn=X[0],ne=X[1].loadingUpdate,nt=(t=(0,u.Z)(function(n){return(0,d.__generator)(this,function(e){switch(e.label){case 0:if(!i)return[3,2];return n.supplierTotal=n.qty*n.unitRate,[4,nn({variables:{id:null==m?void 0:m.id,changes:n}})];case 1:return e.sent(),[3,4];case 2:return n.accountId=Number(b),n.type=j,n.quoteId=Number(f),n.supplierTotal=n.qty*n.unitRate,[4,H({variables:{objects:[n]}})];case 3:e.sent(),e.label=4;case 4:return[2]}})}),function(n){return t.apply(this,arguments)});return(0,r.jsxs)(I.Z,{handleSubmit:k(nt),children:[(0,r.jsx)(x.Z,{children:(0,r.jsx)(Z.Z,{md:12,children:(0,r.jsx)(z.Z,{fullWidth:!0,error:!!(null==E?void 0:E.description),children:(0,r.jsxs)(w.Z,{label:"Description",children:[(0,r.jsx)(S.Z,(0,s.Z)((0,o.Z)({},L),{name:"description",rows:2})),(null==E?void 0:E.description)&&(0,r.jsx)(W.Z,{sx:{m:0},children:null==E?void 0:null===(e=E.description)||void 0===e?void 0:e.message}),(0,r.jsxs)(F.Z,{children:[G.length,"/500"]})]})})})}),(0,r.jsxs)(x.Z,{children:[(0,r.jsx)(Z.Z,{md:4,children:(0,r.jsx)(w.Z,{label:"Quantity",children:(0,r.jsx)(q.Z,(0,s.Z)((0,o.Z)({},L),{name:"qty",type:"number",step:"0.01"}))})}),"Labour"===j&&(0,r.jsx)(Z.Z,{md:4,children:(0,r.jsx)(w.Z,{label:"Quantity Unit",children:(0,r.jsx)(A.Z,(0,s.Z)((0,o.Z)({},L),{name:"qtyUnit",options:[{text:"Hours",value:"hours",disabled:!1},{text:"Days",value:"days",disabled:!1},{text:"Weeks",value:"weeks",disabled:!1}]}))})}),(0,r.jsx)(Z.Z,{md:4,children:(0,r.jsx)(B.Z,(0,s.Z)((0,o.Z)({},L),{label:T("supplier")?"Unit Rate":"Supplier Unit Rate",name:"unitRate",vat:"Ex VAT"}))})]}),(0,r.jsxs)(O.Z,{children:["Supplier Total: ",(0,D.Z)(U*M)]}),(0,r.jsx)(_.Z,{}),T("admin")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Z,{children:(0,r.jsx)(Z.Z,{md:12,children:(0,r.jsx)(B.Z,(0,s.Z)((0,o.Z)({},L),{label:"Customer Unit Rate",name:"total",vat:"Ex VAT"}))})}),(0,r.jsxs)(O.Z,{children:["Customer Total (Labour Item): ",(0,D.Z)(U*J)]}),(0,r.jsx)(_.Z,{})]}),(0,r.jsxs)(x.Z,{justify:"end",style:{margin:"0 5px"},children:[(0,r.jsx)(g.Z,{content:"Cancel",onClick:$,style:{margin:"0 5px"}}),(0,r.jsx)(g.Z,{content:i?"Save":"Add",disabled:K||ne,type:"submit"})]}),(0,r.jsx)("div",{style:{clear:"both"}})]})};G.propTypes={editMode:k.bool,onSuccess:k.func,rawData:k.object,quotationId:k.number,supplierId:k.number,type:k.string,toggleShow:k.func},G.defaultProps={rawData:{}};var V=J.Ry({qty:J.Rx().required("Quantity is a required field"),unitRate:J.Rx().required("Unit rate is a required field"),total:J.Rx().when("isAdmin",{is:function(n){return!0===n},then:function(){return(0,k.number)().required("Customer Unit Rate is a required field")}}),description:J.Z_().max(500,"Description must have a maximum of 500 characters.").test("maxLines","Textarea should not exceed 10 lines",function(n){return!n||n.split("\n").length<=10})}),Y=t(84808),H=t(98456);function K(){var n=(0,E.Z)(["\n  margin: 0 5px;\n"]);return K=function(){return n},n}function X(){var n=(0,E.Z)(["\n  margin: 0;\n"]);return X=function(){return n},n}var nn=function(n){var e=n.quotation,t=n.quotationId,o=n.type,u=n.updateTotal,s=n.readOnly,d=(0,l.useContext)(R.Z).hasRole,p=(0,l.useContext)(b.Z),m=(0,i.a)(a.cu,{variables:{quotationId:t,type:o}}),f=m.data,h=(void 0===f?{lineItems:[]}:f).lineItems,y=m.loading,I=m.refetch,x=(0,c.Z)((0,v.D)(a.nc,{onCompleted:function(n){I()}}),1)[0];(0,l.useEffect)(function(){u(h)},[h]);var Z=function(){I(),p.close()},j=function(n,i){var a;p.show({content:(0,r.jsx)(G,{editMode:!!(null==i?void 0:i.rawData),onSuccess:Z,rawData:null==i?void 0:i.rawData,toggleShow:p.close,quotationId:t,supplierId:null===(a=e.supplier)||void 0===a?void 0:a.id,type:o}),submit:!1,title:"".concat(i?"Edit":"Insert"," ").concat(o," Item")})},_=function(n,e){x({variables:{id:e.id}})},w=[{text:"ID",hidden:!0},{text:"Description"},{hidden:!d(["admin","supplier"]),text:"Qty"},{hidden:!d(["admin","supplier"]),text:"Rate"},{hidden:!d(["admin","supplier"]),text:"Supplier Total"},{hidden:!d(["admin","customer"]),text:"Customer Total"},{hidden:!d(["admin","supplier"])||s,formatter:Q.Z,formatterData:(0,M.N)("/dashboard/quotes/",{onEditClick:j,onDeleteClick:_}),text:"Actions"},{text:"Raw Data",hidden:!0}],q=h.reduce(function(n,e){return n+e.total*e.qty},0),A=h.reduce(function(n,e){return n+e.supplierTotal},0);return y?(0,r.jsx)(Y.Z,{sx:{zIndex:1e5},open:!0,children:(0,r.jsx)(H.Z,{color:"secondary"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.Z,{content:(0,r.jsxs)(ne,{align:"center",justify:"between",children:[(0,r.jsx)("span",{children:o}),d(["admin","supplier"])&&!s&&(0,r.jsx)(g.Z,{content:"Insert ".concat(o," Item"),context:"secondary",onClick:j,size:"sm"})]}),tag:"h4"}),(0,r.jsx)(U.Z,{columns:w,rows:h.map(function(n){return{id:n.id,description:n.description,qty:"Labour"===n.type?"".concat(n.qty," ").concat(n.qtyUnit):n.qty,rate:(0,D.Z)(n.unitRate),supplierTotal:(0,D.Z)(n.supplierTotal),total:(0,D.Z)(n.total*n.qty),action:"",rawData:n}})}),(0,r.jsxs)("div",{style:{textAlign:"right"},children:[d(["admin","supplier"])&&(0,r.jsxs)(nt,{children:["Subtotal - ",o," ",d(["admin"])&&"- Supplier",": ",(0,D.Z)(A)]}),d(["admin","customer"])&&(0,r.jsxs)(nt,{children:["Subtotal - ",o,": ",(0,D.Z)(q)]})]})]})},ne=(0,N.ZP)(x.Z).attrs(function(){return{align:"center",justify:"between"}}).withConfig({displayName:"lineItemTable__StyledRow",componentId:"sc-93db134c-0"})(K()),nt=N.ZP.p.withConfig({displayName:"lineItemTable__StyledP",componentId:"sc-93db134c-1"})(X());nn.propTypes={quotationId:k.number.isRequired,quotation:k.object.isRequired,type:k.string,updateTotal:k.func.isRequired};var no=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;return n.reduce(function(n,t){return"total"===e?n+=t[e]*t.qty:n+=t[e]},0)},nr=function(n){var e=n.quotation,t=n.total,i=n.setTotal,a=(n.supplierTotal,n.setSupplierTotal),u=(n.customerTotal,n.setCustomerTotal),c=n.readOnly,d=(0,l.useContext)(R.Z).hasRole,p=function(n,e){return i(function(t){return(0,s.Z)((0,o.Z)({},t),(0,C.Z)({},n,no(e,"total")))})},m=function(n,e){return a(function(t){return(0,s.Z)((0,o.Z)({},t),(0,C.Z)({},n,no(e,"supplierTotal")))})},v=function(n,e){return u(function(t){return(0,s.Z)((0,o.Z)({},t),(0,C.Z)({},n,no(e,"total")))})},f=t.labour+t.materials,h=.2*f;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Z,{children:(0,r.jsx)(Z.Z,{md:12,children:(0,r.jsx)(nn,{quotationId:e.id,quotation:e,type:"Labour",updateTotal:function(n){p("labour",n),m("labour",n),v("labour",n)},readOnly:c})})}),(0,r.jsx)(_.Z,{}),(0,r.jsx)(x.Z,{children:(0,r.jsx)(Z.Z,{md:12,children:(0,r.jsx)(nn,{quotationId:e.id,quotation:e,type:"Materials",updateTotal:function(n){p("materials",n),m("materials",n),v("materials",n)},readOnly:c})})}),(0,r.jsx)(_.Z,{}),d(["admin","customer"])&&(0,r.jsx)(x.Z,{children:(0,r.jsxs)(Z.Z,{md:12,style:{textAlign:"right"},children:[(0,r.jsxs)("div",{children:["Sub Total: ",(0,D.Z)(f)]}),(0,r.jsxs)("div",{children:["VAT (20%): ",(0,D.Z)(h)]}),(0,r.jsxs)("div",{children:["Total: ",(0,D.Z)(f+h)]})]})})]})},ni=(0,J.Ry)().shape({totalDuration:(0,J.Z_)().required(),totalDurationUnit:(0,J.Z_)().required(),methodStatement:(0,J.Z_)().required(),startDate:(0,J.hT)().required(),rebate:(0,J.Z_)(),notes:(0,J.Z_)()}),na=t(42251),nu=t(63139),ns=t(14564),nc=t(51233),nd=t(79369),nl=t(35381),np=function(n){var e,t,i,a,p,C,R,D,E,k=n.quotation,N=n.status,Q=n.user,L=n.hasRole,U=n.onSuccess,M=(0,l.useContext)(b.Z),J=null==Q?void 0:Q.quoteThreshold,B=(0,l.useState)({labour:0,materials:0}),O=B[0],z=B[1],W=(0,l.useState)({labour:0,materials:0}),F=W[0],G=W[1],V=(0,l.useState)({labour:0,materials:0}),Y=V[0],H=V[1],K=(0,l.useState)(null),X=K[0],nn=K[1],ne=(0,nu.s)(),nt=function(n){nn(n.currentTarget)},no=function(){nn(null)},np=F.labour+F.materials,nm=null==k?void 0:null===(e=k.job)||void 0===e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(n){return n.quoteId===k.id&&n.status==="".concat("admin"===Q.accountType?"adminSupplier":Q.accountType,"QuoteThresholdApproval")}),nv=null==k?void 0:null===(i=k.job)||void 0===i?void 0:null===(a=i.timings)||void 0===a?void 0:a.find(function(n){return n.quoteId===k.id&&n.status==="".concat("admin"===Q.accountType?"adminSupplier":Q.accountType,"QuoteThresholdApproved")}),nf=nm&&nv&&(null==nm?void 0:null===(p=nm.meta)||void 0===p?void 0:p.to)===(null==nv?void 0:nv.userId),nh=(0,c.Z)((0,v.D)(f.HI),1)[0],ny=(0,h.cI)({defaultValues:{totalDuration:(null==k?void 0:k.totalDuration)||"",totalDurationUnit:(null==k?void 0:k.totalDurationUnit)||"hour",startDate:(null==k?void 0:k.startDate)?new Date(k.startDate):"",methodStatement:(null==k?void 0:k.methodStatement)||"",rebate:(null==k?void 0:k.rebate)||"",notes:(null==k?void 0:k.notes)||"",siteVisitAt:(null==k?void 0:k.siteVisitAt)?new Date(k.siteVisitAt):""},resolver:(0,y.S)(ni)}),nb=ny.control,ng=ny.errors,nI=ny.handleSubmit,nx=ny.register,nZ=L("customer")||L("supplier")&&("quotationAccepted"===k.status||"quotationRejected"===k.status||"supplierQuoteSent"===k.status),nj=(C=(0,u.Z)(function(n){var e,t,o,r;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return n.status=(null==k?void 0:k.job.status)==="quoteSent"?"supplierQuoteUpdated":"supplierQuoteComplete",n.startDate&&(n.startDate=m()(n.startDate).format()),[4,nh({variables:{id:k.id,changes:n,recommend:!1}})];case 1:return o=(t=e.sent().data.update_SupplierQuote_by_pk).id,r=t.status,U&&U({id:o,status:r}),[2]}})}),function(n){return C.apply(this,arguments)}),n_=(R=(0,u.Z)(function(n){return(0,d.__generator)(this,function(e){switch(e.label){case 0:return n.status="supplierQuoteDraft",n.startDate&&(n.startDate=m()(n.startDate).format()),[4,nh({variables:{id:k.id,changes:n,recommend:!1}})];case 1:return e.sent(),[2]}})}),function(n){return R.apply(this,arguments)}),nw=(D=(0,u.Z)(function(){var n;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return(n={}).status="supplierQuoteRefused",[4,nh({variables:{id:k.id,changes:n,recommend:!1}})];case 1:return e.sent(),[2]}})}),function(){return D.apply(this,arguments)}),nq=function(){M.close()},nA=function(){M.show({title:"Upload Risk Assessments",content:(0,r.jsx)(P.G,{entity:"Quotation",entityId:k.id})})},nS=(E=(0,u.Z)(function(){return(0,d.__generator)(this,function(n){switch(n.label){case 0:return[4,nh({variables:{changes:{recommended:!0},id:k.id,jobId:k.jobId,recommend:!0}})];case 1:return n.sent(),[2]}})}),function(){return E.apply(this,arguments)}),n$={control:nb,errors:ng,register:nx},nT=L(["admin","supplier"])&&!nZ&&(0,r.jsx)(g.Z,{content:"Cancel",onClick:nq,type:"button",style:ne?{padding:"0 8px",marginRight:8,width:"auto"}:null}),nP=L(["admin","supplier"])&&!nZ&&(0,r.jsx)(g.Z,{content:"Save",context:"secondary",onClick:nI(n_),style:ne?{padding:"0 8px",marginRight:8,marginBottom:8,width:"auto"}:null}),nC=L(["admin"])&&(0,r.jsx)(g.Z,{content:"Reject quote",context:"danger",onClick:nw,style:ne?{padding:"0 8px",marginRight:8}:null}),nR=function(){if(!nZ){if(L(["admin"])||L(["supplier"])&&(0,nl.il)(J,np)||L(["supplier"])&&nf)return(0,r.jsx)(g.Z,{content:"Submit quote",type:"submit",style:ne?{padding:"0 8px",marginRight:8}:null});if(L(["supplier"])&&!(0,nl.il)(J,np))return(0,r.jsx)(g.Z,{content:"Request approval",onClick:function(){var n;return(0,na.I_)({type:"quote",role:"admin"===Q.accountType?"adminSupplier":Q.accountType,jobId:null==k?void 0:null===(n=k.job)||void 0===n?void 0:n.id,quotationId:k.id,accountId:Q.accountId,amount:np,offCanvas:M})},style:ne?{padding:"0 8px",marginRight:8}:null})}};return(0,r.jsxs)(I.Z,{handleSubmit:nI(nj),children:[(0,r.jsx)(x.Z,{children:(0,r.jsxs)(Z.Z,{md:12,children:["Status: ",(0,r.jsx)(j.Z,{content:N.text,size:"md",context:N.context}),L("admin")&&(0,r.jsx)(g.Z,{content:"Recommend This Quotation",context:"secondary",onClick:nS,size:"sm"})]})}),(0,r.jsx)(_.Z,{}),(0,r.jsx)(nr,{quotation:k,total:O,setTotal:z,supplierTotal:F,setSupplierTotal:G,customerTotal:Y,setCustomerTotal:H,readOnly:nZ}),(0,r.jsx)(_.Z,{}),(0,r.jsxs)(x.Z,{children:[(0,r.jsx)(Z.Z,{md:3,children:(0,r.jsx)(w.Z,{label:"Total Duration",children:(0,r.jsx)(q.Z,(0,s.Z)((0,o.Z)({},n$),{name:"totalDuration",type:"number",readOnly:nZ}))})}),(0,r.jsx)(Z.Z,{md:3,children:(0,r.jsx)(w.Z,{label:"Total Duration Unit",children:(0,r.jsx)(A.Z,(0,s.Z)((0,o.Z)({},n$),{name:"totalDurationUnit",options:[{text:"Hour",value:"hour",disabled:!1},{text:"Day",value:"day",disabled:!1},{text:"Week",value:"week",disabled:!1}],readOnly:nZ}))})}),(0,r.jsxs)(Z.Z,{md:3,children:[(0,r.jsx)(w.Z,{label:"Available Start date"}),(0,r.jsx)(T.M,(0,s.Z)((0,o.Z)({},n$),{name:"startDate",readOnly:nZ}))]})]}),(0,r.jsx)(x.Z,{children:(0,r.jsx)(Z.Z,{md:12,children:(0,r.jsx)(w.Z,{label:"Method Statement",children:(0,r.jsx)(S.Z,(0,s.Z)((0,o.Z)({},n$),{name:"methodStatement",readOnly:nZ,rows:2}))})})}),L(["admin","supplier"])&&!nZ&&(0,r.jsx)(x.Z,{children:(0,r.jsxs)(Z.Z,{md:12,children:[(0,r.jsx)(w.Z,{label:"Risk Assessments & Method Statements"}),(0,r.jsx)(w.Z,{label:"Where RAMS are required, please upload them here.",children:(0,r.jsx)(g.Z,{content:"Upload",context:"secondary",onClick:nA,size:"sm"})})]})}),(0,r.jsx)(x.Z,{justify:ne?"center":"end",style:{margin:"5px 0 30px 0"},children:ne?(0,r.jsxs)(x.Z,{justify:"center",children:[nR(),nC,(0,r.jsx)(g.Z,{onClick:nt,context:"secondary",children:(0,r.jsx)(nd.Z,{})}),(0,r.jsx)(ns.ZP,{open:!!X,anchorEl:X,onClose:no,sx:{zIndex:9999},anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,r.jsxs)(nc.Z,{flexDirection:"columnn",alignItems:"center",justifyContent:"space-evenly",p:2,children:[nP,nT]})})]}):(0,r.jsxs)($.Z,{children:[nT,nP,nC,nR()]})}),(0,r.jsx)("div",{style:{clear:"both"}})]})},nm=t(22244),nv=t(2845),nf=t(75327),nh=function(n){var e=n.quotationId,t=n.onSuccess,u=(0,nv.x)(),s=u.hasRole,c=u.user,d=(0,i.a)(a.Ib,{variables:{id:e}}),l=d.data,p=(void 0===l?{quotation:{}}:l).quotation,m=d.loading,v=(0,i.a)(nf.nh,{variables:{id:c.id}}).data,f=(void 0===v?{user:{}}:v).user,h=nm.E6.find(function(n){return n.value===p.status})||{text:"-",context:"info"};return m?(0,r.jsx)(Y.Z,{sx:{zIndex:1e5},open:!0,children:(0,r.jsx)(H.Z,{color:"secondary"})}):(0,r.jsx)(np,{quotation:p,quotationId:e,user:(0,o.Z)({},c,f),hasRole:s,onSuccess:t,status:h})}},13640:function(n,e,t){t.d(e,{EA:function(){return h},Ib:function(){return p},Ih:function(){return f},JE:function(){return m},cu:function(){return v},nc:function(){return y}});var o=t(7297),r=t(75063),i=t(75327);function a(){var n=(0,o.Z)(["\n  query GetQuotation($id: Int!) {\n    quotation: SupplierQuote_by_pk(id: $id) {\n      id\n      createdAt\n      jobId\n      methodStatement\n      notes\n      quoteNumber\n      startDate\n      rebate\n      status\n      totalDuration\n      totalDurationUnit\n      meta\n      updatedAt\n      siteVisitAt\n      job: Job {\n        id\n        status\n        timings: JobTimings(order_by: { id: desc }) {\n          id\n          status\n          notes\n          meta\n          userId\n          quoteId\n          createdAt\n        }\n      }\n      lineItems: SupplierQuoteLineItems {\n        id\n        description\n        item\n        qty\n        qtyUnit\n        quoteId\n        supplierTotal\n        total\n        type\n        unitRate\n      }\n      supplier: Supplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n    }\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,o.Z)(['\n  query GetQuotations($accountId: Int, $status: [String!], $q: String, $limit: Int, $offset: Int) {\n    quotations: SupplierQuote(\n      limit: $limit\n      offset: $offset\n      where: {\n        _or: [\n          { quoteNumber: { _ilike: $q } }\n          { totalDurationUnit: { _ilike: $q } }\n          { notes: { _ilike: $q } }\n        ]\n        accountId: { _eq: $accountId }\n        type: { _eq: "quote" }\n        status: { _in: $status }\n      }\n      order_by: { quoteNumber: desc }\n    ) {\n      id\n      createdAt\n      jobId\n      methodStatement\n      notes\n      quoteNumber\n      startDate\n      rebate\n      status\n      totalDuration\n      totalDurationUnit\n      meta\n      updatedAt\n      type\n      lineItems: SupplierQuoteLineItems {\n        id\n        description\n        item\n        qty\n        qtyUnit\n        quoteId\n        supplierTotal\n        total\n        type\n        unitRate\n      }\n      labourTotal: SupplierQuoteLineItems_aggregate(where: { type: { _eq: "Labour" } }) {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      materialsTotal: SupplierQuoteLineItems_aggregate(where: { type: { _eq: "Materials" } }) {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      total: SupplierQuoteLineItems_aggregate {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      job: Job {\n        description\n        title\n        type\n        number\n        status\n        customer: Customer {\n          id\n          name\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n        location: Location {\n          addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n            id\n            status\n            address: Address {\n              id\n              name\n              addressLine1\n              postCode\n            }\n          }\n        }\n        timings: JobTimings(order_by: { createdAt: asc }) {\n          id\n          status\n          notes\n          createdAt\n          user: User {\n            ...UserFields\n          }\n        }\n      }\n    }\n    meta: SupplierQuote_aggregate(\n      where: {\n        _or: [\n          { quoteNumber: { _ilike: $q } }\n          { totalDurationUnit: { _ilike: $q } }\n          { notes: { _ilike: $q } }\n        ]\n        accountId: { _eq: $accountId }\n        type: { _eq: "quote" }\n        status: { _in: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"]);return u=function(){return n},n}function s(){var n=(0,o.Z)(["\n  query GetQuotationLineItems($quotationId: Int!, $type: String!) {\n    lineItems: SupplierQuoteLineItem(\n      where: { quoteId: { _eq: $quotationId }, type: { _eq: $type } }\n    ) {\n      id\n      description\n      item\n      qty\n      qtyUnit\n      quoteId\n      supplierTotal\n      total\n      type\n      unitRate\n    }\n  }\n"]);return s=function(){return n},n}function c(){var n=(0,o.Z)(["\n  mutation InsertSupplierQuoteLineItem($objects: [SupplierQuoteLineItem_insert_input!]!) {\n    insert_SupplierQuoteLineItem(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return c=function(){return n},n}function d(){var n=(0,o.Z)(["\n  mutation UpdateSupplierQuoteLineItem($id: Int!, $changes: SupplierQuoteLineItem_set_input) {\n    update_SupplierQuoteLineItem_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,o.Z)(["\n  mutation DeleteSupplierQuoteLineItem($id: Int!) {\n    delete_SupplierQuoteLineItem_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return l=function(){return n},n}var p=(0,r.Ps)(a()),m=(0,r.Ps)(u(),i.Px),v=(0,r.Ps)(s()),f=(0,r.Ps)(c()),h=(0,r.Ps)(d()),y=(0,r.Ps)(l())},5481:function(n,e,t){t.d(e,{Dg:function(){return l},HI:function(){return d},j6:function(){return c}});var o=t(7297),r=t(75063);function i(){var n=(0,o.Z)(["\n  mutation AddQuotation($objects: [SupplierQuote_insert_input!]!) {\n    insert_SupplierQuote(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return i=function(){return n},n}function a(){var n=(0,o.Z)(["\n  mutation UpdateQuotation(\n    $id: Int!\n    $changes: SupplierQuote_set_input\n    $recommend: Boolean!\n    $jobId: Int\n  ) {\n    update_SupplierQuote(where: { jobId: { _eq: $jobId } }, _set: { recommended: false })\n      @include(if: $recommend) {\n      returning {\n        id\n      }\n    }\n    update_SupplierQuote_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      status\n    }\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,o.Z)(["\n  mutation UpdateQuotation(\n    $id: Int!\n    $changes: SupplierQuote_set_input\n    $supplierOffer: [SupplierOffer_insert_input!]!\n  ) {\n    update_SupplierQuote_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_SupplierOffer(objects: $supplierOffer) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return n},n}function s(){var n=(0,o.Z)(['\n  mutation UpdateQuotation($jobId: Int, $changes: SupplierQuote_set_input) {\n    update_SupplierQuote(\n      where: {\n        jobId: { _eq: $jobId }\n        status: { _neq: "quotationAccepted" }\n        type: { _eq: "quote" }\n      }\n      _set: $changes\n    ) {\n      returning {\n        id\n        jobId\n        status\n      }\n    }\n  }\n']);return s=function(){return n},n}var c=(0,r.Ps)(i()),d=(0,r.Ps)(a()),l=(0,r.Ps)(u());(0,r.Ps)(s())},66321:function(n,e,t){t.d(e,{E:function(){return h}});var o=t(26042),r=t(69396),i=t(85893),a=t(45697),u=t.n(a),s=t(94054),c=t(50480),d=t(56815),l=t(40476),p=t(79717),m=t(36872),v=t(51233),f=t(15861),h=function(n){var e=n.label,t=n.options,a=n.error,u=n.helperText,h=n.stackProps,b=n.formControlProps,g=n.labelLeft,I=function(n){var e=n.children;return(0,i.jsx)(i.Fragment,{children:e})};return(0,i.jsxs)(s.Z,(0,r.Z)((0,o.Z)({sx:{m:3},error:a,variant:"standard"},void 0===b?{}:b),{children:[(0,i.jsxs)(v.Z,(0,r.Z)((0,o.Z)({},g&&y),{children:[e&&(0,i.jsx)(l.Z,{id:"radio-group",color:"secondary",children:e}),(0,i.jsx)(p.Z,(0,r.Z)((0,o.Z)({},n),{"aria-labelledby":"radio-group",children:(0,i.jsx)(v.Z,(0,r.Z)((0,o.Z)({},void 0===h?{}:h),{children:t.map(function(n){var e=n.value,t=n.label,o=n.icon,r=n.ParentComponent;return(0,i.jsx)(void 0===r?I:r,{children:(0,i.jsx)(c.Z,{value:e,control:(0,i.jsx)(m.Z,{color:"secondary"}),label:(0,i.jsxs)(v.Z,{direction:"row",alignItems:"center",spacing:1,children:[o,(0,i.jsx)(f.Z,{children:t})]})})})})}))}))]})),(0,i.jsx)(d.Z,{children:u})]}))};h.defaultProps={options:[],error:!1,helperText:"",stackProps:{},formControlProps:{},labelLeft:!1},h.propTypes={label:u().string,options:u().arrayOf(u().shape({label:u().string.isRequired,value:u().any.isRequired,ParentComponent:u().elementType})).isRequired,error:u().bool,helperText:u().string,stackProps:u().object,formControlProps:u().object,labelLeft:u().bool};var y={direction:"row",alignItems:"center",flexWrap:"wrap",spacing:1}},86021:function(n,e,t){t.d(e,{_Z:function(){return p}});var o=t(47568),r=t(7297),i=t(97582),a=t(75063),u=t(13777),s=t(63139);function c(){var n=(0,r.Z)(["\n  mutation CreateCustomerInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createCustomerInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"]);return c=function(){return n},n}function d(){var n=(0,r.Z)(["\n  mutation CreateSupplierInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createSupplierInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"]);return d=function(){return n},n}var l,p=(l=(0,o.Z)(function(n){var e,t,o,r,a,c,d,l;return(0,i.__generator)(this,function(i){switch(i.label){case 0:switch(e=n.client,t=n.jobId,o=n.type,r=n.getUrl,a=n.preview,c="",o){case"supplier":c=v;break;case"customerVat":c=m;break;default:return[2]}return(0,s.a)()||r||(d=window.open("/download","_blank")),l="",[4,e.mutate({mutation:c,variables:{jobId:t,preview:a}}).then(function(n){var e,t,o,i=n.data.invoice.key;r?l="".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(i):(null==d||null===(e=d.location)||void 0===e||e.assign("".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(i)),(null==window?void 0:null===(t=window.Capacitor)||void 0===t?void 0:null===(o=t.Plugins)||void 0===o?void 0:o.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(i)}))}).catch(function(n){(0,u.Tb)({message:n,section:"fetch"})})];case 1:return i.sent(),[2,l]}})}),function(n){return l.apply(this,arguments)}),m=(0,a.Ps)(c()),v=(0,a.Ps)(d())},56063:function(n,e,t){t.d(e,{$:function(){return s}});var o,r=t(47568),i=t(97582),a=t(63139),u=t(13777),s=(o=(0,r.Z)(function(n){var e;return(0,i.__generator)(this,function(t){switch(t.label){case 0:return(0,a.a)()||(e=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws-pre-prod.cleverly.works","/pdf/invoice/ppmNew/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(n)}).then(function(n){return n.json()}).then(function(n){var t,o,r;null==e||null===(t=e.location)||void 0===t||t.assign("".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)),(null==window?void 0:null===(o=window.Capacitor)||void 0===o?void 0:null===(r=o.Plugins)||void 0===r?void 0:r.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)})}).catch(function(n){(0,u.Tb)({message:n,section:"fetch"})})];case 1:return t.sent(),[2]}})}),function(n){return o.apply(this,arguments)})},80695:function(n,e,t){t.d(e,{u:function(){return d}});var o,r=t(47568),i=t(26042),a=t(69396),u=t(97582),s=t(13777),c=t(63139),d=(o=(0,r.Z)(function(n){var e,t,o,r,d,l,p,m,v,f,h,y,b,g,I,x;return(0,u.__generator)(this,function(u){switch(u.label){case 0:return e=n.meta,t=n.invoice,I=(0,a.Z)((0,i.Z)({},e),{title:"Proforma Invoice",amountPaid:null==t?void 0:null===(o=t.amountPaid)||void 0===o?void 0:null===(r=o.reconciliations)||void 0===r?void 0:null===(d=r.aggregate)||void 0===d?void 0:null===(l=d.sum)||void 0===l?void 0:l.amount,amountDeducted:null==t?void 0:null===(p=t.amountDeducted)||void 0===p?void 0:null===(m=p.reconciliations)||void 0===m?void 0:null===(v=m.aggregate)||void 0===v?void 0:null===(f=v.sum)||void 0===f?void 0:f.amount,reconciledAmount:null==t?void 0:null===(h=t.reconciledAmount)||void 0===h?void 0:null===(y=h.reconciliations)||void 0===y?void 0:null===(b=y.aggregate)||void 0===b?void 0:null===(g=b.sum)||void 0===g?void 0:g.amount}),(0,c.a)()||(x=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws-pre-prod.cleverly.works","/pdf/invoice/proforma/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(I)}).then(function(n){return n.json()}).then(function(n){var e,t,o;null==x||null===(e=x.location)||void 0===e||e.assign("".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)),(null==window?void 0:null===(t=window.Capacitor)||void 0===t?void 0:null===(o=t.Plugins)||void 0===o?void 0:o.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)})}).catch(function(n){(0,s.Tb)({message:n,section:"fetch"})})];case 1:return u.sent(),[2]}})}),function(n){return o.apply(this,arguments)})},42251:function(n,e,t){t.d(e,{i$:function(){return C},Ii:function(){return R},I_:function(){return D}});var o=t(47568),r=t(97582),i=t(85893),a=t(828),u=t(67294),s=t(45697),c=t(42283),d=t(79665),l=t(50319),p=t(73987),m=t(76600),v=t(49501),f=t(6710),h=t(913),y=t(74231),b=t(6538),g=t(29815),I=t(22244),x=function(n,e){var t=(0,g.Z)(null==n?void 0:n.timings).sort(function(n,e){return e.id-n.id});return Array.isArray(e)?t.find(function(n){var t=n.status;return I.iz.find(function(n){return n.value===t&&!e.includes(t)})}):t.find(function(n){var t=n.status;return I.iz.find(function(n){return n.value===t&&t!==e})})},Z=function(n){var e,t,s=n.type,g=n.status,I=n.role,Z=n.job,j=n.quoteId,_=n.toggleShow,w=n.refetch,q=(0,u.useContext)(p.Z).user,A=(0,a.Z)((0,l.D)(h.qD,{onCompleted:function(n){}}),1)[0],S=(0,a.Z)((0,l.D)(h.r2,{onCompleted:function(n){}}),1)[0],$=(0,a.Z)((0,l.D)(h.k7,{onCompleted:function(n){}}),1)[0],T=(0,c.cI)({defaultValues:{comments:""},resolver:(0,d.S)((e="QuoteThresholdRejected"===g||"ThresholdRejected"===g,(0,y.Ry)().shape({comments:e&&(0,y.Z_)().required()})))}),P=T.errors,C=T.handleSubmit,R=T.register,D=(t=(0,o.Z)(function(n){var e,t,o,i;return(0,r.__generator)(this,function(r){return o={id:Z.id,status:"quote"===s?"QuoteThresholdApproved"===g?"".concat(I,"QuoteThresholdRejected"):"".concat(I,"QuoteThresholdApproved"):"ThresholdApproved"===g?"".concat(I,"ThresholdRejected"):"".concat(I,"ThresholdApproved"),userId:q.id,quoteId:"quote"===s?j:void 0},$({variables:o}),i={notes:n.comments,status:"".concat(I).concat(g),jobId:Z.id,userId:q.id,quoteId:j},S({variables:{objects:[i]}}),A({variables:{id:Z.id,changes:{status:"quote"===s?null===(e=x(Z))||void 0===e?void 0:e.status:null===(t=(0,b.e)(Z))||void 0===t?void 0:t.status}}}),_&&_(),w&&w(),[2]})}),function(n){return t.apply(this,arguments)});return(0,i.jsx)(m.Z,{id:"offCanvasForm",handleSubmit:C(D),children:(0,i.jsx)(v.Z,{label:"Comments",children:(0,i.jsx)(f.Z,{errors:P,name:"comments",register:R,rows:3})})})};Z.propTypes={job:s.object.isRequired,status:s.string.isRequired,toggleShow:s.func.isRequired};var j,_,w=t(26042),q=t(69396),A=t(66812),S=t(2845),$=t(5481),T=(0,y.Ry)().shape({manager:(0,y.Ry)().shape({value:(0,y.Rx)().integer().required(),label:(0,y.Z_)()}).required()}),P=function(n){var e,t=n.role,u=n.type,s=n.quotations,p=n.jobId,v=n.quotationId,f=n.accountId,y=n.amount,b=n.toggleShow,g=(0,S.x)().user,I=(0,a.Z)((0,l.D)(h.r2,{onCompleted:function(n){}}),1)[0],x=(0,a.Z)((0,l.D)(h.qD,{onCompleted:function(n){}}),1)[0],Z=(0,a.Z)((0,l.D)($.HI),1)[0],j=(0,c.cI)({resolver:(0,d.S)(T),defaultValues:{manager:[]}}),_=j.errors,P=j.handleSubmit,C=j.register,R=j.control,D=(e=(0,o.Z)(function(n){return(0,r.__generator)(this,function(e){switch(e.label){case 0:if("issue"!==u)return[3,2];return[4,I({variables:{objects:[{status:"".concat(t,"ThresholdApproval"),jobId:p,userId:g.id,quoteId:v,meta:{to:n.manager.value}}]}})];case 1:case 3:return e.sent(),[3,7];case 2:var i;if(!("quote"===u&&"adminCustomer"===t))return[3,4];return[4,Promise.all(s.map((i=(0,o.Z)(function(e){return(0,r.__generator)(this,function(o){switch(o.label){case 0:return[4,I({variables:{objects:[{status:"".concat(t,"QuoteThresholdApproval"),jobId:p,userId:g.id,quoteId:e.id,meta:{to:n.manager.value}}]}})];case 1:return o.sent(),[4,Z({variables:{id:e.id,changes:{status:"waitingThresholdApproval"},recommend:!1}})];case 2:return o.sent(),[2]}})}),function(n){return i.apply(this,arguments)})))];case 4:return[4,I({variables:{objects:[{status:"".concat(t,"QuoteThresholdApproval"),jobId:p,userId:g.id,quoteId:v,meta:{to:n.manager.value}}]}})];case 5:return e.sent(),[4,Z({variables:{id:v,changes:{status:"waitingThresholdApproval"},recommend:!1}})];case 6:e.sent(),e.label=7;case 7:return[4,x({variables:{id:p,changes:{status:"waitingThresholdApproval"}}})];case 8:return e.sent(),b(),[2]}})}),function(n){return e.apply(this,arguments)});return(0,i.jsx)(m.Z,{id:"offCanvasForm",handleSubmit:P(D),children:(0,i.jsx)(A.P,(0,q.Z)((0,w.Z)({},{control:R,register:C,errors:_}),{label:"Please choose an approver from the list below.",accountId:f,userId:g.id,invoiceThreshold:"issue"===u?y:null,quoteThreshold:"quote"===u?y:null,name:"manager",type:"thresholdManagers"}))})},C=(j=(0,o.Z)(function(n){var e,t,o,a,u,s;return(0,r.__generator)(this,function(r){return e=n.type,t=n.role,o=n.job,a=n.quoteId,u=n.offCanvas,s=n.refetch,u.show({content:(0,i.jsx)(Z,{type:e,role:t,job:o,quoteId:a,status:"quote"===e?"QuoteThresholdApproved":"ThresholdApproved",toggleShow:u.show,refetch:s}),title:"Approve threshold"}),[2]})}),function(n){return j.apply(this,arguments)}),R=(_=(0,o.Z)(function(n){var e,t,o,a,u,s;return(0,r.__generator)(this,function(r){return e=n.type,t=n.role,o=n.job,a=n.quoteId,u=n.offCanvas,s=n.refetch,u.show({content:(0,i.jsx)(Z,{type:e,role:t,job:o,quoteId:a,status:"quote"===e?"QuoteThresholdRejected":"ThresholdRejected",toggleShow:u.show,refetch:s}),title:"Reject threshold"}),[2]})}),function(n){return _.apply(this,arguments)}),D=function(n){var e=n.type,t=n.role,o=n.quotations,r=n.jobId,a=n.quotationId,u=n.accountId,s=n.amount,c=n.offCanvas;c.show({content:(0,i.jsx)(P,{role:t,type:e,jobId:r,quotations:o,quotationId:a,accountId:u,amount:s,toggleShow:c.show}),title:"Threshold approval"})}},97432:function(n,e,t){t.d(e,{l:function(){return o}});var o=function(n,e){var t=Math.pow(10,e);return Math.round(n*t)/t}},98552:function(n,e,t){t.d(e,{SR:function(){return a},Tq:function(){return u},YK:function(){return i},cJ:function(){return r},pX:function(){return o}});var o=["customerVat","supplier"],r=["ProformaInvoiceCustomer","ProformaInvoiceSupplier"],i=["customerPpmInvoice","supplierPpmInvoice"],a={customer:["customerVat","ProformaInvoiceCustomer","customerPpmInvoice"],supplier:["supplier","ProformaInvoiceSupplier","supplierPpmInvoice"]},u={customerVat:"Customer VAT Invoice",supplier:"Supplier Invoice",ProformaInvoiceCustomer:"Customer ad-hoc Invoice",ProformaInvoiceSupplier:"Supplier ad-hoc Invoice",customerPpmInvoice:"PPM Customer Invoice",supplierPpmInvoice:"PPM Supplier Invoice"}}}]);