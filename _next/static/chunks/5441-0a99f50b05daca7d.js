"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5441],{14651:function(e,n,r){var t=r(64836);n.Z=void 0;var o=t(r(64938)),i=r(85893);n.Z=(0,o.default)((0,i.jsx)("circle",{cx:"12",cy:"12",r:"10"}),"Brightness1")},6710:function(e,n,r){var t,o,i,a=r(51174),s=r(67294),l=r(45697),c=r(10367),u=r(64522),d=r(92415),h=r(6269),m=r(66349),p=function(e){var n=e.autoFocus,r=e.className,t=e.cols,o=e.dir,i=e.disabled,a=e.errors,l=e.maxLength,c=e.name,d=e.placeholder,h=e.readOnly,m=e.register,p=e.rows,x=e.size,f=e.spellCheck,g=e.tabIndex,b=e.wrap;return s.createElement(u.Z,{autoFocus:n,className:r,cols:t,component:v,dir:o,disabled:i,errors:a[c],maxLength:l,name:c,placeholder:d,readOnly:h,register:m,rows:p,size:x,spellcheck:f,tabIndex:g,wrap:b})};p.displayName="TextareaField";var v=c.ZP.textarea(t||(t=(0,a.Z)(["\n  ","\n\n  direction: ",";\n  display: block;\n  line-height: 1.25rem;\n  ","\n\n  ","\n    padding: 0.5rem 0.725rem;\n"])),function(e){return(0,h.Z)(e)},function(e){return e.dir},function(e){return e.errors&&(0,c.iv)(o||(o=(0,a.Z)(["\n      ","\n    "])),function(e){return(0,d.Z)(e)})},function(e){return e.size===m.Z.SM&&(0,c.iv)(i||(i=(0,a.Z)(["\n      font-size: 0.625rem;\n    "])))});p.propTypes={autoFocus:l.bool,className:l.any,cols:l.number,dir:(0,l.oneOf)(["ltr","rtl"]),disabled:l.bool,errors:l.object.isRequired,maxLength:l.number,name:l.string.isRequired,placeholder:l.string,readOnly:l.bool,register:l.func.isRequired,rows:l.number,size:(0,l.oneOf)(Object.values(m.Z)),spellCheck:l.bool,tabIndex:l.number,wrap:(0,l.oneOf)(["soft","hard"])},p.defaultProps={autoFocus:!1,dir:"ltr",rows:5,size:"md"},n.Z=p},41085:function(e,n,r){r.d(n,{Z:function(){return A}});var t,o,i,a,s,l,c,u,d,h,m,p,v=r(51174),x=r(18391),f=r(76702),g=r(67294),b=r(45697),Z=r(11163),j=r.n(Z),y=r(10367),C=function(e){return e.toString().toLowerCase().trim().normalize("NFKD").replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(RegExp("-$"),"")},T=function(e){var n=e.activeTab,r=e.childClick,t=e.context,o=e.data,i=e.disabled,a=e.gap,s=e.index,l=e.indicatorSize,c=e.label,u=e.onClick,d=e.scrollToActiveTab,h=(0,g.useRef)(null),m=C(c),p=n.label===m;(0,g.useEffect)(function(){d&&h.current&&h.current.scrollIntoView({behavior:"smooth",block:"end"})},[p]);var v=function(e){!p&&(u&&u({index:s,label:m}),r&&r())};return o||(o={"data-cy":"".concat(m,"Tab")}),g.createElement(w,(0,x.Z)({active:p,context:t},o,{disabled:i,indicatorSize:l,onClick:v,ref:p&&d?h:null,gap:a}),c)};T.displayName="Tab";var w=y.ZP.li(t||(t=(0,v.Z)(["\n  ","\n\n  ","\n\n  ","\n\n  ","\n\n  &:hover {\n    ","\n\n    ","\n  }\n\n  &:last-of-type {\n    border-top-right-radius: ",";\n    border-top-left-radius: inherit;\n    border-right: 1px solid ",";\n  }\n\n  &:first-child {\n    border-top-left-radius: ",";\n    border-top-right-radius: inherit;\n    border-right: 0px;\n  }\n\n  min-width: fit-content;\n  display: inline-block;\n  list-style: none;\n  margin-bottom: -1px;\n  padding: 0.5rem 0.75rem;\n"])),function(e){var n=e.context,r=e.theme,t=e.gap;return(0,y.iv)(o||(o=(0,v.Z)(["\n    background-color: ",";\n    border-left: 1px solid ",";\n    border-bottom: 1px solid ",";\n    border-top: 1px solid ",";\n    color: ",";\n    ","\n  "])),r.TABS.colour,r.TABS.borderColour,n?r.COLOUR[n]:r.TABS.borderColour,r.TABS.borderColour,r.TABS.tabTextColour,0!==t&&(0,y.iv)(i||(i=(0,v.Z)(["\n      border-right: 1px solid ",";\n    "])),r.TABS.borderColour))},function(e){var n=e.active,r=(e.context,e.indicatorSize),t=e.theme;return n&&(0,y.iv)(a||(a=(0,v.Z)(["\n      background-color: ",";\n      border-bottom: ","px solid ",";\n      color: ",";\n    "])),t.TABS.activeColour,r,t.COLOUR.primary,t.TABS.activeTabTextColour)},function(e){var n=e.active;return e.theme,!n&&(0,y.iv)(s||(s=(0,v.Z)(["\n      cursor: pointer;\n    "])))},function(e){var n=e.disabled,r=e.theme;return n&&(0,y.iv)(l||(l=(0,v.Z)(["\n      background-color: ",";\n      cursor: not-allowed;\n    "])),r.TABS.disabledColour)},function(e){var n=e.active,r=e.theme;return!n&&(0,y.iv)(c||(c=(0,v.Z)(["\n        background-color: ",";\n      "])),r.TABS.hoverColour)},function(e){var n=e.disabled,r=e.theme;return n&&(0,y.iv)(u||(u=(0,v.Z)(["\n        background-color: ",";\n      "])),r.TABS.disabledColour)},function(e){return e.theme.TABS.borderRadius},function(e){return e.theme.TABS.borderColour},function(e){return e.theme.TABS.borderRadius});T.propTypes={activeTab:b.string.isRequired,childClick:b.func,context:(0,b.oneOfType)([b.bool,b.string]),data:b.object,disabled:b.bool,index:b.number,label:b.string.isRequired,onClick:(0,b.oneOfType)([b.bool,b.func]).isRequired,scrollToActiveTab:b.bool},T.defaultProps={context:!1,scrollToActiveTab:!0};var I=function(e,n,r){var t,o,i,a=e,s=!1,l=!1;a.addEventListener("mousedown",function(e){t=e.timeStamp,s=!0,o=e.pageX-a.offsetLeft,i=a.scrollLeft}),a.addEventListener("mouseleave",function(){s=!1,l=!1,a.classList.remove("active")}),a.addEventListener("mouseup",function(){s=!1,l=!1,a.classList.remove("active")}),a.addEventListener("mousemove",function(e){if(l||s&&e.timeStamp-t>r){e.preventDefault(),a.classList.add("active");var c=e.pageX-a.offsetLeft-o;l=!0,a.scrollLeft=i-c+n}})},S=function(e){var n=e.activeTab;return e.children[n.index].props.children},L="",_=function(e){var n=e.centerTabs,r=e.children,t=e.className,o=e.indicatorSize,i=e.gap,a=e.grabbable,s=e.grabWalkSpeed,l=e.grabTimeout,c=e.handleChange,u=e.onTabChange,d=e.scrollToActiveTab,h=(0,Z.useRouter)(),m=(0,g.createRef)();(0,g.useEffect)(function(){a&&I(m.current,s,l)},[]),Array.isArray(r)||(r=g.Children.toArray(r)),r.length>1?r.forEach(function(e,n){!0===e.props.active&&(L={index:n,label:C(e.props.label)})}):L={index:0,label:C(r[0].props.label)};var p=(0,g.useState)(L),v=(0,f.Z)(p,2),b=v[0],y=v[1],w=function(e){var n=e.index,r=C(e.label);y({index:n,label:r}),c&&_(r),u&&u(r)},_=function(e){var n=h.query;delete n.tab,n.tab=e,j().push({pathname:h.pathname,query:n,shallow:!0})};return g.createElement(g.Fragment,null,g.createElement(q,{centerTabs:n,className:t,gap:i,grabbable:a,ref:m},r.map(function(e,n){var r=e.props;return g.createElement(T,(0,x.Z)({activeTab:b,index:n,key:r.label,onClick:!r.disabled&&w,scrollToActiveTab:d,gap:i,indicatorSize:o},r))})),g.createElement(S,{activeTab:b,children:r}))},q=y.ZP.ol(d||(d=(0,v.Z)(["\n  align-items: flex-end;\n  border-bottom: 1px solid ",";\n  display: flex;\n  ","\n\n  ","\n\n  margin: 0 0 1rem 0;\n  padding-left: 0;\n  overflow-x: scroll;\n  user-select: none;\n  white-space: nowrap;\n  -ms-overflow-style: none;\n  &&::-webkit-scrollbar {\n    display: none;\n  }\n\n  ","\n"])),function(e){return e.theme.TABS.borderColour},function(e){var n=e.gap;return 0!==n&&(0,y.iv)(h||(h=(0,v.Z)(["\n      gap: ","px;\n    "])),n)},function(e){return e.centerTabs&&(0,y.iv)(m||(m=(0,v.Z)(["\n      justify-content: center;\n    "])))},function(e){return e.grabbable&&(0,y.iv)(p||(p=(0,v.Z)(["\n      &.active {\n        cursor: grabbing;\n\n        li {\n          cursor: grabbing;\n          pointer-events: none;\n        }\n      }\n    "])))});_.propTypes={centerTabs:b.bool,children:(0,b.oneOfType)([b.array,b.object]).isRequired,className:b.string,gap:b.number,grabbable:b.bool,grabWalkSpeed:b.number,grabTimeout:b.number,handleChange:b.bool,indicatorSize:b.number,scrollToActiveTab:b.bool},_.defaultProps={centerTabs:!1,gap:0,grabbable:!0,grabWalkSpeed:25,grabTimeout:100,handleChange:!0,indicatorSize:1,scrollToActiveTab:!0};var A=_},33214:function(e,n,r){r.d(n,{t:function(){return M}});var t=r(26042),o=r(69396),i=r(828),a=r(29815),s=r(85893),l=r(84808),c=r(11057),u=r(87918),d=r(98456),h=r(67720),m=r(86886),p=r(90629),v=r(51233),x=r(50135),f=r(15861),g=r(90948),b=r(61730),Z=r(45697),j=r.n(Z),y=r(9489),C=r(26936),T=r(42283),w=r(48580),I=r(6812),S=r(50319),L=r(4972),_=r(67294),q=r(74610),A=r(92321),k=r(70357),E=r(94572),P=r(32784),F=r(27593),R=r(79665),O=r(90486),U=r(33754),W=r(30381),N=r.n(W),D=r(6103),H=r(39641),Q=r(21269),M=function(e){var n=e.isEdit,r=e.scheduleId,p=e.entity,g=e.entityId,Z=e.close,j=(0,b.Z)("(max-width: 600px)"),W=(0,H.D)(),M=(0,_.useState)(void 0!==n&&n)[0],Y=(0,_.useState)(r),V=Y[0],$=Y[1],G=(0,_.useState)([]),X=G[0],J=G[1],K=(0,_.useState)(""),ee=K[0],en=K[1],er=(0,_.useState)(""),et=er[0],eo=er[1],ei=(0,_.useState)(""),ea=ei[0],es=ei[1],el=(0,_.useState)(""),ec=el[0],eu=el[1],ed=(0,_.useState)(null),eh=ed[0],em=ed[1],ep=(0,T.cI)({defaultValues:{status:"active",coverageAreas:[]},resolver:(0,R.S)(O.r)}),ev=ep.handleSubmit,ex=ep.control,ef=ep.errors,eg=ep.register,eb=ep.watch,eZ=ep.setValue,ej=ep.reset,ey=(0,T.Dq)({control:ex,name:"days"}),eC=eb("service"),eT=eb("coverageAreas"),ew=(0,I.a)(P.WC,{skip:!V,variables:{serviceScheduleId:V,includeParent:!!M},onCompleted:function(e){var n=e.serviceSchedule,r=(0,F.Ty)(n);ej((0,t.Z)({},r)),M||"Customer"!==p?M&&"Customer"===p&&J(n.parent.postcodeAreas.map(function(e){return e.postcode.area})):J(n.postcodeAreas.map(function(e){return e.postcode.area}))}}).loading,eI=(0,I.a)(L.kx,{variables:{q:""!==ee?"%".concat(ee,"%"):null,limit:50,offset:0}}),eS=eI.loading,eL=eI.data,e_=(void 0===eL?{items:[]}:eL).items,eq=(0,I.a)(L.pY,{skip:!(null==eC?void 0:eC.value),variables:(0,o.Z)((0,t.Z)({},(0,F.AL)({defaultScheduleId:r,scheduleId:V,entity:p,entityId:g,editMode:M})),{serviceId:null==eC?void 0:eC.value,q:""!==et?"%".concat(et,"%"):null,limit:50,offset:0})}),eA=eq.loading,ek=eq.data,eE=(void 0===ek?{items:[]}:ek).items,eP=(0,I.a)(L.T_,{variables:{where:{name:{_eq:""!==ea?"%".concat(ea,"%"):null},subtype:{_eq:"reactive"}},limit:50,offset:0}}),eF=eP.loading,eR=eP.data,eO=(void 0===eR?{items:[]}:eR).items,eU=(0,I.a)(L._d,{variables:{where:(0,o.Z)((0,t.Z)({},(0,F.dB)({areas:X})),{name:{_ilike:""!==ec?"%".concat(ec,"%"):null},status:{_eq:"active"},Account_Locations:{accountId:{_eq:g}}}),limit:50,offset:0},onCompleted:function(e){var n=e.items;!M&&"Customer"===p&&(null==n?void 0:n.length)&&eZ("location",(0,a.Z)(n))}}),eW=eU.loading,eN=eU.data,eD=(void 0===eN?{items:[]}:eN).items,eH=(0,i.Z)((0,S.D)(P.Sx,{refetchQueries:["GetServiceSchedules","GetServiceSchedulesForEntity"],onError:function(e){W.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){W.show({content:"Service schedule was created",severity:"success"}),Z()}}),1)[0],eQ=(0,i.Z)((0,S.D)(P.kt,{refetchQueries:["GetServiceSchedules","GetServiceSchedulesForEntity"],onError:function(e){W.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){W.show({content:"Service schedule was updated",severity:"success"}),Z()}}),1)[0],eM=function(e){if(M){var n=(0,F._L)({form:e,entity:p,entityId:g});eQ({variables:{data:(0,o.Z)((0,t.Z)({},n),{id:V})}})}else{var r=(0,F._L)({form:e,entity:p,entityId:g});eH({variables:{data:r}})}},eB=(0,_.useMemo)(function(){return M?"Edit ".concat(z[p]," schedule"):"Add ".concat(z[p]," schedule")},[M,p]);return(0,s.jsxs)("form",{onSubmit:ev(eM),children:[ew&&(0,s.jsx)(l.Z,{sx:{zIndex:1e5},open:!0,children:(0,s.jsx)(d.Z,{color:"secondary"})}),(0,s.jsx)(B,{is600pxOrLess:j,children:(0,s.jsxs)(v.Z,{height:"100%",width:"100%",children:[(0,s.jsx)(v.Z,{children:(0,s.jsx)(f.Z,{variant:"h5",fontWeight:700,children:eB})}),(0,s.jsx)(v.Z,{height:"100%",pt:2,pr:2,sx:{overflowY:"scroll"},children:(0,s.jsxs)(m.ZP,{container:!0,columnSpacing:2,children:[(0,s.jsxs)(m.ZP,{container:!0,item:!0,xs:12,md2:7,columnSpacing:2,rowSpacing:2,children:[(0,s.jsxs)(m.ZP,{item:!0,xs:12,sm2:6,children:[(0,s.jsxs)(v.Z,{spacing:2,mb:2,children:[(0,s.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,s.jsx)(f.Z,{mr:"29px",children:"Service"}),(0,s.jsx)(v.Z,{direction:"row",alignItems:"center",width:"100%",spacing:1,children:(0,s.jsx)(T.Qr,{name:"service",control:ex,render:function(e){var n,r=e.value,o=e.onChange;return(0,s.jsx)(w.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:r||null,onChange:function(e,n){(null==n?void 0:n.value)?o(n):($(null),ej((0,t.Z)({},q.FY)))},loading:eS,options:e_,setSearch:en,textFieldProps:{color:"secondary",variant:"standard",placeholder:"Service",error:ef.service,helperText:null===(n=ef.service)||void 0===n?void 0:n.message},sx:{width:"170px"}})}})})]}),(0,s.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",spacing:2,children:[(0,s.jsx)(f.Z,{children:"Schedule"}),(0,s.jsx)(T.Qr,{name:"schedule",control:ex,render:function(e){var n,r=e.value,i=e.onChange;return(0,s.jsx)(w.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:r||null,onChange:function(e,n){(null==n?void 0:n.value)?($(null==n?void 0:n.value),i(n)):($(null),ej((0,o.Z)((0,t.Z)({},q.FY),{service:eC})))},loading:eA,options:eE,setSearch:eo,textFieldProps:{color:"secondary",variant:"standard",placeholder:"Schedule",error:ef.schedule,helperText:null===(n=ef.schedule)||void 0===n?void 0:n.message},sx:{width:"200px"}})}})]}),(0,s.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,s.jsx)(f.Z,{mr:"34px",children:"Status"}),(0,s.jsx)(T.Qr,{name:"status",control:ex,render:function(e){var n,r=e.value,t=e.onChange;return(0,s.jsx)(A.P,{formControl:{fullWidth:!0,variant:"standard",color:"secondary",error:ef.status,helperText:null===(n=ef.status)||void 0===n?void 0:n.message},selectProps:{fullWidth:!0,sx:{width:"200px"}},value:r,onChange:t,options:q.hm})}})]})]}),(0,s.jsxs)(v.Z,{width:"100%",mb:2,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Priority"}),(0,s.jsx)(T.Qr,{name:"priority",control:ex,render:function(e){var n,r=e.value,t=e.onChange;return(0,s.jsx)(w.q,{multiple:!0,fullWidth:!0,disabled:"Supplier"===p||"Customer"===p||"Location"===p,color:"secondary",filterSelectedOptions:!0,loading:eF,value:r||[],onChange:function(e,n){t(n)},options:eO,setSearch:es,textFieldProps:{placeholder:"Select priority",variant:"standard",color:"secondary",error:ef.priority,helperText:null===(n=ef.priority)||void 0===n?void 0:n.message},sx:{width:"200px"}})}})]}),(0,s.jsxs)(m.ZP,{container:!0,item:!0,columnSpacing:2,rowSpacing:2,children:[(0,s.jsxs)(m.ZP,{item:!0,children:[(0,s.jsx)(f.Z,{children:"Minimum duration"}),(0,s.jsx)(T.Qr,{name:"minimumDuration",control:ex,render:function(e){var n,r=e.value,t=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(Q.Z,{sx:{height:"18px"}}),rightLabel:"Mins",sx:{width:"60px"},type:"number",value:r,onChange:t,error:ef.minimumDuration,helperText:null===(n=ef.minimumDuration)||void 0===n?void 0:n.message})}})]}),(0,s.jsxs)(m.ZP,{item:!0,children:[(0,s.jsx)(f.Z,{children:"Minimum increment"}),(0,s.jsx)(T.Qr,{name:"minimumIncrement",control:ex,render:function(e){var n,r=e.value,t=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(Q.Z,{sx:{height:"18px"}}),rightLabel:"Mins",sx:{width:"60px"},type:"number",value:r,onChange:t,error:ef.minimumIncrement,helperText:null===(n=ef.minimumIncrement)||void 0===n?void 0:n.message})}})]})]})]}),(0,s.jsxs)(m.ZP,{item:!0,xs:12,sm2:6,children:["Supplier"===p&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.B,{paginationSize:4,entity:"ServiceSchedule",entityId:V,name:"coverageAreas",values:eT||[],setValue:eZ}),(0,s.jsx)("input",(0,o.Z)((0,t.Z)({},eg("coverageAreas")),{type:"hidden"}))]}),"Customer"===p&&(0,s.jsx)(T.Qr,{name:"location",control:ex,render:function(e){var n,r=e.value,t=e.onChange;return(0,s.jsx)(w.q,{multiple:!0,fullWidth:!0,color:"secondary",filterSelectedOptions:!0,loading:eW,value:r||[],onChange:function(e,n){t(n)},options:eD,setSearch:eu,textFieldProps:{label:"Select location",variant:"standard",color:"secondary",error:ef.location,helperText:null===(n=ef.location)||void 0===n?void 0:n.message}})}})]}),(0,s.jsxs)(m.ZP,{container:!0,item:!0,xs:12,children:[(0,s.jsxs)(m.ZP,{item:!0,sx:12,height:"27px",width:"100%",pr:2,mb:1,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Rates"}),(0,s.jsx)(h.Z,{})]}),(0,s.jsxs)(m.ZP,{width:"100%",container:!0,item:!0,xs:12,columnSpacing:2,rowSpacing:2,children:[(0,s.jsx)(m.ZP,{item:!0,children:(0,s.jsxs)(v.Z,{spacing:1,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Normal"}),(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(f.Z,{children:"First hour"}),(0,s.jsx)(T.Qr,{name:"normal.firstHour",control:ex,render:function(e){var n,r,t,o=e.value,i=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(C.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:o,onChange:i,error:null===(n=ef.normal)||void 0===n?void 0:n.firstHour,helperText:null===(r=ef.normal)||void 0===r?void 0:null===(t=r.firstHour)||void 0===t?void 0:t.message})}})]}),(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(f.Z,{children:"Subsequent hours"}),(0,s.jsx)(T.Qr,{name:"normal.subsequentHours",control:ex,render:function(e){var n,r,t,o=e.value,i=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(C.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:o,onChange:i,error:null===(n=ef.normal)||void 0===n?void 0:n.subsequentHours,helperText:null===(r=ef.normal)||void 0===r?void 0:null===(t=r.subsequentHours)||void 0===t?void 0:t.message})}})]})]})}),(0,s.jsx)(m.ZP,{item:!0,children:(0,s.jsxs)(v.Z,{spacing:1,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"OOH"}),(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(f.Z,{children:"First hour"}),(0,s.jsx)(T.Qr,{name:"ooh.firstHour",control:ex,render:function(e){var n,r,t,o=e.value,i=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(C.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:o,onChange:i,error:null===(n=ef.ooh)||void 0===n?void 0:n.firstHour,helperText:null===(r=ef.ooh)||void 0===r?void 0:null===(t=r.firstHour)||void 0===t?void 0:t.message})}})]}),(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(f.Z,{children:"Subsequent hours"}),(0,s.jsx)(T.Qr,{name:"ooh.subsequentHours",control:ex,render:function(e){var n,r,t,o=e.value,i=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(C.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:o,onChange:i,error:null===(n=ef.ooh)||void 0===n?void 0:n.subsequentHours,helperText:null===(r=ef.ooh)||void 0===r?void 0:null===(t=r.subsequentHours)||void 0===t?void 0:t.message})}})]})]})}),(0,s.jsx)(m.ZP,{item:!0,children:(0,s.jsxs)(v.Z,{spacing:1,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Premium"}),(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(f.Z,{children:"First hour"}),(0,s.jsx)(T.Qr,{name:"premium.firstHour",control:ex,render:function(e){var n,r,t,o=e.value,i=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(C.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:o,onChange:i,error:null===(n=ef.premium)||void 0===n?void 0:n.firstHour,helperText:null===(r=ef.premium)||void 0===r?void 0:null===(t=r.firstHour)||void 0===t?void 0:t.message})}})]}),(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(f.Z,{children:"Subsequent hours"}),(0,s.jsx)(T.Qr,{name:"premium.subsequentHours",control:ex,render:function(e){var n,r,t,o=e.value,i=e.onChange;return(0,s.jsx)(y.I,{leftLabel:(0,s.jsx)(C.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:o,onChange:i,error:null===(n=ef.premium)||void 0===n?void 0:n.subsequentHours,helperText:null===(r=ef.premium)||void 0===r?void 0:null===(t=r.subsequentHours)||void 0===t?void 0:t.message})}})]})]})})]})]})]}),(0,s.jsx)(m.ZP,{item:!0,xs:12,md2:5,children:(0,s.jsxs)(v.Z,{spacing:1,children:[(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,mb:1,children:"Times"}),(0,s.jsx)(h.Z,{})]}),(0,s.jsxs)(v.Z,{spacing:.5,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"OOH"}),(0,s.jsx)(v.Z,{spacing:.5,children:q.jT.map(function(e){var n,r,t;return(0,s.jsx)(k.k,{control:ex,name:"oohTimes.".concat(e.value),day:e.label,error:null===(n=ef.oohTimes)||void 0===n?void 0:n[e.value],helperText:null===(r=ef.oohTimes)||void 0===r?void 0:null===(t=r[e.value])||void 0===t?void 0:t.message})})})]}),(0,s.jsxs)(v.Z,{spacing:.5,children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Premium"}),(0,s.jsx)(v.Z,{spacing:.5,children:q.jT.map(function(e){var n,r,t;return(0,s.jsx)(k.k,{control:ex,name:"premiumTimes.".concat(e.value),day:e.label,error:null===(n=ef.premiumTimes)||void 0===n?void 0:n[e.value],helperText:null===(r=ef.premiumTimes)||void 0===r?void 0:null===(t=r[e.value])||void 0===t?void 0:t.message})})})]})]})}),(0,s.jsxs)(m.ZP,{container:!0,item:!0,xs:12,mt:2,columnSpacing:2,children:[(0,s.jsx)(m.ZP,{item:!0,xs:0,md2:7}),(0,s.jsx)(m.ZP,{item:!0,xs:12,md2:5,children:(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Days"}),(0,s.jsx)(v.Z,{direction:"row",spacing:1,flexWrap:"wrap",children:ey.fields.map(function(e,n){return(0,s.jsx)(u.Z,{label:N()(e).format("YYYY-MM-DD"),size:"small",onDelete:function(){return ey.remove(n)}})})}),(0,s.jsxs)(v.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,s.jsx)(U.M,{inputFormat:"YYYY-MM-DD",placeholder:"Select days",value:eh,onChange:function(e){em(e)},renderInput:function(e){return(0,s.jsx)(x.Z,(0,o.Z)((0,t.Z)({},e),{fullWidth:!0,color:"secondary",variant:"standard"}))}}),(0,s.jsx)(c.Z,{disableMinWidth:!0,color:"secondary",variant:"contained",size:"small",onClick:function(){return ey.append(eh)},children:(0,s.jsx)(D.Z,{})})]})]})})]}),(0,s.jsx)(m.ZP,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},mt:2,children:(0,s.jsx)(f.Z,{color:"muiGray.main",children:"All job start times occurring outside times specified above will be charged based on Normal rates."})})]})}),(0,s.jsxs)(v.Z,{width:"100%",direction:"row",justifyContent:"center",spacing:2,children:[(0,s.jsx)(c.Z,{color:"danger",variant:"contained",onClick:Z,children:"Cancel"}),(0,s.jsx)(c.Z,{color:"secondary",variant:"contained",type:"submit",children:M?"Save":"Add schedule"})]})]})})]})};M.propTypes={entity:j().oneOf(["Supplier","Customer","Location"]).isRequired},M.defaultProps={};var B=(0,g.ZP)(p.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"90vw",height:n?"100vh":"90vh",padding:"16px 27px 16px 27px",borderRadius:"8px"}}),z={Supplier:"supplier",Customer:"customer",Location:"location"}},20932:function(e,n,r){r.d(n,{E:function(){return s}});var t,o=r(47568),i=r(97582),a=r(75327),s=(t=(0,o.Z)(function(e,n){var r,t,o,s=arguments;return(0,i.__generator)(this,function(t){switch(t.label){case 0:r=s.length>2&&void 0!==s[2]&&s[2],t.label=1;case 1:return t.trys.push([1,3,,4]),[4,e.query({query:a.WF,variables:{email:n}})];case 2:if((o=t.sent().data.users)&&o.length>0)return[2,!!r&&o[0]];return[2,!r||null];case 3:return t.sent(),[2,!0];case 4:return[2]}})}),function(e,n){return t.apply(this,arguments)})},24237:function(e,n,r){r.d(n,{H:function(){return z}});var t=r(26042),o=r(69396),i=r(29815),a=r(85893),s=r(67294),l=r(45697),c=r(6812),u=r(42283),d=r(79665),h=r(5616),m=r(69368),p=r(98456),v=r(94054),x=r(56815),f=r(51233),g=r(50135),b=r(15861),Z=r(76600),j=r(49501),y=r(95103),C=r(55563),T=r(90951),w=r(56361),I=r(95376),S=r(74231),L=(0,S.Ry)().shape({nameFirst:(0,S.Z_)().required(),nameLast:(0,S.Z_)().required(),email:(0,S.Z_)().required().email(),phone:(0,S.Z_)().required(),status:(0,S.Z_)().when("$hasRole",function(e){return e?(0,S.Z_)().oneOf(["active","inactive"]).required():void 0}),invoiceThreshold:(0,S.Rx)().nullable(!0).transform(function(e){return isNaN(e)?null:e}),quoteThreshold:(0,S.Rx)().nullable(!0).transform(function(e){return isNaN(e)?null:e}),role:(0,S.Z_)().when(["$hasRole","$hasOneOwner","accountId"],function(e,n,r){if(e)return n?(0,S.Z_)().oneOf(["owner"],"Each account must have a designated owner.\n          If you would like to change the account type on this user,\n          please create another user account and designate this new account as an owner."):r&&r.length>0&&(0,S.Z_)().required()}),position:(0,S.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:(0,S.Z_)()}),isContact:(0,S.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:(0,S.Z_)().oneOf(["yes","no"]).required()}),location:(0,S.IX)().when("$hasLocation",function(e){return e?(0,S.IX)().of((0,S.Rx)().integer().required()).required():void 0})}),_=r(2845),q=r(75327),A=r(20705),k=r(40656),E=r(63626),P=r(50480),F=function(e){var n=e.name,r=e.control,t=e.permissions,o=e.styles;return(0,a.jsxs)(h.Z,{sx:o,children:[(0,a.jsx)(b.Z,{variant:"h6",color:"dark.main",sx:{fontFamily:"Arial, sans-serif, sans-serif",fontWeight:"normal"},children:"Permissions"}),(0,a.jsx)(f.Z,{spacing:1,direction:"row",children:t.map(function(e){return(0,a.jsx)(u.Qr,{name:"".concat(n?n+".":"").concat(e.name),control:r,render:function(n){var r=n.value,t=n.onChange;return(0,a.jsx)(P.Z,{color:"dark.main",control:(0,a.jsx)(m.Z,{color:"secondary",checked:r,onChange:function(e){return t(e.target.checked)}}),label:e.label})}})})})]})};F.defaultProps={permissions:[]},F.propTypes={name:l.string,control:l.object.isRequired,permissions:l.object,styles:l.object};var R={customer_user:[{label:"Job reports",name:"jobReports"},{label:"PPM Schedules",name:"ppmSchedules"},{label:"Quotes",name:"quotes"},{label:"Finances",name:"finances"}]},O=r(7297),U=r(75063);function W(){var e=(0,O.Z)(["\n  query GetUserEditOffCanvas($userId: Int!, $accountId: Int, $includeAccount: Boolean!) {\n    user: User_by_pk(id: $userId) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      accounts: Account_Users(where: { accountId: { _eq: $accountId } })\n        @include(if: $includeAccount) {\n        id\n        role\n        position\n        isContact\n        status\n        modules\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n  }\n"]);return W=function(){return e},e}function N(){var e=(0,O.Z)(['\n  query FindOwnersByAccount($accountId: Int, $userId: Int) {\n    accountUsers: Account_User(\n      where: { role: { _eq: "owner" }, accountId: { _eq: $accountId }, userId: { _neq: $userId } }\n    ) {\n      id\n      role\n    }\n  }\n']);return N=function(){return e},e}var D=(0,U.Ps)(W()),H=(0,U.Ps)(N()),Q=r(15033),M=["customer_user"],B=["customer_user","tenant_user"],z=function(e){var n,r=e.userId,l=e.accountId,S=e.accountType,P=e.submit,O=(0,_.x)(),U=O.hasRole,W=O.user,N=(0,A.x)({filters:{}}),z=N.initialData,Y=N.ref,V=(0,s.useState)(!0),$=V[0],G=V[1],X=(0,s.useState)(""),J=X[0],K=X[1],ee=(0,s.useState)(null),en=ee[0],er=ee[1],et=(0,u.cI)({defaultValues:{id:r,accountId:l},resolver:(0,d.S)(L),context:{hasRole:(0,E.t4)(S,U),hasLocation:!M.includes(W.role)&&M.includes(J),hasOneOwner:$}}),eo=et.control,ei=et.errors,ea=et.handleSubmit,es=et.register,el=et.watch,ec=et.reset,eu=et.setValue,ed=el("role"),eh=el("location");(0,s.useEffect)(function(){K("".concat(S,"_").concat(ed))},[S,ed]);var em=(0,c.a)(D,{skip:!r,variables:{userId:r,accountId:l,includeAccount:!!l},onCompleted:function(e){var n,r=e.user,t={id:r.id,accountId:r.accountId,nameFirst:r.nameFirst||"",nameLast:r.nameLast||"",email:r.email||"",phone:r.phone||"",invoiceThreshold:r.invoiceThreshold,quoteThreshold:r.quoteThreshold,role:"",position:"",isContact:"",status:"active",meta:r.meta},o=null===(n=r.accounts)||void 0===n?void 0:n.find(function(e){return e.account.id===l});o&&(t.accountUserId=o.id,t.accountId=o.account.id,t.role=o.role,t.position=o.position,t.isContact=!0===o.isContact?"yes":"no",t.status=o.status,t.location=o.userLocations.map(function(e){return e.accountLocationId}),t.modules=o.modules),ec(t),K("".concat(S,"_").concat(t.role)),er(t.accountUserId)}}),ep=em.data,ev=(void 0===ep?{}:ep).user,ex=em.loading;(0,c.a)(H,{skip:!l,variables:{accountId:l,userId:r},onCompleted:function(e){G(!(e.accountUsers.length>0))}});var ef=(0,c.a)(q.ZA,{variables:(0,o.Z)((0,t.Z)({},z),{accountId:l})}),eg=ef.data,eb=void 0===eg?{location:[],meta:{aggregate:{totalCount:0}}}:eg,eZ=eb.location,ej=eb.meta,ey=ef.loading,eC=ef.refetch,eT=(0,i.Z)(I.I);switch(S){case"supplier":eT.push({text:"Operative",value:"contractor"});break;case"admin":eT.push({text:"Helpdesk",value:"helpdesk"})}var ew={control:eo,errors:ei,register:es},eI=function(e){P(e,null==ev?void 0:ev.meta)},eS=(0,s.useCallback)(function(e){return function(n){n.target.checked?eu("location",(0,i.Z)(null!=eh?eh:[]).concat([e])):eu("location",eh.filter(function(n){return n!==e}))}},[eh,eu]),eL=(0,s.useMemo)(function(){return[{sortable:!1,minWidth:10,field:"id",headerName:"",renderCell:function(e){var n=e.row;return(0,a.jsx)(m.Z,{color:"secondary",checked:null==eh?void 0:eh.includes(n.id),onChange:eS(n.id)})}},{sortable:!1,flex:1,field:"name",headerName:"Name"},{sortable:!1,flex:1,field:"address",headerName:"Address",renderCell:function(e){var n=e.row;return n.address?(0,a.jsxs)(f.Z,{children:[(0,a.jsx)(b.Z,{children:n.address.addressLine1}),(0,a.jsx)(b.Z,{children:n.address.postCode})]}):(0,a.jsx)(b.Z,{children:"Please add"})}}]},[eh,eS]);if(ex)return(0,a.jsx)(f.Z,{widht:"100%",alignItems:"center",children:(0,a.jsx)(p.Z,{color:"secondary"})});var e_={id:(0,E.t4)(S,U)};return(0,a.jsxs)(Z.Z,{id:"offCanvasForm",handleSubmit:ea(eI),children:[(0,a.jsx)(w.q,(0,t.Z)({},ew)),l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(h.Z,{children:[(0,E.t4)(S,U)&&(0,a.jsx)(v.Z,{fullWidth:!0,error:ei.role,children:(0,a.jsxs)(j.Z,{label:"Role",children:[(0,a.jsx)(y.Z,(0,o.Z)((0,t.Z)({},ew),{name:"role",options:eT})),(0,a.jsx)(x.Z,{sx:{margin:0},children:null===(n=ei.role)||void 0===n?void 0:n.message})]})}),(0,a.jsx)(j.Z,{label:"Position / Job title",children:(0,a.jsx)(C.Z,(0,o.Z)((0,t.Z)({},ew),{name:"position"}))}),(0,E.pP)({accountType:S,role:ed,hasRole:U})&&(null==ev?void 0:ev.id)!==W.id&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{label:"Threshold limit / Invoice",children:(0,a.jsx)(g.Z,{inputRef:es,inputProps:{min:0},size:"small",name:"invoiceThreshold",type:"number",sx:{width:"100%",fieldset:{border:"1px solid ".concat(k.Q.COLOUR.dark)}},InputProps:{sx:{input:{padding:"0 0.725rem",height:"2.25rem"}}}})}),(0,a.jsx)(j.Z,{label:"Threshold limit / Quote",children:(0,a.jsx)(g.Z,{inputRef:es,inputProps:{min:0},size:"small",name:"quoteThreshold",type:"number",sx:{width:"100%",fieldset:{border:"1px solid ".concat(k.Q.COLOUR.dark)}},InputProps:{sx:{input:{padding:"0 0.725rem",height:"2.25rem"}}}})})]}),(0,a.jsx)(T.Z,(0,o.Z)((0,t.Z)({},ew),{data:[{id:"yes",label:"Yes",value:"yes"},{id:"no",label:"No",value:"no"}],legend:"Contact User",name:"isContact",stacked:!0})),B.includes(J)&&r!==W.id&&(0,a.jsx)(F,{name:"modules",control:eo,permissions:R[J],styles:{mb:2}})]}),(0,a.jsx)(h.Z,{children:M.includes(J)&&r!==W.id&&(0,a.jsxs)(j.Z,{label:"Locations",children:[(0,a.jsx)(Q.i,{columnVisibilityModel:e_,columns:eL,loading:ey,meta:ej,ref:Y,refetch:eC,rows:eZ.map(function(e){var n;return{id:e.accountLocations[0].id,name:e.name,address:null===(n=e.addresses[0])||void 0===n?void 0:n.address}})}),(0,a.jsx)("input",(0,o.Z)((0,t.Z)({},es("location")),{type:"hidden"}))]})})]}),r&&(0,a.jsx)(C.Z,(0,o.Z)((0,t.Z)({},ew),{name:"id",type:"hidden"})),l&&(0,a.jsx)(C.Z,(0,o.Z)((0,t.Z)({},ew),{name:"accountId",type:"hidden"})),en&&(0,a.jsx)(C.Z,(0,o.Z)((0,t.Z)({},ew),{name:"accountUserId",type:"hidden"}))]})};z.propTypes={accountType:l.string,defaultValues:l.object,submit:l.func.isRequired}},63626:function(e,n,r){r.d(n,{pP:function(){return c},qF:function(){return s},t4:function(){return l},te:function(){return a}});var t=r(26042),o=r(29815),i=r(92148),a=function(e,n,r){var o={};return e.id?(o.id=parseInt(e.id),o.changes={nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,meta:(0,t.Z)({},n),invoiceThreshold:e.invoiceThreshold||null,quoteThreshold:e.quoteThreshold||null},e.accountUserId?(o.updateAccountUser=!0,o.accountUserId=parseInt(e.accountUserId),o.accountUserChanges={role:e.role,position:e.position,isContact:"yes"===e.isContact,status:e.status,modules:e.modules}):(o.accountUserId=0,o.updateAccountUser=!1)):(o.role=e.role||"user",o.position=e.position,o.isContact="yes"===e.isContact,o.status=e.status,o.accountId=e.accountId,o.modules=e.modules,r?o.userId=r.id:o.User={data:{nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,status:e.status,meta:{sendDefaultWelcomeEmail:!0},invoiceThreshold:e.invoiceThreshold||null,quoteThreshold:e.quoteThreshold||null}}),o},s=function(e){return{accountUserId:e.accountUserId,objects:e.location.map(function(n){return{accountUserId:e.accountUserId,accountLocationId:n}})}},l=function(e,n){return"customer"!==e&&"supplier"!==e||n((0,o.Z)(i.td).concat((0,o.Z)(i.Sf),(0,o.Z)(i.n),(0,o.Z)(i.nx)))},c=function(e){var n=e.accountType,r=e.role,t=e.hasRole;return t(["admin_owner","customer_owner","supplier_owner"])?!["admin_owner","customer_owner","supplier_owner"].includes("".concat(n,"_").concat(r)):t(["customer_manager","supplier_manager"])?["admin_user","customer_user","supplier_user"].includes("".concat(n,"_").concat(r)):!!t(["admin_manager"])&&["admin_user","customer_user","supplier_user","customer_manager","supplier_manager"].includes("".concat(n,"_").concat(r))}},1589:function(e,n,r){r.d(n,{q:function(){return R}});var t=r(47568),o=r(26042),i=r(828),a=r(29815),s=r(97582),l=r(85893),c=r(67294),u=r(45697),d=r(11163),h=r.n(d),m=r(30381),p=r.n(m),v=r(51233),x=r(90629),f=r(11057),g=r(15861),b=r(69661),Z=r(66252),j=r(6812),y=r(50319),C=r(14651),T=r(5336),w=r(15033),I=r(93884),S=r(24237),L=r(86267),_=r(75327),q=r(20705),A=r(63626),k=r(20932),E=r(2845),P=r(64872),F=r(71225),R=function(e){var n=e.accountType,r=e.filters,u=(0,Z.x)(),d=(0,q.x)({filters:r}),m=d.initialData,R=d.ref,U=(0,P.a)(),W=(0,c.useState)(null),N=W[0],D=W[1],H=(0,E.x)(),Q=H.user,M=H.hasRole,B=(0,j.a)(_.fo,{variables:m}),z=B.data,Y=void 0===z?{users:[],meta:{aggregate:{totalCount:0}}}:z,V=Y.users,$=Y.meta,G=B.loading,X=B.refetch,J=(0,i.Z)((0,y.D)(_.I4,{onCompleted:function(){U.close(),X()}}),2),K=J[0],ee=J[1].error,en=(0,i.Z)((0,y.D)(_.AX,{onCompleted:function(){U.close(),X()}}),2),er=en[0],et=en[1].error,eo=(0,i.Z)((0,y.D)(_.tW,{onCompleted:function(){X()}}),2),ei=eo[0],ea=eo[1].error;ee&&ee.graphQLErrors.forEach(function(e){var n;(null===(n=e.extensions)||void 0===n?void 0:n.code)==="constraint-violation"?D("Error: a user with this e-mail address already exists"):D("Error creating user")}),et&&et.graphQLErrors.forEach(function(e){var n;(null===(n=e.extensions)||void 0===n?void 0:n.code)==="constraint-violation"?D("Error, a user with this e-mail address already exists"):D("Error updating user")}),ea&&D("Error getting user`s locations");var es,el=function(e){return[{context:"secondary",icon:"edit",onClick:em(e),tooltip:"Edit"},{context:"secondary",icon:"avatar",onClick:eh(e),tooltip:"Avatar"}]},ec=[{headerName:"",field:"avatar",maxWidth:60,sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsx)(b.Z,{src:(0,F.Q)(n.media),sx:{marginLeft:"15px",width:"24px",height:"24px"}})}},{headerName:"Name",field:"name",minWidth:150,sortName:'{"nameFirst": "ORDER"}'},{headerName:"Email Address",field:"email",minWidth:150},{headerName:"Contact User",field:"contactUser",width:130,sortable:!1,renderCell:function(e){if(e.row.accountUser.isContact)return(0,l.jsx)(v.Z,{direction:"row",width:"100%",alignItems:"center",justifyContent:"flex-start",children:(0,l.jsx)(C.Z,{color:"error"})})}},{headerName:"Phone",field:"phone",minWidth:100,sortable:!1},{headerName:"Position",field:"position",minWidth:100,sortable:!1},{headerName:"Role",field:"role",minWidth:110,sortable:!1},{headerName:"Status",field:"status",minWidth:110,sortable:!1},{headerName:"Date Added",field:"createdAt",minWidth:130}].concat((0,a.Z)(M(["admin","customer","supplier"])?[{headerName:"Actions",field:"actions",minWidth:100,flex:1,sortable:!1,renderCell:function(e){var n=e.row;return M(["customer_user","supplier_user"])?n.id===Q.id&&(0,l.jsx)(T.C,{actionsData:el,row:n}):(0,l.jsx)(T.C,{actionsData:el,row:n})}}]:[])),eu=(0,c.useMemo)(function(){var e=[];return V.forEach(function(n){var t=null;t=r.accountId?n.accounts.find(function(e){var n;return(null===(n=e.account)||void 0===n?void 0:n.id)===parseInt(r.accountId)}):n.accounts.find(function(e){return null!==e.account});var o={id:n.id,name:"".concat(n.nameFirst," ").concat(n.nameLast),nameFirst:n.nameFirst,nameLast:n.nameLast,accountId:t&&t.account.id,type:t&&t.account.type,email:n.email,account:t?"".concat(t.account.name," (").concat(t.account.type,")"):"-",phone:n.phone,position:(null==t?void 0:t.position)?t.position:"N/A",accountUser:t,role:null==t?void 0:t.role,status:t?t.status:n.status,createdAt:p()(n.createdAt).format("YYYY-MM-DD"),media:n.media};e.push(o)}),e},[r.accountId,V]),ed=(0,c.useCallback)((es=(0,t.Z)(function(e,n){var r,t,i,a,l;return(0,s.__generator)(this,function(i){switch(i.label){case 0:return[4,(0,k.E)(u,e.email,!0)];case 1:if(r=i.sent(),t=(0,A.te)((0,o.Z)({},e),n,r),!e.id)return[3,2];return er({variables:(0,o.Z)({},t)}),e.location&&ei({variables:(0,o.Z)({},(0,A.qF)(e))}),[3,4];case 2:return[4,K({variables:{objects:t}})];case 3:l=i.sent().data.insert_Account_User.returning,e.location&&ei({variables:(0,o.Z)({},(0,A.qF)({location:e.location,accountUserId:l[0].id}))}),i.label=4;case 4:return[2]}})}),function(e,n){return es.apply(this,arguments)}),[ei,u,K,er]),eh=function(e){return function(n){n.stopPropagation(),U.show({content:(0,l.jsx)(L.G,{category:"avatar",entity:"User",entityId:e.id,limit:1,type:"image"}),submit:!1,title:"Upload avatar"})}},em=(0,c.useCallback)(function(e){return function(t){var o;t.stopPropagation(),U.show({content:(0,l.jsx)(S.H,{accountType:n,userId:null!==(o=null==e?void 0:e.id)&&void 0!==o?o:null,submit:ed,submitError:N,accountId:r.accountId}),title:e?"Edit user":"Add user"})}},[n,U,ed,N,r.accountId]),ep=function(e){h().push("/dashboard/users/view?id=".concat(e.id))},ev=(0,c.useMemo)(function(){var e={};return eu.length||(e={title:"No users",subtitleFirstLine:"You currently have users set up in the system",subtitleSecondLine:"Click\xa0create user to get started building.",buttonText:"Create user",onAction:em(null)}),e},[em,eu]);return(0,l.jsxs)(v.Z,{spacing:2,sx:O.container,children:[(0,l.jsx)(v.Z,{width:"100%",direction:"row",sx:O.header,justifyContent:"flex-end",children:(0,l.jsx)(f.Z,{variant:"contained",color:"secondary",onClick:em(null),children:"Create User"})}),(0,l.jsxs)(x.Z,{sx:O.tableContainer,children:[(0,l.jsx)(g.Z,{ml:2,variant:"h5",sx:O.title,children:"Users"}),(null==eu?void 0:eu.length)?(0,l.jsx)(w.i,{ref:R,loading:G,columns:ec,rows:eu,meta:$,refetch:X,autoHeight:!1,onRowClick:ep,containerHeight:"calc(100% - 52px)"}):!G&&(0,l.jsx)(I.C,(0,o.Z)({imageSrc:"/static/icons/no_locations_found.svg"},ev))]})]})},O={container:{width:"100%",height:"100%"},header:{margin:"1em 0",paddingRight:"1em"},tableContainer:{padding:"16px 0px",height:"calc(80vh - 22px)"},title:{fontWeight:600,marginBottom:"15px"}};R.propTypes={accountType:u.string,filters:u.object}},56361:function(e,n,r){r.d(n,{q:function(){return f}});var t=r(26042),o=r(69396),i=r(29815),a=r(85893),s=r(45697),l=r(9270),c=r(62140),u=r(49501),d=r(55563),h=r(70982),m=r(95103),p=r(21789),v=r(2845),x=r(92148),f=function(e){var n=e.errors,r=e.prefix,s=e.register,f=(0,v.x)().hasRole,g={errors:n,register:s};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(c.Z,{md:6,children:(0,a.jsx)(u.Z,{label:"First name",children:(0,a.jsx)(d.Z,(0,o.Z)((0,t.Z)({},g),{name:"".concat(r,"nameFirst")}))})}),(0,a.jsx)(c.Z,{md:6,children:(0,a.jsx)(u.Z,{label:"Last name",children:(0,a.jsx)(d.Z,(0,o.Z)((0,t.Z)({},g),{name:"".concat(r,"nameLast")}))})}),(0,a.jsx)(c.Z,{md:6,children:(0,a.jsxs)(u.Z,{label:"Email",children:[(0,a.jsx)(d.Z,(0,o.Z)((0,t.Z)({},g),{name:"".concat(r,"email"),type:"email"})),n["".concat(r,"email")]&&"duplicate"===n["".concat(r,"email")].type&&(0,a.jsx)(h.Z,{message:n["".concat(r,"email")].message})]})}),(0,a.jsx)(c.Z,{md:6,children:(0,a.jsx)(u.Z,{label:"Mobile",children:(0,a.jsx)(d.Z,(0,o.Z)((0,t.Z)({},g),{name:"".concat(r,"phone")}))})})]}),f((0,i.Z)(x.td).concat((0,i.Z)(x.Sf),(0,i.Z)(x.n),(0,i.Z)(x.nx)))&&(0,a.jsx)(u.Z,{label:"Status",children:(0,a.jsx)(m.Z,(0,o.Z)((0,t.Z)({},g),{name:"".concat(r,"status"),options:p.bg}))}),(0,a.jsx)(d.Z,(0,o.Z)((0,t.Z)({},g),{name:"".concat(r,"userId"),type:"hidden"}))]})};f.propTypes={errors:s.object.isRequired,prefix:s.string,register:s.func.isRequired},f.defaultProps={prefix:""}},20402:function(e,n,r){r.d(n,{Y:function(){return o},l:function(){return t}});var t=[{text:"Account Type",value:""},{text:"Admin",value:"admin"},{text:"Customer",value:"customer"},{text:"Supplier",value:"supplier"},{text:"Tenant",value:"tenant"}],o=function(e){return[{icon:"edit",tooltip:"Edit",to:"/dashboard/".concat(e.type,"s/").concat("supplier"===e.type?"edit":"manage","?id=").concat(e.id)}]}},95376:function(e,n,r){r.d(n,{I:function(){return t}});var t=[{text:"Select Role",value:""},{text:"Owner",value:"owner"},{text:"Manager",value:"manager"},{text:"User",value:"user"}]}}]);