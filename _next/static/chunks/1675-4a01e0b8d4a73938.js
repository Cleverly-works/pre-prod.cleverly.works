"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1675],{12872:function(n,e,t){t.d(e,{Au:function(){return f},FD:function(){return l},YW:function(){return m},dG:function(){return g},kU:function(){return p},tC:function(){return v}});var i=t(7297),o=t(75063);function r(){var n=(0,i.Z)(["\n  mutation AddComplianceEntity($objects: [Compliance_Entity_insert_input!]!) {\n    insert_Compliance_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return r=function(){return n},n}function a(){var n=(0,i.Z)(["\n  mutation UpdateComplianceEntity($id: Int!, $changes: Compliance_Entity_set_input) {\n    update_Compliance_Entity_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return a=function(){return n},n}function s(){var n=(0,i.Z)(['\n  query GetCompliancesForSelect($adminId: Int!, $type: String) {\n    compliances: Compliance(where: { adminId: { _eq: $adminId }, type: { _eq: $type } }) {\n      value: id\n      label: name\n      url\n      governingBody\n      regNumExample\n      expectCertificate\n      hasInsuranceAmount\n      type\n      questions: Taxonomies(where: { entity: { _eq: "Compliance" } }) {\n        id\n        name\n        meta\n      }\n      category: Category {\n        id\n        name\n      }\n    }\n  }\n']);return s=function(){return n},n}function u(){var n=(0,i.Z)(["\n  mutation DeleteComplianceEntity($id: Int!) {\n    delete_Compliance_Entity_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return u=function(){return n},n}function c(){var n=(0,i.Z)(['\n  query getComplianceTiles(\n    $customerId: Int\n    $locationId: Int\n    $nowNew: timestamptz\n    $now: date\n    $nextMonth: date\n    $nextWeek: timestamptz\n  ) {\n    overdue: Compliance_Entity_aggregate(\n      where: {\n        expiryAt: { _lt: $now }\n        entity: { _eq: "Location" }\n        entityId: { _eq: $locationId }\n        Location: { Account_Locations: { accountId: { _eq: $customerId } } }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    upComing: Compliance_Entity_aggregate(\n      where: {\n        _and: [{ expiryAt: { _gt: $now } }, { expiryAt: { _lt: $nextMonth } }]\n        entity: { _eq: "Location" }\n        entityId: { _eq: $locationId }\n        Location: { Account_Locations: { accountId: { _eq: $customerId } } }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n\n    jobs: Compliance_Entity(\n      where: {\n        entity: { _eq: "Job" }\n        Job: { locationId: { _eq: $locationId }, customerId: { _eq: $customerId } }\n      }\n      order_by: { Job: { timingStart: asc } }\n    ) {\n      entityId\n      job: Job {\n        amount\n        supplierId\n        scheduledAt\n        timingStart\n      }\n    }\n    openCPPM: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          status: { _neq: "closed" }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    openCPPMToday: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          status: { _neq: "closed" }\n          _and: { timingStart: { _gte: $nowNew, _lte: $nowNew } }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    openCPPMNextWeek: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          status: { _neq: "closed" }\n          _and: { timingStart: { _gte: $nowNew, _lte: $nextWeek } }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    CPPMDocOutstanding: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          JobTimings: { status: { _in: ["complianceRequestedDocumentation"] } }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    unsatisfactoryCPPM: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          JobTimings: { status: { _in: ["complianceRejected"] } }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n\n    waitingCustomerSingOff: Compliance_Entity_aggregate(\n      where: {\n        entity: { _eq: "Job" }\n        Media: { entity: { _eq: "Compliance_Entity" } }\n        Job: {\n          locationId: { _eq: $locationId }\n          customerId: { _eq: $customerId }\n          JobTimings: {\n            _and: [\n              { status: { _in: ["complianceRequestedDocumentation"] } }\n              { status: { _nin: ["complianceApproved", "complianceRejected"] } }\n            ]\n          }\n        }\n      }\n    ) {\n      aggregate {\n        count\n      }\n    }\n    CPPMSpendAmount: Job_aggregate(\n      where: {\n        Compliances: { entity: { _eq: "Job" } }\n        locationId: { _eq: $locationId }\n        customerId: { _eq: $customerId }\n      }\n    ) {\n      aggregate {\n        sum {\n          amount\n        }\n      }\n    }\n  }\n']);return c=function(){return n},n}function d(){var n=(0,i.Z)(['\n  query getCompliance_Entity($entity: String, $entityId: Int) {\n    compliances: Compliance_Entity(\n      where: { entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n      order_by: { expiryAt: asc }\n    ) {\n      id\n      createdAt\n      entity\n      entityId\n      expiryAt\n      insuranceAmount\n      regNum\n      meta\n      compliance: Compliance {\n        id\n        type\n        name\n        status\n        hasInsuranceAmount\n        questions: Taxonomies(where: { entity: { _eq: "Compliance" } }) {\n          id\n          name\n          meta\n        }\n      }\n    }\n  }\n']);return d=function(){return n},n}var l=(0,o.Ps)(r()),m=(0,o.Ps)(a()),p=(0,o.Ps)(s()),v=(0,o.Ps)(u()),g=(0,o.Ps)(c()),f=(0,o.Ps)(d())},36769:function(n,e,t){t.d(e,{p:function(){return h}});var i=t(85893),o=t(45697),r=t(6812),a=t(12872),s=t(11640),u=t(63500),c=t(73303),d=t.n(c),l=t(11587),m=t(26186),p=t(11082),v=new Date,g=(0,s.Z)(v,1),f=(0,u.Z)(v,1),x=(0,s.Z)(v,-12),h=function(n){var e,t=n.customerId,o=n.locationId,s=n.hideFinance,u=(0,r.a)(a.dG,{variables:{customerId:t,locationId:o,now:v,nowNew:v,nextMonth:g,nextWeek:f}}),c=u.loading,h=u.data,b=void 0===h?{JobSchedule:[]}:h,I=b.CPPMDocOutstanding,y=b.CPPMSpendAmount,_=b.jobs,j=b.openCPPM,Z=b.openCPPMNextWeek,C=b.openCPPMToday,$=b.overdue,S=b.unsatisfactoryCPPM,q=b.upComing,w=d()(null==_?void 0:_.filter(function(n){return new Date(n.job.timingStart)>x&&new Date(n.job.timingStart)<v}),function(n){return Number(n.job.amount)}),N=null===(e=null==_?void 0:_.find(function(n){return new Date(null==n?void 0:n.job.timingStart)>v}))||void 0===e?void 0:e.job;return!c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["Overdue: ",(0,i.jsx)("b",{children:null==$?void 0:$.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["Upcoming: ",(0,i.jsx)("b",{children:null==q?void 0:q.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["Unconfirmed: ",(0,i.jsx)("b",{children:_.filter(function(n){return!n.job.scheduledAt}).length})]}),context:"secondary",shape:"round",size:"sm"}),(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["Next Visit: ",(0,i.jsx)("b",{children:N?(0,m.Z)(null==N?void 0:N.timingStart):"-"})]}),context:"secondary",shape:"round",size:"sm"}),(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["Work Orders: ",(0,i.jsx)("b",{children:_.length})]}),context:"secondary",shape:"round",size:"sm"}),!s&&(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["Compliance Spent (12M): ",(0,i.jsx)("b",{children:(0,p.Z)(w)})]}),context:"secondary",shape:"round",size:"sm"}),(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["Open CPPMs: ",(0,i.jsx)("b",{children:null==j?void 0:j.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["CPPMs due today: ",(0,i.jsx)("b",{children:null==C?void 0:C.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["CPPMs due this week: ",(0,i.jsx)("b",{children:null==Z?void 0:Z.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["CPPM Docs Outstanding: ",(0,i.jsx)("b",{children:null==I?void 0:I.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["Unsatisfactory CPPM: ",(0,i.jsx)("b",{children:null==S?void 0:S.aggregate.count})]}),context:"secondary",shape:"round",size:"sm"}),!s&&(0,i.jsx)(l.Z,{content:(0,i.jsxs)(i.Fragment,{children:["CPPM Spend YDT: ",(0,i.jsx)("b",{children:(0,p.Z)(null==y?void 0:y.aggregate.sum.amount)})]}),context:"secondary",shape:"round",size:"sm"})]})};h.propTypes={customerId:o.number,locationId:o.number,hideFinance:o.bool}},45154:function(n,e,t){t.d(e,{c:function(){return r}});var i=t(26186),o=t(11082),r=function(n,e,t){var r=t.numberPrefix,a=void 0===r?"":r,s=t.numberSuffix,u=void 0===s?"":s,c="customer"===e,d="supplier"===e;return n.map(function(n){var e,t,r,s,l,m,p,v,g,f,x,h,b,I,y,_,j,Z,C,$=n.manager?"".concat(n.manager.nameFirst," ").concat(n.manager.nameLast):"Unassigned",S=n.scheduledAt?(0,i.Z)(n.scheduledAt,!0):n.timingStart?(0,i.Z)(n.timingStart,!0):"-",q=n.customerRebateAmount>0?n.customerVatTotal-n.customerRebateAmount-n.supplierTotal:n.customerTotal-n.supplierTotal;return d?{id:"".concat(a," ").concat(n.number," ").concat(u),type:n.type,invoiceNumber:(null===(e=n.invoices)||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.invoiceNumber)||"-",priority:(null===(r=n.sla)||void 0===r?void 0:r.name)||"-",service:(null===(s=n.service)||void 0===s?void 0:s.name)||"-",description:n.description||"-",location:(null===(l=n.location)||void 0===l?void 0:l.name)||"-",sublocation:(null===(m=n.sublocation)||void 0===m?void 0:m.name)||"-",scheduleDate:S,created:(0,i.Z)(n.createdAt),status:n.status}:c?{id:"".concat(a," ").concat(n.number," ").concat(u),type:n.type,invoiceNumber:(null===(p=n.invoices)||void 0===p?void 0:null===(v=p[0])||void 0===v?void 0:v.invoiceNumber)||"-",ref:n.reference,jobTotal:(0,o.Z)(n.customerVatTotal)||0,expensesAmountCustomer:(0,o.Z)(n.customerExpensesTotal)||0,priority:(null===(g=n.sla)||void 0===g?void 0:g.name)||"-",service:(null===(f=n.service)||void 0===f?void 0:f.name)||"-",description:n.description||"-",manager:$,location:(null===(x=n.location)||void 0===x?void 0:x.name)||"-",sublocation:(null===(h=n.sublocation)||void 0===h?void 0:h.name)||"-",scheduleDate:S,created:(0,i.Z)(n.createdAt),status:n.status}:{id:"".concat(a," ").concat(n.number," ").concat(u),type:n.type,invoiceNumber:(null===(b=n.invoices)||void 0===b?void 0:null===(I=b[0])||void 0===I?void 0:I.invoiceNumber)||"-",ref:n.reference,jobTotal:(0,o.Z)(n.customerVatTotal)||0,expensesAmountCustomer:(0,o.Z)(n.customerExpensesTotal)||0,supplierAmount:(0,o.Z)(n.supplierVatTotal)||0,expensesAmountSupplier:(0,o.Z)(n.supplierExpensesTotal)||0,revenue:(0,o.Z)(q)||0,priority:(null===(y=n.sla)||void 0===y?void 0:y.name)||"-",service:(null===(_=n.service)||void 0===_?void 0:_.name)||"-",description:n.description||"-",manager:$,location:(null===(j=n.location)||void 0===j?void 0:j.name)||"-",sublocation:(null===(Z=n.sublocation)||void 0===Z?void 0:Z.name)||"-",supplier:(null===(C=n.supplier)||void 0===C?void 0:C.name)||"-",scheduleDate:S,created:(0,i.Z)(n.createdAt),status:n.status}})}},43235:function(n,e,t){t.d(e,{r:function(){return o}});var i=t(29383),o=function(n){return(0,i.Z)(new Date(n),new Date)}},5054:function(n,e,t){t.d(e,{O:function(){return i}});var i=function(n){return n?new Date(n):new Date}},67259:function(n,e,t){t.d(e,{A:function(){return V}});var i=t(26042),o=t(69396),r=t(828),a=t(85893),s=t(67294),u=t(30381),c=t.n(u),d=t(45697),l=t(11163),m=t.n(l),p=t(57460),v=t.n(p),g=t(96486),f=t(11057),x=t(90629),h=t(51233),b=t(15861),I=t(98456),y=t(81261),_=t(63855),j=t(93884),Z=t(15033),C=t(75759),$=t(5336),S=t(45416),q=t(6812),w=t(73359),N=t(7297),A=t(75063);function F(){var n=(0,N.Z)(['\n  query GetFinancialJob(\n    $adminId: Int\n    $customerId: Int\n    $endDate: timestamptz\n    $startDate: timestamptz\n    $limit: Int\n    $status: [String]\n    $managerId: Int\n    $locationId: Int\n    $offset: Int\n    $supplierId: Int\n    $q: String\n    $orderBy: Job_order_by!\n    $sublocationId: Int\n    $userId: Int\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n        sublocationId: { _eq: $sublocationId }\n        _or: [{ customerUserId: { _eq: $userId } }, { supplierUserId: { _eq: $userId } }]\n        ','\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      type\n      number\n      status\n      description\n      reference\n      timingStart\n      scheduledAt\n      createdAt\n      customerTotal: customerFinances(path: "amountInfo.total")\n      supplierTotal: supplierFinances(path: "amountInfo.total")\n      customerVatTotal: customerFinances(path: "amountInfo.vatTotal")\n      supplierVatTotal: supplierFinances(path: "amountInfo.vatTotal")\n      customerExpensesTotal: customerFinances(path: "expensesInfo.expensesTotal")\n      supplierExpensesTotal: supplierFinances(path: "expensesInfo.expensesTotal")\n      customerRebateAmount: customerFinances(path: "rebate.amount")\n      slaId\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        invoiceNumber\n        outstandingAmounts: AccountEntry {\n          amount: outstandingAmount\n        }\n      }\n      customer: Customer {\n        id\n        name\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      sla: SLA {\n        name\n      }\n      manager: Manager {\n        fullName\n        nameLast\n        nameFirst\n        id\n      }\n      service: Service {\n        id\n        name\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n        sublocationId: { _eq: $sublocationId }\n        _or: [{ customerUserId: { _eq: $userId } }, { supplierUserId: { _eq: $userId } }]\n        ',"\n\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return F=function(){return n},n}var P=function(n){var e=n.tagsWhere,t=void 0===e?"":e;return(0,A.Ps)(F(),t,t)},T=t(9492),D=t(50459),k=t(45154),M=t(2845),E=t(18586),W=t(63139),R=t(20705),J=t(12547),L=t(48381),O=t(66137),V=function(n){var e,t,u,d,p,N,A=n.initialFilters,F=n.entityRelationToFetch,V=n.filtersVisibilityModel,B=n.columnVisibilityModel,U=(0,M.x)(),Q=U.user,Y=U.hasRole,G=(0,E.q)(),H=null===(e=G.admin.jobSetting)||void 0===e?void 0:e.jobNumberPrefix,K=null===(t=G.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,X=(0,l.useRouter)().pathname,nn=(0,s.useState)(!1),ne=nn[0],nt=nn[1],ni=(0,s.useState)((0,i.Z)({},A)),no=ni[0],nr=ni[1],na=(0,W.s)(),ns=(0,R.x)({filters:no}),nu=ns.initialData,nc=ns.ref,nd=(0,q.a)(P({tagsWhere:(0,O.Y)(nu.tags)}),{variables:(0,o.Z)((0,i.Z)({},nu,F),{number:nu.id?String(nu.id):null,startDate:nu.startDate,endDate:nu.endDate,adminId:Q.adminId})}),nl=nd.data,nm=void 0===nl?{jobs:[],meta:{aggregate:{totalCount:0}}}:nl,np=nm.jobs,nv=nm.meta,ng=nd.loading,nf=nd.refetch,nx=nu.customerId,nh=nu.endDate,nb=nu.locationId,nI=nu.orderBy,ny=nu.startDate,n_=nu.status,nj=nu.supplierId,nZ=(0,r.Z)((0,w.t)(P({tagsWhere:(0,O.Y)(nu.tags)}),{variables:{adminId:Q.adminId,customerId:nx,endDate:nh,locationId:nb,orderBy:nI,startDate:ny,status:n_,supplierId:nj},onCompleted:function(n){var e,t=(0,k.c)(n.jobs,Q.accountType,{numberPrefix:H,numberSuffix:K}),i=(null===(e=n.jobs[0])||void 0===e?void 0:e.id)||"New-report",o=v().unparse(t),r="data:application/octet-stream,"+encodeURIComponent(o);(0,T.S)(r,"".concat(i,"-work-orders.csv"))}}),2),nC=nZ[0],n$=nZ[1].loading,nS=function(n){m().push("".concat("/dashboard/issues/","manage?id=").concat(n.number))},nq=function(n){m().push("/dashboard/issues/view?id=".concat(n.number))},nw=function(n){return c()(n).format("YYYY-MM-DD")},nN=function(n){var e=[{context:"secondary",icon:"info",onClick:function(e){return nq(n)},tooltip:"Info"}];return Y("admin")&&e.unshift({context:"secondary",icon:"edit",onClick:function(e){return nS(n)},tooltip:"Edit"}),e},nA=[{headerName:"Job ID",field:"jobId",sortable:!1,flex:1,minWidth:100,renderCell:function(n){var e=n.row;return(0,a.jsx)(S.D,{id:e.id,number:e.number,openCanvas:!0,type:e.type,numberPrefix:H,numberSuffix:K})}},{headerName:"Invoice number",field:"invoiceNumber",sortable:!1,flex:1,minWidth:100},{headerName:"Reference",field:"ref",sortable:!1,flex:1,minWidth:100},{minWidth:300,field:"tags",headerName:"Tags",sortable:!1,renderCell:function(n){var e=n.row;return(0,a.jsx)(L.K,{row:e,refetchQueries:["GetFinancialJob"],entity:"Job"})}},{headerName:"Service",field:"service",sortName:'{"Service": {"name": "ORDER"}}',flex:1,minWidth:100},{headerName:"Priority",field:"priority",sortName:'{"SLA": {"name": "ORDER"}}',flex:1,minWidth:100},{headerName:"Customer",field:"customer",minWidth:200,flex:1,renderCell:function(n){var e,t,i=n.row;return(0,a.jsx)(J.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(null===(e=i.customer)||void 0===e?void 0:e.id),noWrap:!i.customer,children:(null===(t=i.customer)||void 0===t?void 0:t.name)||"-"})}},{headerName:"Location",field:"location",minWidth:300,flex:1,renderCell:function(n){var e,t,i=n.row;return(0,a.jsx)(J.r,{color:"secondary",href:"/dashboard/properties/view?id=".concat(null===(e=i.location)||void 0===e?void 0:e.id),noWrap:!i.location||Y(["supplier","tenant"]),children:(null===(t=i.location)||void 0===t?void 0:t.name)||"-"})}},{headerName:"Customer (NET)",field:"customerNet",minWidth:150,sortable:!1,flex:1,valueFormatter:function(n){var e=n.value;return"\xa3".concat((u=+e).toFixed(2))}},{headerName:"Amount Outstanding",field:"amountOutstanding",sortable:!1,minWidth:150,flex:1,valueFormatter:function(n){var e=n.value;return"\xa3".concat((d=+e).toFixed(2))}},{headerName:"Supplier (NET)",field:"supplierNet",minWidth:150,sortable:!1,flex:1,valueFormatter:function(n){var e=n.value;return"\xa3".concat((p=+e).toFixed(2))}},{headerName:Y("admin")?"Net Revenue":"Revenue",field:"revenue",minWidth:150,sortable:!1,flex:1,valueFormatter:function(n){var e=n.value;return"\xa3".concat((N=+e).toFixed(2))}},{headerName:"Scheduled",field:"scheduleDate",minWidth:130,flex:1},{headerName:"Created",field:"date",flex:1,minWidth:100},{headerName:"Supplier",field:"supplier",sortName:'{"Supplier": {"name": "ORDER"}}',flex:1,minWidth:140,renderCell:function(n){var e,t,i=n.row;return(0,a.jsx)(J.r,{color:"secondary",noWrap:!Y("admin")||!i.supplier,href:"/dashboard/suppliers/view?id=".concat(null===(e=i.supplier)||void 0===e?void 0:e.id),children:(null===(t=i.supplier)||void 0===t?void 0:t.name)||""})}},{headerName:"Status",field:"status",flex:1,minWidth:100,renderCell:function(n){var e=n.row;return(0,a.jsx)(C.B,{value:e.status})}},{headerName:"Actions",field:"actions",sortable:!1,minWidth:130,flex:1,renderCell:function(n){var e=n.row;return(0,a.jsx)($.C,{actionsData:nN,row:e})}}],nF=(0,s.useMemo)(function(){return null==np?void 0:np.map(function(n){var e,t,i,o,r,a=n.scheduledAt?nw(n.scheduledAt,!0):n.timingStart?nw(n.timingStart,!0):"-",s=n.customerRebateAmount>0?n.customerVatTotal-n.customerRebateAmount-n.supplierTotal:n.customerTotal-n.supplierTotal;return{id:n.id,jobId:"J ".concat(n.number," "),type:n.type,number:n.number,invoiceNumber:(null===(e=n.invoices)||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.invoiceNumber)||"-",amountOutstanding:null==n?void 0:null===(i=n.invoices)||void 0===i?void 0:i.reduce(function(n,e){var t;return n+((null==e?void 0:null===(t=e.outstandingAmounts)||void 0===t?void 0:t.amount)||0)},0),ref:n.reference||"-",description:n.description||"-",service:(null===(o=n.service)||void 0===o?void 0:o.name)||"-",priority:(null===(r=n.sla)||void 0===r?void 0:r.name)||"-",location:n.location,customerNet:null==n?void 0:n.customerTotal,supplierNet:null==n?void 0:n.supplierTotal,supplier:null==n?void 0:n.supplier,tags:n.tags,revenue:s||0,scheduleDate:a,customer:null==n?void 0:n.customer,date:nw(n.createdAt),status:n.status}})},[np]),nP=(0,s.useCallback)(function(n){n.stopPropagation();var e=(0,D.Uu)(no);m().push("/dashboard/issues/manage".concat(e))},[no]),nT=(0,s.useMemo)(function(){var n={};return nF.length||g.isEqual(no,A)?{title:"No work orders",subtitleFirstLine:"You currently have no work orders set up in the system",subtitleSecondLine:"Click create work orders to get started building.",buttonText:"Create work orders",onAction:nP}:{title:"No results",subtitleFirstLine:"The filters you have applied have returned no results",subtitleSecondLine:"Please amend and try again if necessary."}},[no,nP,A,nF]),nD=(0,i.Z)({ref:Y(["admin","customer"]),service:Y(["admin","customer"]),customerNet:Y(["admin","customer"]),amountOutstanding:Y(["admin","customer"]),supplierNet:Y(["admin","supplier"]),revenue:Y("admin"),supplier:Y("admin"),tags:Y("admin"),customer:X.includes("suppliers")&&Y("admin")},B);return(0,a.jsxs)(a.Fragment,{children:[ne&&(0,a.jsx)(_.h,{initialFilters:A,open:ne,setFilters:nr,setOpen:nt,filtersVisibilityModel:V}),(0,a.jsxs)(h.Z,{spacing:2,sx:z.header,children:[(0,a.jsxs)(h.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,a.jsx)(f.Z,{variant:"contained",startIcon:(0,a.jsx)(y.Z,{}),onClick:function(){return nt(!0)},children:"Filters"}),(0,a.jsxs)(h.Z,{direction:"row",spacing:2,children:[!Y(["supplier","tenant"])&&(0,a.jsx)(f.Z,{variant:"contained",color:"secondary",onClick:nP,children:"Create Work Order"}),!na&&(0,a.jsx)(f.Z,{startIcon:!n$&&(0,a.jsx)("img",{src:"/static/icons/csv.svg"}),disabled:n$,variant:"contained",color:"success",onClick:function(n){n.stopPropagation(),nC()},children:n$?(0,a.jsx)(I.Z,{size:20,color:"secondary"}):"Export"})]})]}),(0,a.jsxs)(x.Z,{sx:z.tableContainer,children:[(0,a.jsx)(b.Z,{ml:2,variant:"h5",sx:z.title,children:"Work Orders"}),(null==nF?void 0:nF.length)?(0,a.jsx)(Z.i,{ref:nc,loading:ng,columns:nA,rows:nF,columnVisibilityModel:nD,meta:nv,refetch:nf,autoHeight:!1,onRowClick:nq,containerHeight:"calc(100% - 52px)"}):!ng&&(0,a.jsx)(j.C,(0,i.Z)({imageSrc:"/static/icons/no_locations_found.svg"},nT))]})]})]})},z={header:{width:"100%",height:"100%"},tableContainer:{padding:"16px 0px",height:"calc(80vh - 22px)"},title:{fontWeight:600,marginBottom:"15px"}};V.propTypes={filters:d.object},V.defaultProps={filters:{assetId:null,managerId:null},columnVisibilityModel:{}}},63855:function(n,e,t){t.d(e,{h:function(){return T}});var i=t(26042),o=t(69396),r=t(828),a=t(29815),s=t(85893),u=t(67294),c=t(11057),d=t(69368),l=t(50480),m=t(11994),p=t(90629),v=t(51233),g=t(50135),f=t(5616),x=t(61730),h=t(45697),b=t.n(h),I=t(73359),y=t(6812),_=t(59938),j=t(42283),Z=t(50459),C=t(92148),$=t(2845),S=t(4972),q=t(10166),w=t(78232),N=t(33754),A=t(11163),F=t(57179),P=t(48580),T=function(n){var e=n.open,t=n.setOpen,m=n.initialFilters,p=(n.filters,n.setFilters),h=n.filtersVisibilityModel,b=void 0===h?{}:h,q=(0,$.x)(),N=q.hasRole,T=q.user,W=(0,A.useRouter)().query,R=(0,x.Z)("(max-width: 400px)"),J=(0,r.Z)((0,_.X)("form_data_issues_".concat(m.filterType),m),2),L=J[0],O=J[1],V=(0,j.cI)({defaultValues:L}),z=V.control,B=V.handleSubmit,U=V.register,Q=V.reset,Y=V.watch,G=V.getValues,H=Y("locationId"),K=(0,u.useState)(""),X=K[0],nn=K[1],ne=(0,r.Z)((0,I.t)(S.yR,{fetchPolicy:"network-only",variables:{accountId:T.accountId}}),2),nt=ne[0],ni=ne[1],no=ni.loading,nr=ni.data,na=(void 0===nr?{items:[]}:nr).items,ns=(0,r.Z)((0,I.t)(S.SW),2),nu=ns[0],nc=ns[1],nd=nc.loading,nl=nc.data,nm=(void 0===nl?{items:[]}:nl).items,np=(0,r.Z)((0,I.t)(S._d,{variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:m.customerId}}}}}),2),nv=np[0],ng=np[1],nf=ng.loading,nx=ng.data,nh=(void 0===nx?{items:[]}:nx).items,nb=(0,r.Z)((0,I.t)(S.zR,{variables:{locationId:null==H?void 0:H.value}}),2),nI=nb[0],ny=nb[1],n_=ny.loading,nj=ny.data,nZ=(void 0===nj?{items:[]}:nj).items,nC=(0,r.Z)((0,I.t)(S.by,{variables:{where:{type:{_eq:"supplier"}}}}),2),n$=nC[0],nS=nC[1],nq=nS.loading,nw=nS.data,nN=(void 0===nw?{items:[]}:nw).items,nA=(0,y.a)(S.K4,{variables:{accountId:T.accountId,limit:50,offset:0,q:""!==X?"%".concat(X,"%"):null}}),nF=nA.data,nP=(void 0===nF?{items:[]}:nF).items,nT=nA.loading,nD=function(n){try{var e,o,r,a,s,u,c,d,l,v={customerId:null===(e=n.customerId)||void 0===e?void 0:e.value,endDate:null==n?void 0:n.endDate,locationId:null===(o=n.locationId)||void 0===o?void 0:o.value,sublocationId:null===(r=n.sublocationId)||void 0===r?void 0:r.value,managerId:n.managerId?T.id:null,tags:null===(a=n.tags)||void 0===a?void 0:a.map(function(n){return n.value}),startDate:null==n?void 0:n.startDate,status:null===(s=n.status)||void 0===s?void 0:s.map(function(n){return n.value}),supplierId:null===(u=n.supplierId)||void 0===u?void 0:u.value,userId:null===(c=n.userId)||void 0===c?void 0:c.value,customerManagerId:null===(d=n.customerManager)||void 0===d?void 0:d.value},g=null==n?void 0:n.q;if(g){v.q="%".concat(g,"%")||0;var f=/^\d+$/.test(g);"id"in m&&(v.id=f?Number(g):null),"meta"in m&&(v.meta=f?{invoiceNumbers:[g]}:null),"jobNumber"in m&&(v.jobNumber=f?String(g):null,v.invoiceNumber=f?Number(g):null)}(null===(l=v.status)||void 0===l?void 0:l.length)&&(v.isChangedStatusSelect=!0),p(function(n){return(0,i.Z)({},n,v)});var x=G();O(function(n){return(0,i.Z)({},n,x)})}finally{t(!1)}},nk=function(){p(m),Q(m),sessionStorage.removeItem("form_data_issues_".concat(m.filterType)),t(!1)},nM=function(n){var e=!0;return n in b&&!b[n]&&(e=!1),e};return(0,s.jsx)(k,{keepMounted:!0,open:e,onClose:function(){return t(!1)},sx:D.modal,children:(0,s.jsx)("form",{onSubmit:B(nD),children:(0,s.jsx)(M,{children:(0,s.jsxs)(v.Z,{direction:"row",flexWrap:"wrap",justifyContent:"center",children:[(0,s.jsx)(g.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search...",name:"q",inputRef:U}),nM("status")&&(0,s.jsx)(f.Z,{sx:D.inputContainer(R),children:(0,s.jsx)(j.Qr,{name:"status",control:z,render:function(n){var e=n.value,t=n.onChange;return(0,s.jsx)(w.F,{value:e||[],onChange:function(n,e){return t(e)},multiple:!0,limitTags:1,label:"Select status",options:(0,Z.lR)(W.show)})}})}),N(["supplier"].concat((0,a.Z)(C.n)))&&nM("user")&&(0,s.jsx)(f.Z,{sx:D.inputContainer(R),children:(0,s.jsx)(j.Qr,{name:"userId",control:z,render:function(n){var e=n.value,t=n.onChange;return(0,s.jsx)(w.F,{value:e,onChange:function(n,e){return t(e)},label:"Select user",loading:no,onOpen:function(){return nt()},options:na})}})}),N("admin")&&nM("tags")&&(0,s.jsx)(f.Z,{sx:D.inputContainer(R),children:(0,s.jsx)(F.r,{control:z})}),!m.customerId&&N("admin")&&nM("customer")&&(0,s.jsx)(f.Z,{sx:D.inputContainer(R),children:(0,s.jsx)(j.Qr,{name:"customerId",control:z,render:function(n){var e=n.value,t=n.onChange;return(0,s.jsx)(w.F,{value:e,onChange:function(n,e){return t(e)},label:"Select customer",loading:nd,onOpen:function(){return nu()},options:nm})}})}),N(["admin","customer"])&&nM("location")&&(0,s.jsx)(f.Z,{sx:D.inputContainer(R),children:(0,s.jsx)(j.Qr,{name:"locationId",control:z,render:function(n){var e=n.value,t=n.onChange;return(0,s.jsx)(w.F,{value:e,onChange:function(n,e){return t(e)},label:"Select location",loading:nf,onOpen:function(){return nv()},options:nh})}})}),N("admin")&&nM("supplier")&&(0,s.jsx)(f.Z,{sx:D.inputContainer(R),children:(0,s.jsx)(j.Qr,{name:"supplierId",control:z,render:function(n){var e=n.value,t=n.onChange;return(0,s.jsx)(w.F,{value:e,onChange:function(n,e){return t(e)},label:"Select supplier",loading:nq,onOpen:function(){return n$()},options:nN})}})}),H&&N("admin")&&nM("sublocation")&&(0,s.jsx)(f.Z,{sx:D.inputContainer(R),children:(0,s.jsx)(j.Qr,{name:"sublocationId",control:z,render:function(n){var e=n.value,t=n.onChange;return(0,s.jsx)(w.F,{value:e,onChange:function(n,e){return t(e)},label:"Select sublocation",loading:n_,onOpen:function(){return nI()},options:nZ})}})}),(0,s.jsx)(f.Z,{sx:D.inputContainer(R),children:(0,s.jsx)(j.Qr,{name:"startDate",control:z,render:function(n){return(0,s.jsx)(E,(0,o.Z)((0,i.Z)({},n),{label:"Start date",renderInput:function(n){return(0,s.jsx)(g.Z,(0,o.Z)((0,i.Z)({},n),{variant:"standard"}))}}))}})}),(0,s.jsx)(f.Z,{sx:D.inputContainer(R),children:(0,s.jsx)(j.Qr,{name:"endDate",control:z,render:function(n){return(0,s.jsx)(E,(0,o.Z)((0,i.Z)({},n),{label:"End date",renderInput:function(n){return(0,s.jsx)(g.Z,(0,o.Z)((0,i.Z)({},n),{variant:"standard"}))}}))}})}),N((0,a.Z)(C.SA))&&nM("accountManager")&&(0,s.jsx)(f.Z,{sx:D.inputContainer(R),children:(0,s.jsx)(j.Qr,{name:"customerManager",control:z,render:function(n){var e=n.value,t=n.onChange;return(0,s.jsx)(P.q,{value:e,onChange:function(n,e){return t(e)},loading:nT,options:nP,setSearch:nn,textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}})}})}),!m.noAssignToMeFilter&&N((0,a.Z)(C.SA).concat((0,a.Z)(C.n),(0,a.Z)(C.nx)))&&nM("accountManager")&&(0,s.jsx)(f.Z,{sx:D.singleFilter(R),children:(0,s.jsx)(j.Qr,{name:"managerId",control:z,render:function(n){var e=n.value,t=n.onChange;return(0,s.jsx)(l.Z,{control:(0,s.jsx)(d.Z,{color:"secondary",checked:e,onChange:function(n){return t(n.target.checked)}}),label:"Assigned to me"})}})}),(0,s.jsxs)(v.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,sx:D.bottomButtons,children:[(0,s.jsx)(c.Z,{variant:"contained",color:"danger",onClick:function(){return nk()},children:"Cancel"}),(0,s.jsx)(c.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})})},D={modal:{width:"40%"},inputContainer:function(n){return(0,i.Z)({width:n?"100%":"50%"},n?{padding:"10px 0px"}:{padding:"10px"})},singleFilter:function(n){return(0,i.Z)({width:"100%"},n?{padding:"10px 0px"}:{padding:"10px"})},checkboxContainer:function(n){return(0,i.Z)({width:"100%"},n?{padding:"10px 0px"}:{padding:"10px"})},bottomButtons:{marginTop:"20px"}};T.defaultProps={open:!1,setOpen:function(){},initialFilters:{},filters:{},setFilters:function(){},filtersVisibilityModel:{}},T.propTypes={open:b().bool,setOpen:b().func,initialFilters:b().object,filters:b().object,setFilters:b().func,filtersVisibilityModel:b().object};var k=(0,q.Z)(m.Z)(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}}),M=(0,q.Z)(p.Z)(function(){return{padding:"24px",maxWidth:"700px",maxHeight:"100vh",overflowY:"scroll"}}),E=(0,q.Z)(N.M)(function(){return{"&.MuiFormControl-root.MuiTextField-root":{width:"100%"}}})},30430:function(n,e,t){t.d(e,{Bo:function(){return x},CV:function(){return v},FT:function(){return I},JB:function(){return f},iU:function(){return g},kW:function(){return h}});var i=t(7297),o=t(85893),r=t(10367),a=t(11587),s=t(51466),u=t(26186),c=t(43235),d=t(5054);function l(){var n=(0,i.Z)(["\n  margin: 0;\n"]);return l=function(){return n},n}function m(){var n=(0,i.Z)(["\n  align-items: center;\n  display: flex;\n"]);return m=function(){return n},n}function p(){var n=(0,i.Z)(["\n  flex-direction: column;\n  margin-left: 1rem;\n"]);return p=function(){return n},n}var v=function(n){var e=(0,d.O)();return parseInt(n.filter(function(n){return(0,d.O)(n.expiryAt)>=e}).length/n.length*100)},g=function(n){if(!n||0===n.length)return null;var e=(0,d.O)();return parseInt(n.filter(function(n){return(0,d.O)(n.expiryAt)>=e}).length/n.length*100)||null};(0,r.ZP)(a.Z).withConfig({displayName:"helper__StyledBadge",componentId:"sc-ee567c94-0"})(l()),r.ZP.div.withConfig({displayName:"helper__Wrapper",componentId:"sc-ee567c94-1"})(m()),r.ZP.div.withConfig({displayName:"helper__Next",componentId:"sc-ee567c94-2"})(p());var f=function(n){return n.filter(function(n){return 0>(0,c.r)(n.expiryAt)}).length},x=function(n){if(!n||0===n.length||!n.nodes||n.nodes&&(null===(e=n.nodes)||void 0===e?void 0:e.length)===0)return{content:"No locations",context:"secondary"};var e,t=[];(n.nodes||n).forEach(function(n){var e,i;((null===(e=n.location)||void 0===e?void 0:e.compliance)||n.compliances)&&t.push(v((null===(i=n.location)||void 0===i?void 0:i.compliance)||n.compliances))});var i=Math.round(t.reduce(function(n,e){return isNaN(e)&&(e=0),n+e},0)/t.length);return{content:"Score: ".concat(i||0," %"),context:h(i)}},h=function(n){return n>79?"success":n>49?"info":"danger"},b=function(n){var e=(0,c.r)(n);return e>14?"success":e>=0?"info":"danger"},I=function(n){var e=n.row;if(e.expiryAt)return(0,o.jsx)(s.Z,{content:(0,u.Z)(e.expiryAt),context:b(e.expiryAt),size:"sm"})}},93884:function(n,e,t){t.d(e,{C:function(){return p}});var i=t(26042),o=t(69396),r=t(85893);t(67294);var a=t(45697),s=t(90948),u=t(15861),c=t(51233),d=t(11057),l=t(61730),m=(0,s.ZP)("img")({width:"300px",height:"250px"}),p=function(n){var e=n.imageSrc,t=n.sx,a=n.imageSx,s=n.title,p=n.titleSx,v=n.subtitleFirstLine,g=n.subtitleFirstLineSx,f=n.subtitleSecondLine,x=n.subtitleSecondLineSx,h=n.buttonText,b=n.onAction,I=(0,l.Z)("(max-width: 400px)");return(0,r.jsxs)(c.Z,{sx:(0,o.Z)((0,i.Z)({},t),{width:"100%",height:"100%"}),justifyContent:"center",alignItems:"center",spacing:2,color:"#757575",children:[(0,r.jsx)(m,{src:e,sx:(0,o.Z)((0,i.Z)({},a),{width:I?"250px":"300px"})}),(0,r.jsx)(u.Z,{typography:"h5",sx:(0,i.Z)({},p),children:s}),(0,r.jsxs)(c.Z,{alignItems:"center",sx:{padding:"0px 10px",textAlign:"center"},children:[(0,r.jsx)(u.Z,{sx:(0,i.Z)({},g),children:v}),(0,r.jsx)(u.Z,{sx:(0,i.Z)({},x),children:f})]}),h&&b&&(0,r.jsx)(d.Z,{variant:"contained",color:"secondary",onClick:b,children:h})]})};p.propTypes={imageSrc:a.string,title:a.string,subtitleFirstLine:a.string,subtitleSecondLine:a.string,onAction:a.func,sx:a.object,imageSx:a.object,titleSx:a.object,subtitleFirstLineSx:a.object,subtitleSecondLineSx:a.object},p.defaultProps={title:"",subtitleFirstLine:"",subtitleSecondLine:"",sx:{},imageSx:{},titleSx:{},subtitleFirstLineSx:{},subtitleSecondLineSx:{},onAction:null}},30016:function(n,e,t){t.d(e,{E:function(){return O}});var i=t(47568),o=t(26042),r=t(828),a=t(97582),s=t(85893),u=t(67294),c=t(45697),d=t(6812),l=t(50319),m=t(7297),p=t(75063);function v(){var n=(0,m.Z)(["\n  query GetNote($entityId: Int!) {\n    note: Note(where: { entityId: { _eq: $entityId } }, order_by: { createdAt: desc }) {\n      accountId\n      comments\n      createdAt\n      id\n      userId\n      user: User {\n        nameFirst\n        nameLast\n      }\n    }\n  }\n"]);return v=function(){return n},n}function g(){var n=(0,m.Z)(["\n  mutation AddNote(\n    $accountId: Int\n    $comments: String\n    $entity: String\n    $entityId: Int\n    $userId: Int\n  ) {\n    insert_Note(\n      objects: {\n        accountId: $accountId\n        comments: $comments\n        entity: $entity\n        entityId: $entityId\n        userId: $userId\n      }\n    ) {\n      returning {\n        id\n        comments\n      }\n    }\n  }\n"]);return g=function(){return n},n}function f(){var n=(0,m.Z)(["\n  mutation UpdateNote($id: Int!, $change: Note_set_input) {\n    update_Note_by_pk(pk_columns: { id: $id }, _set: $change) {\n      id\n      comments\n    }\n  }\n"]);return f=function(){return n},n}var x=(0,p.Ps)(v()),h=(0,p.Ps)(g()),b=(0,p.Ps)(f()),I=t(78289),y=t(16551),_=t(77439),j=t(11585),Z=t(86036),C=t(69396),$=t(42283),S=t(79665),q=t(76600),w=t(9270),N=t(62140),A=t(49501),F=t(6710),P=t(55563),T=t(74231),D=(0,T.Ry)().shape({comments:(0,T.Z_)().required()}),k=function(n){var e=n.defaultValues,t=n.onSubmit,i=(0,$.cI)({defaultValues:(0,o.Z)({},e),resolver:(0,S.S)(D)}),r=i.control,a=i.errors,u=i.handleSubmit,c={control:r,errors:a,register:i.register};return(0,s.jsxs)(q.Z,{id:"offCanvasForm",handleSubmit:u(t),children:[(0,s.jsx)(w.Z,{children:(0,s.jsx)(N.Z,{md:12,children:(0,s.jsx)(A.Z,{label:"Title",children:(0,s.jsx)(F.Z,(0,C.Z)((0,o.Z)({},c),{name:"comments",rows:4}))})})}),e.id&&(0,s.jsx)(P.Z,(0,C.Z)((0,o.Z)({},c),{name:"id",type:"hidden"}))]})};k.propTypes={defaultValues:c.object,onSubmit:c.func.isRequired};var M=t(68956),E=t(26186),W=t(55843),R=t(16540),J=function(n){var e=n.note,t=n.loading,i=n.handleClick,o=n.userId,r=[{hidden:!0},{hidden:!0},{text:"Title"},{text:"By"},{text:"Created"},{formatter:M.Z,formatterData:function(n){return[{context:"secondary",disabled:o!==n.userId,icon:["fas","edit"],onClick:function(n,e){return i(n,e)},tooltip:"Edit"}]},text:"Actions"}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(W.Z,{marginBottom:"xs"}),(0,s.jsx)(R.Z,{columns:r,loading:t,rows:e.map(function(n){var e,t;return{id:n.id,userId:n.userId,comments:n.comments,user:"".concat(null===(e=n.user)||void 0===e?void 0:e.nameFirst," ").concat(null===(t=n.user)||void 0===t?void 0:t.nameLast),date:(0,E.Z)(n.createdAt),actions:""}})})]})};J.propTypes={userId:c.number.isRequired,note:c.array.isRequired,loading:c.bool.isRequired,handleClick:c.func.isRequired},J.defaultProps={note:[]};var L=t(2845),O=function(n){var e,t=n.entity,c=n.entityId,m=(n.open,n.title),p=n.single,v=(0,u.useContext)(I.Z),g=(0,L.x)().user,f=(0,d.a)(x,{variables:{entity:t,entityId:c}}),C=f.loading,$=f.data,S=(void 0===$?{note:[]}:$).note,q=f.refetch,w=(0,r.Z)((0,l.D)(h,{onCompleted:function(){v.close(),q()}}),1)[0],N=(0,r.Z)((0,l.D)(b,{onCompleted:function(){v.close(),q()}}),1)[0],A=(e=(0,i.Z)(function(n){return(0,a.__generator)(this,function(e){switch(e.label){case 0:if(!n.id)return[3,2];return[4,N({variables:{id:n.id,change:n}})];case 1:return e.sent(),[3,4];case 2:return n.accountId=g.accountId,n.entity=t,n.entityId=c,n.userId=g.id,[4,w({variables:n})];case 3:e.sent(),e.label=4;case 4:return[2]}})}),function(n){return e.apply(this,arguments)}),F=function(n,e){n.preventDefault(),n.stopPropagation();var t=(0,o.Z)({},e);v.show({content:(0,s.jsx)(k,{defaultValues:t,onCancel:P,onSubmit:A}),title:e?"Edit note":"Add note"})},P=function(){v.close()},T=function(){return(0,s.jsx)(y.Z,{children:p&&S.length?(0,s.jsx)(_.Z,{context:"secondary",content:"Edit",onClick:function(n){return F(n,S[0])},size:"sm"}):(0,s.jsx)(_.Z,{context:"secondary",content:"Add new",onClick:F,size:"sm"})})};return(0,s.jsxs)(j.Z,{fitParentHeight:!0,title:m,toolbar:(0,s.jsx)(T,{}),children:[p&&S.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Z.Z,{text:S[0].comments}),(0,s.jsx)(Z.Z,{content:"By",text:"".concat(S[0].user.nameFirst," ").concat(S[0].user.nameLast)})]}),!p&&(0,s.jsx)(J,{entity:t,entityId:c,note:S,loading:C,refetch:q,handleClick:F,userId:g.id})]})};O.propTypes={entity:c.string.isRequired,entityId:c.number.isRequired,single:c.bool,title:c.string},O.defaultProps={open:!0,single:!1,title:"Note"}},66137:function(n,e,t){t.d(e,{Y:function(){return i}});var i=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Job",t="";return(null==n?void 0:n.length)&&(t="\n      Taxonomy: {\n      _and: [\n        { entity: { _eq: ".concat(e,' } }\n        {\n          Taxonomy: {\n            status: { _eq: "active" }\n            _and: [{ id: { _in: [').concat(n,'] } }, { type: { _eq: "tags" } }]\n          }\n        }\n      ]\n    }\n  ')),t}},21789:function(n,e,t){t.d(e,{bg:function(){return i}});var i=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]}}]);