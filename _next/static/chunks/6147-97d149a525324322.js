"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6147],{22595:function(e,n,t){t.d(n,{E:function(){return i}});var i=function(e,n){if(Array.isArray(n)){var t,i=null;return n.forEach(function(n){var t,o=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});i=(null==o?void 0:o.createdAt)||i}),i}var o=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==o?void 0:o.createdAt)||null}},61816:function(e,n,t){t.d(n,{n:function(){return y}});var i=t(26042),o=t(69396),a=t(85893),r=t(45697),s=t(11585),u=t(90951),l=t(28497),d=t(15214),c=t(9270),m=t(62140),p=t(44634),y=function(e){var n=e.errors,t=e.register,r=e.pricingWatch,y=e.hasServiceRate,v=e.isPPM,g={register:t,errors:n},f=p.Hu.filter(function(e){var n=e.value;return!v||"fixed"===n});return(0,a.jsxs)(s.Z,{dataSet:{"data-cy":"pricing"},open:!0,title:"Pricing",children:[(0,a.jsx)(u.Z,(0,o.Z)((0,i.Z)({},g),{data:f,legend:"Pricing",name:"pricing"})),"time-materials"===r&&(0,a.jsx)(l.Z,(0,o.Z)((0,i.Z)({},g),{label:"Spend Threshold",name:"customerSpendThreshold",vat:"Ex VAT"})),"fixed"===r&&(0,a.jsxs)(a.Fragment,{children:[y?(0,a.jsx)(d.Z,{content:"This customer has a service rate on their account. The customer amounts will be calculated using the relevant service rates.",context:"info"}):(0,a.jsx)(l.Z,(0,o.Z)((0,i.Z)({},g),{label:"Customer",name:"amount",vat:"Ex VAT"})),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(m.Z,{sm:12,md:6,children:(0,a.jsx)(l.Z,(0,o.Z)((0,i.Z)({},g),{label:"Supplier labour amount",name:"supplierLabourAmount",vat:"Ex VAT"}))}),(0,a.jsx)(m.Z,{sm:12,md:6,children:(0,a.jsx)(l.Z,(0,o.Z)((0,i.Z)({},g),{label:"Supplier materials amount",name:"supplierMaterialsAmount",vat:"Ex VAT"}))})]})]})]})};y.propTypes={errors:r.object.isRequired,pricingWatch:r.string,register:r.func.isRequired,hasServiceRate:r.bool,isPPM:r.bool}},64714:function(e,n,t){t.d(n,{t:function(){return d}});var i=t(26042),o=t(69396),a=t(85893),r=t(45697),s=t(11585),u=t(66812),l=t(32749),d=function(e){var n=e.control,t=e.errors,r={control:n,errors:t,register:e.register};return(0,a.jsxs)(s.Z,{dataSet:{"data-cy":"taxonomy"},open:!0,title:"Service",children:[(0,a.jsx)(l.l,(0,o.Z)((0,i.Z)({},r),{label:"Cost category",name:"costCategorySelected",type:"costCategory"})),(0,a.jsx)(u.P,(0,o.Z)((0,i.Z)({},r),{errors:(0,i.Z)({},t),name:"serviceSelected",label:"Service",type:"service"}))]})};d.propTypes={control:r.object.isRequired,errors:r.object.isRequired,register:r.func.isRequired}},59983:function(e,n,t){t.d(n,{X:function(){return j}});var i=t(82670),o=t(26042),a=t(69396),r=t(85893),s=t(67294),u=t(45697),l=t(11585),d=t(49501),c=t(95103),m=t(90951),p=t(9270),y=t(62140),v=t(58594),g=t(21300),f=t(44634),b=[{text:"Select...",value:""},{text:"Today",value:"today"},{text:"This week",value:"thisWeek"},{text:"This month",value:"thisMonth"},{text:"Next Three month",value:"nextThreeMonth"}],h=t(4135),x=t(43703),S=t(11640),I=t(83894),Z=t(69119),q=t(67090),_=function(){var e=(0,h.Z)(new Date),n=(0,x.Z)(new Date),t=(0,h.Z)((0,S.Z)(new Date(n),2)),i=(0,I.Z)(new Date),o=(0,Z.Z)(new Date),a=(0,q.Z)(new Date);return{monthEnd:e,nextThreeEnd:t,todayEnd:i,todayStart:o,weekEnd:a}},T=f.KB,j=function(e){var n=e.control,t=e.errors,u=e.hasRole,h=e.query,x=e.register,S=e.setValue,I=e.timingWatch,Z=e.watch,q={control:n,errors:t,register:x},j=u("customer")&&!u("admin"),$=Z("pricing"),D=Z("timingStart"),R=Z("timingEnd"),w=Z("multipleDays"),C=Z("timeSpan"),U=Z("timing");(0,s.useEffect)(function(){j&&(T=f.KB.filter(function(e){return"at"!==e.value}),S("timing","between")),C&&A({time:C,setValue:S})},[C]),(0,s.useEffect)(function(){"at"===U&&S("timeSpan","")},[U]);var A=function(e){var n,t,i=e.time,o=e.setValue,a=_(),r=a.monthEnd,s=a.todayStart,u=a.weekEnd,l=a.todayEnd,d=a.nextThreeEnd;switch(i){case"today":n=s,t=l;break;case"thisWeek":n=s,t=u;break;case"thisMonth":n=s,t=r;break;case"nextThreeMonth":n=s,t=d}o("timing","between"),o("timingStart",n),o("timingEnd",t)},E=function(e){var n=new Date,t=new Date(e);return n.getTime()<t.getTime()},J=function(e){var n=D?new Date(D):new Date,t=new Date(e);return n.getTime()<t.getTime()};return(0,r.jsxs)(l.Z,{dataSet:{"data-cy":"timing"},open:!0,title:"Timing",children:[!(null==h?void 0:h.id)&&S&&(0,r.jsx)(d.Z,{label:"Select Time span",children:(0,r.jsx)(c.Z,(0,a.Z)((0,o.Z)({},q),{name:"timeSpan",options:b}))}),(0,r.jsx)(m.Z,(0,a.Z)((0,o.Z)({},q),{data:T,legend:"Timing",name:"timing"})),(0,r.jsxs)(p.Z,{children:[(0,r.jsxs)(y.Z,{md:12,children:[(0,r.jsx)(d.Z,{label:"Start time"}),(0,r.jsx)(g.M,(0,a.Z)((0,o.Z)({},q),{dateFormat:"d MMM yyyy HH:mm",maxDate:R?new Date(R):null,minDate:new Date,filterTime:E,name:"timingStart",placeholder:"Click to select Start time",showTimeSelect:!0,todayButton:!1}))]}),"at"!==I&&(0,r.jsxs)(y.Z,{md:12,children:[(0,r.jsx)(d.Z,{label:"End time"}),(0,r.jsx)(g.M,(0,a.Z)((0,o.Z)({},q),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:D?new Date(D):new Date,filterTime:J,name:"timingEnd",showTimeSelect:!0,todayButton:!1}))]})]}),(0,i.Z)(D,Date)&&"fixed"===$&&(0,r.jsx)(v.Z,(0,a.Z)((0,o.Z)({},q),{data:[{id:"multipleDays",label:"Multiple days"}],name:"multipleDays"})),w&&(0,r.jsx)(d.Z,{label:"End Date",children:(0,r.jsx)(g.M,(0,a.Z)((0,o.Z)({},q),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!0,filterTime:J,minDate:D?new Date(D):new Date,name:"endDate",showTimeSelect:!0,todayButton:!1}))}),u("admin")&&(0,r.jsx)(v.Z,(0,a.Z)((0,o.Z)({},q),{data:[{id:"allowTimingNormalHours",label:"Allow premium rates to be used",value:"allowTimingNormalHours"}],name:"allowTimingNormalHours"}))]})};j.propTypes={control:u.object.isRequired,errors:u.object.isRequired,query:u.object.isRequired,register:u.func.isRequired,setValue:u.func,timingWatch:u.string}},19486:function(e,n,t){t.d(n,{I2:function(){return m},Pu:function(){return h},a6:function(){return v},lV:function(){return p},A5:function(){return b},$z:function(){return c},G2:function(){return g},eD:function(){return y},GU:function(){return f}});var i=t(26042),o=t(69396),a=t(29815),r=t(30381),s=t.n(r),u=t(83704),l=t.n(u),d=function(e){return e.map(function(e){return{entity:"Job",taxonomyId:e.tag.id}})};l()(s());var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o={};if(o.assetSelected=null,o.costCategorySelected=null,o.customerSelected=null,o.customerUserSelected=null,o.locationSelected=null,o.sublocationSelected=null,o.managerSelected=null,o.serviceSelected=null,o.siteVisitReq=!1,o.taxonomyId_ShortDesc=null,o.assetCategorySelected=null,o.access=null,o.paymentMethod="invoice",o.reportPassFail=!1,o.reportPassFailTitle="",o.requireReportRecommendations=!1,o.tags=[],e.customer&&(o.customerSelected={value:e.customer.id,label:e.customer.name}),e.location){var r,s,u,l,c,m=e.location.customerAssociations;o.locationSelected={value:e.location.id,label:e.location.name},m&&(o.customerSelected={value:null==m?void 0:null===(s=m[0])||void 0===s?void 0:null===(u=s.customer)||void 0===u?void 0:u.id,label:null==m?void 0:null===(l=m[0])||void 0===l?void 0:null===(c=l.customer)||void 0===c?void 0:c.name})}if(e.asset&&(o.assetSelected={value:e.asset.id,label:e.asset.name},o.assetCategorySelected={value:null===(p=e.asset)||void 0===p?void 0:null===(y=p.Category)||void 0===y?void 0:y.id,label:null===(v=e.asset)||void 0===v?void 0:null===(g=v.Category)||void 0===g?void 0:g.name}),n("admin")&&(o.managerSelected={value:t.id,label:"".concat(t.nameFirst," ").concat(t.nameLast)}),(null===(r=o.tags)||void 0===r?void 0:r.length)&&(o.Taxonomy={data:(0,a.Z)(o.tags?d(o.tags):[])}),n("customer")&&(o.customerUserSelected={value:t.id,label:"".concat(t.nameFirst," ").concat(t.nameLast)}),e.parentJob){var p,y,v,g,f,b,h,x,S,I=e.parentJob,Z=I.access,q=I.answers,_=I.assetCategory,T=I.assets,j=I.costCategoryTaxonomy,$=I.customer,D=I.customerUser,R=I.manager,w=I.siteVisitAt,C=I.service,U=I.shortJobDesc,A=I.location,E=I.sublocation;o.access=Z,$&&(o.customerSelected={value:$.id,label:$.name}),D&&(o.customerUserSelected={value:D.id,label:"".concat(D.nameFirst," ").concat(D.nameLast)}),A&&(o.locationSelected={value:A.id,label:A.name}),E&&(o.sublocationSelected={value:E.id,label:E.name}),R&&(o.managerSelected={value:R.id,label:"".concat(R.nameFirst," ").concat(R.nameLast),accounts:R.accounts}),(null==T?void 0:T.length)>0&&(o.assetSelected=T.map(function(e){return{value:e.asset.id,label:e.asset.name,assetId:e.id,jobId:e.entityId}})),_&&(o.assetCategorySelected={value:_.id,label:_.name}),"true"===i&&(o.title="Recall: ".concat((null===(f=null==I?void 0:I.shortJobDesc[0])||void 0===f?void 0:f.taxonomy.name)||I.title),o.description=I.description,o.reference=I.reference,o.source=I.source,o.slaId=I.slaId,o.paymentMethod=I.paymentMethod,o.pricing=I.pricing,o.taxonomyId_ShortDesc={value:U[0].taxonomyId,label:null===(b=U[0])||void 0===b?void 0:null===(h=b.taxonomy)||void 0===h?void 0:h.name,meta:null===(x=U[0])||void 0===x?void 0:null===(S=x.taxonomy)||void 0===S?void 0:S.meta},C&&(o.serviceSelected={value:C.id,label:C.name}),w&&(o.siteVisitReq=!0),o.questions=q.map(function(e){var n;return{id:e.id,taxonomyId:e.taxonomyId,comments:e.comments,name:null===(n=e.taxonomy)||void 0===n?void 0:n.name}}),j&&(o.costCategorySelected={value:j.id,label:j.name}))}return o},m=function(e){var n,t,i={};return Object.keys(e).map(function(n){var t=e[n];return"number"==typeof t&&(t=t.toString()),["timingStart","timingEnd","quoteDue","quoteDueSupplier","siteVisitStart","siteVisitEnd"].includes(n)&&null!==t&&(t=new Date(t)),i[n]=t,i}),i.siteVisitReq||(i.siteVisitWeekends=!1),delete i.siteVisitReq,i.siteVisitWeekends?i.siteVisitWeekends=!0:i.siteVisitWeekends=!1,e.customer&&(i.customerSelected={value:e.customer.id,label:e.customer.name}),e.customerUser&&(i.customerUserSelected={value:e.customerUser.id,label:"".concat(e.customerUser.nameFirst," ").concat(e.customerUser.nameLast)}),e.location&&(i.locationSelected={value:e.location.id,label:e.location.name,permitsRequired:null==e?void 0:null===(t=e.location)||void 0===t?void 0:t.permitsRequired}),e.sublocation&&(i.sublocationSelected={value:e.sublocation.id,label:e.sublocation.name}),(null===(n=e.issueTypes[0])||void 0===n?void 0:n.issue)&&(i.issueType={label:e.issueTypes[0].issue.name,value:e.issueTypes[0].issue.id}),e.manager&&(i.managerSelected={value:e.manager.id,label:"".concat(e.manager.nameFirst," ").concat(e.manager.nameLast),accounts:e.manager.accounts}),e.service&&(i.serviceSelected={value:e.service.id,label:e.service.name}),e.assets&&e.assets.length>0?(i.assetSelected=e.assets.map(function(e){return{value:e.asset.id,label:e.asset.name,assetId:e.id,jobId:e.entityId}}),delete i.assets):i.assetSelected=[],i.assetCategory&&(i.assetCategorySelected={value:i.assetCategory.id,label:i.assetCategory.name},delete i.assetCategory),i.siteVisitReq=!1,e.siteVisitStart&&(i.siteVisitReq=!0),i.shortJobDesc&&i.shortJobDesc.length>0&&(i.taxonomyId_ShortDesc={value:i.shortJobDesc[0].taxonomyId,label:i.shortJobDesc[0].taxonomy.name,meta:i.shortJobDesc[0].taxonomy.meta}),i.questions=i.answers.map(function(e){var n;return{id:e.id,taxonomyId:e.taxonomyId,comments:e.comments,name:null===(n=e.taxonomy)||void 0===n?void 0:n.name}}),delete i.answers,i.costCategoryTaxonomy?i.costCategorySelected={value:i.costCategoryTaxonomy.id,label:i.costCategoryTaxonomy.name}:i.costCategorySelected=null,i.allowTimingNormalHours=!e.timingNormalHours,e.estimatedDuration&&e.estimatedDurationUnit&&(i.estimatedDuration=s().duration(e.estimatedDuration,"milliseconds").as(e.estimatedDurationUnit)),i},p=function(e){var n,t,r,u,l,c,m,p=e.query,y=e.data,v=e.hasRole,g=e.user,f=e.type;y.title=null,["slaId","customerSpendThreshold"].map(function(e){return y[e]?y[e]=parseInt(y[e]):y[e]=null,y}),delete y.timeSpan,["quoteDue","quoteDueSupplier","timingEnd","timingStart","endDate"].map(function(e){return y[e]&&(y[e]=s()(y[e]).utc().format()),y}),y.siteVisitReq?["siteVisitStart","siteVisitEnd"].map(function(e){return y[e]&&(y[e]=s()(y[e]).format()),y}):(y.siteVisitStart=null,y.siteVisitEnd=null),y.siteVisitWeekends="true"===y.siteVisitWeekends,delete y.siteVisitReq,["costCategory","customer","customerUser","location","manager","service"].map(function(e){return y[e+"Selected"]&&y[e+"Selected"].value&&(y[e+"Id"]=y[e+"Selected"].value),delete y[e+"Selected"],y}),(null===(n=y.sublocationSelected)||void 0===n?void 0:n.value)?y.sublocationId=null===(r=y.sublocationSelected)||void 0===r?void 0:r.value:y.sublocationId=null,delete y.sublocationSelected,"allowTimingNormalHours"===y.allowTimingNormalHours?y.timingNormalHours=!1:y.timingNormalHours=!0,delete y.allowTimingNormalHours,y.multipleDays&&"fixed"===y.pricing||(y.endDate=null),delete y.multipleDays;var b="";p.quoted?(y.type="quote",y.serviceId=null,y.quoted=!0,y.pricing="fixed",b="quoteNew"):"ppm"===f?y.type="ppm":(y.type="reactive",b=v("admin")?"raised":"pending"),p.id||(y.status=b,y.JobTimings={data:{status:y.status,userId:g.id}},v("admin")?y.adminId=g.accountId:y.adminId=g.adminId||1),p.parentId&&(y.parentId=parseInt(p.parentId)),y.timing&&"at"===y.timing&&(y.timingEnd=null),"foc"===y.quoteCharge&&(y.quoteChargeAmount=null);var h=[];if(y.questions&&(h=JSON.parse(y.questions).map(function(e){return{comments:e.comments,entity:e.entity,taxonomyId:e.taxonomyId}})),!p.id&&y.taxonomyId_ShortDesc&&(y.Taxonomy={data:[{entity:"Job",taxonomyId:y.taxonomyId_ShortDesc.value}].concat((0,a.Z)(h))}),(null===(t=y.tags)||void 0===t?void 0:t.length)&&(y.Taxonomy={data:(0,a.Z)(null!==(l=null===(u=y.Taxonomy)||void 0===u?void 0:u.data)&&void 0!==l?l:[]).concat((0,a.Z)(d(y.tags)))}),y.issueType&&(y.Taxonomy={data:(0,a.Z)(null!==(m=null===(c=y.Taxonomy)||void 0===c?void 0:c.data)&&void 0!==m?m:[]).concat([{entity:"Job",taxonomyId:y.issueType.value}])}),delete y.taxonomyId_ShortDesc,delete y.questions,y.estimatedDuration&&y.estimatedDurationUnit?y.estimatedDuration=s().duration(y.estimatedDuration,y.estimatedDurationUnit).as("milliseconds"):(delete y.estimatedDuration,delete y.estimatedDurationUnit),y.meta=(0,o.Z)((0,i.Z)({},y.meta),{customerSignature:y.customerSignature,supplierSignature:y.supplierSignature}),delete y.customerSignature,delete y.supplierSignature,y.assetSelected&&y.assetSelected.length>0){var x=y.assetSelected.map(function(e){return{assetId:e.value,status:"active",entity:"Job"}});y.Assets={data:x}}return delete y.assetSelected,y.assetCategoryId=y.assetCategorySelected&&y.assetCategorySelected.value,delete y.assetCategorySelected,delete y.tags,delete y.issueType,y},y=function(e,n){if(n){if(!(null===(t=e.taxonomyId_ShortDesc)||void 0===t?void 0:t.value))return{};var t,o,r,s=JSON.parse(e.questions).map(function(e){return{comments:e.comments,entityId:n,entity:"Job",taxonomyId:e.taxonomyId}});return[{entityId:n,entity:"Job",taxonomyId:e.taxonomyId_ShortDesc.value}].concat((0,a.Z)((null===(o=e.issueType)||void 0===o?void 0:o.value)?[{entityId:n,entity:"Job",taxonomyId:e.issueType.value}]:[]),(0,a.Z)(d(null!==(r=e.tags)&&void 0!==r?r:[]).map(function(e){return(0,i.Z)({entityId:n},e)})),(0,a.Z)(s))}},v=function(e,n){var t={meta:(0,o.Z)((0,i.Z)({},e.meta),{reporter:(0,o.Z)((0,i.Z)({},e.meta.reporter),{nameFirst:n.name.split(" ")[0],nameLast:n.name.split(" ")[1]||"",phone:n.phone,email:n.email,shouldSendNotifications:n.shouldSendNotifications})})};return delete n.name,delete n.phone,delete n.email,delete n.shouldSendNotifications,t},g=function(e){return{nameFirst:e.name.split(" ")[0],nameLast:e.name.split(" ")[1]||"",phone:e.phone,email:e.email,meta:{shouldSendNotifications:e.shouldSendNotifications}}},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"reactive",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{slas:[],customerSlas:[],locationSlas:[]},t=n.slas,i=n.customerSlas,o=n.locationSlas;return t.filter(function(n){return n.subtype===e}).map(function(e){var n=null==o?void 0:o.find(function(n){return n.slaId===e.id&&n.inUse}),t=null==i?void 0:i.find(function(n){return n.slaId===e.id&&n.inUse}),a=(null==n?void 0:n.notes)||(null==t?void 0:t.notes),r=(null==n?void 0:n.onSite)||(null==t?void 0:t.onSite),s=(null==n?void 0:n.onSiteUnit)||(null==t?void 0:t.onSiteUnit),u=(null==n?void 0:n.quoteReturned)||(null==t?void 0:t.quoteReturned),l=(null==n?void 0:n.quoteReturnedUnit)||(null==t?void 0:t.quoteReturnedUnit);return{id:e.id,label:e.label,value:e.id,notes:a||e.notes,onSite:r||e.onSite,onSiteUnit:s||e.onSiteUnit,quoteReturned:u||e.quoteReturned,quoteReturnedUnit:l||e.quoteReturnedUnit,disabled:!!((null==o?void 0:o.find(function(n){return n.slaId===e.id&&!n.inUse}))||(null==i?void 0:i.find(function(n){return n.slaId===e.id&&!n.inUse})))}})},b=function(e,n){var t=[];if(n.Media_Entity){var a=!0,r=!1,s=void 0;try{for(var u,l=n.Media_Entity.data[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value,c=(0,o.Z)((0,i.Z)({},d),{entityId:e});t.push(c)}}catch(m){r=!0,s=m}finally{try{a||null==l.return||l.return()}finally{if(r)throw s}}delete n.Media_Entity}return t},h=function(e,n,t){return{managerSelected:n("admin")?{value:t.id,label:"".concat(t.nameFirst," ").concat(t.nameLast)}:null,access:e.location.access,sublocationSelected:e.sublocation?{value:e.sublocation.id,label:e.sublocation.name}:null,locationSelected:{value:e.location.id,label:e.location.name},customerSelected:{value:e.customer.id,label:e.customer.name},customerUserSelected:{value:e.customerUser.id,label:e.customerUser.name},assetSelected:[{value:e.asset.id,label:e.asset.name}],assetCategorySelected:e.assetCategory?{value:e.assetCategory.id,label:e.assetCategory.name}:null}}},85488:function(e,n,t){t.d(n,{H_:function(){return f},Vw:function(){return S},aL:function(){return y},pf:function(){return v},sW:function(){return x},wd:function(){return g},xY:function(){return b},yT:function(){return h}});var i=t(7297),o=t(75063),a=t(66312);function r(){var e=(0,i.Z)(["\n  fragment JobFields on Job {\n    access\n    issueReportedDescription\n    adminId\n    costCategory\n    createdAt\n    description\n    id\n    meta\n    pricing\n    reference\n    scheduledAt\n    status\n    supplierLabourAmount\n    supplierMaterialsAmount\n    timing\n    timingEnd\n    timingNormalHours\n    timingStart\n    title\n    type\n    siteVisitStart\n    siteVisitEnd\n    siteVisitWeekends\n    amount\n    number\n    quoted\n    timingStatus\n    correctDuration\n    correctStart\n    correctEnd\n  }\n"]);return r=function(){return e},e}function s(){var e=(0,i.Z)(["\n  fragment JobQuoteFields on Job {\n    quoted\n    quoteNumber\n    quoteDue\n    quoteDueSupplier\n    quoteCharge\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,i.Z)(["\n  fragment JobAdminFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]);return u=function(){return e},e}function l(){var e=(0,i.Z)(["\n  fragment JobSupplierFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]);return l=function(){return e},e}function d(){var e=(0,i.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $_append: Job_append_input = {}\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes, _append: $_append) {\n      id\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=(0,i.Z)(["\n  mutation InsertJobTiming($timing: [JobTiming_insert_input!]!) {\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return c=function(){return e},e}function m(){var e=(0,i.Z)(['\n  query GetJobHistory(\n    $jobId: Int\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $serviceId: Int\n    $startDate: timestamptz!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      id\n      title\n      status\n      scheduledAt\n      createdAt\n      meta\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return m=function(){return e},e}function p(){var e=(0,i.Z)(['\n  query GetJob($jobId: Int!) {\n    job: Job_by_pk(id: $jobId) {\n      access\n      costCategory\n      customerSpendThreshold\n      description\n      supplierLabourAmount\n      supplierMaterialsAmount\n      quoteDue\n      quoteNumber\n      id\n      number\n      meta\n      paymentMethod\n      reference\n      status\n      title\n      type\n      quoted\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n      }\n      quotations: SupplierQuotes {\n        id\n        quoteNumber\n        status\n        lineItems: SupplierQuoteLineItems {\n          id\n          description\n          item\n          qty\n          qtyUnit\n          quoteId\n          total\n          type\n          unitRate\n          supplierTotal\n        }\n        supplier: Supplier {\n          id\n          type\n          name\n          accountUsers: Account_Users {\n            user: User {\n              id\n              fullName\n              nameFirst\n              nameLast\n              phone\n              email\n              devices: UserDevices(where: { status: { _eq: "active" } }) {\n                id\n                playerId\n              }\n            }\n          }\n        }\n      }\n      admin: Admin {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      customer: Customer {\n        id\n        name\n        website\n        slas: SLAs(where: { entity: { _eq: "Account" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        nameFirst\n        nameLast\n        fullName\n        email\n        phone\n      }\n      supplier: Supplier {\n        id\n        name\n        contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n          id\n          role\n          position\n          isContact\n          lastSignInAt\n          userId\n          user: User {\n            id\n            fullName\n            nameFirst\n            nameLast\n            email\n            phone\n          }\n        }\n      }\n      supplierUser: SupplierUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n        email\n        phone\n      }\n      location: Location {\n        id\n        name\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      costCategoryTaxonomy: CostCategory {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n  ',"\n  ","\n"]);return p=function(){return e},e}var y=(0,o.Ps)(r()),v=(0,o.Ps)(s()),g=(0,o.Ps)(u()),f=(0,o.Ps)(l()),b=(0,o.Ps)(d()),h=(0,o.Ps)(c()),x=(0,o.Ps)(m()),S=(0,o.Ps)(p(),a.WW,a.MR)},14272:function(e,n,t){t.d(n,{f:function(){return I}});var i=t(26042),o=t(69396),a=t(85893),r=t(67294),s=t(45697),u=t(58594),l=t(28497),d=t(55563),c=t(90951),m=t(95103),p=t(6710),y=t(78289),v=t(23233),g=t(49501),f=t(77439),b=t(40826),h=t(21300),x=t(35418),S={checkbox:u.Z,currencyInput:l.Z,datepicker:h.M,input:d.Z,radio:c.Z,select:m.Z,textArea:p.Z,selectRange:m.Z},I=function(e){var n=e.control,t=e.entity,s=e.entityId,u=e.errors,l=e.input,d=e.inputType,c=e.key,m=e.label,p=e.mediaMeta,h=e.name,I=e.options,Z=e.register,q=(0,r.useContext)(y.Z),_="select"===l&&I.length>0,T=["checkbox","radio"].includes(l)&&I.length>0,j=(0,o.Z)((0,i.Z)({control:n},T&&{data:I},_&&{options:I.map(function(e){return(0,o.Z)((0,i.Z)({},e),{text:e.label})})},"selectRange"===l&&{range:[10,0]}),{errors:u,key:c,label:v.Z.camelize(m),name:h,register:Z,type:T?l:d,minDate:"2020-04-19T08:29:04.839Z"}),$=function(){q.show({content:t&&s&&(0,a.jsx)(x.G,{entity:t,entityId:s,mediaMeta:p,category:"supplierQuestion"}),submit:!1,title:m})},D=S[l];return(0,a.jsx)(a.Fragment,{children:"currencyInput"===l?(0,a.jsx)(g.Z,{label:m,children:(0,a.jsx)(D,(0,o.Z)((0,i.Z)({},j),{label:""}))}):(0,a.jsx)(a.Fragment,{children:"media"===l?(0,a.jsx)(g.Z,{label:m,children:(0,a.jsx)(f.Z,{context:"info",content:(0,a.jsx)(b.Z,{icon:"file-upload"}),onClick:$,size:"sm"})}):(0,a.jsx)(g.Z,{label:m,children:(0,a.jsx)(D,(0,i.Z)({},j))})})})};I.propTypes={control:s.object.isRequired,entity:s.string,entityId:s.number,errors:s.object.isRequired,input:s.string,inputType:s.string,key:s.string,label:s.string.isRequired,mediaMeta:s.object,name:s.string.isRequired,options:s.array,register:s.func.isRequired},I.defaultProps={input:"input",options:[],inputType:"text",label:"label"}},42575:function(e,n,t){t.d(n,{Im:function(){return m},RQ:function(){return v},X4:function(){return f},fC:function(){return g},mW:function(){return p},ze:function(){return y}});var i=t(7297),o=t(75063);function a(){var e=(0,i.Z)(['\n  query GetTaxonomys(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Taxonomy_order_by!\n    $status: String = "active"\n    $type: String\n    $typeGroup: String\n    $parentId: Int\n    $fetchGroup: Boolean! = true\n    $id: Int\n    $isGroup: Boolean = false\n  ) {\n    taxonomy: Taxonomy(\n      limit: $limit\n      offset: $offset\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n      order_by: [$orderBy]\n    ) {\n      options: Taxonomies(\n        where: {\n          type: { _eq: $type }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n\n        childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n          taxonomyId: id\n          name\n          type\n          meta\n          status\n        }\n      }\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n      parent: Parent {\n        id\n        name\n        type\n      }\n      childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n        taxonomyId: id\n        name\n        type\n        meta\n        status\n      }\n      jobs: Taxonomy_Entities_aggregate(\n        where: { Taxonomy: { type: { _eq: "jobTags" } }, entity: { _eq: "Job" } }\n      ) {\n        aggregate {\n          count\n        }\n      }\n    }\n    meta: Taxonomy_aggregate(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n    taxonomyGroup: Taxonomy(where: { isGroup: { _eq: true }, type: { _eq: $typeGroup } })\n      @include(if: $fetchGroup) {\n      value: id\n      text: name\n    }\n  }\n']);return a=function(){return e},e}function r(){var e=(0,i.Z)(["\n  query GetTaxonomy($id: Int!) {\n    taxonomy: Taxonomy_by_pk(id: $id) {\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n    }\n  }\n"]);return r=function(){return e},e}function s(){var e=(0,i.Z)(["\n  mutation AddTaxonomy($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        type\n      }\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,i.Z)(["\n  mutation UpdateTaxonomy($id: Int!, $changes: Taxonomy_set_input) {\n    update_Taxonomy_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      type\n    }\n  }\n"]);return u=function(){return e},e}function l(){var e=(0,i.Z)(["\n  query GeTaxonomyWithEntities($type: String!, $entity: String!, $entityId: Int!) {\n    questions: Taxonomy(where: { type: { _eq: $type } }) {\n      id\n      meta\n      name\n      status\n      taxonomy_entity: Taxonomy_Entities(\n        where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }\n      ) {\n        comments\n      }\n    }\n  }\n"]);return l=function(){return e},e}function d(){var e=(0,i.Z)(["\n  mutation InsertTaxonomyEntity(\n    $entity: String!\n    $entityId: Int!\n    $questions: [Taxonomy_Entity_insert_input!]!\n    $objectStatusLog: [StatusLog_insert_input!]!\n    $hasStatusLog: Boolean!\n  ) {\n    delete_Taxonomy_Entity(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      returning {\n        id\n      }\n    }\n    insert_Taxonomy_Entity(objects: $questions) {\n      returning {\n        id\n      }\n    }\n\n    insert_StatusLog(objects: $objectStatusLog) @include(if: $hasStatusLog) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=(0,i.Z)(["\n  query GetSlasForTemplate($where: SLA_bool_exp, $limit: Int, $offset: Int) {\n    slas: SLA(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      id\n      label: name\n      subtype\n      notes\n      onSite\n      onSiteUnit\n      quoteReturned\n      quoteReturnedUnit\n    }\n  }\n"]);return c=function(){return e},e}var m=(0,o.Ps)(a());(0,o.Ps)(r());var p=(0,o.Ps)(s()),y=(0,o.Ps)(u()),v=(0,o.Ps)(l()),g=(0,o.Ps)(d()),f=(0,o.Ps)(c())},32109:function(e,n,t){t.d(n,{y:function(){return m}});var i=t(85893),o=t(45697),a=t(55377),r=t(9270),s=t(62140),u=t(86036),l=t(16551),d=t(77439),c=t(35418),m=function(e){var n=e.answers,t=e.onEdit,o=e.entity,m=e.entityId,p=function(){t&&t(n)};return(0,i.jsxs)(i.Fragment,{children:[n&&n.length>0&&(0,i.jsx)(a.Z,{content:"Questions"}),n&&n.map(function(e){var n,t,l,d=e.meta;return(null==d?void 0:d.input)==="media"?(0,i.jsx)(r.Z,{children:(0,i.jsxs)(s.Z,{md:6,children:[(0,i.jsx)(c.G,{entity:o,entityId:m,showItemActions:!1,showActionButtons:!1,summary:null==d?void 0:d.label,category:"supplierQuestion",mediaMeta:{taxonomyId:e.id}}),(0,i.jsx)(a.Z,{})]})}):(0,i.jsx)(u.Z,{content:(null===(n=e.taxonomy)||void 0===n?void 0:n.name)||e.name,text:e.comments||(null===(t=e.taxonomy_entity)||void 0===t?void 0:null===(l=t[0])||void 0===l?void 0:l.comments)},e.id||e.taxonomyId)}),n&&n.length>0&&t&&(0,i.jsx)(l.Z,{align:"flex-end",children:(0,i.jsx)(d.Z,{content:"Edit Answers",size:"sm",context:"secondary",onClick:p})}),n&&n.length>0&&(0,i.jsx)(a.Z,{})]})};m.propTypes={answers:o.array}},87556:function(e,n,t){t.d(n,{D:function(){return h}});var i=t(26042),o=t(69396),a=t(85893),r=t(67294),s=t(45697),u=t(42283),l=t(79665),d=t(76600),c=t(9270),m=t(62140),p=t(16551),y=t(77439),v=t(14272),g=t(74231),f=function(e,n){var t=n.object,o=n.string,a={};return null==e||e.forEach(function(e){var n;(null===(n=e.meta)||void 0===n?void 0:n.required)&&(a[e.name]=o().required())}),t().shape((0,i.Z)({},a))},b=function(e){var n=e.map(function(e){return(0,o.Z)((0,i.Z)({},e),{name:"".concat(e.name,"/id=").concat(e.taxonomyId)})}),t=(0,g.Ry)().shape({}),a=f(n,{object:g.Ry,string:g.Z_});return t.concat(a)},h=function(e){var n,t=e.entity,s=e.entityId,g=e.onSuccess,f=e.questions,h=e.hasChangeStatus,x=(0,u.cI)({defaultValues:(n={},f.forEach(function(e){var t=e.comments,i=e.taxonomyId,o=e.name;n["".concat(o,"/id=").concat(i)]=t}),n),resolver:(0,l.S)(b(f))}),S=x.control,I=x.errors,Z=x.handleSubmit,q={control:S,errors:I,register:x.register},_=function(e,n){var i=Object.keys(e).map(function(n){return{taxonomyId:parseInt(n.split("/id=")[1]),name:n.split("/id=")[0],comments:String(e[n]),entity:t,entityId:s}});g&&g(i,n)};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(d.Z,{id:h?"offCanvasFormQuestions":"offCanvasForm",handleSubmit:Z(function(e){return _(e,"supplierQuestionsSubmitted")}),children:(0,a.jsxs)(c.Z,{children:[f.map(function(e){var n,u,l,d;return(0,a.jsx)(m.Z,{md:12,children:(0,r.createElement)(v.f,(0,o.Z)((0,i.Z)({},q),{input:null===(n=e.meta)||void 0===n?void 0:n.input,inputType:null===(u=e.meta)||void 0===u?void 0:u.inputType,key:e.taxonomyId,label:null===(l=e.meta)||void 0===l?void 0:l.label,name:"".concat(e.name,"/id=").concat(e.taxonomyId),options:null===(d=e.meta)||void 0===d?void 0:d.options,entity:t,entityId:s,mediaMeta:{taxonomyId:e.taxonomyId}}))})}),h&&(0,a.jsx)(m.Z,{md:12,children:(0,a.jsxs)(p.Z,{align:"flex-end",children:[(0,a.jsx)(y.Z,{content:"Save",context:"success",onClick:Z(function(e){return _(e,"supplierQuestionsDraft")}),size:"sm"}),(0,a.jsx)(y.Z,{content:"Submit",context:"secondary",type:"submit",size:"sm"})]})})]})})})};h.propTypes={entity:s.string.isRequired,entityId:s.number,onSuccess:s.func,hasChangeStatus:s.bool,questions:s.array.isRequired},h.defaultProps={hasChangeStatus:!1}},32749:function(e,n,t){t.d(n,{l:function(){return y}});var i=t(26042),o=t(69396),a=t(99534),r=t(85893),s=t(67294),u=t(45697),l=t(6812),d=t(42575),c=t(49501),m=t(84043),p=function(e,n){var t,i,o,a=!0;return(null===(t=e.errors[e.name])||void 0===t?void 0:t.message)!==(null===(i=n.errors[n.name])||void 0===i?void 0:i.message)&&(a=!1),["name","type"].forEach(function(t){e[t]!==n[t]&&(a=!1)}),a},y=(0,s.memo)(function(e){var n,t,s,u=e.control,p=e.errors,y=e.label,v=e.name,g=e.register,f=e.type,b=e.filters,h=(0,a.Z)(e,["control","errors","label","name","register","type","filters"]),x=(s=(void 0===(t=(0,l.a)(d.Im,{variables:(0,o.Z)((0,i.Z)({isGroup:"assetCategory"===f},b),{orderBy:{name:"asc"},type:f})}).data)?{taxonomy:[]}:t).taxonomy,"assetCategory"===f?s.map(function(e){return{label:e.name,options:e.options,childs:e.childs,meta:e.meta}}):s.map(function(e){return{label:e.name,value:e.id,childs:e.childs,meta:e.meta}}));return(0,r.jsx)(c.Z,{id:v,label:y,children:(0,r.jsx)(m.Z,(0,i.Z)((0,o.Z)((0,i.Z)({},{control:u,errors:p,register:g}),{cacheOptions:!0,isClearable:!0,options:x,name:v}),h))})},p);y.propTypes={control:u.object.isRequired,errors:u.object.isRequired,label:u.string.isRequired,filters:u.object,type:(0,u.oneOf)(["assetCategory","expenseCategory","jobTags","costCategory","clientType","tags"])},y.defaultProps={filters:{}}},44634:function(e,n,t){t.d(n,{Hu:function(){return i},KB:function(){return o},M2:function(){return a}});var i=[{id:"time-materials",label:"Time & Materials",value:"time-materials"},{id:"fixed",label:"Fixed",value:"fixed"}],o=[{id:"at",label:"At",value:"at"},{id:"between",label:"Between",value:"between"}],a=[{id:"complete",label:"Job complete",value:"complete"},{id:"completeCertificate",label:"Job complete, certificate to follow",value:"completeCertificate"},{id:"returnVisit",label:"Return visit required",value:"returnVisit"},{id:"returnVisitByAnother",label:"Visit required by another supplier",value:"returnVisitByAnother"},{id:"couldNotDo",label:"Could not do",value:"couldNotDo"}]}}]);