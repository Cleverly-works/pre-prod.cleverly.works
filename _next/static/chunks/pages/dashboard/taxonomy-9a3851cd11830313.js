(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4031],{23570:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/taxonomy",function(){return n(56942)}])},19486:function(e,t,n){"use strict";n.d(t,{I2:function(){return m},Pu:function(){return x},a6:function(){return v},lV:function(){return p},A5:function(){return h},$z:function(){return d},G2:function(){return g},eD:function(){return y},GU:function(){return f}});var o=n(26042),a=n(69396),i=n(29815),r=n(30381),s=n.n(r),l=n(83704),u=n.n(l),c=function(e){return e.map(function(e){return{entity:"Job",taxonomyId:e.tag.id}})};u()(s());var d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,a={};if(a.assetSelected=null,a.costCategorySelected=null,a.customerSelected=null,a.customerUserSelected=null,a.locationSelected=null,a.sublocationSelected=null,a.managerSelected=null,a.serviceSelected=null,a.siteVisitReq=!1,a.taxonomyId_ShortDesc=null,a.assetCategorySelected=null,a.access=null,a.paymentMethod="invoice",a.reportPassFail=!1,a.reportPassFailTitle="",a.requireReportRecommendations=!1,a.tags=[],e.customer&&(a.customerSelected={value:e.customer.id,label:e.customer.name}),e.location){var r,s,l,u,d,m=e.location.customerAssociations;a.locationSelected={value:e.location.id,label:e.location.name},m&&(a.customerSelected={value:null==m?void 0:null===(s=m[0])||void 0===s?void 0:null===(l=s.customer)||void 0===l?void 0:l.id,label:null==m?void 0:null===(u=m[0])||void 0===u?void 0:null===(d=u.customer)||void 0===d?void 0:d.name})}if(e.asset&&(a.assetSelected={value:e.asset.id,label:e.asset.name},a.assetCategorySelected={value:null===(p=e.asset)||void 0===p?void 0:null===(y=p.Category)||void 0===y?void 0:y.id,label:null===(v=e.asset)||void 0===v?void 0:null===(g=v.Category)||void 0===g?void 0:g.name}),t("admin")&&(a.managerSelected={value:n.id,label:"".concat(n.nameFirst," ").concat(n.nameLast)}),(null===(r=a.tags)||void 0===r?void 0:r.length)&&(a.Taxonomy={data:(0,i.Z)(a.tags?c(a.tags):[])}),t("customer")&&(a.customerUserSelected={value:n.id,label:"".concat(n.nameFirst," ").concat(n.nameLast)}),e.parentJob){var p,y,v,g,f,h,x,b,I,Z=e.parentJob,j=Z.access,C=Z.answers,S=Z.assetCategory,q=Z.assets,T=Z.costCategoryTaxonomy,_=Z.customer,R=Z.customerUser,P=Z.manager,D=Z.siteVisitAt,w=Z.service,k=Z.shortJobDesc,A=Z.location,E=Z.sublocation;a.access=j,_&&(a.customerSelected={value:_.id,label:_.name}),R&&(a.customerUserSelected={value:R.id,label:"".concat(R.nameFirst," ").concat(R.nameLast)}),A&&(a.locationSelected={value:A.id,label:A.name}),E&&(a.sublocationSelected={value:E.id,label:E.name}),P&&(a.managerSelected={value:P.id,label:"".concat(P.nameFirst," ").concat(P.nameLast),accounts:P.accounts}),(null==q?void 0:q.length)>0&&(a.assetSelected=q.map(function(e){return{value:e.asset.id,label:e.asset.name,assetId:e.id,jobId:e.entityId}})),S&&(a.assetCategorySelected={value:S.id,label:S.name}),"true"===o&&(a.title="Recall: ".concat((null===(f=null==Z?void 0:Z.shortJobDesc[0])||void 0===f?void 0:f.taxonomy.name)||Z.title),a.description=Z.description,a.reference=Z.reference,a.source=Z.source,a.slaId=Z.slaId,a.paymentMethod=Z.paymentMethod,a.pricing=Z.pricing,a.taxonomyId_ShortDesc={value:k[0].taxonomyId,label:null===(h=k[0])||void 0===h?void 0:null===(x=h.taxonomy)||void 0===x?void 0:x.name,meta:null===(b=k[0])||void 0===b?void 0:null===(I=b.taxonomy)||void 0===I?void 0:I.meta},w&&(a.serviceSelected={value:w.id,label:w.name}),D&&(a.siteVisitReq=!0),a.questions=C.map(function(e){var t;return{id:e.id,taxonomyId:e.taxonomyId,comments:e.comments,name:null===(t=e.taxonomy)||void 0===t?void 0:t.name}}),T&&(a.costCategorySelected={value:T.id,label:T.name}))}return a},m=function(e){var t,n,o={};return Object.keys(e).map(function(t){var n=e[t];return"number"==typeof n&&(n=n.toString()),["timingStart","timingEnd","quoteDue","quoteDueSupplier","siteVisitStart","siteVisitEnd"].includes(t)&&null!==n&&(n=new Date(n)),o[t]=n,o}),o.siteVisitReq||(o.siteVisitWeekends=!1),delete o.siteVisitReq,o.siteVisitWeekends?o.siteVisitWeekends=!0:o.siteVisitWeekends=!1,e.customer&&(o.customerSelected={value:e.customer.id,label:e.customer.name}),e.customerUser&&(o.customerUserSelected={value:e.customerUser.id,label:"".concat(e.customerUser.nameFirst," ").concat(e.customerUser.nameLast)}),e.location&&(o.locationSelected={value:e.location.id,label:e.location.name,permitsRequired:null==e?void 0:null===(n=e.location)||void 0===n?void 0:n.permitsRequired}),e.sublocation&&(o.sublocationSelected={value:e.sublocation.id,label:e.sublocation.name}),(null===(t=e.issueTypes[0])||void 0===t?void 0:t.issue)&&(o.issueType={label:e.issueTypes[0].issue.name,value:e.issueTypes[0].issue.id}),e.manager&&(o.managerSelected={value:e.manager.id,label:"".concat(e.manager.nameFirst," ").concat(e.manager.nameLast),accounts:e.manager.accounts}),e.service&&(o.serviceSelected={value:e.service.id,label:e.service.name}),e.assets&&e.assets.length>0?(o.assetSelected=e.assets.map(function(e){return{value:e.asset.id,label:e.asset.name,assetId:e.id,jobId:e.entityId}}),delete o.assets):o.assetSelected=[],o.assetCategory&&(o.assetCategorySelected={value:o.assetCategory.id,label:o.assetCategory.name},delete o.assetCategory),o.siteVisitReq=!1,e.siteVisitStart&&(o.siteVisitReq=!0),o.shortJobDesc&&o.shortJobDesc.length>0&&(o.taxonomyId_ShortDesc={value:o.shortJobDesc[0].taxonomyId,label:o.shortJobDesc[0].taxonomy.name,meta:o.shortJobDesc[0].taxonomy.meta}),o.questions=o.answers.map(function(e){var t;return{id:e.id,taxonomyId:e.taxonomyId,comments:e.comments,name:null===(t=e.taxonomy)||void 0===t?void 0:t.name}}),delete o.answers,o.costCategoryTaxonomy?o.costCategorySelected={value:o.costCategoryTaxonomy.id,label:o.costCategoryTaxonomy.name}:o.costCategorySelected=null,o.allowTimingNormalHours=!e.timingNormalHours,e.estimatedDuration&&e.estimatedDurationUnit&&(o.estimatedDuration=s().duration(e.estimatedDuration,"milliseconds").as(e.estimatedDurationUnit)),o},p=function(e){var t,n,r,l,u,d,m,p=e.query,y=e.data,v=e.hasRole,g=e.user,f=e.type;y.title=null,["slaId","customerSpendThreshold"].map(function(e){return y[e]?y[e]=parseInt(y[e]):y[e]=null,y}),delete y.timeSpan,["quoteDue","quoteDueSupplier","timingEnd","timingStart","endDate"].map(function(e){return y[e]&&(y[e]=s()(y[e]).utc().format()),y}),y.siteVisitReq?["siteVisitStart","siteVisitEnd"].map(function(e){return y[e]&&(y[e]=s()(y[e]).format()),y}):(y.siteVisitStart=null,y.siteVisitEnd=null),y.siteVisitWeekends="true"===y.siteVisitWeekends,delete y.siteVisitReq,["costCategory","customer","customerUser","location","manager","service"].map(function(e){return y[e+"Selected"]&&y[e+"Selected"].value&&(y[e+"Id"]=y[e+"Selected"].value),delete y[e+"Selected"],y}),(null===(t=y.sublocationSelected)||void 0===t?void 0:t.value)?y.sublocationId=null===(r=y.sublocationSelected)||void 0===r?void 0:r.value:y.sublocationId=null,delete y.sublocationSelected,"allowTimingNormalHours"===y.allowTimingNormalHours?y.timingNormalHours=!1:y.timingNormalHours=!0,delete y.allowTimingNormalHours,y.multipleDays&&"fixed"===y.pricing||(y.endDate=null),delete y.multipleDays;var h="";p.quoted?(y.type="quote",y.serviceId=null,y.quoted=!0,y.pricing="fixed",h="quoteNew"):"ppm"===f?y.type="ppm":(y.type="reactive",h=v("admin")?"raised":"pending"),p.id||(y.status=h,y.JobTimings={data:{status:y.status,userId:g.id}},v("admin")?y.adminId=g.accountId:y.adminId=g.adminId||1),p.parentId&&(y.parentId=parseInt(p.parentId)),y.timing&&"at"===y.timing&&(y.timingEnd=null),"foc"===y.quoteCharge&&(y.quoteChargeAmount=null);var x=[];if(y.questions&&(x=JSON.parse(y.questions).map(function(e){return{comments:e.comments,entity:e.entity,taxonomyId:e.taxonomyId}})),!p.id&&y.taxonomyId_ShortDesc&&(y.Taxonomy={data:[{entity:"Job",taxonomyId:y.taxonomyId_ShortDesc.value}].concat((0,i.Z)(x))}),(null===(n=y.tags)||void 0===n?void 0:n.length)&&(y.Taxonomy={data:(0,i.Z)(null!==(u=null===(l=y.Taxonomy)||void 0===l?void 0:l.data)&&void 0!==u?u:[]).concat((0,i.Z)(c(y.tags)))}),y.issueType&&(y.Taxonomy={data:(0,i.Z)(null!==(m=null===(d=y.Taxonomy)||void 0===d?void 0:d.data)&&void 0!==m?m:[]).concat([{entity:"Job",taxonomyId:y.issueType.value}])}),delete y.taxonomyId_ShortDesc,delete y.questions,y.estimatedDuration&&y.estimatedDurationUnit?y.estimatedDuration=s().duration(y.estimatedDuration,y.estimatedDurationUnit).as("milliseconds"):(delete y.estimatedDuration,delete y.estimatedDurationUnit),y.meta=(0,a.Z)((0,o.Z)({},y.meta),{customerSignature:y.customerSignature,supplierSignature:y.supplierSignature}),delete y.customerSignature,delete y.supplierSignature,y.assetSelected&&y.assetSelected.length>0){var b=y.assetSelected.map(function(e){return{assetId:e.value,status:"active",entity:"Job"}});y.Assets={data:b}}return delete y.assetSelected,y.assetCategoryId=y.assetCategorySelected&&y.assetCategorySelected.value,delete y.assetCategorySelected,delete y.tags,delete y.issueType,y},y=function(e,t){if(t){if(!(null===(n=e.taxonomyId_ShortDesc)||void 0===n?void 0:n.value))return{};var n,a,r,s=JSON.parse(e.questions).map(function(e){return{comments:e.comments,entityId:t,entity:"Job",taxonomyId:e.taxonomyId}});return[{entityId:t,entity:"Job",taxonomyId:e.taxonomyId_ShortDesc.value}].concat((0,i.Z)((null===(a=e.issueType)||void 0===a?void 0:a.value)?[{entityId:t,entity:"Job",taxonomyId:e.issueType.value}]:[]),(0,i.Z)(c(null!==(r=e.tags)&&void 0!==r?r:[]).map(function(e){return(0,o.Z)({entityId:t},e)})),(0,i.Z)(s))}},v=function(e,t){var n={meta:(0,a.Z)((0,o.Z)({},e.meta),{reporter:(0,a.Z)((0,o.Z)({},e.meta.reporter),{nameFirst:t.name.split(" ")[0],nameLast:t.name.split(" ")[1]||"",phone:t.phone,email:t.email,shouldSendNotifications:t.shouldSendNotifications})})};return delete t.name,delete t.phone,delete t.email,delete t.shouldSendNotifications,n},g=function(e){return{nameFirst:e.name.split(" ")[0],nameLast:e.name.split(" ")[1]||"",phone:e.phone,email:e.email,meta:{shouldSendNotifications:e.shouldSendNotifications}}},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"reactive",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{slas:[],customerSlas:[],locationSlas:[]},n=t.slas,o=t.customerSlas,a=t.locationSlas;return n.filter(function(t){return t.subtype===e}).map(function(e){var t=null==a?void 0:a.find(function(t){return t.slaId===e.id&&t.inUse}),n=null==o?void 0:o.find(function(t){return t.slaId===e.id&&t.inUse}),i=(null==t?void 0:t.notes)||(null==n?void 0:n.notes),r=(null==t?void 0:t.onSite)||(null==n?void 0:n.onSite),s=(null==t?void 0:t.onSiteUnit)||(null==n?void 0:n.onSiteUnit),l=(null==t?void 0:t.quoteReturned)||(null==n?void 0:n.quoteReturned),u=(null==t?void 0:t.quoteReturnedUnit)||(null==n?void 0:n.quoteReturnedUnit);return{id:e.id,label:e.label,value:e.id,notes:i||e.notes,onSite:r||e.onSite,onSiteUnit:s||e.onSiteUnit,quoteReturned:l||e.quoteReturned,quoteReturnedUnit:u||e.quoteReturnedUnit,disabled:!!((null==a?void 0:a.find(function(t){return t.slaId===e.id&&!t.inUse}))||(null==o?void 0:o.find(function(t){return t.slaId===e.id&&!t.inUse})))}})},h=function(e,t){var n=[];if(t.Media_Entity){var i=!0,r=!1,s=void 0;try{for(var l,u=t.Media_Entity.data[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var c=l.value,d=(0,a.Z)((0,o.Z)({},c),{entityId:e});n.push(d)}}catch(m){r=!0,s=m}finally{try{i||null==u.return||u.return()}finally{if(r)throw s}}delete t.Media_Entity}return n},x=function(e,t,n){return{managerSelected:t("admin")?{value:n.id,label:"".concat(n.nameFirst," ").concat(n.nameLast)}:null,access:e.location.access,sublocationSelected:e.sublocation?{value:e.sublocation.id,label:e.sublocation.name}:null,locationSelected:{value:e.location.id,label:e.location.name},customerSelected:{value:e.customer.id,label:e.customer.name},customerUserSelected:{value:e.customerUser.id,label:e.customerUser.name},assetSelected:[{value:e.asset.id,label:e.asset.name}],assetCategorySelected:e.assetCategory?{value:e.assetCategory.id,label:e.assetCategory.name}:null}}},12547:function(e,t,n){"use strict";n.d(t,{r:function(){return d}});var o=n(26042),a=n(69396),i=n(85893),r=n(45697),s=n.n(r),l=n(41664),u=n.n(l),c=n(23795),d=function(e){var t=e.children,n=e.href,r=e.noWrap,s=e.target,l=e.sx,d=void 0===l?{}:l;return r?(0,i.jsx)(i.Fragment,{children:t}):n?(0,i.jsx)(u(),{href:n,target:s,passHref:!0,children:(0,i.jsx)(c.Z,(0,a.Z)((0,o.Z)({sx:d},e),{children:t}))}):(0,i.jsx)(c.Z,(0,a.Z)((0,o.Z)({sx:d},e),{children:t}))};d.defaultProps={onClick:function(e){e.stopPropagation()}},d.propTypes={onClick:s().func,href:s().string,noWrap:s().bool,color:s().string}},66812:function(e,t,n){"use strict";n.d(t,{P:function(){return C}});var o=n(47568),a=n(26042),i=n(99534),r=n(7297),s=n(97582),l=n(85893),u=n(67294),c=n(45697),d=n(10367),m=n(66252),p=n(4972),y=n(78289),v=n(52019),g=n(49501),f=n(9270),h=n(62140),x=n(84043),b=n(77439);function I(){var e=(0,r.Z)(["\n  position: relative;\n  right: 25px;\n  top: 2px;\n"]);return I=function(){return e},e}var Z=function(e,t){var n,o,a,i=!0;return(null===(n=e.errors[e.name])||void 0===n?void 0:n.message)!==(null===(o=t.errors[t.name])||void 0===o?void 0:o.message)&&(i=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach(function(n){e[n]!==t[n]&&(i=!1)}),i},j=function(e){var t=e.accountId,n=e.area,o=e.assetCategoryId,a=e.entity,i=e.entityId,r=(e.hasRole,e.id),s=e.locationId,l=e.serviceId,u=e.taxonomyGroupType,c=e.customerId,d=e.customerRole,m=e.type,y=e.userId,v=e.invoiceThreshold,g=e.quoteThreshold,f=m;switch(d&&(f="".concat(m,"_").concat(d)),f){case"address":return{query:p.cz,variables:{entity:a,entityId:i}};case"asset":return{query:p.UH,variables:{categoryId:o,locationId:s}};case"assetBookable":return{query:p.UH,variables:{categoryId:o,locationId:s,bookable:"yes"}};case"assetCategory":return{query:p.nD,variables:{id:r}};case"assetSublocation":return{query:p.UH,variables:{category:"sublocation",adminId:t,locationId:s}};case"compliance":return{query:p.kU,variables:{locationId:s}};case"coverage":return{query:p.j$};case"customer":return{query:p.SW};case"job":return{query:p.Qn,variables:{locationId:s}};case"manager":return{query:p.he,variables:{accountId:t,userId:y}};case"thresholdManagers":return{query:p.Ak,variables:{accountId:t,userId:y,invoiceThreshold:v,quoteThreshold:g}};case"product":return{query:p.UH,variables:{category:"product",locationId:s}};case"property":return{query:p._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:t}}}}};case"property_user":return{query:p._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:t},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:c}}},User_Account_Locations:{Account_User:{userId:{_eq:c},accountId:{_eq:t}}}}}}};case"sensor":return{query:p.UH,variables:{category:"sensor",locationId:s}};case"service":return{query:p.kx};case"sla":return{query:p.t1,variables:{type:"priority",adminId:t}};case"sublocation":return{query:p.zR,variables:{locationId:s}};case"supplier":var h={type:{_eq:"supplier"}};return n&&(h.PostcodeAreas={PostcodeArea:{area:{_eq:n}},entity:{_eq:"Account"},status:{_eq:"active"}}),l&&(h.ServiceSchedule={status:{_eq:"active"},entity:{_eq:"Supplier"},serviceId:{_eq:l}},n&&(h.ServiceSchedule.PostcodeAreas={PostcodeArea:{area:{_eq:n}}})),{query:p.by,variables:{where:h}};case"user":return{query:p.yR,variables:{accountId:t}};case"usersForBookings":return{query:p.yR,variables:{accountId:y}};case"tenant":return{query:p.RJ};case"taxonomyGroup":return{query:p.Cj,variables:{type:u}};case"expenseCategory":return{query:p.Ve};default:return{query:p.qd}}},C=(0,u.memo)(function(e){var t,n=e.AddForm,r=e.accountId,c=e.area,d=e.assetCategoryId,p=e.control,I=e.entity,Z=e.entityId,C=e.errors,q=e.id,T=e.isClearable,_=e.isDisabled,R=e.label,P=e.locationId,D=e.name,w=e.serviceId,k=e.taxonomyGroupType,A=e.customerId,E=e.customerRole,F=e.type,V=e.userId,U=e.invoiceThreshold,$=e.quoteThreshold,N=(0,i.Z)(e,["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId","invoiceThreshold","quoteThreshold"]),G=(0,m.x)(),O=(0,u.useState)(!1),J=O[0],L=O[1],Q=(0,u.useState)(),H=Q[0],M=Q[1],z=(0,u.useState)(!1),W=z[0],B=z[1],X=(0,u.useContext)(y.Z),K=(0,u.useContext)(v.Z).hasRole,Y=(0,u.useState)(!1),ee=Y[0],et=Y[1];(0,u.useEffect)(function(){return et(!1),B(!1),function(){}},[r,d,I,Z,P,w,F,A,E,V]);var en=(t=(0,o.Z)(function(){var e,t,n,o,i,l,u;return(0,s.__generator)(this,function(i){switch(i.label){case 0:if(W)return et(!0),[2,null];return L(!0),t=(e=j({accountId:r,area:c,assetCategoryId:d,entity:I,entityId:Z,hasRole:K,id:q,locationId:P,serviceId:w,taxonomyGroupType:k,customerId:A,customerRole:E,type:F,userId:V,invoiceThreshold:U,quoteThreshold:$})).query,o=void 0===(n=e.variables)?{}:n,[4,G.query({query:t,variables:(0,a.Z)({},o)})];case 1:return M((void 0===(l=i.sent().data)?{items:[]}:l).items),L(!1),B(!0),et(!0),[2]}})}),function(){return t.apply(this,arguments)}),eo=function(){X.show({content:(0,l.jsx)("div",{children:(0,l.jsx)(n,{})}),title:"Add form"})};return(0,l.jsx)(g.Z,{id:D,label:R,children:(0,l.jsxs)(f.Z,{children:[(0,l.jsx)(h.Z,{md:n?11:12,children:(0,l.jsx)(x.Z,(0,a.Z)({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:p,errors:C,isDisabled:_,isClearable:T,isLoading:J,menuIsOpen:ee,options:H,onFocus:en,onBlur:function(){et(!1)},name:D,searchable:!0},N),N.defaultValue)}),n&&(0,l.jsx)(h.Z,{md:1,children:(0,l.jsx)(S,{children:(0,l.jsx)(b.Z,{content:null,startIcon:"plus",size:"sm",onClick:eo})})})]})})},Z),S=d.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-a24ec191-0"})(I());C.propTypes={AddForm:c.object,area:c.string,accountId:c.number,assetCategoryId:c.number,control:c.object.isRequired,errors:c.object.isRequired,entity:c.string,entityId:c.number,id:c.number,isClearable:c.bool,label:c.string.isRequired,locationId:c.number,name:c.string.isRequired,serviceId:c.number,taxonomyGroupType:(0,c.oneOf)(["expenseCategory","costCategory","jobTags"]),type:c.string},C.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},22186:function(e,t,n){"use strict";n.d(t,{V:function(){return d}});var o=n(26042),a=n(69396),i=n(85893),r=n(67294),s=n(45697),l=n.n(s),u=n(87918),c=n(41796),d=function(e){var t,n=e.chipProps,s=e.tagEntityId,l=e.name,d=e.color,m=e.onDelete,p=(0,r.useMemo)(function(){return m?(0,a.Z)((0,o.Z)({},n),{onDelete:function(e){e.stopPropagation(),m(s)}}):(0,o.Z)({},n)},[n,m,s]);return(0,i.jsx)(u.Z,(0,a.Z)((0,o.Z)({},p),{size:"small",label:l,sx:{fontSize:"11px",color:(t=d,(0,c.mi)(t,"#FFFFFF")>2.5?"#FFFFFF":"#000"),bgcolor:d,borderRadius:"0px 16px 16px 0px"}}))};d.defaultProps={chipProps:{},onDelete:null,color:"#f2f2f2"},d.propTypes={chipProps:l().object,tagEntityId:l().string.isRequired,name:l().string.isRequired,color:l().string.isRequired,onDelete:l().func.isRequired}},28864:function(e,t,n){"use strict";n.d(t,{T:function(){return h}});var o=n(85893),a=n(45697),i=n.n(a),r=n(93946),s=n(97212),l=n(98619),u=n(59334),c=n(51233),d=n(50135),m=n(50594),p=n(40055),y=n(5336),v=n(10166),g=n(67294),f=n(42283),h=function(e){var t=e.tagEntityId,n=e.tagId,a=e.name,i=e.color,u=e.editable,v=e.onDelete,h=e.onColorChange,b=e.onNameChange,I=(0,f.cI)({defaultValues:{name:a,color:i}}),Z=I.register,j=I.handleSubmit,C=(0,g.useState)(null),S=C[0],q=C[1],T=function(){return[{icon:"delete",onClick:function(e){e.stopPropagation(),v(t)},tooltip:"Remove"},{icon:"edit",onClick:function(e){e.stopPropagation(),q("rename")},tooltip:"Rename"},{icon:"visibility",onClick:function(e){e.stopPropagation(),q("changeColor")},tooltip:"Change color"}]},_=function(e){e.stopPropagation(),q(null)},R=function(e){h({tagId:n,color:e.color}),q(null)},P=function(e){b({tagId:n,name:e.name}),q(null)};return(0,o.jsx)(s.ZP,{disablePadding:!0,secondaryAction:!u||!S&&(0,o.jsx)(y.C,{icon:"defaultHoriz",actionsData:T}),children:S?({changeColor:function(){return(0,o.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,o.jsx)("input",{name:"color",ref:Z,type:"color",style:{padding:0,border:"none","background-color":"unset"}}),(0,o.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,o.jsx)(r.Z,{size:"small",color:"danger",onClick:_,children:(0,o.jsx)(m.Z,{})}),(0,o.jsx)(r.Z,{size:"small",color:"success",onClick:j(R),children:(0,o.jsx)(p.Z,{})})]})]})},rename:function(){return(0,o.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,o.jsx)(d.Z,{name:"name",inputRef:Z,variant:"standard",color:"secondary"}),(0,o.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,o.jsx)(r.Z,{size:"small",color:"danger",onClick:_,children:(0,o.jsx)(m.Z,{})}),(0,o.jsx)(r.Z,{size:"small",color:"success",onClick:j(P),children:(0,o.jsx)(p.Z,{})})]})]})}})[S]():(0,o.jsx)(l.Z,{children:(0,o.jsx)(x,{primary:a,color:i})})},n)};h.defaultProps={onDelete:function(){},onColorChange:function(){},onNameChange:function(){},editable:!0},h.propTypes={tagEntityId:i().string.isRequired,tagId:i().string.isRequired,name:i().string.isRequired,color:i().string.isRequired,editable:i().bool,onDelete:i().func.isRequired,onColorChange:i().func.isRequired,onNameChange:i().func.isRequired};var x=(0,v.Z)(u.Z)(function(e){return e.theme,{"&.MuiListItemText-root .MuiListItemText-primary":{fontWeight:700,color:e.color}}})},11975:function(e,t,n){"use strict";n.d(t,{P:function(){return p}});var o=n(85893),a=n(67294),i=n(45697),r=n.n(i),s=n(15861),l=n(14564),u=n(78462),c=n(51233),d=n(22186),m=n(28864),p=function(e){var t=e.tags,n=(e.title,e.handleDeleteTagEntity),i=(0,a.useState)(null),r=i[0],p=i[1],y=null==t?void 0:t.slice(0,5),v=(null==t?void 0:t.length)-(null==y?void 0:y.length),g=Boolean(r);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Z,{direction:"row",spacing:1,children:y.map(function(e,t){var a;return(0,o.jsx)(d.V,{tagEntityId:e.id||t,name:e.tag.name,color:null===(a=e.tag.meta)||void 0===a?void 0:a.color,onDelete:n})})}),v>0&&(0,o.jsxs)(s.Z,{fontWeight:700,ml:1,onMouseEnter:function(e){p(e.currentTarget),e.stopPropagation()},children:["+",v]}),(0,o.jsx)(l.ZP,{id:g?"tags-in-table-popover":void 0,open:g,anchorEl:r,onClose:function(){return p(null)},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,o.jsx)(u.Z,{children:null==t?void 0:t.map(function(e){var t;return(0,o.jsx)(m.T,{tagEntityId:e.id,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,editable:!1},e.tag.id)})})})]})};p.propTypes={tags:r().object,title:r().string},p.defaultProps={tags:{},displayOnly:!1,refetchQueries:[],handleDeleteTagEntity:function(){}}},89256:function(e,t,n){"use strict";n.d(t,{n:function(){return k}});var o=n(47568),a=n(26042),i=n(69396),r=n(828),s=n(29815),l=n(97582),u=n(85893),c=n(45697),d=n.n(c),m=n(96486),p=n(6812),y=n(50319),v=n(11961),g=n(93362),f=n(23776),h=n(5616),x=n(98456),b=n(93946),I=n(78462),Z=n(18972),j=n(14564),C=n(51233),S=n(50135),q=n(67294),T=n(10166),_=n(2845),R=n(28864),P=n(51738),D=n(11975),w=(0,g.D)(),k=function(e){var t=e.entityId,n=e.entity,c=e.values,d=void 0===c?[]:c,g=e.name,j=void 0===g?"tags":g,T=e.setValue,k=(0,_.x)().user,E=(0,q.useState)(null),F=E[0],V=E[1],U=(0,q.useState)(""),$=U[0],N=U[1],G=(0,q.useState)(""),O=G[0],J=G[1],L=(0,q.useState)(""),Q=L[0],H=L[1],M=(0,p.a)(P.BU,{skip:!t,variables:{entityId:t,entity:n},onCompleted:function(e){T(j,e.tags)}}),z=M.data,W=(void 0===z?{tags:[]}:z).tags,B=M.loading,X=M.refetch,K=(0,p.a)(P.gI,{skip:!F,variables:{entityId:t,entity:n,q:""!==Q?"%".concat(Q,"%"):null}}),Y=K.data,ee=(void 0===Y?{tags:[]}:Y).tags,et=K.loading,en=(0,r.Z)((0,y.D)(P.Zm,{refetchQueries:["GetAllTags"]}),2),eo=en[0],ea=en[1].loading,ei=(0,r.Z)((0,y.D)(P.LE,{onCompleted:function(){X()}}),2),er=ei[0],es=ei[1].loading,el=(0,r.Z)((0,y.D)(P.cS,{onCompleted:function(){X()}}),2),eu=el[0],ec=el[1].loading,ed=(0,r.Z)((0,y.D)(P.g$,{refetchQueries:["GetAllTags"]}),2),em=ed[0],ep=ed[1].loading;(0,q.useEffect)(function(){var e=setTimeout(function(){H(O)},500);return function(){return clearTimeout(e)}},[O]);var ey,ev,eg,ef=function(e){e.stopPropagation(),V(e.currentTarget)},eh=function(){V(null)},ex=(ey=(0,o.Z)(function(e,o){var a,i,r;return(0,l.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof o)return[3,1];return N({label:o}),[3,6];case 1:if(!(o&&o.inputValue&&t))return[3,2];return er({variables:{objects:[{entity:n,entityId:t,Taxonomy:{data:{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:k.adminId}}}]}}),N(null),[3,6];case 2:if(!(o&&o.value&&t))return[3,3];return er({variables:{objects:[{entity:n,entityId:t,taxonomyId:o.value}]}}),N(null),[3,6];case 3:if(!(o&&o.inputValue))return[3,5];return[4,eo({variables:{objects:[{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:k.adminId}]}})];case 4:return r=e.sent().data.insert_Taxonomy,T(j,(0,s.Z)(d).concat([{id:null,tag:{id:r.returning[0].id,name:r.returning[0].name,meta:r.returning[0].meta}}])),N(null),[3,6];case 5:o&&o.value&&(T(j,(0,s.Z)(d).concat([{id:null,tag:{id:o.value,name:o.label,meta:o.meta}}])),N(null)),e.label=6;case 6:return[2]}})}),function(e,t){return ey.apply(this,arguments)}),eb=(0,q.useCallback)(function(e,t){var n=w(e,t),o=t.inputValue,a=e.some(function(e){return o===e.label});return""===o||a||n.push({inputValue:o,label:'Add "'.concat(o,'"')}),n},[]),eI=(0,q.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),eZ=function(e){t?eu({variables:{tagEntityId:e}}):T(j,d.filter(function(t,n){return n!==e}))},ej=(ev=(0,o.Z)(function(e){var t,n,o,r,s,u;return(0,l.__generator)(this,function(n){switch(n.label){case 0:return[4,em({variables:{tagId:t=e.tagId,object:{meta:{color:e.color}}}})];case 1:return s=n.sent().data.update_Taxonomy_by_pk,T(j,d.map(function(e){return e.tag.id===t?(0,i.Z)((0,a.Z)({},e),{tag:(0,a.Z)({},s)}):e})),[2]}})}),function(e){return ev.apply(this,arguments)}),eC=(eg=(0,o.Z)(function(e){var t,n,o,r,s,u;return(0,l.__generator)(this,function(o){switch(o.label){case 0:return[4,em({variables:{tagId:t=e.tagId,object:{name:n=e.name}}})];case 1:return s=o.sent().data.update_Taxonomy_by_pk,T(n,d.map(function(e){return e.tag.id===t?(0,i.Z)((0,a.Z)({},e),{tag:(0,a.Z)({},s)}):e})),[2]}})}),function(e){return eg.apply(this,arguments)}),eS=Boolean(F),eq=(0,q.useMemo)(function(){return ee.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[ee]),eT=(0,q.useMemo)(function(){return m.uniqBy((0,s.Z)(W).concat((0,s.Z)(d)),function(e){var t;return null===(t=e.tag)||void 0===t?void 0:t.id})},[W,d]);return(0,u.jsxs)(C.Z,{direction:"row",alignItems:"center",children:[(0,u.jsx)(D.P,{tags:eT,handleDeleteTagEntity:eZ}),(0,u.jsx)(A,{id:eS?"tags-popover":void 0,open:eS,anchorEl:F,onClose:eh,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,u.jsxs)(h.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,u.jsx)(f.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,s.Z)(eq),value:$,onChange:ex,onInputChange:function(e,t){J(t)},filterOptions:eb,getOptionLabel:eI,renderOption:function(e,t){return(0,u.jsx)(Z.Z,(0,i.Z)((0,a.Z)({},e),{children:t.label}))},renderInput:function(e){return(0,u.jsx)(S.Z,(0,i.Z)((0,a.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,i.Z)((0,a.Z)({},e.InputProps),{endAdornment:(0,u.jsxs)(u.Fragment,{children:[et||ea||es?(0,u.jsx)(x.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),B||ec||ep?(0,u.jsx)(C.Z,{width:"100%",alignItems:"center",p:4,children:(0,u.jsx)(x.Z,{color:"secondary"})}):(0,u.jsx)(I.Z,{children:null==eT?void 0:eT.map(function(e,t){var n;return(0,u.jsx)(R.T,{tagEntityId:e.id||t,tagId:e.tag.id,name:e.tag.name,color:null===(n=e.tag.meta)||void 0===n?void 0:n.color,onDelete:eZ,onColorChange:ej,onNameChange:eC})})})]})}),(0,u.jsx)(b.Z,{color:"black",onClick:ef,children:(0,u.jsx)(v.Z,{sx:{height:"16px",width:"16px"}})})]})};k.defaultProps={entityId:null},k.propTypes={entityId:d().number};var A=(0,T.Z)(j.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}})},51738:function(e,t,n){"use strict";n.d(t,{Aw:function(){return Z},BU:function(){return g},C3:function(){return I},LE:function(){return h},Zm:function(){return v},cS:function(){return x},g$:function(){return b},gI:function(){return y},lx:function(){return f}});var o=n(7297),a=n(75063);function i(){var e=(0,o.Z)(['\n  query GetTagsForEntity($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    tags: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']);return i=function(){return e},e}function r(){var e=(0,o.Z)(["\n  mutation CreateTag($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        name\n        meta\n      }\n    }\n  }\n"]);return r=function(){return e},e}function s(){var e=(0,o.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n']);return s=function(){return e},e}function l(){var e=(0,o.Z)(['\n  query GetTagsForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']);return l=function(){return e},e}function u(){var e=(0,o.Z)(["\n  mutation CreateTagsAgainstEntity($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return e},e}function c(){var e=(0,o.Z)(["\n  mutation DeleteTagAgainstEntity($tagEntityId: Int!) {\n    delete_Taxonomy_Entity_by_pk(id: $tagEntityId) {\n      id\n      taxonomyId\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,o.Z)(["\n  mutation UpdateTagAgainstEntity($tagId: Int!, $object: Taxonomy_set_input!) {\n    update_Taxonomy_by_pk(pk_columns: { id: $tagId }, _set: $object) {\n      id\n      name\n      meta\n    }\n  }\n"]);return d=function(){return e},e}function m(){var e=(0,o.Z)(["\n  mutation CreateTagsAgainstEntityWithFollowing($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return m=function(){return e},e}function p(){var e=(0,o.Z)(["\n  mutation DeleteTagAgainstEntityWithFollowing($where: Taxonomy_Entity_bool_exp!) {\n    delete_Taxonomy_Entity(where: $where) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return p=function(){return e},e}var y=(0,a.Ps)(i()),v=(0,a.Ps)(r()),g=(0,a.Ps)(s()),f=(0,a.Ps)(l()),h=(0,a.Ps)(u()),x=(0,a.Ps)(c()),b=(0,a.Ps)(d()),I=(0,a.Ps)(m()),Z=(0,a.Ps)(p())},56942:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eu}});var o=n(85893),a=n(19076),i=n(67294),r=n(11163),s=n(41085),l=n(45697),u=n(55862),c=n(26042),d=n(69396),m=n(6812),p=n(42575),y=n(68956),v=n(74297),g=n(16551),f=n(77439),h=n(11585),x=n(40826),b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dark";return function(){return(0,o.jsx)(x.Z,{context:t,icon:"check",size:"sm",title:e})}},I=function(e,t){return"assetCategory"===e&&!t},Z=n(91272),j=n(47568),C=n(828),S=n(97582),q=n(50319),T=n(42283),_=n(76600),R=n(49501),P=n(6710),D=n(90951),w=n(15214),k=n(28497),A=n(9270),E=n(62140),F=n(79665),V=n(66812),U=n(32749),$=n(19486),N=n(69368),G=n(50480),O=n(56815),J=n(15861),L=n(35292),Q=n(40656),H=n(2845),M=n(89256),z=function(e){var t,n,a,i,r=e.defaultValues,s=e.onSuccess,l=(e.groups,e.parentId),u=void 0===l?null:l,y=(0,H.x)().hasRole,v=(0,T.cI)({defaultValues:null==r?void 0:r.template,resolver:(0,F.S)(L.b)}),g=v.control,f=v.errors,h=v.handleSubmit,x=v.register,b=v.watch,I=v.setValue,Z=(0,C.Z)((0,q.D)(p.ze,{onCompleted:function(e){var t=e.update_Taxonomy_by_pk.id;s&&s(t)}}),1)[0],Q=(0,m.a)(p.X4,{variables:{where:{subtype:{_eq:"reactive"}}}}).data,z=(0,m.a)(p.X4,{variables:{where:{subtype:{_eq:"quote"}}}}).data,B=b("reportPassFail"),X=b("reportPassFailTitle"),K=b("slaIdReactive"),Y=b("slaIdQuote"),ee=b("tags"),et=(0,$.GU)("reactive",Q),en=null===(t=null==et?void 0:et.find(function(e){return e.id===Number(K)}))||void 0===t?void 0:t.notes,eo=(0,$.GU)("quote",z),ea=null===(n=null==eo?void 0:eo.find(function(e){return e.id===Number(Y)}))||void 0===n?void 0:n.notes,ei=(i=(0,j.Z)(function(e){var t;return(0,S.__generator)(this,function(n){switch(n.label){case 0:if(!u)return[3,2];return e.parentId=u,t={meta:(0,d.Z)((0,c.Z)({},r||{}),{template:e})},[4,Z({variables:{id:u,changes:t}})];case 1:n.sent(),n.label=2;case 2:return[2]}})}),function(e){return i.apply(this,arguments)}),er={errors:f,register:x,control:g};return(0,o.jsxs)(_.Z,{id:"offCanvasForm",handleSubmit:h(ei),children:[(0,o.jsx)(R.Z,{label:"Work Description",children:(0,o.jsx)(P.Z,(0,d.Z)((0,c.Z)({},er),{name:"description",rows:3}))}),y("admin")&&(0,o.jsx)(M.n,{entityId:u,entity:"Taxonomy",name:"tags",setValue:I,values:ee}),(0,o.jsx)(G.Z,{sx:W,control:(0,o.jsx)(T.Qr,{name:"reportPassFail",control:g,render:function(e){var t=e.onChange,n=e.value;return(0,o.jsx)(N.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:"Add Pass/Fail status"}),!!B&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(G.Z,{sx:W,control:(0,o.jsx)(T.Qr,{name:"requireReportRecommendations",control:g,render:function(e){var t=e.onChange,n=e.value;return(0,o.jsx)(N.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:'Require "Recommendations" if job fails'}),(0,o.jsxs)(R.Z,{label:"Specify text to appear Pass/Fail toggle",children:[(0,o.jsx)(P.Z,(0,d.Z)((0,c.Z)({},er),{name:"reportPassFailTitle",rows:3})),(null==f?void 0:f.reportPassFailTitle)&&(0,o.jsx)(O.Z,{sx:{m:0},children:null==f?void 0:null===(a=f.reportPassFailTitle)||void 0===a?void 0:a.message}),(0,o.jsxs)(J.Z,{children:[(null==X?void 0:X.length)||0,"/50"]})]})]}),(0,o.jsx)(D.Z,(0,d.Z)((0,c.Z)({},er),{data:et,legend:"Priority Work Orders",name:"slaIdReactive"})),K&&(0,o.jsx)(w.Z,{content:en||"-",context:"light"}),(0,o.jsx)(D.Z,(0,d.Z)((0,c.Z)({},er),{data:eo,legend:"Priority Quotes",name:"slaIdQuote"})),Y&&(0,o.jsx)(w.Z,{content:ea||"-",context:"light"}),(0,o.jsx)(U.l,(0,d.Z)((0,c.Z)({},er),{label:"Cost category",name:"costCategorySelected",type:"costCategory"})),(0,o.jsx)(V.P,(0,d.Z)((0,c.Z)({},er),{errors:(0,c.Z)({},f),name:"serviceSelected",label:"Service",type:"service"})),(0,o.jsx)(k.Z,(0,d.Z)((0,c.Z)({},er),{label:"Customer",name:"amount",vat:"Ex VAT"})),(0,o.jsxs)(A.Z,{children:[(0,o.jsx)(E.Z,{sm:12,md:6,children:(0,o.jsx)(k.Z,(0,d.Z)((0,c.Z)({},er),{label:"Supplier labour amount",name:"supplierLabourAmount",vat:"Ex VAT"}))}),(0,o.jsx)(E.Z,{sm:12,md:6,children:(0,o.jsx)(k.Z,(0,d.Z)((0,c.Z)({},er),{label:"Supplier materials amount",name:"supplierMaterialsAmount",vat:"Ex VAT"}))})]}),(0,o.jsx)(G.Z,{sx:W,control:(0,o.jsx)(T.Qr,{name:"customerSignature",control:g,render:function(e){var t=e.onChange,n=e.value;return(0,o.jsx)(N.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:"Require customer signature"}),(0,o.jsx)(G.Z,{sx:W,control:(0,o.jsx)(T.Qr,{name:"supplierSignature",control:g,render:function(e){var t=e.onChange,n=e.value;return(0,o.jsx)(N.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:"Require engineer signature"}),(0,o.jsx)("input",(0,c.Z)({type:"hidden"},x("tags")))]})};z.propTypes={defaultValues:l.object,onSuccess:l.func.isRequired};var W={color:Q.Q.COLOUR.dark,"& .MuiTypography-root":{fontFamily:"Arial,sans-serif,sans-serif"}},B=n(23390),X=n(70616),K=n(20705),Y=n(86267),ee=function(e){var t=e.entityId,n=(0,C.Z)((0,q.D)(p.ze),1)[0],a=function(e){n({variables:{id:t,changes:{meta:{imageLink:e[0].link}}}})};return(0,o.jsx)(Y.G,{entity:"Taxonomy",entityId:t,type:"image",onMediaAdd:a,onlySingleMedia:!0})},et=n(64872),en=function(e){var t,n=e.filters,a=e.props,i={item:"id",order:"desc"},r=(0,K.x)({filters:n,initialSort:i}),s=r.initialData,l=r.ref,u=(0,et.a)(),x=(0,d.Z)((0,c.Z)({},s),{isGroup:a.isAssetCategoryParent,typeGroup:(t=a.type,"expenseCategory"===t?"expenseCategoryGroup":t),fetchGroup:"expenseCategory"===a.type||"assetCategory"===a.type}),j=(0,m.a)(p.Im,{variables:x}),C=j.data,S=void 0===C?{taxonomy:[],meta:{aggregate:{totalCount:0}}}:C,q=S.taxonomy,T=S.meta,_=S.taxonomyGroup,R=j.loading,P=j.refetch,D=function(){P(),u.close()},w=function(e,t){var n,i;e.stopPropagation(),t||(t={status:"active"}),t.type=a.type,u.show({content:(0,o.jsx)(X.j,{defaultValues:t,onSuccess:D,isAssetCategoryParent:a.isAssetCategoryParent,groups:("expenseCategory"===a.type||I(a.type,a.isAssetCategoryParent))&&_,hasSublocation:q.find(function(e){var t;return(null===(t=e.meta)||void 0===t?void 0:t.sublocation)===!0}),systemQuestions:{sensor:void 0!==q.find(function(e){var t;return null===(t=e.childs)||void 0===t?void 0:t.find(function(e){var t,n;return(null===(t=e.meta)||void 0===t?void 0:t.isSystem)&&(null===(n=e.meta)||void 0===n?void 0:n.questionType)==="sensor"})})}}),title:t.id?"Edit":"Add ".concat(a.title)})},k=function(e){u.show({content:(0,o.jsx)(B.R,{defaultValues:e,type:"jobTags"===a.type?"jobQuestion":"assetQuestion",parentId:e.id,groups:{}}),submit:!1,title:"Questions"})},A=function(e){u.show({content:(0,o.jsx)(z,{defaultValues:(0,d.Z)((0,c.Z)({},e.meta),{name:e.name}),groups:{},onSuccess:D,parentId:e.id}),title:e.name,width:"35%"})},E=function(e){u.show({content:(0,o.jsx)(ee,{entityId:e.id}),title:e.name,width:"35%",submit:!1})},F=[{context:"secondary",icon:["fas","edit"],onClick:function(e,t){return w(e,t)},tooltip:"Edit"}];["jobTags","assetCategory"].includes(a.type)&&!a.isAssetCategoryParent&&F.push({context:"info",icon:["fas","question"],numberOverlay:"childCount",onClick:function(e,t){return k(t)},tooltip:"Manage Questions"}),"jobTags"===a.type&&F.push({context:"secondary",icon:["fas","info-circle"],numberOverlay:"hasDescription",onClick:function(e,t){return A(t)},tooltip:"Add Template"}),"issueType"===a.type&&F.push({context:"secondary",icon:["fas","info-circle"],numberOverlay:"hasDescription",onClick:function(e,t){return E(t)},tooltip:"Add issue type photo"});var V=[{hidden:!0},{hidden:!0},{text:"Name"},{hidden:"expenseCategory"!==a.type&&!I(a.type,a.isAssetCategoryParent),text:"Group"},{hidden:"jobTags"!==a.type,text:"Jobs"},{hidden:!0},{hidden:"assetCategory"!==a.type||a.isAssetCategoryParent,text:"TCO"},{hidden:"assetCategory"!==a.type||a.isAssetCategoryParent,text:"Sensor"},{hidden:"assetCategory"!==a.type||a.isAssetCategoryParent,text:"Sublocation"},{text:"Status"},{hidden:"signatures"!==a.type,text:"Display for"},{hidden:!0},{hidden:!0,text:"meta"},{hidden:!0},{formatter:y.Z,formatterData:F,text:"Actions"}],U=function(){return(0,o.jsx)(g.Z,{children:(0,o.jsx)(f.Z,{context:"secondary",content:"Add New",onClick:w,size:"sm"})})};return(0,o.jsx)(h.Z,{handleClick:w,open:!0,title:a.title,toolbar:(0,o.jsx)(U,{}),children:(0,o.jsx)(Z.t,{columns:V,loading:R,meta:T,ref:l,initialSort:i,refetch:P,rows:q.map(function(e){var t,n,o,a,i,r,s,l,u,c,d=[];return((null===(t=e.meta)||void 0===t?void 0:t.customerSignature)||(null===(n=e.meta)||void 0===n?void 0:n.supplierSignature))&&((null===(s=e.meta)||void 0===s?void 0:s.customerSignature)&&d.push("Customer"),(null===(l=e.meta)||void 0===l?void 0:l.supplierSignature)&&d.push("Supplier")),{id:e.id,parentId:e.parentId,name:e.name,groupText:null===(o=e.parent)||void 0===o?void 0:o.name,jobs:e.jobs.aggregate.count,status:e.status,hasTCO:(u=null==e?void 0:e.childs).find(function(e){var t,n;return(null===(t=e.meta)||void 0===t?void 0:t.isSystem)&&(null===(n=e.meta)||void 0===n?void 0:n.questionType)==="tco"})&&b("TCO"),hasSensor:(c=null==e?void 0:e.childs).find(function(e){var t,n;return(null===(t=e.meta)||void 0===t?void 0:t.isSystem)&&(null===(n=e.meta)||void 0===n?void 0:n.questionType)==="sensor"})&&b("Sensor"),hasSublocation:(null===(a=e.meta)||void 0===a?void 0:a.sublocation)&&b("Sub-location"),statusText:(0,v.Z)(e.status),displayFor:d.length>0&&d.join(", "),childCount:null===(i=e.childs)||void 0===i?void 0:i.length,meta:e.meta,hasDescription:(null===(r=e.meta)||void 0===r?void 0:r.template)?"1":"",actions:""}})})})};en.propTypes={filters:l.object};var eo=n(46929),ea=n(21789),ei=function(e){var t=e.control,n=e.errors,a=e.register,r=e.setFilters,s=e.props,l=e.watch,u={control:t,errors:n,register:a},m=l("parentId");return(0,i.useEffect)(function(){r(function(e){return(0,d.Z)((0,c.Z)({},e),{parentId:(null==m?void 0:m.value)||null,type:s.type})})},[m]),(0,o.jsxs)(A.Z,{align:"baseline",children:[(0,o.jsx)(E.Z,{md:6,children:(0,o.jsx)(eo.r,(0,d.Z)((0,c.Z)({},u),{onChange:function(e){return r(function(t){return(0,d.Z)((0,c.Z)({},t),{status:e.target.value||null,type:s.type})})},options:ea.bg}))}),"expenseCategory"===s.type&&(0,o.jsx)(E.Z,{md:6,children:(0,o.jsx)(V.P,(0,d.Z)((0,c.Z)({},u),{errors:(0,c.Z)({},n),label:"",name:"parentId",placeholder:"Group",type:"taxonomyGroup",isClearable:!0,taxonomyGroupType:"expenseCategoryGroup"}))})]})};ei.propTypes={control:l.object.isRequired,errors:l.object.isRequired,register:l.func.isRequired,setFilters:l.func.isRequired};var er=function(e){var t={q:null,status:null,type:e.type||"",parentId:null,filterType:"taxonomy_table"};return(0,o.jsx)(u.J,{FiltersComp:ei,initialFilters:t,props:e,TableComp:en})};er.propTypes={type:(0,l.oneOf)(["assetCategory","complianceCategory","expenseCategory","costCategory","tags","supplierQuestion","signatures"])};var es=n(18586),el=function(){var e,t,n=(0,r.useRouter)().query,a=(0,es.q)(),l=null==a?void 0:null===(e=a.admin)||void 0===e?void 0:null===(t=e.modules)||void 0===t?void 0:t.assets,u=(0,i.useMemo)(function(){return n.tab||"expense-categories"},[n.tab]),c=[(0,o.jsx)("div",{active:"expense-categories"===u,label:"Expense Categories",children:(0,o.jsx)(er,{type:"expenseCategory",title:"Expense Categories"})}),(0,o.jsx)("div",{active:"cost-categories"===u,label:"Cost Categories",children:(0,o.jsx)(er,{type:"costCategory",title:"Cost Categories"})}),(0,o.jsx)("div",{active:"job-templates-and-questions"===u,label:"Job templates and questions",children:(0,o.jsx)(er,{type:"jobTags",title:"Job Descriptions"})}),(0,o.jsx)("div",{active:"supplier-questions"===u,label:"Supplier Questions",children:(0,o.jsx)(er,{type:"supplierQuestion",title:"Supplier Questions"})}),(0,o.jsx)("div",{hide:!l,active:"asset-categories"===u,label:"Asset Categories",children:(0,o.jsxs)(s.Z,{handleChange:!1,children:[(0,o.jsx)("div",{active:!0,label:"Asset Categories Parent",children:(0,o.jsx)(er,{type:"assetCategory",title:"Asset Categories Parent",isAssetCategoryParent:!0})}),(0,o.jsx)("div",{label:"Asset Categories Child",children:(0,o.jsx)(er,{type:"assetCategory",title:"Asset Categories Child"})})]})}),(0,o.jsx)("div",{active:"compliance-categories"===u,label:"Compliance Categories",children:(0,o.jsx)(er,{type:"complianceCategory",title:"Compliance Categories"})}),(0,o.jsx)("div",{active:"client-type"===u,label:"Client Type",children:(0,o.jsx)(er,{type:"clientType",title:"Client Type"})}),(0,o.jsx)("div",{active:"tags"===u,label:"Tags",children:(0,o.jsx)(er,{type:"tags",title:"Tags"})}),(0,o.jsx)("div",{active:"job-hold-reason"===u,label:"Job Hold Reason",children:(0,o.jsx)(er,{type:"jobHoldReason",title:"Job Hold Reason"})}),(0,o.jsx)("div",{active:"signatures"===u,label:"Signatures",children:(0,o.jsx)(er,{type:"signatures",title:"Signatures"})}),(0,o.jsx)("div",{active:"issue-types"===u,label:"Issue Types",children:(0,o.jsx)(er,{type:"issueType",title:"Issue types"})})];return(0,o.jsx)(s.Z,{children:c.filter(function(e){return!e.props.hide}).map(function(e){return e})},u)},eu=function(){return(0,o.jsx)(a.Z,{pageHeading:{heading:"Categories"},View:(0,o.jsx)(el,{})})}}},function(e){e.O(0,[3662,2283,212,619,8890,2583,4135,6043,1564,1336,3776,5370,2329,778,6540,4046,1023,1870,2797,9241,653,5497,597,8948,1191,5558,6733,1741,9785,9774,2888,179],function(){return e(e.s=23570)}),_N_E=e.O()}]);