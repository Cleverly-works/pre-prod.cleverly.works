(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5503,4972],{20633:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/issues/manage",function(){return t(65647)}])},52971:function(e,n,t){"use strict";t.d(n,{V:function(){return _}});var i=t(26042),r=t(69396),o=t(29815),a=t(85893),s=t(45697),l=t.n(s),u=t(93946),c=t(51233),d=t(15861),m=t(21023),p=t(96540),f=t(67294),v=t(12547),h=t(42283),y=t(79665),g=t(11057),x=t(50135),Z=t(77957),b=t(41733),j=t(74231),q=j.Ry({name:j.Z_().required(),url:j.Z_().url().required()}),I=function(e){var n=e.noEdit,t=e.noDelete,o=e.onDelete,s=e.id,l=e.isAdded,d=e.url,p=e.name,j=e.onSave,I=(0,f.useState)(l),_=I[0],S=I[1],$=(0,h.cI)({resolver:(0,y.S)(q)}),w=$.control,C=$.handleSubmit,A=$.errors,D=function(e){e.stopPropagation(),S(!0)},P=function(e){e.stopPropagation(),S(!1),p&&d||o()},T=function(e){j(e),S(!1)};return(0,a.jsx)("form",{children:_?(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)(c.Z,{spacing:1,children:[(0,a.jsx)(h.Qr,{control:w,name:"name",defaultValue:p,render:function(e){var n;return(0,a.jsx)(x.Z,(0,r.Z)((0,i.Z)({fullWidth:!0,label:"Name",variant:"standard",color:"secondary"},e),{error:A.name,helperText:null===(n=A.name)||void 0===n?void 0:n.message}))}}),(0,a.jsx)(h.Qr,{control:w,name:"url",defaultValue:d,render:function(e){var n;return(0,a.jsx)(x.Z,(0,r.Z)((0,i.Z)({fullWidth:!0,label:"Link",variant:"standard",color:"secondary"},e),{error:A.url,helperText:null===(n=A.url)||void 0===n?void 0:n.message}))}})]}),(0,a.jsxs)(c.Z,{direction:"row",justifyContent:"flex-end",spacing:1,mt:2,children:[(0,a.jsx)(g.Z,{variant:"contained",color:"danger",size:"small",onClick:P,children:"Cancel"}),(0,a.jsx)(g.Z,{variant:"contained",size:"small",onClick:C(T),children:"Save"})]})]}):(0,a.jsxs)(c.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsx)(v.r,{target:"_blank",variant:"body1",color:"secondary",href:d,sx:{textDecoration:"auto",fontWeight:700},children:p}),!n&&(0,a.jsx)(m.Z,{title:"Edit",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:D,children:(0,a.jsx)(Z.Z,{sx:{fontSize:"16px"}})})}),!t&&(0,a.jsx)(m.Z,{title:"Delete",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:function(){return o(s)},children:(0,a.jsx)(b.Z,{sx:{fontSize:"16px"}})})})]})})};I.defaultProps={isAdded:!1,noEdit:!1,noDelete:!1,url:"",name:"",onSave:function(){},onCancel:function(){},onDelete:function(){}},I.propTypes={isAdded:l().bool,noEdit:l().bool,noDelete:l().bool,url:l().string,name:l().string,onSave:l().func,onCancel:l().func,onDelete:l().func};var _=function(e){var n=e.values,t=e.setValue,s=e.name,l=e.title,v=e.displayMode,h=e.noDeleteEdit,y=e.titleSx,g=(0,f.useState)([]),x=g[0],Z=g[1];(0,f.useEffect)(function(){Array.isArray(n)&&Z(n)},[n]);var b=function(e){e.stopPropagation(),Z(function(e){return(0,o.Z)(e).concat([{name:"",link:"",isAdded:!0}])})},j=function(e,n){var i=(0,o.Z)(x);i.splice(e,1,n),t(s,i)};return(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)(c.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsxs)(d.Z,{sx:y,children:[l,":"]}),!v&&(0,a.jsx)(m.Z,{title:"Add new link",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:b,children:(0,a.jsx)(p.Z,{})})})]}),(0,a.jsx)(c.Z,{pl:2,spacing:.8,children:(null==x?void 0:x.length)?x.map(function(e,o){var l;return(0,a.jsx)(I,(0,r.Z)((0,i.Z)({index:o},e),{noEdit:h||v,noDelete:h||v,onDelete:function(){var e=n.filter(function(e,n){return n!==o});t(s,e),Z(e)},onSave:function(e){return j(o,e)}}))}):(0,a.jsx)(d.Z,{typography:"subtitle2",children:"No data"})})]})};_.defaultProps={values:[],setValue:function(){},title:"Related links",displayMode:!1,noDeleteEdit:!1,titleSx:{}},_.propTypes={values:l().arrayOf(l().shape({isAdded:l().bool,noEdit:l().bool,url:l().string,name:l().string})),titleSx:l().object,setValue:l().func,noDeleteEdit:l().bool}},5336:function(e,n,t){"use strict";t.d(n,{C:function(){return A}});var i=t(85893),r=t(67294),o=t(45697),a=t.n(o),s=t(93946),l=t(25464),u=t(18972),c=t(57976),d=t(73890),m=t(69008),p=t(41687),f=t(60888),v=t(40535),h=t(63441),y=t(41733),g=t(77957),x=t(2548),Z=t(24519),b=t(2391),j=t(69308),q=t(79369),I=t(22961),_=t(28201),S=t(51233),$=t(15861),w={add:(0,i.jsx)(p.Z,{}),archive:(0,i.jsx)(d.Z,{}),avatar:(0,i.jsx)(_.Z,{}),check:(0,i.jsx)(f.Z,{}),delete:(0,i.jsx)(y.Z,{}),description:(0,i.jsx)(v.Z,{}),download:(0,i.jsx)(h.Z,{}),info:(0,i.jsx)(x.Z,{}),edit:(0,i.jsx)(g.Z,{}),location:(0,i.jsx)(j.Z,{}),unarchive:(0,i.jsx)(m.Z,{}),uploadFile:(0,i.jsx)(Z.Z,{}),receipt:(0,i.jsx)(b.Z,{}),visibility:(0,i.jsx)(I.Z,{})},C={default:(0,i.jsx)(c.Z,{}),defaultHoriz:(0,i.jsx)(q.Z,{}),description:(0,i.jsx)(v.Z,{})},A=function(e){var n=e.actionsData,t=e.icon,o=e.row,a=e.disabled,c=(0,r.useState)(null),d=c[0],m=c[1],p=function(e){e.stopPropagation(),m(e.currentTarget)},f=function(){m(null)};return(0,i.jsxs)("div",{children:[(0,i.jsx)(s.Z,{sx:{":hover":{backgroundColor:"#DDDDDD"}},disabled:a,"aria-controls":"simple-menu","aria-haspopup":"true",onClick:p,children:C[t]}),(0,i.jsx)(l.Z,{id:"simple-menu",anchorEl:d,keepMounted:!0,open:Boolean(d),onClose:f,PaperProps:{sx:{borderRadius:2}},children:n(o).map(function(e,n){return(0,i.jsx)(u.Z,{disabled:e.disabled,onClick:function(n){e.onClick(n),f()},sx:{pl:3,pr:4},children:(0,i.jsxs)(S.Z,{direction:"row",alignItems:"center",spacing:2,children:[(null==w?void 0:w[e.icon])||null,(0,i.jsx)($.Z,{children:e.tooltip})]})},n)})})]})};A.propTypes={actionsData:a().func.isRequired,icon:a().oneOf(["default","description"]),row:a().any.isRequired,disabled:a().bool},A.defaultProps={actionsData:function(){return[{disabled:!1,onClick:function(){},icon:"edit",tooltip:"Edit"}]},icon:"default",disabled:!1}},46602:function(e,n,t){"use strict";t.d(n,{k:function(){return Z}});var i=t(26042),r=t(69396),o=t(85893),a=t(45697),s=t(42283),l=t(79665),u=t(76600),c=t(9270),d=t(62140),m=t(49501),p=t(55563),f=t(6710),v=t(95103),h=t(74231),y=(0,h.Ry)().shape({name:(0,h.Z_)(),invoicingEntity:(0,h.Z_)(),addressLine1:(0,h.Z_)().required(),addressLine2:(0,h.Z_)(),addressLine3:(0,h.Z_)(),city:(0,h.Z_)().required(),postCode:(0,h.Z_)().matches("^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?))))\\s?[0-9][A-Za-z]{2})$|^([AC-FHKNPRTV-Y]\\d{2}|D6W)\\s[0-9AC-FHKNPRTV-Y]{4}$").required(),county:(0,h.Z_)(),countryId:(0,h.Z_)().required()}),g=t(25742),x=t(73760),Z=function(e){var n=e.defaultValues,t=(e.onCancel,e.onSubmit),a=e.type,h=(0,s.cI)({defaultValues:(0,i.Z)({},n),resolver:(0,l.S)(y)}),Z=h.control,b=h.errors,j=h.handleSubmit,q={control:Z,errors:b,register:h.register};return(0,o.jsxs)(u.Z,{id:"offCanvasForm",handleSubmit:j(t),children:[(0,o.jsxs)(c.Z,{children:[(0,o.jsx)(d.Z,{md:12,children:(0,o.jsx)(m.Z,{label:"Address name",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},q),{name:"name"}))})}),"invoice"===a&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.Z,{md:12,children:(0,o.jsx)(m.Z,{label:"invoicing email",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},q),{name:"invoicingEmail",type:"email"}))})}),(0,o.jsx)(d.Z,{md:12,children:(0,o.jsx)(m.Z,{label:"Invoicing entity",children:(0,o.jsx)(f.Z,(0,r.Z)((0,i.Z)({},q),{name:"invoicingEntity",rows:4}))})})]}),(0,o.jsx)(d.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Address Line 1",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},q),{name:"addressLine1"}))})}),(0,o.jsx)(d.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Address Line 2",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},q),{name:"addressLine2"}))})}),(0,o.jsx)(d.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Address Line 3",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},q),{name:"addressLine3"}))})}),(0,o.jsx)(d.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"City",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},q),{name:"city"}))})}),(0,o.jsx)(d.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Post Code",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},q),{name:"postCode"}))})}),(0,o.jsx)(d.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"County",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},q),{name:"county"}))})}),(0,o.jsx)(d.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Country",children:(0,o.jsx)(v.Z,(0,r.Z)((0,i.Z)({},q),{name:"countryId",options:x.O}))})})]}),(0,o.jsx)(c.Z,{justify:"end",children:(0,o.jsx)(d.Z,{md:12,children:(0,o.jsx)(g.H,{content:"Submit",type:"submit"})})}),(null==n?void 0:n.id)&&(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},q),{name:"id",type:"hidden"})),(null==n?void 0:n.meta)&&(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},q),{name:"meta",type:"hidden"}))]})};Z.propTypes={defaultValues:a.object,onCancel:a.func.isRequired,onSubmit:a.func.isRequired,type:a.string}},25993:function(e,n,t){"use strict";t.d(n,{V:function(){return U}});var i=t(47568),r=t(26042),o=t(69396),a=t(828),s=t(97582),l=t(85893),u=t(67294),c=t(45697),d=t(6812),m=t(50319),p=t(51809),f=t(11163),v=t.n(f),h=t(42283),y=t(79665),g=t(76600),x=t(15214),Z=t(9270),b=t(62140),j=t(49501),q=t(55563),I=t(6710),_=t(95103),S=t(84043),$=t(11057),w=t(69368),C=t(50480),A=t(6054),D=t(66812),P=function(e){var n=e.accountId,t=e.accountName,i=e.canSelectAccount,a=e.control,s=e.errors,c=e.setValue,d=e.watch,m=n?{value:n,label:t}:d("propertyOwner"),p=(0,A.Z)(m),f=function(e){c("contactUser",null)};(0,u.useEffect)(function(){m!==p&&p&&f(m)},[m]);var v={control:a,errors:s};return(0,l.jsxs)(Z.Z,{children:[(0,l.jsx)(b.Z,{md:6,children:(0,l.jsx)(D.P,(0,o.Z)((0,r.Z)({},v),{defaultValue:n&&{value:n,label:t},errors:(0,r.Z)({},s),isDisabled:!i,label:"Client",name:"propertyOwner",placeholder:"Select",type:"customer"}))}),(0,l.jsx)(b.Z,{md:6,children:(0,l.jsx)(D.P,(0,o.Z)((0,r.Z)({},v),{accountId:(null==m?void 0:m.value)||null,errors:(0,r.Z)({},s),isDisabled:!m,label:"Contact Name",name:"contactUser",placeholder:m?"Select":"Select the location owner",type:"user"}))})]})};P.propTypes={accountId:c.number,accountName:c.string,canSelectAccount:c.bool.isRequired,control:c.func.isRequired,errors:c.object.isRequired,setValue:c.func.isRequired,watch:c.func.isRequired};var T=t(22595),k=function(e,n){var t=e.propertyOwner,i=e.contactUser;return e.Account_Locations={data:{accountId:t.value}},delete e.propertyOwner,e.contactUserId=(null==i?void 0:i.value)||null,delete e.contactUser,n&&delete e.Account_Locations,e},R=function(e,n,t,i){var r={location:k(e,!0),locationId:n.locationId,accountId:n.accountId,newAccountId:n.newAccountId,hasChanged:n.hasChanged};i({variables:r})},E=t(74231),L=t(46602),F=t(21789),M=t(2845),V=t(64872),N="/dashboard/properties/",U=function(e){var n,t,c,f,A=e.accountId,D=e.accountName,U=e.entity,z=e.data,W=e.refetch,G=e.onAddressCreated,O=e.isPropsComponent,H=e.initialValues,Q=e.xeroContactId,B=e.displayXeroContacts,J=e.xeroContacts,X=e.displaySignin,Y=e.handleXeroAuthorize,K=e.onClose,ee=(0,V.a)(),en=(0,M.x)().hasRole,et=(0,u.useState)(!1),ei=et[0],er=et[1],eo=null==J?void 0:J.find(function(e){return e.value===Q}),ea=(0,o.Z)((0,r.Z)({},z?(location.propertyOwner={label:z.customer[0].account.name,value:z.customer[0].account.id},location.contactUser=(null==z?void 0:z.user)&&z.customer[0].account.id&&{label:z.user.fullName,value:z.user.id},location.access=z.access,location.name=z.name,location.status=z.status,location.permitsRequired=z.permitsRequired,location):{},H),{xeroContact:eo})||{},es=(0,h.cI)({defaultValues:ea,resolver:(0,y.S)((0,E.Ry)().shape({access:(0,E.Z_)().required(),contactUser:(0,E.Ry)().required(),name:(0,E.Z_)().required(),propertyOwner:(0,E.Ry)().required(),status:en("admin")&&(0,E.Z_)().required(),permitsRequired:(0,E.O7)()}))}),el=es.control,eu=es.errors,ec=es.handleSubmit,ed=es.register,em=es.setValue,ep=es.getValues,ef=es.watch,ev=(0,d.a)(p.yf,{variables:{id:null==z?void 0:z.id},skip:!(null==z?void 0:z.id)}).data,eh=(void 0===ev?{property:{}}:ev).property,ey=(c=(0,i.Z)(function(e){var n,t,i,o,a,l,u,c,d,m,p;return(0,s.__generator)(this,function(a){switch(a.label){case 0:var s,u;return n=e.addressFormData,t=e.outerFormData,i={Addresses:{data:{Address:{data:(0,r.Z)({},n)},entity:U}}},o=(0,r.Z)({},ep(),i,t),en("customer")&&(o.status="active"),[4,eZ({variables:{objects:[k(s=o)]}})];case 1:return p=void 0===(m=(void 0===(c=(void 0===(l=a.sent().data)?{}:l).insert_Location)?{}:c).returning)?{}:m,G&&G(p),ee.close(),[2]}})}),function(e){return c.apply(this,arguments)}),eg=(f=(0,i.Z)(function(e){return(0,s.__generator)(this,function(n){return ee.show({title:"Add new address",content:(0,l.jsx)(L.k,{onCancel:function(){},onSubmit:function(n){ey({addressFormData:n,outerFormData:e})},type:"text"}),submit:!1}),[2]})}),function(e){return f.apply(this,arguments)}),ex=(0,a.Z)((0,m.D)(p.A1,{onCompleted:function(e){if(!O){var n=e.insert_Location.returning[0].id;ee.close(),W?W():v().push("".concat(N,"view?id=").concat(n))}}}),2),eZ=ex[0],eb=ex[1].loading,ej=(0,a.Z)((0,m.D)(p.$A,{onCompleted:function(e){var n=e.update_Location_by_pk.id;ee.close(),W?W():v().push("".concat(N,"view?id=").concat(n))}}),2),eq=ej[0],eI=ej[1].loading,e_=(0,a.Z)((0,m.D)(p.$E),1)[0],eS=function(e){if(er(!1),z){if("inactive"===e.status&&!(n=eh.jobs).every(function(e){return!!(0,T.E)(e,["completed","closed"])})){er(!0);return}e.xeroContact&&e_({variables:{id:null===(s=null==z?void 0:z.customer[0])||void 0===s?void 0:s.account.id,changes:{meta:(0,o.Z)((0,r.Z)({},null===(l=null==z?void 0:z.customer[0])||void 0===l?void 0:l.account.meta),{xeroContactId:e.xeroContact.value})}}});var n,t,i,a,s,l,u={locationId:null==z?void 0:z.id,accountId:null===(t=null==z?void 0:z.customer[0])||void 0===t?void 0:t.account.id,newAccountId:null==e?void 0:null===(i=e.propertyOwner)||void 0===i?void 0:i.value,hasChanged:(null===(a=null==z?void 0:z.customer[0])||void 0===a?void 0:a.account.id)!==(null==e?void 0:e.propertyOwner.value)};R((0,o.Z)((0,r.Z)({},e),{xeroContact:void 0}),u,z.id,eq),K()}else eg(e),K()},e$={control:el,errors:eu,register:ed};return(0,l.jsxs)(g.Z,{disabled:eb||eI,id:"offCanvasForm",handleSubmit:ec(eS),children:[ei&&(0,l.jsx)(x.Z,{context:"info",content:" This location cannot be made inactive, it has active jobs."}),(0,l.jsx)(Z.Z,{children:(0,l.jsx)(b.Z,{md:12,children:(0,l.jsx)(P,(0,o.Z)((0,r.Z)({},e$),{accountId:A,accountName:D,canSelectAccount:!A,setValue:em,watch:ef}))})}),(0,l.jsx)(j.Z,{label:"Name",children:(0,l.jsx)(q.Z,(0,o.Z)((0,r.Z)({},e$),{name:"name"}))}),(0,l.jsx)(j.Z,{label:"Access information",children:(0,l.jsx)(I.Z,(0,o.Z)((0,r.Z)({},e$),{name:"access",rows:4}))}),en("admin")&&(0,l.jsx)(j.Z,{label:"Status",children:(0,l.jsx)(_.Z,(0,o.Z)((0,r.Z)({},e$),{name:"status",options:F.bg}))}),(0,l.jsx)(h.Qr,{name:"permitsRequired",control:el,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(C.Z,{control:(0,l.jsx)(w.Z,{color:"secondary",checked:n||!1,onChange:function(e){return t(e.target.checked)}}),label:"Permits required"})}}),en("admin")&&void 0!==B&&B&&(0,l.jsx)(j.Z,{label:"Xero Contact",children:X?(0,l.jsx)($.Z,{variant:"contained",onClick:function(){Y()},children:"Connect to Xero to select Contact"}):(0,l.jsx)(S.Z,(0,o.Z)((0,r.Z)({options:J},e$),{name:"xeroContact"}))})]})};P.propTypes={accountId:c.number,accountName:c.string,data:c.object,refetch:c.func,offCanvas:c.func}},51809:function(e,n,t){"use strict";t.d(n,{$A:function(){return v},$E:function(){return h},A1:function(){return f},Un:function(){return p},yf:function(){return y}});var i=t(7297),r=t(75063);function o(){var e=(0,i.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return o=function(){return e},e}function a(){var e=(0,i.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n']);return a=function(){return e},e}function s(){var e=(0,i.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return s=function(){return e},e}function l(){var e=(0,i.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]);return l=function(){return e},e}function u(){var e=(0,i.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return u=function(){return e},e}function c(){var e=(0,i.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,i.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"]);return d=function(){return e},e}function m(){var e=(0,i.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]);return m=function(){return e},e}(0,r.Ps)(o());var p=(0,r.Ps)(a()),f=(0,r.Ps)(s()),v=(0,r.Ps)(l()),h=(0,r.Ps)(u());(0,r.Ps)(c()),(0,r.Ps)(d());var y=(0,r.Ps)(m())},13262:function(e,n,t){"use strict";t.d(n,{f:function(){return $}});var i=t(26042),r=t(69396),o=t(29815),a=t(85893),s=t(67294),l=t(45697),u=t.n(l),c=t(15861),d=t(93946),m=t(51233),p=t(21023),f=t(96540),v=t(79665),h=t(50135),y=t(11057),g=t(90948),x=t(42283),Z=t(41733),b=t(40656),j=t(74231),q=j.Ry().shape({caption:j.Z_()}),I=(0,g.ZP)(c.Z)({backgroundColor:b.Q.COLOUR.secondary,color:b.Q.COLOUR.white,textAlign:"center",minWidth:"64px",borderRadius:"4px",margin:"10px 0",padding:"4px 10px",boxShadow:"0px 3px 1px -2px rgba(0,0,0,0.2),\n    0px 2px 2px 0px rgba(0,0,0,0.14),\n    0px 1px 5px 0px rgba(0,0,0,0.12)"}),_=(0,g.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),S=function(e){var n,t=e.noDelete,o=e.onDelete,l=e.isAdded,u=e.media,f=e.caption,g=e.onSave,j=(0,s.useState)(null),S=j[0],$=j[1],w=(0,s.useState)(""),C=w[0],A=w[1],D=(0,s.useState)(l),P=D[0],T=D[1],k=(0,x.cI)({resolver:(0,v.S)(q)}),R=k.register,E=k.errors,L=k.handleSubmit,F=k.reset,M=function(e){e.stopPropagation(),$(null),F()},V=function(e){e.stopPropagation(),T(!1),o()},N=function(e){S&&(g((0,r.Z)((0,i.Z)({},e),{media:S,type:C})),T(!1))},U=(0,s.useCallback)(function(e){return function(n){n.stopPropagation();var t=n.target.files[0];A(e),$(t)}},[$]);return(0,a.jsx)("form",{children:P?(0,a.jsx)(m.Z,{children:(0,a.jsxs)(m.Z,{rowGap:2,children:[(0,a.jsx)(h.Z,{fullWidth:!0,label:"Caption",variant:"standard",color:"secondary",name:"caption",inputRef:R,error:E.name,helperText:null===(n=E.name)||void 0===n?void 0:n.message}),S?(0,a.jsxs)(m.Z,{rowGap:3,children:[(0,a.jsxs)(m.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(c.Z,{sx:{color:b.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:S.name}),(0,a.jsx)(p.Z,{title:"Delete",placement:"top-start",children:(0,a.jsx)(d.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:M,children:(0,a.jsx)(Z.Z,{})})})]}),(0,a.jsxs)(m.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,a.jsx)(y.Z,{variant:"contained",color:"danger",size:"small",onClick:V,children:"Cancel"}),(0,a.jsx)(y.Z,{variant:"contained",size:"small",onClick:L(N),children:"Save"})]})]}):(0,a.jsxs)(m.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,a.jsxs)(I,{component:"label",children:["Add image\xa0",(0,a.jsx)(_,{onChange:U("image"),type:"file",accept:"image/*, .heic"})]}),(0,a.jsxs)(I,{component:"label",children:["Add document\xa0",(0,a.jsx)(_,{onChange:U("document"),type:"file",accept:".pdf, .doc, .docx, .xlsx",multiple:!0})]})]})]})}):(0,a.jsxs)(m.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:1,children:[(0,a.jsx)(c.Z,{sx:{color:b.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:f||(null==u?void 0:u.name)||"No caption"}),!t&&(0,a.jsx)(p.Z,{title:"Delete",placement:"top-start",children:(0,a.jsx)(d.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:o,children:(0,a.jsx)(Z.Z,{sx:{fontSize:"16px"}})})})]})})};S.propTypes={noDelete:u().func,onDelete:u().func,isAdded:u().bool,media:u().object,onSave:u().func};var $=function(e){var n=e.values,t=e.setValue,l=e.name,u=e.title,v=e.titleSx,h=e.onDeleteExistingMedia,y=(0,s.useState)([]),g=y[0],x=y[1];(0,s.useEffect)(function(){Array.isArray(n)&&x(n)},[n]);var Z=function(e){e.stopPropagation(),x(function(e){return(0,o.Z)(e).concat([{mediaId:null,caption:"",media:null,type:"",isAdded:!0}])})},b=function(e,n){var i=(0,o.Z)(g);i.splice(e,1,n),t(l,i)};return(0,a.jsxs)(m.Z,{children:[(0,a.jsxs)(m.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsx)(c.Z,{sx:v,children:u?u+":":""}),(0,a.jsx)(p.Z,{title:"Add new attachment",placement:"top-start",children:(0,a.jsx)(d.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:Z,children:(0,a.jsx)(f.Z,{})})})]}),(0,a.jsx)(m.Z,{pl:2,spacing:.8,children:(null==g?void 0:g.length)?g.map(function(e,n){var o;return(0,a.jsx)(S,(0,r.Z)((0,i.Z)({index:n},e),{onDelete:function(){h&&g[n].mediaId&&h(g[n].mediaId);var e=g.filter(function(e,t){return t!==n});t(l,e),x(e)},onSave:function(e){return b(n,e)}}),e.caption+n)}):(0,a.jsx)(c.Z,{typography:"subtitle2",children:"No data"})})]})};$.propTypes={values:u().array,setValue:u().func,name:u().string,title:u().string,titleSx:u().object,onDeleteExistingMedia:u().func},$.defaultProps={name:"attachments",title:"Attachments",titleSx:{}}},35418:function(e,n,t){"use strict";t.d(n,{G:function(){return T}});var i=t(26042),r=t(69396),o=t(7297),a=t(85893),s=t(67294),l=t(45697),u=t(6812),c=t(52824),d=t(10367),m=t(78289),p=t(41564),f=t(34953),v=t(62466),h=t(68956),y=t(73373),g=t(11585),x=t(18678),Z=t(55377),b=t(16551),j=t(77439),q=t(74297),I=t(23892),_=t(39087),S=t(76256),$=t(75795),w=t(91272),C=t(20705),A=t(2845);function D(){var e=(0,o.Z)(["\n  width: 24px;\n"]);return D=function(){return e},e}function P(){var e=(0,o.Z)(["\n  border: 1px solid #eee;\n"]);return P=function(){return e},e}var T=function(e){var n=e.carousel,t=e.category,o=e.children,l=e.data,d=(e.details,e.entity),D=e.entityId,P=e.filters,T=(e.limit,e.listView),E=e.mediaMeta,L=e.onMediaAdd,F=e.onMediaRemove,M=(e.pagination,e.showActionButtons),V=e.showEntityColumn,N=e.showItemActions,U=e.summary,z=e.type,W=(0,C.x)({filters:P}),G=W.initialData,O=W.ref,H=(0,A.x)(),Q=H.hasRole,B=H.user,J=(0,s.useContext)(m.Z),X=(0,u.a)(c.t,{variables:(0,r.Z)((0,i.Z)({},G),{entity:d,entityId:D,category:t,adminId:B.adminId,meta:E})}),Y=X.data,K=void 0===Y?{items:[],meta:{aggregate:{totalCount:0}}}:Y,ee=K.items,en=K.meta,et=X.loading,ei=X.refetch,er=function(e){J.close(),l.length||ei(),L&&L(e)},eo=function(e){J.close(),l.length||ei(),F&&F(e)},ea=function(e){e.stopPropagation(),J.show({content:(0,a.jsx)(S.z,{accept:"image/*",adminId:B.adminId,category:t,entity:d,entityId:D,expiryShow:!1,mediaMeta:E,multiple:!0,onSuccess:er,type:"image"}),title:"Upload Photos"})},es=function(e){e.stopPropagation(),J.show({content:(0,a.jsx)(S.z,{accept:".pdf, .doc, .docx, .xlsx",adminId:B.adminId,category:t,entity:d,entityId:D,expiryShow:!1,mediaMeta:E,onSuccess:er,type:"document"}),title:"Upload Documents"})},el=function(e){J.show({content:(0,a.jsx)(I.d,{mediaId:e.data.id,onSuccess:eo}),submit:!1,title:"Delete Media"})},eu=function(e){J.show({content:(0,a.jsx)(_.z,{media:e.data,toggleShow:J.close}),submit:!1,title:"Media Details",width:"50%"})},ec=[{context:"primary",icon:["fas","info-circle"],onClick:function(e,n){return eu(n)},tooltip:"Details"}];Q("admin")&&ec.push({context:"danger",icon:["fas","trash"],onClick:function(e,n){return el(n)},tooltip:"Delete"});var ed=[{hidden:!0},{hidden:!0},{hidden:!0,text:"Caption"},{hidden:!1,text:"File"},{hidden:!V,text:"Entity"},{formatter:function(e){var n,t=e.row;return(0,a.jsx)(k,{children:(null==t?void 0:null===(n=t.authority)||void 0===n?void 0:n.adminOnly)&&(0,a.jsx)(p.Z,{content:"Admin user only",children:(0,a.jsx)(f.Z,{alt:"Admin Only",src:"/messaging/admin-only.svg"})})})},text:"",tooltip:"Only Admin can see"},{formatter:(0,v.Z)("/dashboard/users/view","userId","uploaded"),text:"Uploaded by"},{hidden:!T,text:"Thumbnails"},{hidden:!N,formatter:h.Z,formatterData:ec,text:"Actions"}],em=function(e,n){e.preventDefault(),window.open("".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(n))},ep=[],ef=ee.map(function(e){var n=e.entity,t=e.entityId,i=e.id,r=e.item,o=r.caption,s=r.filename,l=r.meta,u=r.name,c=r.type,d=r.user;return{data:r,id:i,userId:null==d?void 0:d.id,file:function(){return(0,a.jsx)(y.Z,{onClick:function(e){return em(e,s)},children:o||u||s})},entity:n&&"".concat(n,"#").concat(t),authority:l,uploaded:"".concat(null==d?void 0:d.nameFirst," ").concat(null==d?void 0:d.nameLast),thumbnails:(0,$.S)(c,l),actions:""}}),ev=(ee.forEach(function(e){var n=e.item,t=n.caption,i=n.filename;"image"===n.type&&ep.push({caption:t,filename:i})}),ep),eh=ev.length;return(0,a.jsxs)(g.Z,{fitParentHeight:!0,open:!0,title:U,children:[o,n&&eh>0&&(0,a.jsx)(R,{children:(0,a.jsx)(x.Z,{fullWidth:!0,height:"200px",numberOfItems:1,showNavs:!1,showPagination:!0,slides:ev.map(function(e){var n=e.caption,t=e.filename;return{node:(0,a.jsx)(f.Z,{alt:n,src:"".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(t)}),text:" "}})})}),(0,a.jsx)(w.t,{columns:ed,loading:et,fullHeight:!0,paginationSize:!1,meta:en,ref:O,refetch:ei,rows:ef}),M&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{size:"sm"}),(0,a.jsxs)(b.Z,{align:"flex-end",children:[(!z||"document"===z)&&!Q("supplier")&&(0,a.jsx)(j.Z,{content:"Add Document",context:"secondary",onClick:es,size:"sm"}),(!z||"image"===z||"avatar"===z)&&!Q("supplier")&&(0,a.jsx)(j.Z,{content:"Add ".concat((0,q.Z)(z||"Image")),context:"secondary",onClick:ea,size:"sm"})]})]})]})},k=d.ZP.div.withConfig({displayName:"table__StyledIcon",componentId:"sc-9d92024f-0"})(D()),R=d.ZP.div.withConfig({displayName:"table__StyledCarousel",componentId:"sc-9d92024f-1"})(P());T.propTypes={carousel:l.bool,category:l.string,children:l.node,data:l.array,details:l.bool,entity:l.string,entityId:l.number,filters:l.object,limit:l.number,listView:l.bool,mediaMeta:l.object,onMediaAdd:l.func,onMediaRemove:l.func,pagination:l.object,showActionButtons:l.bool,showEntityColumn:l.bool,showItemActions:l.bool,summary:l.string,type:l.string},T.defaultProps={carousel:!0,category:null,data:[],details:!1,filters:{},limit:20,listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,summary:"Media",type:null}},4972:function(e,n,t){"use strict";t.d(n,{A5:function(){return eu},Ak:function(){return z},Cj:function(){return Y},K4:function(){return eo},Oq:function(){return el},Qn:function(){return N},RJ:function(){return X},SW:function(){return V},T_:function(){return Q},UH:function(){return M},UM:function(){return ei},Ve:function(){return K},_d:function(){return G},_f:function(){return er},by:function(){return B},cz:function(){return E},he:function(){return U},j$:function(){return W},kB:function(){return en},kU:function(){return ee},kx:function(){return O},nD:function(){return F},nP:function(){return es},pY:function(){return ea},qd:function(){return L},t1:function(){return H},yR:function(){return J},zR:function(){return et}});var i=t(7297),r=t(75063);function o(){var e=(0,i.Z)(["\n  query GetAddressForSelect($q: String, $entity: String!, $entityId: Int!) {\n    items: Address(\n      where: {\n        Address_Entities: { entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n        _or: [\n          { addressLine1: { _eq: $q } }\n          { addressLine2: { _eq: $q } }\n          { addressLine3: { _eq: $q } }\n          { county: { _eq: $q } }\n          { postCode: { _eq: $q } }\n          { city: { _eq: $q } }\n        ]\n      }\n    ) {\n      label: addressLine1\n      value: id\n      id\n      name\n      addressLine1\n      addressLine2\n      addressLine3\n      postCode\n      county\n      country: Country {\n        name\n      }\n      city\n      Address_Entities {\n        invoice\n      }\n    }\n  }\n"]);return o=function(){return e},e}function a(){var e=(0,i.Z)(["\n  query GetAccountsForSelect($q: String, $type: String, $limit: Int, $offset: Int) {\n    items: Account(\n      where: { name: { _ilike: $q }, type: { _eq: $type } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,i.Z)(['\n  query GetTaxonomy($q: String, $id: Int) {\n    items: Taxonomy(\n      where: { type: { _eq: "assetCategory" }, status: { _eq: "active" } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      options: Taxonomies(\n        where: {\n          type: { _eq: "assetCategory" }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']);return s=function(){return e},e}function l(){var e=(0,i.Z)(["\n  query GetAssetsForSelect(\n    $locationId: Int\n    $q: String\n    $categoryId: Int\n    $bookable: String\n    $limit: Int\n    $offset: Int\n  ) {\n    items: Asset(\n      where: {\n        categoryId: { _eq: $categoryId }\n        locationId: { _eq: $locationId }\n        name: { _ilike: $q }\n        bookable: { _eq: $bookable }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return l=function(){return e},e}function u(){var e=(0,i.Z)(['\n  query GetCustomersForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Account(\n      where: { name: { _ilike: $q }, type: { _eq: "customer" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      admin: Admins {\n        id: adminId\n      }\n      label: name\n      spendThreshold: meta(path: "$.finance.spendThreshold")\n      serviceRateLabour: meta(path: "$.finance.serviceRateLabour")\n      serviceRateExpenses: meta(path: "$.finance.serviceRateExpenses")\n      value: id\n    }\n  }\n']);return u=function(){return e},e}function c(){var e=(0,i.Z)(["\n  query GetJobsForSelect($_q: Int, $locationId: Int) {\n    items: Job(\n      where: {\n        Location: { id: { _eq: $locationId } }\n        _or: [{ id: { _eq: $_q } }, { Invoices: { id: { _eq: $_q } } }]\n      }\n      order_by: { title: asc }\n    ) {\n      label: label\n      value: id\n      number\n      createdAt\n      description\n      status\n      timingStart\n      title\n      type\n      Location {\n        name\n      }\n      Taxonomy {\n        Taxonomy {\n          shortJobDescription: name\n        }\n      }\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,i.Z)(['\n  query GetManagersForSelect($userId: Int, $accountId: Int!, $q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          role: { _in: ["owner", "manager"] }\n          status: { _eq: "active" }\n          Account: { id: { _eq: $accountId } }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        id: { _neq: $userId }\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']);return d=function(){return e},e}function m(){var e=(0,i.Z)(['\n  query GetManagersForSelect(\n    $userId: Int\n    $accountId: Int!\n    $q: String\n    $invoiceThreshold: numeric\n    $quoteThreshold: numeric\n  ) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          role: { _in: ["owner", "manager"] }\n          status: { _eq: "active" }\n          Account: { id: { _eq: $accountId } }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        id: { _neq: $userId }\n        _and: [\n          {\n            _or: [\n              { invoiceThreshold: { _gt: $invoiceThreshold } }\n              { invoiceThreshold: { _is_null: true } }\n            ]\n          }\n          {\n            _or: [\n              { quoteThreshold: { _gt: $quoteThreshold } }\n              { quoteThreshold: { _is_null: true } }\n            ]\n          }\n        ]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']);return m=function(){return e},e}function p(){var e=(0,i.Z)(["\n  query GetPostCodeAreaForSelect($countryId: Int, $q: String) {\n    items: PostcodeArea(\n      where: { name: { _ilike: $q }, countryId: { _eq: $countryId } }\n      order_by: { name: asc }\n    ) {\n      area\n      label: name\n      value: id\n    }\n  }\n"]);return p=function(){return e},e}function f(){var e=(0,i.Z)(['\n  query GetPropertiesForSelect($where: Location_bool_exp, $limit: Int, $offset: Int) {\n    items: Location(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      label: name\n      value: id\n      access\n      permitsRequired\n      registeredAddress: Addresses(\n        where: { entity: { _eq: "Location" }, registered: { _eq: true } }\n      ) {\n        address: Address {\n          id\n          addressLine1\n          addressLine2\n          addressLine3\n          county\n          country: Country {\n            name\n          }\n          postCode\n          city\n        }\n      }\n    }\n  }\n']);return f=function(){return e},e}function v(){var e=(0,i.Z)(['\n  query GetServicesForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Service(\n      where: { name: { _ilike: $q }, status: { _eq: "active" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return v=function(){return e},e}function h(){var e=(0,i.Z)(["\n  query GetSlasForSelect($q: String, $adminId: Int, $type: String) {\n    items: SLA(\n      where: { name: { _ilike: $q }, type: { _eq: $type }, adminId: { _eq: $adminId } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return h=function(){return e},e}function y(){var e=(0,i.Z)(["\n  query GetSlasForSelectNew($where: SLA_bool_exp, $limit: Int, $offset: Int) {\n    items: SLA(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      label: name\n      value: id\n    }\n  }\n"]);return y=function(){return e},e}function g(){var e=(0,i.Z)(["\n  query GetSuppliersForSelect($where: Account_bool_exp, $limit: Int, $offset: Int) {\n    items: Account(where: $where, limit: $limit, offset: $offset, order_by: { name: asc }) {\n      label: name\n      value: id\n    }\n  }\n"]);return g=function(){return e},e}function x(){var e=(0,i.Z)(['\n  query GetUsersForSelect($accountId: Int, $q: String, $limit: Int, $offset: Int) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          accountId: { _eq: $accountId }\n          isContact: { _eq: true }\n          status: { _eq: "active" }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']);return x=function(){return e},e}function Z(){var e=(0,i.Z)(['\n  query GetUsersForSelect($q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']);return Z=function(){return e},e}function b(){var e=(0,i.Z)(["\n  query GetTaxonomyGroupForSelect($q: String, $type: String!) {\n    items: Taxonomy(\n      where: { isGroup: { _eq: true }, name: { _ilike: $q }, type: { _eq: $type } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return b=function(){return e},e}function j(){var e=(0,i.Z)(['\n  query GetTaxonomy($q: String) {\n    items: Taxonomy(where: { type: { _eq: "expenseCategoryGroup" } }, order_by: { name: asc }) {\n      label: name\n      options: Taxonomies(\n        where: { type: { _eq: "expenseCategory" }, name: { _ilike: $q } }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']);return j=function(){return e},e}function q(){var e=(0,i.Z)(['\n  query GetCompliancesForSelect($q: String, $locationId: Int, $limit: Int, $offset: Int) {\n    items: Taxonomy(\n      where: { type: { _eq: "complianceCategory" } }\n      order_by: { name: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: name\n      options: Compliances(\n        where: {\n          name: { _ilike: $q }\n          Compliance_Entities: { Location: { id: { _eq: $locationId } } }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']);return q=function(){return e},e}function I(){var e=(0,i.Z)(["\n  query GetUserRole($userId: Int!, $accountId: Int!) {\n    accountUsers: Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n    ) {\n      role\n    }\n  }\n"]);return I=function(){return e},e}function _(){var e=(0,i.Z)(["\n  query GetSublocationsForSelect($locationId: Int!, $q: String, $limit: Int, $offset: Int) {\n    items: Sublocation(\n      where: { name: { _ilike: $q }, locationId: { _eq: $locationId }, active: { _eq: true } }\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n"]);return _=function(){return e},e}function S(){var e=(0,i.Z)(['\n  query GetTaxonomy($q: String, $limit: Int, $offset: Int) {\n    items: Taxonomy(\n      where: {\n        type: { _eq: "assetCategory" }\n        isGroup: { _eq: false }\n        status: { _eq: "active" }\n        name: { _ilike: $q }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return S=function(){return e},e}function $(){var e=(0,i.Z)(["\n  query GetTaxonomyForSelect(\n    $where: Taxonomy_bool_exp\n    $limit: Int\n    $offset: Int\n    $orderBy: Taxonomy_order_by!\n    $includeMeta: Boolean! = false\n  ) {\n    items: Taxonomy(where: $where, limit: $limit, offset: $offset, order_by: [$orderBy]) {\n      value: id\n      label: name\n      meta @include(if: $includeMeta)\n    }\n  }\n"]);return $=function(){return e},e}function w(){var e=(0,i.Z)(['\n  query GetTagsForTask($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "taskTags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']);return w=function(){return e},e}function C(){var e=(0,i.Z)(['\n  query GetTagsForEntity(\n    $entityId: Int\n    $entity: String!\n    $q: String!\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    tags: Taxonomy(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: "active" }\n        type: { _eq: "taskTags" }\n        _not: { Taxonomy_Entities: { entity: { _eq: $entity }, entityId: { _eq: $entityId } } }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']);return C=function(){return e},e}function A(){var e=(0,i.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "taskTags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n']);return A=function(){return e},e}function D(){var e=(0,i.Z)(["\n  query GetCustomerManagers($accountId: Int, $q: String, $limit: Int, $offset: Int) {\n    items: User(\n      where: { Account_Users: { accountId: { _eq: $accountId } }, fullName: { _ilike: $q } }\n      order_by: { fullName: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n"]);return D=function(){return e},e}function P(){var e=(0,i.Z)(["\n  query GetServiceSchedulesForSelect(\n    $q: String\n    $serviceId: Int\n    $entity: service_schedule_entity\n    $entityId: Int\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    items: ServiceSchedule(\n      where: {\n        name: { _ilike: $q }\n        serviceId: { _eq: $serviceId }\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return P=function(){return e},e}function T(){var e=(0,i.Z)(['\n  query GetPropertyById($id: Int!) {\n    item: Location_by_pk(id: $id) {\n      label: name\n      value: id\n      access\n      registeredAddress: Addresses(\n        where: { entity: { _eq: "Location" }, registered: { _eq: true } }\n      ) {\n        address: Address {\n          id\n          addressLine1\n          addressLine2\n          addressLine3\n          county\n          country: Country {\n            name\n            code\n          }\n          postCode\n          city\n        }\n      }\n    }\n  }\n']);return T=function(){return e},e}function k(){var e=(0,i.Z)(['\n  query GetCompliancesForSelectNew($q: String, $locationId: Int, $limit: Int, $offset: Int) {\n    items: Compliance(\n      where: {\n        name: { _ilike: $q }\n        Category: { type: { _eq: "complianceCategory" } }\n        Compliance_Entities: { entity: { _eq: "Location" }, Location: { id: { _eq: $locationId } } }\n      }\n      order_by: { name: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      value: id\n      label: name\n      category: Category {\n        label: name\n      }\n    }\n  }\n']);return k=function(){return e},e}function R(){var e=(0,i.Z)(['\n  query GetTaskAssignedToForSelect(\n    $accountId: Int\n    $q: String\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']);return R=function(){return e},e}var E=(0,r.Ps)(o()),L=(0,r.Ps)(a()),F=(0,r.Ps)(s()),M=(0,r.Ps)(l()),V=(0,r.Ps)(u()),N=(0,r.Ps)(c()),U=(0,r.Ps)(d()),z=(0,r.Ps)(m()),W=(0,r.Ps)(p()),G=(0,r.Ps)(f()),O=(0,r.Ps)(v()),H=(0,r.Ps)(h()),Q=(0,r.Ps)(y()),B=(0,r.Ps)(g()),J=(0,r.Ps)(x()),X=(0,r.Ps)(Z()),Y=(0,r.Ps)(b()),K=(0,r.Ps)(j()),ee=(0,r.Ps)(q()),en=(0,r.Ps)(I()),et=(0,r.Ps)(_()),ei=(0,r.Ps)(S()),er=(0,r.Ps)($());(0,r.Ps)(w()),(0,r.Ps)(C()),(0,r.Ps)(A());var eo=(0,r.Ps)(D()),ea=(0,r.Ps)(P()),es=(0,r.Ps)(T()),el=(0,r.Ps)(k()),eu=(0,r.Ps)(R())},91272:function(e,n,t){"use strict";t.d(n,{t:function(){return u}});var i=t(85893),r=t(67294),o=t(45697),a=t(11163),s=t(46003),l=t(16540),u=(0,r.forwardRef)(function(e,n){var t=e.columns,o=e.history,u=e.initialSort,c=e.loading,d=e.meta,m=e.paginationSize,p=e.refetch,f=e.rowClick,v=e.rows,h=e.xeroPageSize,y=(0,a.useRouter)(),g=y.query,x=void 0===g?{}:g,Z=(0,r.useState)(parseInt(null==x?void 0:x.page,10)||1),b=Z[0],j=Z[1],q=(0,r.useState)(h||s.C1.paginationSize),I=q[0],_=q[1];u||(u={item:"createdAt",order:"desc"});var S=(0,r.useState)({item:u.item,order:u.order}),$=S[0],w=S[1],C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=y.query,t=void 0===n?{}:n;if(e>1?t.page=e:delete t.page,!(Object.keys(t).length>0))return{};var i=Object.keys(t).map(function(n){return"page"===n?"".concat(n,"=").concat(e):"".concat(n,"=").concat(t[n])}).join("&");return"?".concat(i)},A=function(){w({item:u.item,order:u.order}),j(1);var e=C();y.push(e),_(h||s.C1.paginationSize)};(0,r.useImperativeHandle)(n,function(){return{currentPage:b,pageSize:I,sort:$,resetPagination:function(){A()}}});var D=function(e){var n=C(e);o&&y.push(n),j(e),!o&&p&&p()},P=function(e){e!==s.C1.paginationSize&&(_(e),p&&p())},T=function(e){var n;w({item:e.item,order:e.order}),p&&p()};return(0,i.jsx)(l.Z,{columns:t,loading:c,paginationSize:m,pagination:d&&!0,paginationProps:d&&{currentPage:b,onPageChange:D,onPageSizeChange:P,pageCount:Math.ceil(d.aggregate.totalCount/I),perPage:I},rowClick:f,rows:v,sort:$,setSort:T})});u.propTypes={columns:o.array.isRequired,history:o.bool,initialSort:o.object,loading:o.bool,meta:o.object,refetch:o.func,rowClick:o.func,rows:o.array.isRequired},u.defaultProps={history:!0,loading:!0,paginationSize:!1}},22186:function(e,n,t){"use strict";t.d(n,{V:function(){return d}});var i=t(26042),r=t(69396),o=t(85893),a=t(67294),s=t(45697),l=t.n(s),u=t(87918),c=t(41796),d=function(e){var n,t=e.chipProps,s=e.tagEntityId,l=e.name,d=e.color,m=e.onDelete,p=(0,a.useMemo)(function(){return m?(0,r.Z)((0,i.Z)({},t),{onDelete:function(e){e.stopPropagation(),m(s)}}):(0,i.Z)({},t)},[t,m,s]);return(0,o.jsx)(u.Z,(0,r.Z)((0,i.Z)({},p),{size:"small",label:l,sx:{fontSize:"11px",color:(n=d,(0,c.mi)(n,"#FFFFFF")>2.5?"#FFFFFF":"#000"),bgcolor:d,borderRadius:"0px 16px 16px 0px"}}))};d.defaultProps={chipProps:{},onDelete:null,color:"#f2f2f2"},d.propTypes={chipProps:l().object,tagEntityId:l().string.isRequired,name:l().string.isRequired,color:l().string.isRequired,onDelete:l().func.isRequired}},28864:function(e,n,t){"use strict";t.d(n,{T:function(){return g}});var i=t(85893),r=t(45697),o=t.n(r),a=t(93946),s=t(97212),l=t(98619),u=t(59334),c=t(51233),d=t(50135),m=t(50594),p=t(40055),f=t(5336),v=t(10166),h=t(67294),y=t(42283),g=function(e){var n=e.tagEntityId,t=e.tagId,r=e.name,o=e.color,u=e.editable,v=e.onDelete,g=e.onColorChange,Z=e.onNameChange,b=(0,y.cI)({defaultValues:{name:r,color:o}}),j=b.register,q=b.handleSubmit,I=(0,h.useState)(null),_=I[0],S=I[1],$=function(){return[{icon:"delete",onClick:function(e){e.stopPropagation(),v(n)},tooltip:"Remove"},{icon:"edit",onClick:function(e){e.stopPropagation(),S("rename")},tooltip:"Rename"},{icon:"visibility",onClick:function(e){e.stopPropagation(),S("changeColor")},tooltip:"Change color"}]},w=function(e){e.stopPropagation(),S(null)},C=function(e){g({tagId:t,color:e.color}),S(null)},A=function(e){Z({tagId:t,name:e.name}),S(null)};return(0,i.jsx)(s.ZP,{disablePadding:!0,secondaryAction:!u||!_&&(0,i.jsx)(f.C,{icon:"defaultHoriz",actionsData:$}),children:_?({changeColor:function(){return(0,i.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,i.jsx)("input",{name:"color",ref:j,type:"color",style:{padding:0,border:"none","background-color":"unset"}}),(0,i.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(a.Z,{size:"small",color:"danger",onClick:w,children:(0,i.jsx)(m.Z,{})}),(0,i.jsx)(a.Z,{size:"small",color:"success",onClick:q(C),children:(0,i.jsx)(p.Z,{})})]})]})},rename:function(){return(0,i.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,i.jsx)(d.Z,{name:"name",inputRef:j,variant:"standard",color:"secondary"}),(0,i.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(a.Z,{size:"small",color:"danger",onClick:w,children:(0,i.jsx)(m.Z,{})}),(0,i.jsx)(a.Z,{size:"small",color:"success",onClick:q(A),children:(0,i.jsx)(p.Z,{})})]})]})}})[_]():(0,i.jsx)(l.Z,{children:(0,i.jsx)(x,{primary:r,color:o})})},t)};g.defaultProps={onDelete:function(){},onColorChange:function(){},onNameChange:function(){},editable:!0},g.propTypes={tagEntityId:o().string.isRequired,tagId:o().string.isRequired,name:o().string.isRequired,color:o().string.isRequired,editable:o().bool,onDelete:o().func.isRequired,onColorChange:o().func.isRequired,onNameChange:o().func.isRequired};var x=(0,v.Z)(u.Z)(function(e){return e.theme,{"&.MuiListItemText-root .MuiListItemText-primary":{fontWeight:700,color:e.color}}})},11975:function(e,n,t){"use strict";t.d(n,{P:function(){return p}});var i=t(85893),r=t(67294),o=t(45697),a=t.n(o),s=t(15861),l=t(14564),u=t(78462),c=t(51233),d=t(22186),m=t(28864),p=function(e){var n=e.tags,t=(e.title,e.handleDeleteTagEntity),o=(0,r.useState)(null),a=o[0],p=o[1],f=null==n?void 0:n.slice(0,5),v=(null==n?void 0:n.length)-(null==f?void 0:f.length),h=Boolean(a);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.Z,{direction:"row",spacing:1,children:f.map(function(e,n){var r;return(0,i.jsx)(d.V,{tagEntityId:e.id||n,name:e.tag.name,color:null===(r=e.tag.meta)||void 0===r?void 0:r.color,onDelete:t})})}),v>0&&(0,i.jsxs)(s.Z,{fontWeight:700,ml:1,onMouseEnter:function(e){p(e.currentTarget),e.stopPropagation()},children:["+",v]}),(0,i.jsx)(l.ZP,{id:h?"tags-in-table-popover":void 0,open:h,anchorEl:a,onClose:function(){return p(null)},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,i.jsx)(u.Z,{children:null==n?void 0:n.map(function(e){var n;return(0,i.jsx)(m.T,{tagEntityId:e.id,tagId:e.tag.id,name:e.tag.name,color:null===(n=e.tag.meta)||void 0===n?void 0:n.color,editable:!1},e.tag.id)})})})]})};p.propTypes={tags:a().object,title:a().string},p.defaultProps={tags:{},displayOnly:!1,refetchQueries:[],handleDeleteTagEntity:function(){}}},89256:function(e,n,t){"use strict";t.d(n,{n:function(){return T}});var i=t(47568),r=t(26042),o=t(69396),a=t(828),s=t(29815),l=t(97582),u=t(85893),c=t(45697),d=t.n(c),m=t(96486),p=t(6812),f=t(50319),v=t(11961),h=t(93362),y=t(23776),g=t(5616),x=t(98456),Z=t(93946),b=t(78462),j=t(18972),q=t(14564),I=t(51233),_=t(50135),S=t(67294),$=t(10166),w=t(2845),C=t(28864),A=t(51738),D=t(11975),P=(0,h.D)(),T=function(e){var n=e.entityId,t=e.entity,c=e.values,d=void 0===c?[]:c,h=e.name,q=void 0===h?"tags":h,$=e.setValue,T=(0,w.x)().user,R=(0,S.useState)(null),E=R[0],L=R[1],F=(0,S.useState)(""),M=F[0],V=F[1],N=(0,S.useState)(""),U=N[0],z=N[1],W=(0,S.useState)(""),G=W[0],O=W[1],H=(0,p.a)(A.BU,{skip:!n,variables:{entityId:n,entity:t},onCompleted:function(e){$(q,e.tags)}}),Q=H.data,B=(void 0===Q?{tags:[]}:Q).tags,J=H.loading,X=H.refetch,Y=(0,p.a)(A.gI,{skip:!E,variables:{entityId:n,entity:t,q:""!==G?"%".concat(G,"%"):null}}),K=Y.data,ee=(void 0===K?{tags:[]}:K).tags,en=Y.loading,et=(0,a.Z)((0,f.D)(A.Zm,{refetchQueries:["GetAllTags"]}),2),ei=et[0],er=et[1].loading,eo=(0,a.Z)((0,f.D)(A.LE,{onCompleted:function(){X()}}),2),ea=eo[0],es=eo[1].loading,el=(0,a.Z)((0,f.D)(A.cS,{onCompleted:function(){X()}}),2),eu=el[0],ec=el[1].loading,ed=(0,a.Z)((0,f.D)(A.g$,{refetchQueries:["GetAllTags"]}),2),em=ed[0],ep=ed[1].loading;(0,S.useEffect)(function(){var e=setTimeout(function(){O(U)},500);return function(){return clearTimeout(e)}},[U]);var ef,ev,eh,ey=function(e){e.stopPropagation(),L(e.currentTarget)},eg=function(){L(null)},ex=(ef=(0,i.Z)(function(e,i){var r,o,a;return(0,l.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof i)return[3,1];return V({label:i}),[3,6];case 1:if(!(i&&i.inputValue&&n))return[3,2];return ea({variables:{objects:[{entity:t,entityId:n,Taxonomy:{data:{type:"tags",status:"active",name:i.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:T.adminId}}}]}}),V(null),[3,6];case 2:if(!(i&&i.value&&n))return[3,3];return ea({variables:{objects:[{entity:t,entityId:n,taxonomyId:i.value}]}}),V(null),[3,6];case 3:if(!(i&&i.inputValue))return[3,5];return[4,ei({variables:{objects:[{type:"tags",status:"active",name:i.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:T.adminId}]}})];case 4:return a=e.sent().data.insert_Taxonomy,$(q,(0,s.Z)(d).concat([{id:null,tag:{id:a.returning[0].id,name:a.returning[0].name,meta:a.returning[0].meta}}])),V(null),[3,6];case 5:i&&i.value&&($(q,(0,s.Z)(d).concat([{id:null,tag:{id:i.value,name:i.label,meta:i.meta}}])),V(null)),e.label=6;case 6:return[2]}})}),function(e,n){return ef.apply(this,arguments)}),eZ=(0,S.useCallback)(function(e,n){var t=P(e,n),i=n.inputValue,r=e.some(function(e){return i===e.label});return""===i||r||t.push({inputValue:i,label:'Add "'.concat(i,'"')}),t},[]),eb=(0,S.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),ej=function(e){n?eu({variables:{tagEntityId:e}}):$(q,d.filter(function(n,t){return t!==e}))},eq=(ev=(0,i.Z)(function(e){var n,t,i,a,s,u;return(0,l.__generator)(this,function(t){switch(t.label){case 0:return[4,em({variables:{tagId:n=e.tagId,object:{meta:{color:e.color}}}})];case 1:return s=t.sent().data.update_Taxonomy_by_pk,$(q,d.map(function(e){return e.tag.id===n?(0,o.Z)((0,r.Z)({},e),{tag:(0,r.Z)({},s)}):e})),[2]}})}),function(e){return ev.apply(this,arguments)}),eI=(eh=(0,i.Z)(function(e){var n,t,i,a,s,u;return(0,l.__generator)(this,function(i){switch(i.label){case 0:return[4,em({variables:{tagId:n=e.tagId,object:{name:t=e.name}}})];case 1:return s=i.sent().data.update_Taxonomy_by_pk,$(t,d.map(function(e){return e.tag.id===n?(0,o.Z)((0,r.Z)({},e),{tag:(0,r.Z)({},s)}):e})),[2]}})}),function(e){return eh.apply(this,arguments)}),e_=Boolean(E),eS=(0,S.useMemo)(function(){return ee.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[ee]),e$=(0,S.useMemo)(function(){return m.uniqBy((0,s.Z)(B).concat((0,s.Z)(d)),function(e){var n;return null===(n=e.tag)||void 0===n?void 0:n.id})},[B,d]);return(0,u.jsxs)(I.Z,{direction:"row",alignItems:"center",children:[(0,u.jsx)(D.P,{tags:e$,handleDeleteTagEntity:ej}),(0,u.jsx)(k,{id:e_?"tags-popover":void 0,open:e_,anchorEl:E,onClose:eg,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,u.jsxs)(g.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,u.jsx)(y.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,s.Z)(eS),value:M,onChange:ex,onInputChange:function(e,n){z(n)},filterOptions:eZ,getOptionLabel:eb,renderOption:function(e,n){return(0,u.jsx)(j.Z,(0,o.Z)((0,r.Z)({},e),{children:n.label}))},renderInput:function(e){return(0,u.jsx)(_.Z,(0,o.Z)((0,r.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,o.Z)((0,r.Z)({},e.InputProps),{endAdornment:(0,u.jsxs)(u.Fragment,{children:[en||er||es?(0,u.jsx)(x.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),J||ec||ep?(0,u.jsx)(I.Z,{width:"100%",alignItems:"center",p:4,children:(0,u.jsx)(x.Z,{color:"secondary"})}):(0,u.jsx)(b.Z,{children:null==e$?void 0:e$.map(function(e,n){var t;return(0,u.jsx)(C.T,{tagEntityId:e.id||n,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,onDelete:ej,onColorChange:eq,onNameChange:eI})})})]})}),(0,u.jsx)(Z.Z,{color:"black",onClick:ey,children:(0,u.jsx)(v.Z,{sx:{height:"16px",width:"16px"}})})]})};T.defaultProps={entityId:null},T.propTypes={entityId:d().number};var k=(0,$.Z)(q.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}})},51738:function(e,n,t){"use strict";t.d(n,{Aw:function(){return j},BU:function(){return h},C3:function(){return b},LE:function(){return g},Zm:function(){return v},cS:function(){return x},g$:function(){return Z},gI:function(){return f},lx:function(){return y}});var i=t(7297),r=t(75063);function o(){var e=(0,i.Z)(['\n  query GetTagsForEntity($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    tags: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']);return o=function(){return e},e}function a(){var e=(0,i.Z)(["\n  mutation CreateTag($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        name\n        meta\n      }\n    }\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,i.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n']);return s=function(){return e},e}function l(){var e=(0,i.Z)(['\n  query GetTagsForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']);return l=function(){return e},e}function u(){var e=(0,i.Z)(["\n  mutation CreateTagsAgainstEntity($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return e},e}function c(){var e=(0,i.Z)(["\n  mutation DeleteTagAgainstEntity($tagEntityId: Int!) {\n    delete_Taxonomy_Entity_by_pk(id: $tagEntityId) {\n      id\n      taxonomyId\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,i.Z)(["\n  mutation UpdateTagAgainstEntity($tagId: Int!, $object: Taxonomy_set_input!) {\n    update_Taxonomy_by_pk(pk_columns: { id: $tagId }, _set: $object) {\n      id\n      name\n      meta\n    }\n  }\n"]);return d=function(){return e},e}function m(){var e=(0,i.Z)(["\n  mutation CreateTagsAgainstEntityWithFollowing($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return m=function(){return e},e}function p(){var e=(0,i.Z)(["\n  mutation DeleteTagAgainstEntityWithFollowing($where: Taxonomy_Entity_bool_exp!) {\n    delete_Taxonomy_Entity(where: $where) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return p=function(){return e},e}var f=(0,r.Ps)(o()),v=(0,r.Ps)(a()),h=(0,r.Ps)(s()),y=(0,r.Ps)(l()),g=(0,r.Ps)(u()),x=(0,r.Ps)(c()),Z=(0,r.Ps)(d()),b=(0,r.Ps)(m()),j=(0,r.Ps)(p())},60185:function(e,n,t){"use strict";t.d(n,{z:function(){return m}});var i=t(47568),r=t(828),o=t(29815),a=t(97582),s=t(6812),l=t(50319),u=t(52824),c=t(24043),d=t(67294),m=function(e,n,t,m){var p,f,v,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"media",y=(0,d.useState)(!1),g=y[0],x=y[1],Z=(0,s.a)(u.O,{variables:{entity:e,entityId:m,category:h,adminId:n},skip:!m}),b=Z.data,j=(void 0===b?{items:[]}:b).items,q=Z.loading,I=(0,r.Z)((0,l.D)(c.CI),2),_=I[0],S=I[1].loading,$=(0,r.Z)((0,l.D)(c.xM,{refetchQueries:["MEDIAS"]}),1)[0],w=function(e){_({variables:{mediaId:e}})},C=function(){var e="cleverly-pre-prod-media";return JSON.stringify([{width:32,height:32,bucket:e,sizeName:"vSmall",fit:"inside"},{width:200,height:200,bucket:e,sizeName:"small",fit:"inside"},{width:600,height:600,bucket:e,sizeName:"medium",fit:"inside"},{width:1200,height:1200,bucket:e,sizeName:"large",fit:"inside"}])},A=(p=(0,i.Z)(function(i,r){var o,s;return(0,a.__generator)(this,function(a){switch(a.label){case 0:if(a.trys.push([0,,4,5]),x(!0),!r)return[3,3];return[4,P(r)];case 1:return o=a.sent(),s={adminId:n,caption:r.caption,expiryAt:null,extension:r.media.name.split(".").pop(),userId:t,filename:o.key,type:r.type,Media_Entities:{data:[{entity:e,entityId:i}]}},[4,$({variables:{objects:s}})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:return x(!1),[7];case 5:return[2]}})}),function(e,n){return p.apply(this,arguments)}),D=(f=(0,i.Z)(function(){var i,r,s,l,u,c,d,m,p,f,v,h,y,g,Z,b,j,q,I=arguments;return(0,a.__generator)(this,function(a){switch(a.label){case 0:i=I.length>0&&void 0!==I[0]?I[0]:[],r=I.length>1&&void 0!==I[1]?I[1]:"media",a.label=1;case 1:a.trys.push([1,,10,11]),x(!0),s=null,l=!0,u=!1,c=void 0,a.label=2;case 2:a.trys.push([2,7,8,9]),d=i[Symbol.iterator](),a.label=3;case 3:if(l=(m=d.next()).done)return[3,6];if((p=m.value).mediaId)return[3,5];return[4,P(p)];case 4:v=a.sent(),h=null,y=null,"image"===p.type?(g=v.key,h=(Z=v.data.find(function(e){return"large"===e.name}))?Z.relativePath:g,y={original:{relativePath:g},thumbnails:v.data||null}):h=v.key,s={Media_Entity:{data:(0,o.Z)(null!==(b=null==s?void 0:null===(f=s.Media_Entity)||void 0===f?void 0:f.data)&&void 0!==b?b:[]).concat([{entity:e,Medium:{data:{adminId:n,caption:null!==(j=null==p?void 0:p.caption)&&void 0!==j?j:null,expiryAt:null,extension:p.media.name.split(".").pop(),userId:t,category:r,filename:h,type:p.type,meta:y}}}])}},a.label=5;case 5:return l=!0,[3,3];case 6:return[3,9];case 7:return q=a.sent(),u=!0,c=q,[3,9];case 8:try{l||null==d.return||d.return()}finally{if(u)throw c}return[7];case 9:return[2,s];case 10:return x(!1),[7];case 11:return[2]}})}),function(){return f.apply(this,arguments)}),P=(v=(0,i.Z)(function(e){var n,t,i,r,o;return(0,a.__generator)(this,function(o){switch(o.label){case 0:switch(n="cleverly-pre-prod-media",t="https://aws-pre-prod.cleverly.works/aws/s3/upload",(i=new window.FormData).append("file",e.media,e.media.name),e.type){case"image":r="https://aws-pre-prod.cleverly.works/image/process",i.append("sizes",C());break;case"document":case"audio":i.append("bucket",n),i.append("folder","".concat(e.type,"s")),r=t}return[4,window.fetch(r,{method:"POST",body:i})];case 1:return[2,o.sent().json()]}})}),function(e){return v.apply(this,arguments)});return{uploadMedia:A,uploadMediaToS3:P,createMediaInput:D,deleteMediaByEntity:w,loadingAddMedia:g,loadingDeleteMedia:S,preloadedMediaLoading:q,preloadedMedia:(null==j?void 0:j.length)?j:[]}}},73760:function(e,n,t){"use strict";t.d(n,{O:function(){return i},v:function(){return r}});var i=[{text:"Country",value:""},{text:"United Kingdom",value:1},{text:"Ireland",value:4}],r=[{label:"United Kingdom",value:1},{label:"Ireland",value:4}]},96216:function(e,n,t){"use strict";t.d(n,{Y:function(){return i}});var i=[{text:"Select...",value:""},{text:"Call",value:"call"},{text:"Email",value:"email"},{text:"Portal",value:"portal"},{text:"Other",value:"other"}]},21789:function(e,n,t){"use strict";t.d(n,{bg:function(){return i}});var i=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},65647:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return eG}});var i=t(26042),r=t(85893),o=t(11163),a=t.n(o),s=t(19076),l=t(47568),u=t(69396),c=t(828),d=t(97582),m=t(67294),p=t(66252),f=t(73359),v=t(50319),h=t(913),y=t(24043),g=t(22595),x=t(45697),Z=t.n(x),b=t(42283),j=t(79665),q=t(6054),I=t(76600),_=t(9270),S=t(62140),$=t(77439),w=t(6812),C=t(85488),A=t(83863),D=t(54559),P=t(78289),T=t(26186),k=t(11585),R=t(91272),E=t(22713),L=t(20705),F=t(18586),M=(0,A.Z)((0,D.Z)(new Date,12)),V=(0,m.memo)(function(e){var n,t,o=e.jobId,a=e.locationId,s=e.serviceId,l=(0,L.x)({filters:{}}),c=l.initialData,d=l.ref,p=(0,m.useContext)(P.Z),f=(0,F.q)(),v=null===(n=f.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,h=null===(t=f.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,y=(0,w.a)(C.sW,{variables:(0,u.Z)((0,i.Z)({jobId:o,locationId:a},c),{serviceId:s,startDate:M})}),g=y.data,x=void 0===g?{jobs:[],meta:{aggregate:{totalCount:0}}}:g,Z=x.jobs,b=x.meta,j=y.loading,q=y.refetch,I=function(e){p.show({content:(0,r.jsx)(E.g,{jobId:e.id,toggleShow:p.close,numberPrefix:v,numberSuffix:h}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,r.jsx)(k.Z,{title:"Job History",children:(0,r.jsx)(R.t,{columns:[{hidden:!0,text:"Id"},{text:"Title"},{text:"Service"},{text:"Date"}],history:!1,loading:j,meta:b,ref:d,refetch:q,rowClick:I,rows:Z.map(function(e){var n;return{id:e.id,title:e.title,service:null===(n=e.service)||void 0===n?void 0:n.name,createdDate:(0,T.Z)(e.createdAt)}})})})},function(e,n){var t=!0;return(n.locationId!==e.locationId||n.serviceId!==e.serviceId)&&(t=!1),t});V.propTypes={jobId:x.number,locationId:x.number.isRequired,serviceId:x.number};var N=t(29815),U=t(49501),z=t(95103),W=t(66812),G=t(96216),O=t(92148),H=(0,m.memo)(function(e){var n=e.control,t=e.customerSelectedWatch,o=e.errors,a=e.hasRole,s={control:n,errors:o,register:e.register};return(0,r.jsxs)(k.Z,{dataSet:{"data-cy":"customer"},open:!0,title:"Customer",children:[(0,r.jsx)(W.P,(0,u.Z)((0,i.Z)({},s),{errors:(0,i.Z)({},o),label:"Customer",name:"customerSelected",type:"customer"})),t&&(0,r.jsx)(W.P,(0,u.Z)((0,i.Z)({},s),{isDisabled:!a((0,N.Z)(O.td).concat((0,N.Z)(O.Sf),(0,N.Z)(O.n))),accountId:(null==t?void 0:t.value)||null,errors:(0,i.Z)({},o),label:"Contact User",name:"customerUserSelected",type:"user"})),a("admin")&&(0,r.jsx)(U.Z,{label:"Source",children:(0,r.jsx)(z.Z,(0,u.Z)((0,i.Z)({},s),{name:"source",options:G.Y}))})]})},function(e,n){var t,i;return e.customerSelectedWatch===n.customerSelectedWatch&&!(null===(t=n.errors.customerSelected)||void 0===t?void 0:t.message)&&!(null===(i=n.errors.customerUserSelected)||void 0===i?void 0:i.message)});H.propTypes={control:x.object.isRequired,customerSelectedWatch:x.object,errors:x.object.isRequired,register:x.func.isRequired};var Q=t(55843),B=t(6710),J=t(90951),X=t(15214),Y=t(55563),K=t(32109),ee=t(32749),en=t(87556),et=t(19486),ei=t(2845),er=t(89256),eo=function(e){var n,t=e.control,o=e.currentAnswers,a=e.errors,s=e.isQuote,l=e.isPPM,c=e.jobId,d=(e.locationSelectedWatch,e.prevTaxonomy),p=e.register,f=e.taxonomyWatch,v=e.watch,h=e.dataSlas,y=e.tagsWatch,g=e.setValue,x=(0,ei.x)().hasRole,Z=(0,m.useContext)(P.Z),b=(0,m.useState)(o),j=b[0],q=b[1],I=v("slaId");(0,m.useEffect)(function(){f!==d&&f&&D(null==f?void 0:f.childs)},[f]);var $=(0,et.GU)(s?"quote":"reactive",h),w=null===(n=null==$?void 0:$.find(function(e){return e.id===Number(I)}))||void 0===n?void 0:n.notes,C={errors:a,register:p,control:t},A=function(e){q(e),Z.close()},D=function(e){e&&e.length>0?Z.show({content:(0,r.jsx)(en.D,{onSuccess:A,entity:"Job",entityId:c,questions:e}),title:"Please answer the following questions"}):q([])};return(0,r.jsxs)(k.Z,{dataSet:{"data-cy":"details"},open:!0,title:"Description",children:[(0,r.jsx)(ee.l,(0,u.Z)((0,i.Z)({},C),{label:s?"Quote Headline":"Short job description",name:"taxonomyId_ShortDesc",type:"jobTags"})),(0,r.jsx)(K.y,{answers:j,onEdit:D}),(0,r.jsx)(Q.Z,{}),(0,r.jsx)(U.Z,{label:"Work Description",children:(0,r.jsx)(B.Z,(0,u.Z)((0,i.Z)({},C),{name:"description",rows:3}))}),!l&&(0,r.jsx)(J.Z,(0,u.Z)((0,i.Z)({},C),{data:$,legend:"Priority",name:"slaId"})),I&&(0,r.jsx)(X.Z,{content:w||"-",context:"light"}),!s&&(0,r.jsxs)(_.Z,{children:[(0,r.jsx)(S.Z,{md:6,children:(0,r.jsx)(U.Z,{label:"Estimated duration",children:(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},C),{name:"estimatedDuration",type:"number",defaultValue:90,min:0}))})}),(0,r.jsx)(S.Z,{md:6,children:(0,r.jsx)(U.Z,{label:"Unit",children:(0,r.jsx)(z.Z,(0,u.Z)((0,i.Z)({},C),{name:"estimatedDurationUnit",options:[{text:"Hours",value:"hours"},{text:"Minutes",value:"minutes"},{text:"Days",value:"days"}],defaultValue:"minutes"}))})})]}),(0,r.jsx)(U.Z,{label:"".concat(x("customer")?"Your reference":"Customer reference"),children:(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},C),{name:"reference"}))}),x("admin")&&(0,r.jsx)(er.n,{entityId:c,values:y,setValue:g,entity:"Job"}),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},C),{name:"questions",type:"hidden",defaultValue:JSON.stringify(j)})),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},C),{name:"reportPassFail",type:"hidden"})),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},C),{name:"reportPassFailTitle",type:"hidden"})),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},C),{name:"requireReportRecommendations",type:"hidden"})),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},C),{name:"customerSignature",type:"hidden"})),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},C),{name:"supplierSignature",type:"hidden"}))]})};eo.propTypes={control:x.object.isRequired,currentAnswers:x.array.isRequired,errors:x.object.isRequired,isQuote:x.bool,isPPM:x.bool,jobId:x.number,locationSelectedWatch:x.object,prevTaxonomy:x.string,register:x.func.isRequired,taxonomyWatch:x.object.isRequired,watch:x.func.isRequired,slaData:x.array},eo.defaultProps={isQuote:!1};var ea=t(7297),es=t(25993),el=t(4972),eu=t(10367);function ec(){var e=(0,ea.Z)(["\n  && > div:first-of-type {\n    ","\n  }\n  && {\n    margin-bottom: 1rem;\n  }\n"]);return ec=function(){return e},e}var ed=["manager","owner"],em=function(e){var n,t,o=e.assetCategoryWatch,a=e.control,s=e.customerSelectedWatch,l=e.customerUserSelectedWatch,d=e.errors,m=e.locationSelectedWatch,p=e.register,f=e.setValue,v=(0,F.q)(),h=null==v?void 0:null===(n=v.admin)||void 0===n?void 0:null===(t=n.modules)||void 0===t?void 0:t.assets,y=(0,w.a)(el.kB,{variables:{accountId:null==s?void 0:s.value,userId:null==l?void 0:l.value}}).data,g=(void 0===y?{accountUsers:[]}:y).accountUsers,x=function(e){var n=(0,c.Z)(e,1)[0];f("locationSelected",{value:n.id,label:n.name})},Z={isClearable:!1,control:a,errors:d,register:p};return(0,r.jsxs)(k.Z,{dataSet:{"data-cy":"location"},open:!0,title:"Location",children:[(0,r.jsx)(W.P,(0,u.Z)((0,i.Z)({},Z),{accountId:null==s?void 0:s.value,errors:(0,i.Z)({},d),name:"locationSelected",label:"Property",type:"property",customerRole:g.some(function(e){return ed.includes(e.role)})?null:"user",customerId:null==l?void 0:l.value,AddForm:function(){return(0,r.jsx)(es.V,{initialValues:{propertyOwner:(0,i.Z)({},s)},isPropsComponent:!0,entity:"Location",onAddressCreated:x})}})),m&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(W.P,(0,u.Z)((0,i.Z)({},Z),{isClearable:!0,label:"Sublocation",locationId:m.value,name:"sublocationSelected",type:"sublocation"})),(0,r.jsx)(U.Z,{label:"Access information",children:(0,r.jsx)(B.Z,(0,u.Z)((0,i.Z)({},Z),{name:"access",rows:2}))}),h&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(W.P,(0,u.Z)((0,i.Z)({},Z),{isClearable:!0,label:"Asset Category",locationId:m.value,id:null==o?void 0:o.value,name:"assetCategorySelected",type:"assetCategory"})),(0,r.jsx)(ep,(0,u.Z)((0,i.Z)({},Z),{isClearable:!0,isDisabled:!o,label:"Assets",locationId:m.value,assetCategoryId:(null==o?void 0:o.value)||null,name:"assetSelected",type:"asset",isMulti:!0}))]})]})]})};em.propTypes={control:x.object.isRequired,customerSelectedWatch:x.object,errors:x.object.isRequired,locationSelectedWatch:x.object,register:x.func.isRequired};var ep=(0,eu.ZP)(W.P).withConfig({displayName:"location__StyledSelect",componentId:"sc-71770ac9-0"})(ec(),function(e){return e.isDisabled?"background-color: #cecece !important;":""}),ef=(0,m.memo)(function(e){var n=e.control,t=e.errors,o=e.user;return(0,r.jsx)(k.Z,{dataSet:{"data-cy":"manager"},open:!0,title:"Admin User",children:(0,r.jsx)(W.P,{control:n,accountId:o.accountId,errors:(0,i.Z)({},t),isClearable:!1,label:"Assigned to",name:"managerSelected",type:"user"})})},function(e,n){return!0});ef.propTypes={control:x.object.isRequired,errors:x.object.isRequired,user:x.object.isRequired};var ev=t(58594),eh=["1w","1m","3m","6m","12m"].map(function(e){return{id:e,label:e,value:e}}),ey=[1,2,3,4].map(function(e){return{id:"week"+e,label:e,value:"week"+e}}),eg=function(e){var n,t=e.control,o={control:t,errors:e.errors,register:(e.locationId,e.register)};return(0,r.jsxs)(k.Z,{dataSet:{"data-cy":"ppm"},open:!0,title:"PPM",children:[(0,r.jsx)(ev.Z,(0,u.Z)((0,i.Z)({},o),{data:eh,legend:"Frequency",name:"frequency",stacked:!1})),(0,r.jsx)(U.Z,{label:"Frequency Description",children:(0,r.jsx)(B.Z,(0,u.Z)((0,i.Z)({},o),{name:"frequencyDesc",rows:2}))}),(0,r.jsx)(ev.Z,(0,u.Z)((0,i.Z)({},o),{data:ey,legend:"Week",name:"week",stacked:!1}))]})};eg.propTypes={control:x.object.isRequired,errors:x.object.isRequired,locationId:x.number,register:x.func.isRequired};var ex=t(61816),eZ=t(21300),eb=t(1691),ej=t(30381),eq=t.n(ej),eI=function(e){var n=e.control,t=e.errors,o=e.register,a=e.siteVisitWatch,s=e.watch,l=e.quoteReturnedTimingEndSupplier,c=e.quoteReturnedTimingEndCustomer,d={control:n,errors:t,register:o},p=s("siteVisitStart"),f=s("siteVisitEnd"),v=s("siteVisitWeekends"),h=s("quoteDue"),y=s("quoteDueSupplier"),g=function(e){var n=new Date,t=new Date(e);return t.getHours()>=8&&17>t.getHours()&&n.getTime()<t.getTime()},x=function(e){var n=p?new Date(p):new Date,t=new Date(e);return t.getHours()>=8&&17>t.getHours()&&n.getTime()<t.getTime()},Z=function(e){var n=e.getDay();return 0!==n&&6!==n},b=(0,m.useMemo)(function(){return eq()(h).isAfter(c,"day")||eq()(y).isAfter(l,"day")},[h,y,c,l]);return(0,r.jsxs)(k.Z,{dataSet:{"data-cy":"quote"},open:!0,title:"Quote information",children:[(0,r.jsx)(U.Z,{label:"Number of Quotes",children:(0,r.jsx)(z.Z,(0,u.Z)((0,i.Z)({},d),{name:"quoteNumber",placeholder:"Select number of quotes",range:[4,1]}))}),b&&(0,r.jsx)(eb.Z,{color:"info",variant:"filled",sx:{mb:1},children:"Please note, the selected quote return date is later than that required by the relevant SLA. This will trigger a SLA breach."}),(0,r.jsx)(U.Z,{label:"Quote due by Customer",children:(0,r.jsx)(eZ.M,(0,u.Z)((0,i.Z)({},d),{name:"quoteDue",placeholder:"Click to select Quote Due Date"}))}),(0,r.jsx)(U.Z,{label:"Quote due from Supplier",children:(0,r.jsx)(eZ.M,(0,u.Z)((0,i.Z)({},d),{name:"quoteDueSupplier",placeholder:"Click to select Quote Due Date"}))}),(0,r.jsx)(ev.Z,(0,u.Z)((0,i.Z)({},d),{data:[{id:"siteVisitReq",label:"Site visit required",value:!0}],name:"siteVisitReq"})),a&&(0,r.jsxs)(_.Z,{children:[(0,r.jsx)(S.Z,{md:12,children:(0,r.jsx)(ev.Z,(0,u.Z)((0,i.Z)({},d),{data:[{id:"siteVisitWeekends",label:"Include Weekends",value:!0}],name:"siteVisitWeekends"}))}),(0,r.jsxs)(S.Z,{md:12,children:[(0,r.jsx)(U.Z,{label:"Start time"}),(0,r.jsx)(eZ.M,(0,u.Z)((0,i.Z)({},d),{dateFormat:"d MMM yyyy HH:mm",minDate:new Date,maxDate:f?new Date(f):null,filterTime:g,filterDate:!v&&Z,name:"siteVisitStart",showTimeSelect:!0,todayButton:!1}))]}),p&&(0,r.jsxs)(S.Z,{md:12,children:[(0,r.jsx)(U.Z,{label:"End time"}),(0,r.jsx)(eZ.M,(0,u.Z)((0,i.Z)({},d),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:p?new Date(p):new Date,filterTime:x,filterDate:!v&&Z,name:"siteVisitEnd",showTimeSelect:!0,todayButton:!1}))]})]})]})};eI.propTypes={control:x.object.isRequired,errors:x.object.isRequired,register:x.func.isRequired};var e_=t(74231);(0,e_.Ry)().shape({title:(0,e_.Z_)().required(),description:(0,e_.Z_)().required(),access:(0,e_.Z_)(),serviceSelected:(0,e_.Ry)().required(),timingEnd:(0,e_.hT)().required(),timingStart:(0,e_.hT)().required()});var eS=t(64714),e$=t(59983),ew=t(50135),eC=t(51233),eA=t(48580),eD=function(e){var n=e.register,t=e.control,i=(0,c.Z)((0,f.t)(h.dL),2),o=i[0],a=i[1],s=a.loading,l=a.data,u=(void 0===l?{issueTypes:[]}:l).issueTypes;return(0,r.jsx)(k.Z,{title:"Issue reported",open:!0,children:(0,r.jsxs)(eC.Z,{spacing:3,children:[(0,r.jsx)(b.Qr,{name:"issueType",control:t,render:function(e){var n=e.value,t=e.onChange;return(0,r.jsx)(eA.q,{value:n,disableClearable:!0,loading:s,onOpen:o,textFieldProps:{color:"secondary",variant:"standard",label:"Select issue type"},sx:{width:"200px"},onChange:function(e,n){return t(n)},options:u})}}),(0,r.jsx)(ew.Z,{multiline:!0,name:"issueReportedDescription",inputRef:n})]})})},eP=t(52971),eT=t(13262),ek=function(e){var n=e.setValue,t=e.permitsLinks,i=e.attachmentsPermits,o=e.showWarning,a=e.onDeleteExistingMedia;return(0,r.jsxs)(eC.Z,{sx:eR.container,children:[o&&(0,r.jsx)(eb.Z,{variant:"filled",severity:"error",children:"Warning: This site requires a permit for attendance"}),(0,r.jsx)(eP.V,{name:"permitsLinks",setValue:n,values:t,title:"Permits links"}),(0,r.jsx)(eT.f,{setValue:n,values:i,onDeleteExistingMedia:a,name:"permitsAttachments",title:"Permits attachments"})]})};ek.propTypes={setValue:Z().func,permitsLinks:Z().array,attachmentsPermits:Z().array,showWarning:Z().bool},ek.defaultProps={showWarning:!0};var eR={container:{width:"100%"}},eE=t(53485),eL=function(e){var n,t,o,a=e.defaultValues,s=e.preloadedMedia,l=e.deleteMediaByEntity,c=e.job,d=e.onSubmit,p=e.query,f=(0,ei.x)(),v=f.hasRole,y=f.user,g=(0,b.cI)({defaultValues:a,resolver:(0,j.S)((n=p,t=v,o=a.type,(0,e_.Ry)().shape({managerSelected:t("admin")&&(0,e_.Ry)().required(),customerSelected:(0,e_.Ry)().nullable().required(),customerUserSelected:(0,e_.Ry)().required(),source:t("admin")&&(0,e_.Z_)().oneOf(["call","email","portal","other"]).required(),slaId:"ppm"!==o&&(0,e_.Rx)().required(),description:(0,e_.Z_)().required(),taxonomyId_ShortDesc:(0,e_.Ry)().required(),reference:(0,e_.Z_)(),locationSelected:(0,e_.Ry)().required(),access:(0,e_.Z_)().required(),pricing:!n.quoted&&(0,e_.Z_)().oneOf(["time-materials","fixed"]),customerSpendThreshold:!n.quoted&&(0,e_.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),amount:!n.quoted&&(0,e_.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierLabourAmount:!n.quoted&&(0,e_.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierMaterialsAmount:!n.quoted&&(0,e_.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),quoteNumber:n.quoted&&(0,e_.Z_)().required(),quoteDue:n.quoted&&(0,e_.hT)().required(),quoteDueSupplier:n.quoted&&(0,e_.hT)().required(),siteVisitStart:n.quoted&&(0,e_.hT)().when("siteVisitReq",{is:"true",then:(0,e_.hT)().required()}),siteVisitEnd:n.quoted&&(0,e_.hT)().when("siteVisitReq",{is:"true",then:(0,e_.hT)().required()}),siteVisitWeekends:n.quoted&&(0,e_.Z_)(),costCategorySelected:t(["admin","customer"])&&!n.quoted&&(0,e_.Ry)().required(),serviceSelected:t(["admin","customer"])&&!n.quoted&&(0,e_.Ry)().required(),timing:!n.quoted&&(0,e_.Z_)().required().oneOf(["at","between"]),timingStart:!n.quoted&&(0,e_.hT)().required(),timingEnd:!n.quoted&&(0,e_.hT)().when("timing",{is:"between",then:(0,e_.hT)().required()}),allowTimingNormalHours:!n.quoted&&(0,e_.Z_)(),reportPassFail:(0,e_.Xg)(),reportPassFailTitle:(0,e_.Z_)().nullable(),customerSignature:(0,e_.Xg)(),supplierSignature:(0,e_.Xg)(),requireReportRecommendations:(0,e_.Xg)(),estimatedDuration:(0,e_.Rx)().min(0),estimatedDurationUnit:(0,e_.Z_)()})))}),x=g.control,Z=g.errors,C=g.formState,A=g.handleSubmit,D=g.register,P=g.setValue,T=g.watch,k=(0,m.useState)(),R=k[0],E=k[1],L=(0,m.useState)(),F=L[0],M=L[1],N=T("tags",a.tags),U=T("customerSelected",a.customerSelected),z=T("customerUserSelected",a.customerUserSelected),W=T("locationSelected",a.locationSelected),G=T("pricing",a.pricing),O=T("serviceSelected",a.serviceSelected),Q=T("timing",a.timing),B=T("siteVisitReq",a.siteVisitReq),J=T("taxonomyId_ShortDesc"),X=T("assetCategorySelected",null==a?void 0:a.assetCategorySelected),Y=T("slaId"),K=T("permitsLinks"),ee=T("permitsAttachments"),en=(0,q.Z)(U),er=(0,q.Z)(z),ea=(0,q.Z)(W),es=(0,q.Z)(J),el=(0,w.a)(h.Ab,{skip:!(null==U?void 0:U.value)||!(null==W?void 0:W.value),variables:{customerId:null==U?void 0:U.value,locationId:null==W?void 0:W.value}}).data;(0,m.useEffect)(function(){if(void 0!==ea&&W!==ea?[{name:"access",value:(null==W?void 0:W.access)||""},{name:"coordinates",value:null}].forEach(function(e){var n;return P(e.name,e.value)}):U!==en&&en?[{name:"coordinates",value:null},{name:"customerUserSelected",value:null},{name:"locationSelected",value:null}].forEach(function(e){var n;return P(e.name,e.value)}):G&&!p.parentId&&!p.id&&[{name:"customerSpendThreshold",value:null==U?void 0:U.spendThreshold},{name:"amount",value:null==J?void 0:null===(c=J.meta)||void 0===c?void 0:null===(d=c.template)||void 0===d?void 0:d.amount},{name:"supplierLabourAmount",value:null==J?void 0:null===(m=J.meta)||void 0===m?void 0:null===(f=m.template)||void 0===f?void 0:f.supplierLabourAmount},{name:"supplierMaterialsAmount",value:null==J?void 0:null===(v=J.meta)||void 0===v?void 0:null===(h=v.template)||void 0===h?void 0:h.supplierMaterialsAmount}].forEach(function(e){var n;return P(e.name,e.value)}),J!==es&&!p.id&&!p.parentId){[{name:"title",value:null==J?void 0:null===(y=J.meta)||void 0===y?void 0:null===(g=y.template)||void 0===g?void 0:g.title},{name:"description",value:null==J?void 0:null===(x=J.meta)||void 0===x?void 0:null===(Z=x.template)||void 0===Z?void 0:Z.description},{name:"tags",value:(null==J?void 0:null===(b=J.meta)||void 0===b?void 0:null===(j=b.template)||void 0===j?void 0:j.tags)||[]},{name:"costCategorySelected",value:null==J?void 0:null===(q=J.meta)||void 0===q?void 0:null===(I=q.template)||void 0===I?void 0:I.costCategorySelected},{name:"serviceSelected",value:null==J?void 0:null===(_=J.meta)||void 0===_?void 0:null===(S=_.template)||void 0===S?void 0:S.serviceSelected},{name:"reportPassFail",value:(null==J?void 0:null===($=J.meta)||void 0===$?void 0:null===(w=$.template)||void 0===w?void 0:w.reportPassFail)||!1},{name:"customerSignature",value:(null==J?void 0:null===(C=J.meta)||void 0===C?void 0:null===(A=C.template)||void 0===A?void 0:A.customerSignature)||!1},{name:"supplierSignature",value:(null==J?void 0:null===(D=J.meta)||void 0===D?void 0:null===(T=D.template)||void 0===T?void 0:T.customerSignature)||!1},{name:"reportPassFailTitle",value:null==J?void 0:null===(k=J.meta)||void 0===k?void 0:null===(R=k.template)||void 0===R?void 0:R.reportPassFailTitle},{name:"requireReportRecommendations",value:(null==J?void 0:null===(E=J.meta)||void 0===E?void 0:null===(L=E.template)||void 0===L?void 0:L.requireReportRecommendations)||!1}].forEach(function(e){var n;return P(e.name,e.value)});var e,n,t,i,r,o,a,s,l,u,c,d,m,f,v,h,y,g,x,Z,b,j,q,I,_,S,$,w,C,A,D,T,k,R,E,L,F,M=null==J?void 0:null===(F=J.meta)||void 0===F?void 0:F.template;(null==M?void 0:M.amount)||(null==M?void 0:M.supplierLabourAmount)||(null==M?void 0:M.supplierMaterialsAmount)?P("pricing","fixed"):P("pricing",null)}J!==es&&[{name:"reportPassFail",value:(null==J?void 0:null===(e=J.meta)||void 0===e?void 0:null===(n=e.template)||void 0===n?void 0:n.reportPassFail)||!1},{name:"reportPassFailTitle",value:null==J?void 0:null===(t=J.meta)||void 0===t?void 0:null===(i=t.template)||void 0===i?void 0:i.reportPassFailTitle},{name:"customerSignature",value:(null==J?void 0:null===(r=J.meta)||void 0===r?void 0:null===(o=r.template)||void 0===o?void 0:o.customerSignature)||!1},{name:"supplierSignature",value:(null==J?void 0:null===(a=J.meta)||void 0===a?void 0:null===(s=a.template)||void 0===s?void 0:s.supplierSignature)||!1},{name:"requireReportRecommendations",value:(null==J?void 0:null===(l=J.meta)||void 0===l?void 0:null===(u=l.template)||void 0===u?void 0:u.requireReportRecommendations)||!1}].forEach(function(e){var n;return P(e.name,e.value)}),er&&(null==z?void 0:z.value)!==(null==er?void 0:er.value)&&P("locationSelected",null)},[U,null==z?void 0:z.value,W,en,er,ea,es,G,p.id,p.parentId,P,J]),(0,m.useEffect)(function(){if(Y&&!p.quoted){var e,n,t=(0,et.GU)("reactive",el),i=null===(e=null==t?void 0:t.find(function(e){return e.id===Number(Y)}))||void 0===e?void 0:e.onSite,r=null===(n=null==t?void 0:t.find(function(e){return e.id===Number(Y)}))||void 0===n?void 0:n.onSiteUnit;if(i&&r){var o=eq()(null==a?void 0:a.createdAt),s=eq()(null==a?void 0:a.createdAt).add(i,r),l=30-o.minute()%30,u=30-s.minute()%30;P("timing","between"),P("timingStart",o.clone().add(l,"minutes").toDate()),P("timingEnd",s.clone().add(u,"minutes").toDate())}}},[el,null==a?void 0:a.createdAt,p.quoted,P,Y]),(0,m.useEffect)(function(){if(Y&&p.quoted){var e,n,t=(0,et.GU)("quote",el),i=null===(e=null==t?void 0:t.find(function(e){return e.id===Number(Y)}))||void 0===e?void 0:e.quoteReturned,r=null===(n=null==t?void 0:t.find(function(e){return e.id===Number(Y)}))||void 0===n?void 0:n.quoteReturnedUnit;if(i&&r){var o=eq()(null==a?void 0:a.createdAt).add(i,r),s=30-o.minute()%30,l=o.clone().add(s,"minutes").toDate(),u=o.clone().add(s,"minutes").subtract(1,"day").toDate();P("quoteDue",l),P("quoteDueSupplier",u),M(l),E(u)}}},[el,null==a?void 0:a.createdAt,p.quoted,P,Y]),(0,m.useEffect)(function(){P("permitsAttachments",s.map(function(e){return{mediaId:e.mediaId,caption:e.media.caption,media:null,type:"",isAdded:!1}}))},[s,P]);var eu={control:x,errors:Z,register:D};return(0,r.jsxs)(I.Z,{handleSubmit:A(d),children:[(0,r.jsxs)(_.Z,{children:[(0,r.jsxs)(S.Z,{md:6,children:[v("admin")&&(0,r.jsx)(ef,(0,u.Z)((0,i.Z)({},eu),{user:y})),(0,r.jsx)(H,(0,u.Z)((0,i.Z)({},eu),{customerSelectedWatch:U,user:y,hasRole:v})),(null==c?void 0:c.type)!=="quote"&&!p.quoted&&(0,r.jsx)(eD,{register:D,control:x}),W&&v(["admin","customer","tenant"])&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eo,(0,u.Z)((0,i.Z)({},eu),{dataSlas:el,currentAnswers:a.questions,jobId:null==c?void 0:c.id,locationSelectedWatch:W,taxonomyWatch:J,prevTaxonomy:es,watch:T,isQuote:p.quoted,isPPM:"ppm"===a.type,tagsWatch:N,setValue:P})),!p.quoted&&v(["admin","customer"])&&(0,r.jsx)(eS.t,(0,i.Z)({},eu)),!p.quoted&&v("admin")&&(0,r.jsx)(ex.n,(0,u.Z)((0,i.Z)({},eu),{pricingWatch:G,hasServiceRate:!!(null==U?void 0:U.serviceRateLabour)||!!(null==U?void 0:U.serviceRateExpenses),serviceSelectedWatch:O,isPPM:(null==c?void 0:c.type)==="ppm"})),!p.quoted&&(0,r.jsx)(e$.X,(0,u.Z)((0,i.Z)({},eu),{hasRole:v,query:p,setValue:P,timingWatch:Q,watch:T}))]})]}),(0,r.jsxs)(S.Z,{md:6,children:[U&&(0,r.jsx)(em,(0,u.Z)((0,i.Z)({},eu),{setValue:P,assetCategoryWatch:X,customerSelectedWatch:U,customerUserSelectedWatch:z,locationSelectedWatch:W})),(null==W?void 0:W.permitsRequired)&&v(["admin","customer"])&&(0,r.jsx)(eE.s,{title:"Location permits",children:(0,r.jsx)(ek,{setValue:P,permitsLinks:K,attachmentsPermits:ee,onDeleteExistingMedia:l})}),W&&(0,r.jsxs)(r.Fragment,{children:[p.quoted&&(0,r.jsx)(eI,(0,u.Z)((0,i.Z)({},eu),{siteVisitWatch:B,watch:T,quoteReturnedTimingEndSupplier:R,quoteReturnedTimingEndCustomer:F})),p.ppm&&(0,r.jsx)(eg,(0,u.Z)((0,i.Z)({},eu),{locationId:W.value})),!c&&(0,r.jsx)(V,{locationId:W.value,serviceId:(null==O?void 0:O.value)||null})]})]})]}),(0,r.jsx)("input",(0,i.Z)({type:"hidden"},D("permitsLinks"))),(0,r.jsx)("input",(0,i.Z)({type:"hidden"},D("permitsAttachments"))),(0,r.jsx)("input",(0,i.Z)({type:"hidden"},D("tags"))),(0,r.jsx)($.Z,{content:"Submit",disabled:C.isSubmitting,size:"lg",type:"submit"})]})};eL.propTypes={defaultValues:x.object.isRequired,job:x.object,onSubmit:x.func.isRequired,query:x.object.isRequired};var eF=t(9928),eM=t(39641),eV=t(84808),eN=t(98456),eU=t(60185),ez=t(31679),eW=function(e){var n=(0,ei.x)(),t=n.hasRole,o=n.user,s=(0,p.x)(),x=(0,eM.D)(),Z=(0,ez.useMainContext)(),b=Z.predefinedAssetForWorkOrder,j=Z.setPredefinedAssetForWorkOrder,q=(0,m.useState)(!0),I=q[0],_=q[1],S="/dashboard/issues/",$=e.accountId||0,w=e.locationId||0,C=e.parentId||0,A=e.assetId||0,D=e.recall||null;t("customer")&&($=o.accountId);var P,T,k,R=(0,c.Z)((0,f.t)(h.E6,{skip:!e.id,variables:{adminId:o.adminId,number:"".concat(e.id)},onError:function(e){x.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),E=R[0],L=R[1],F=L.loading,M=L.data,V=(void 0===M?{job:null}:M).job,N=V&&V[0],U=(0,eU.z)("Job",o.adminId,o.id,null==N?void 0:N.id,"supportingDocuments"),z=U.createMediaInput,W=U.preloadedMedia,G=U.deleteMediaByEntity,O=U.loadingDeleteMedia,H=(0,c.Z)((0,f.t)(h.TY,{onError:function(e){x.show({content:"Error: ".concat(e.message),severity:"error"})},variables:{accountId:$,locationId:w,parentId:C,assetId:A,includeAccount:!!$,includeLocation:!!w,includeParentJob:!!C,includeAsset:!!A}}),2),Q=H[0],B=H[1],J=B.loading,X=B.data,Y=(0,c.Z)((0,v.D)(y.xM,{onError:function(e){x.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),K=Y[0],ee=Y[1].loading,en=(0,c.Z)((0,v.D)(y.tv,{onError:function(e){x.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),er=en[0],eo=en[1].loading,ea=(0,c.Z)((0,v.D)(h.mJ,{onError:function(e){x.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:(P=(0,l.Z)(function(n){var t,i,r,u,c,m;return(0,d.__generator)(this,function(u){switch(u.label){case 0:return i=(t=n.createJob.data.insert_Job.returning[0]).id,r=t.number,[4,(0,eF.F)(s,i)];case 1:if(u.sent(),!(C&&"true"===D))return[3,4];return[4,ec({variables:{objects:[{notes:"Marked as dispute because of creating a recall job",status:"inDispute",jobId:e.parentId,userId:o.id}]}})];case 2:var m;return u.sent(),[4,K({variables:{objects:{caption:"report for recall job",expiryAt:null,extension:null==(c=e.report)?void 0:c.split(".").pop(),userId:o.id,filename:c,type:"document"}}}).then((m=(0,l.Z)(function(e){var n,t,r;return(0,d.__generator)(this,function(n){switch(n.label){case 0:return[4,er({variables:{objects:r={mediaId:e.data.insert_Media.returning[0].id,entity:"Job",entityId:i}}})];case 1:return n.sent(),[2]}})}),function(e){return m.apply(this,arguments)}))];case 3:u.sent(),u.label=4;case 4:return a().push("".concat(S,"view?id=").concat(r)),[2]}})}),function(e){return P.apply(this,arguments)})}),2),es=ea[0],el=ea[1].loading,eu=(0,c.Z)((0,v.D)(h.r2,{onError:function(e){x.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),ec=eu[0],ed=eu[1].loading,em=(0,c.Z)((0,v.D)(h.uA,{onCompleted:(T=(0,l.Z)(function(e){var n;return(0,d.__generator)(this,function(t){switch(t.label){case 0:return[4,(0,eF.F)(s,N.id)];case 1:return t.sent(),n=e.update_Job_by_pk.number,a().push("".concat(S,"view?id=").concat(n)),[2]}})}),function(e){return T.apply(this,arguments)})}),2),ep=em[0],ef=em[1].loading;(0,m.useEffect)(function(){e.id?E():$||w||C?Q():_(!1)},[]),(0,m.useEffect)(function(){!F&&N?_(!1):!J&&X&&_(!1)},[F,J]);var ev=(k=(0,l.Z)(function(n){var r,a,s,l,c,m,p,f,v;return(0,d.__generator)(this,function(d){switch(d.label){case 0:return r=(0,et.eD)(n,null==N?void 0:N.id),[4,z(n.permitsAttachments,"supportingDocuments")];case 1:return a=d.sent(),delete n.permitsAttachments,[4,(0,et.lV)({query:e,data:(0,i.Z)({},(0,u.Z)((0,i.Z)({},n),{meta:null!==(s=null==N?void 0:N.meta)&&void 0!==s?s:{}}),a||{}),hasRole:t,user:o,type:eh.type})];case 2:if(l=d.sent(),!(!e.id||e.parentId))return[3,4];return[4,es({variables:{adminId:o.adminId,objects:[l]}})];case 3:return d.sent(),[3,6];case 4:return p=[],f=eh.assetSelected.map(function(e){return e.assetId}),(null===(c=l.Assets)||void 0===c?void 0:null===(m=c.data)||void 0===m?void 0:m.length)>0&&(p=l.Assets.data.map(function(e){return(0,u.Z)((0,i.Z)({},e),{entityId:N.id})}),delete l.Assets),v=(0,et.A5)(N.id,l),delete l.Taxonomy,[4,ep({variables:{jobId:N.id,changes:l,compliances:[],deletedAssetIds:f,assets:p,questions:r,media:v,hasQuestions:(null==r?void 0:r.length)>0}})];case 5:d.sent(),d.label=6;case 6:return[2]}})}),function(e){return k.apply(this,arguments)});if((0,m.useEffect)(function(){return function(){j(null)}},[j]),N&&((0,g.E)(N,"accepted")&&!t("admin")||(0,g.E)(N,"inProgress")))return(0,r.jsx)("p",{children:"Work order can't be edited after started by supplier"});var eh={};return b?eh=(0,et.Pu)(b,t,o):I||(eh=e.id?N?(0,et.I2)(N):null:(0,et.$z)(X,t,o,D)),(0,r.jsxs)(r.Fragment,{children:[(I||F||O||J||ee||eo||el||ed||ef)&&(0,r.jsx)(eV.Z,{open:!0,sx:{zIndex:1e5},children:(0,r.jsx)(eN.Z,{color:"secondary"})}),!I&&eh&&(0,r.jsx)(eL,{defaultValues:eh,job:e.id?N:null,onSubmit:ev,preloadedMedia:W,deleteMediaByEntity:G,query:e})]})},eG=function(){var e=(0,o.useRouter)().query,n=e.id?"Edit":"Create",t="Work Order";return t=e.quoted?"Quote":t,t=e.ppm?"PPM":t,(0,r.jsx)(s.Z,{pageHeading:{heading:"".concat(n," ").concat(t)},View:(0,r.jsx)(eW,(0,i.Z)({},e))})}}},function(e){e.O(0,[3662,2283,212,619,8890,2583,4135,8579,6043,1564,4244,1336,3911,3776,5370,6540,4046,1023,2797,9241,653,1207,8948,8324,2518,8344,6733,8151,6147,9774,2888,179],function(){return e(e.s=20633)}),_N_E=e.O()}]);