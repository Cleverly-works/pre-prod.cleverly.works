(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6872],{38727:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/assets/view",function(){return t(67973)}])},78232:function(e,n,t){"use strict";t.d(n,{F:function(){return A}});var i=t(14924),o=t(26042),r=t(69396),a=t(85893),s=t(45697),d=t.n(s),l=t(10166),c=t(80482),u=t(23776),p=t(98456),h=t(16143),m=t(50135),x=t(99534),f=t(29815),v=t(74061),g=t(6498),b=t(75438),j=t(15861),y=t(61730),Z=t(67294),w=(0,Z.createContext)({}),C=(0,Z.forwardRef)(function(e,n){var t=(0,Z.useContext)(w);return(0,a.jsx)("div",(0,o.Z)({ref:n},e,t))}),I=(0,Z.forwardRef)(function(e,n){var t=e.children,i=(0,x.Z)(e,["children"]),o=[];t.forEach(function(e){o.push(e),o.push.apply(o,(0,f.Z)(e.children||[]))});var r,s,d=(0,g.u)(),l=(0,y.Z)(d.breakpoints.up("sm"),{noSsr:!0}),c=o.length,u=l?36:48,p=function(e){return e.hasOwnProperty("group")?48:u},h=(s=(0,Z.useRef)(null),(0,Z.useEffect)(function(){null!=s.current&&s.current.resetAfterIndex(0,!0)},[c]),s);return(0,a.jsx)("div",{ref:n,children:(0,a.jsx)(w.Provider,{value:i,children:(0,a.jsx)(v.S_,{itemData:o,height:(c>8?8*u:o.map(p).reduce(function(e,n){return e+n},0))+16,width:"100%",ref:h,outerElementType:C,innerElementType:"ul",itemSize:function(e){return p(o[e])},overscanCount:5,itemCount:c,children:P})})})});function P(e){var n=e.data,t=e.index,i=e.style,s=n[t],d=(0,r.Z)((0,o.Z)({},i),{top:i.top+8});return s.hasOwnProperty("group")?(0,a.jsx)(b.Z,{component:"div",style:d,children:s.group},s.key):(0,a.jsx)(j.Z,(0,r.Z)((0,o.Z)({component:"li"},s[0]),{noWrap:!0,style:d,children:s[1].label}))}var A=function(e){var n=e.label,t=e.loading,i=e.placeholder,s=e.error,d=e.helperText,l=e.inputProps;return(0,a.jsx)(R,(0,r.Z)((0,o.Z)({},e),{disableListWrap:!0,PopperComponent:S,ListboxComponent:I,renderInput:function(e){return(0,a.jsx)(m.Z,(0,r.Z)((0,o.Z)({},e,l),{error:s,helperText:d,label:n,placeholder:i,color:"secondary",variant:"standard",InputProps:(0,r.Z)((0,o.Z)({},e.InputProps,(null==l?void 0:l.InputProps)||{}),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[t?(0,a.jsx)(p.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},renderOption:function(e,n,t){return[e,n,t.index]},renderGroup:function(e){return e}}))};A.defaultProps={value:null,onChange:function(){},label:"",loading:!1,error:!1,onOpen:function(){},options:[],inputProps:{},withoutSelectIcon:!1},A.propTypes={value:d().shape({value:d().any,label:d().string}),onChange:d().func,label:d().string,loading:d().bool,onOpen:d().func,options:d().arrayOf(d().shape({value:d().any,label:d().string})),inputProps:d().object,withoutSelectIcon:d().bool,inputValue:d().string,onInputChange:d().func};var S=(0,l.Z)(h.Z)((0,i.Z)({zIndex:"12000 !important"},"& .".concat(c.Z.listbox),{boxSizing:"border-box","& ul":{padding:0,margin:0}})),R=(0,l.Z)(u.Z)(function(e){var n=e.withoutSelectIcon;return{"& .MuiAutocomplete-root":{cursor:"pointer"},"& .MuiAutocomplete-popper":{zIndex:"12000 "},"& .MuiAutocomplete-endAdornment":{"& .MuiButtonBase-root.MuiIconButton-root.MuiAutocomplete-popupIndicator":{"& .MuiSvgIcon-root":(0,o.Z)({},n&&{display:"none"})}}}})},35418:function(e,n,t){"use strict";t.d(n,{G:function(){return D}});var i=t(26042),o=t(69396),r=t(7297),a=t(85893),s=t(67294),d=t(45697),l=t(6812),c=t(52824),u=t(10367),p=t(78289),h=t(41564),m=t(34953),x=t(62466),f=t(68956),v=t(73373),g=t(11585),b=t(18678),j=t(55377),y=t(16551),Z=t(77439),w=t(74297),C=t(23892),I=t(39087),P=t(76256),A=t(75795),S=t(91272),R=t(20705),M=t(2845);function k(){var e=(0,r.Z)(["\n  width: 24px;\n"]);return k=function(){return e},e}function E(){var e=(0,r.Z)(["\n  border: 1px solid #eee;\n"]);return E=function(){return e},e}var D=function(e){var n=e.carousel,t=e.category,r=e.children,d=e.data,u=(e.details,e.entity),k=e.entityId,E=e.filters,D=(e.limit,e.listView),O=e.mediaMeta,z=e.onMediaAdd,T=e.onMediaRemove,W=(e.pagination,e.showActionButtons),B=e.showEntityColumn,U=e.showItemActions,Y=e.summary,F=e.type,L=(0,R.x)({filters:E}),_=L.initialData,H=L.ref,Q=(0,M.x)(),G=Q.hasRole,V=Q.user,X=(0,s.useContext)(p.Z),J=(0,l.a)(c.t,{variables:(0,o.Z)((0,i.Z)({},_),{entity:u,entityId:k,category:t,adminId:V.adminId,meta:O})}),K=J.data,$=void 0===K?{items:[],meta:{aggregate:{totalCount:0}}}:K,ee=$.items,en=$.meta,et=J.loading,ei=J.refetch,eo=function(e){X.close(),d.length||ei(),z&&z(e)},er=function(e){X.close(),d.length||ei(),T&&T(e)},ea=function(e){e.stopPropagation(),X.show({content:(0,a.jsx)(P.z,{accept:"image/*",adminId:V.adminId,category:t,entity:u,entityId:k,expiryShow:!1,mediaMeta:O,multiple:!0,onSuccess:eo,type:"image"}),title:"Upload Photos"})},es=function(e){e.stopPropagation(),X.show({content:(0,a.jsx)(P.z,{accept:".pdf, .doc, .docx, .xlsx",adminId:V.adminId,category:t,entity:u,entityId:k,expiryShow:!1,mediaMeta:O,onSuccess:eo,type:"document"}),title:"Upload Documents"})},ed=function(e){X.show({content:(0,a.jsx)(C.d,{mediaId:e.data.id,onSuccess:er}),submit:!1,title:"Delete Media"})},el=function(e){X.show({content:(0,a.jsx)(I.z,{media:e.data,toggleShow:X.close}),submit:!1,title:"Media Details",width:"50%"})},ec=[{context:"primary",icon:["fas","info-circle"],onClick:function(e,n){return el(n)},tooltip:"Details"}];G("admin")&&ec.push({context:"danger",icon:["fas","trash"],onClick:function(e,n){return ed(n)},tooltip:"Delete"});var eu=[{hidden:!0},{hidden:!0},{hidden:!0,text:"Caption"},{hidden:!1,text:"File"},{hidden:!B,text:"Entity"},{formatter:function(e){var n,t=e.row;return(0,a.jsx)(N,{children:(null==t?void 0:null===(n=t.authority)||void 0===n?void 0:n.adminOnly)&&(0,a.jsx)(h.Z,{content:"Admin user only",children:(0,a.jsx)(m.Z,{alt:"Admin Only",src:"/messaging/admin-only.svg"})})})},text:"",tooltip:"Only Admin can see"},{formatter:(0,x.Z)("/dashboard/users/view","userId","uploaded"),text:"Uploaded by"},{hidden:!D,text:"Thumbnails"},{hidden:!U,formatter:f.Z,formatterData:ec,text:"Actions"}],ep=function(e,n){e.preventDefault(),window.open("".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(n))},eh=[],em=ee.map(function(e){var n=e.entity,t=e.entityId,i=e.id,o=e.item,r=o.caption,s=o.filename,d=o.meta,l=o.name,c=o.type,u=o.user;return{data:o,id:i,userId:null==u?void 0:u.id,file:function(){return(0,a.jsx)(v.Z,{onClick:function(e){return ep(e,s)},children:r||l||s})},entity:n&&"".concat(n,"#").concat(t),authority:d,uploaded:"".concat(null==u?void 0:u.nameFirst," ").concat(null==u?void 0:u.nameLast),thumbnails:(0,A.S)(c,d),actions:""}}),ex=(ee.forEach(function(e){var n=e.item,t=n.caption,i=n.filename;"image"===n.type&&eh.push({caption:t,filename:i})}),eh),ef=ex.length;return(0,a.jsxs)(g.Z,{fitParentHeight:!0,open:!0,title:Y,children:[r,n&&ef>0&&(0,a.jsx)(q,{children:(0,a.jsx)(b.Z,{fullWidth:!0,height:"200px",numberOfItems:1,showNavs:!1,showPagination:!0,slides:ex.map(function(e){var n=e.caption,t=e.filename;return{node:(0,a.jsx)(m.Z,{alt:n,src:"".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(t)}),text:" "}})})}),(0,a.jsx)(S.t,{columns:eu,loading:et,fullHeight:!0,paginationSize:!1,meta:en,ref:H,refetch:ei,rows:em}),W&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Z,{size:"sm"}),(0,a.jsxs)(y.Z,{align:"flex-end",children:[(!F||"document"===F)&&!G("supplier")&&(0,a.jsx)(Z.Z,{content:"Add Document",context:"secondary",onClick:es,size:"sm"}),(!F||"image"===F||"avatar"===F)&&!G("supplier")&&(0,a.jsx)(Z.Z,{content:"Add ".concat((0,w.Z)(F||"Image")),context:"secondary",onClick:ea,size:"sm"})]})]})]})},N=u.ZP.div.withConfig({displayName:"table__StyledIcon",componentId:"sc-9d92024f-0"})(k()),q=u.ZP.div.withConfig({displayName:"table__StyledCarousel",componentId:"sc-9d92024f-1"})(E());D.propTypes={carousel:d.bool,category:d.string,children:d.node,data:d.array,details:d.bool,entity:d.string,entityId:d.number,filters:d.object,limit:d.number,listView:d.bool,mediaMeta:d.object,onMediaAdd:d.func,onMediaRemove:d.func,pagination:d.object,showActionButtons:d.bool,showEntityColumn:d.bool,showItemActions:d.bool,summary:d.string,type:d.string},D.defaultProps={carousel:!0,category:null,data:[],details:!1,filters:{},limit:20,listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,summary:"Media",type:null}},66321:function(e,n,t){"use strict";t.d(n,{E:function(){return f}});var i=t(26042),o=t(69396),r=t(85893),a=t(45697),s=t.n(a),d=t(94054),l=t(50480),c=t(56815),u=t(40476),p=t(79717),h=t(36872),m=t(51233),x=t(15861),f=function(e){var n=e.label,t=e.options,a=e.error,s=e.helperText,f=e.stackProps,g=e.formControlProps,b=e.labelLeft,j=function(e){var n=e.children;return(0,r.jsx)(r.Fragment,{children:n})};return(0,r.jsxs)(d.Z,(0,o.Z)((0,i.Z)({sx:{m:3},error:a,variant:"standard"},void 0===g?{}:g),{children:[(0,r.jsxs)(m.Z,(0,o.Z)((0,i.Z)({},b&&v),{children:[n&&(0,r.jsx)(u.Z,{id:"radio-group",color:"secondary",children:n}),(0,r.jsx)(p.Z,(0,o.Z)((0,i.Z)({},e),{"aria-labelledby":"radio-group",children:(0,r.jsx)(m.Z,(0,o.Z)((0,i.Z)({},void 0===f?{}:f),{children:t.map(function(e){var n=e.value,t=e.label,i=e.icon,o=e.ParentComponent;return(0,r.jsx)(void 0===o?j:o,{children:(0,r.jsx)(l.Z,{value:n,control:(0,r.jsx)(h.Z,{color:"secondary"}),label:(0,r.jsxs)(m.Z,{direction:"row",alignItems:"center",spacing:1,children:[i,(0,r.jsx)(x.Z,{children:t})]})})})})}))}))]})),(0,r.jsx)(c.Z,{children:s})]}))};f.defaultProps={options:[],error:!1,helperText:"",stackProps:{},formControlProps:{},labelLeft:!1},f.propTypes={label:s().string,options:s().arrayOf(s().shape({label:s().string.isRequired,value:s().any.isRequired,ParentComponent:s().elementType})).isRequired,error:s().bool,helperText:s().string,stackProps:s().object,formControlProps:s().object,labelLeft:s().bool};var v={direction:"row",alignItems:"center",flexWrap:"wrap",spacing:1}},98571:function(e,n,t){"use strict";t.d(n,{eI:function(){return R},UH:function(){return j},Pd:function(){return C}});var i=t(85893),o=t(84059),r=t(45697),a=t.n(r),s=t(51233),d=t(11057),l=t(86532),c=t(22797),u=t(38895),p=t(15861),h=t(5616),m=t(27434),x=t(63441),f=t(63139),v=t(67294),g=function(e){var n=e.id,t=e.value,r=e.isExpandedByDefault,a=e.collapsible,g=(0,f.a)(),j=(0,v.useState)(r),y=j[0],Z=j[1],w=function(){return Z(function(e){return!e})},C=function(e){e.stopPropagation();var t=document.querySelector("#qr-".concat(n," > canvas")).toDataURL(),i=document.createElement("a");i.href=t,i.download="".concat(n,".png"),document.body.appendChild(i),i.click(),document.body.removeChild(i)},I=(0,v.useMemo)(function(){var e={Main:s.Z,Header:s.Z,Body:s.Z};return a&&(e={Main:l.Z,Header:u.Z,Body:c.Z}),e},[a]);return(0,i.jsx)(h.Z,{children:(0,i.jsxs)(I.Main,{expanded:y,onChange:w,children:[(0,i.jsx)(I.Header,{expandIcon:(0,i.jsx)(m.Z,{}),children:(0,i.jsxs)(s.Z,{width:"100%",direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(p.Z,{variant:"h6",children:"QR Code"}),(0,i.jsx)(d.Z,{disabled:g,disableMinWidth:!0,size:"small",color:"info",variant:"contained",onClick:C,sx:b.downloadButton,children:(0,i.jsx)(x.Z,{sx:b.downloadIcon})})]})}),(0,i.jsx)(I.Body,{sx:b.body,children:(0,i.jsx)(s.Z,{id:"qr-".concat(n),alignItems:"center",children:(0,i.jsx)(o.Qd,{bgColor:"#ffffff",fgColor:"#000000",value:t,level:"H",size:256})})})]})})},b={downloadIcon:{height:"17px",width:"17px"},downloadButton:{mr:2},body:{marginTop:"20px"}};g.propTypes={id:a().string,value:a().string,isExpandedByDefault:a().bool,collapsible:a().bool},g.defaultProps={id:"new-qr-code",isExpandedByDefault:!1,collapsible:!0};var j=g,y=t(93946),Z=t(78394),w=function(e){var n=e.id,t=e.value,r=function(e){e.stopPropagation();var t=document.querySelector("#qr-".concat(n," > canvas")).toDataURL(),i=document.createElement("a");i.href=t,i.download="".concat(n,".png"),document.body.appendChild(i),i.click(),document.body.removeChild(i)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(y.Z,{onClick:r,size:"large",sx:{borderRadius:"10px!important",width:"130px"},children:(0,i.jsxs)(s.Z,{alignItems:"center",children:[(0,i.jsx)(Z.Z,{sx:{width:"50px",height:"50px"},color:"secondary"}),(0,i.jsx)(p.Z,{children:"Qr Code"})]})}),(0,i.jsx)(s.Z,{id:"qr-".concat(n),alignItems:"center",display:"none",children:(0,i.jsx)(o.Qd,{style:{display:"none"},bgColor:"#ffffff",fgColor:"#000000",value:t,level:"H",size:256})})]})};w.propTypes={id:a().string,value:a().string},w.defaultProps={id:"new-qr-code",isExpandedByDefault:!1,collapsible:!0};var C=w,I=t(78566),P=t.n(I),A=t(28842),S=function(e){var n=e.id,t=e.value,o=function(e){e.stopPropagation();var t=document.querySelector("#barcode-".concat(n," > svg")).outerHTML,i=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(i),r=document.createElement("a");r.href=o,r.download="".concat(n,".svg"),document.body.appendChild(r),r.click(),document.body.removeChild(r)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(y.Z,{onClick:o,size:"large",sx:{borderRadius:"10px!important",width:"130px"},children:(0,i.jsxs)(s.Z,{alignItems:"center",children:[(0,i.jsx)(A.Z,{sx:{width:"50px",height:"50px"},color:"secondary"}),(0,i.jsx)(p.Z,{children:"Barcode"})]})}),(0,i.jsx)(s.Z,{id:"barcode-".concat(n),alignItems:"center",display:"none",children:(0,i.jsx)(P(),{value:"".concat(t),style:{display:"none"}})})]})};S.defaultProps={id:"asset",value:""},S.propTypes={id:a().string.isRequired,value:a().string.isRequired};var R=S},91272:function(e,n,t){"use strict";t.d(n,{t:function(){return l}});var i=t(85893),o=t(67294),r=t(45697),a=t(11163),s=t(46003),d=t(16540),l=(0,o.forwardRef)(function(e,n){var t=e.columns,r=e.history,l=e.initialSort,c=e.loading,u=e.meta,p=e.paginationSize,h=e.refetch,m=e.rowClick,x=e.rows,f=e.xeroPageSize,v=(0,a.useRouter)(),g=v.query,b=void 0===g?{}:g,j=(0,o.useState)(parseInt(null==b?void 0:b.page,10)||1),y=j[0],Z=j[1],w=(0,o.useState)(f||s.C1.paginationSize),C=w[0],I=w[1];l||(l={item:"createdAt",order:"desc"});var P=(0,o.useState)({item:l.item,order:l.order}),A=P[0],S=P[1],R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=v.query,t=void 0===n?{}:n;if(e>1?t.page=e:delete t.page,!(Object.keys(t).length>0))return{};var i=Object.keys(t).map(function(n){return"page"===n?"".concat(n,"=").concat(e):"".concat(n,"=").concat(t[n])}).join("&");return"?".concat(i)},M=function(){S({item:l.item,order:l.order}),Z(1);var e=R();v.push(e),I(f||s.C1.paginationSize)};(0,o.useImperativeHandle)(n,function(){return{currentPage:y,pageSize:C,sort:A,resetPagination:function(){M()}}});var k=function(e){var n=R(e);r&&v.push(n),Z(e),!r&&h&&h()},E=function(e){e!==s.C1.paginationSize&&(I(e),h&&h())},D=function(e){var n;S({item:e.item,order:e.order}),h&&h()};return(0,i.jsx)(d.Z,{columns:t,loading:c,paginationSize:p,pagination:u&&!0,paginationProps:u&&{currentPage:y,onPageChange:k,onPageSizeChange:E,pageCount:Math.ceil(u.aggregate.totalCount/C),perPage:C},rowClick:m,rows:x,sort:A,setSort:D})});l.propTypes={columns:r.array.isRequired,history:r.bool,initialSort:r.object,loading:r.bool,meta:r.object,refetch:r.func,rowClick:r.func,rows:r.array.isRequired},l.defaultProps={history:!0,loading:!0,paginationSize:!1}},9492:function(e,n,t){"use strict";t.d(n,{S:function(){return i}});var i=function(e,n){var t=document.createElement("a");"string"==typeof t.download?(document.body.appendChild(t),t.download=n,t.href=e,t.click(),document.body.removeChild(t)):location.replace(e)}},67973:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return em}});var i=t(85893),o=t(14924),r=t(26042),a=t(69396),s=t(828),d=t(29815),l=t(45697),c=t.n(l),u=t(11163),p=t.n(u),h=t(6812),m=t(68957),x=t(5616),f=t(98456),v=t(86886),g=t(51233),b=t(86532),j=t(22797),y=t(38895),Z=t(11057),w=t(15861),C=t(77957),I=t(30381),P=t.n(I),A=t(27434),S=t(64872),R=t(35656),M=t(71152),k=function(e){var n,t,o=e.assetId,r=e.name,a=e.description,d=e.parentAsset,l=e.customer,c=e.location,u=e.sublocation,p=e.category,h=e.createdAt,m=e.status,f=e.categoryQuestions,I=e.categoryAnswers,k=e.assetAdditional,E=e.editable,D=e.expanded,N=e.onChangeExpanded,q=(0,S.a)(),O=function(e){e.stopPropagation(),q.show({content:(0,i.jsx)(R.R,{assetId:o,offCanvas:q}),title:"Edit Asset",submit:!0})};return(0,i.jsx)(x.Z,{children:(0,i.jsxs)(b.Z,{expanded:D,onChange:N,children:[(0,i.jsx)(y.Z,{expandIcon:(0,i.jsx)(A.Z,{}),children:(0,i.jsxs)(g.Z,{width:"100%",direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(w.Z,{variant:"h6",children:"Details"}),E&&(0,i.jsx)(Z.Z,{disableMinWidth:!0,size:"small",color:"secondary",variant:"contained",onClick:O,sx:{mr:2},children:(0,i.jsx)(C.Z,{sx:{height:"17px",width:"17px"}})})]})}),(0,i.jsx)(j.Z,{children:(0,i.jsxs)(v.ZP,{container:!0,rowSpacing:2,children:[(0,i.jsxs)(v.ZP,{container:!0,item:!0,xs:6,rowSpacing:1,columnSpacing:1,children:[(0,i.jsxs)(v.ZP,{item:!0,xs:12,children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Name"}),(0,i.jsx)(w.Z,{children:r})]}),(0,i.jsxs)(v.ZP,{item:!0,xs:12,children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Description"}),(0,i.jsx)(w.Z,{children:a})]}),(0,i.jsxs)(v.ZP,{item:!0,xs:12,children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Parent asset"}),(0,i.jsx)(w.Z,{children:d})]}),(0,i.jsxs)(v.ZP,{item:!0,xs:12,children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Customer"}),(0,i.jsx)(w.Z,{children:l})]}),(0,i.jsxs)(v.ZP,{item:!0,xs:12,sx:{maxWidth:"85%!important"},children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Location"}),(0,i.jsx)(w.Z,{children:c})]}),(0,i.jsxs)(v.ZP,{item:!0,xs:12,children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Sublocation"}),(0,i.jsx)(w.Z,{children:u})]}),(0,i.jsxs)(v.ZP,{item:!0,xs:12,children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Category"}),(0,i.jsx)(w.Z,{children:p})]}),(0,i.jsxs)(v.ZP,{item:!0,xs:12,children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Type"}),(0,i.jsx)(w.Z,{children:d?"Child":"Parent"})]}),(0,i.jsxs)(v.ZP,{item:!0,xs:12,children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Date created"}),(0,i.jsx)(w.Z,{children:P()(h).format("YYYY-MM-DD")})]}),(0,i.jsxs)(v.ZP,{item:!0,xs:12,children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Status"}),(0,i.jsx)(w.Z,{children:m})]}),f.map(function(e,n){var t,o,r=I[e.name];return Array.isArray(r)&&(r=r.filter(function(e){return e}).join(", ")),(null===(t=e.meta)||void 0===t?void 0:t.input)==="datepicker"&&(r=P()(r).format("Do MMM YYYY")),(0,i.jsxs)(v.ZP,{item:!0,xs:12,children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:null===(o=e.meta)||void 0===o?void 0:o.label}),(0,i.jsx)(w.Z,{children:r})]},"".concat(e.name,"-").concat(n))})]}),(0,i.jsx)(v.ZP,{container:!0,item:!0,xs:6,children:(0,i.jsx)(g.Z,{spacing:1,mt:1,children:k?Object.entries(k).map(function(e){var o,r,a=(0,s.Z)(e,2),d=a[0],l=a[1];return(0,i.jsxs)(x.Z,{children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:null!==(n=null===(o=M.W[d])||void 0===o?void 0:o.label)&&void 0!==n?n:"No label"}),(0,i.jsxs)(g.Z,{direction:"row",alignItems:"center",children:[null!==(t=null===(r=M.W[d])||void 0===r?void 0:r.icon)&&void 0!==t?t:null,(0,i.jsx)(w.Z,{children:null!=l?l:"-"})]})]})}):null})})]})})]})})};k.defaultProps={assetId:null,name:"-",description:"-",parentAsset:!1,customer:"-",location:"-",sublocation:"-",category:"-",createdAt:new Date,status:"active",categoryQuestions:[],categoryAnswers:{},editable:!1,expanded:!1,onChangeExpanded:function(){}},k.propTypes={assetId:c().number.isRequired,name:c().string,description:c().string,parentAsset:c().string,customer:c().string,location:c().string,sublocation:c().string,category:c().string,createdAt:c().oneOfType([c().object,c().string]),status:c().string,assetAdditional:c().object,categoryQuestions:c().arrayOf(c().shape({name:c().string.isRequired,meta:c().shape({label:c().string.isRequired,input:c().oneOf(["input","textArea","currencyInput","radio","select","selectRange","datepicker","checkbox"]).isRequired})})),categoryAnswers:c().object.isRequired,editable:c().bool,expanded:c().bool,onChangeExpanded:c().func};var E=t(86267),D=t(57460),N=t.n(D),q=t(15033),O=t(20705),z=t(2845),T=t(45416),W=t(18586),B=t(75759),U=t(12547),Y=t(5336),F=t(73359),L=t(9492),_=t(67294),H=function(e){var n,t,o,d=e.assetId,l=e.editable,c=e.expanded,u=e.onChangeExpanded,v=e.asset,C=(0,W.q)(),I=(0,z.x)().hasRole,S=I("admin"),R=I("supplier"),M=I("tenant"),k=null===(n=C.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,E=null===(t=C.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,D=(0,_.useState)(!1),H=D[0],Q=D[1],G=(0,O.x)({filters:{}}),V=G.ref,X=G.initialData,J=(0,h.a)(m.zu,{variables:(0,a.Z)((0,r.Z)({},X),{assetId:null==v?void 0:v.id})}),K=J.data,$=void 0===K?{jobs:[],meta:{aggregate:{totalCount:0}}}:K,ee=$.jobs,en=$.meta,et=J.loading,ei=J.refetch,eo=(0,s.Z)((0,F.t)(m.zu,{fetchPolicy:"no-cache",variables:{assetId:d,orderBy:X.orderBy,offset:0,limit:(null==en?void 0:null===(o=en.aggregate)||void 0===o?void 0:o.totalCount)||150},onCompleted:function(e){var n=e.jobs;try{var t=N().unparse(ea(n,!0)),i="data:application/octet-stream,"+encodeURIComponent(t);(0,L.S)(i,"asset-".concat(d,"_jobs.csv"))}finally{Q(!1)}}}),1)[0],er=function(e){var n=[];return l&&n.push({context:"secondary",icon:"edit",onClick:function(n){return p().push("/dashboard/issues/manage?id=".concat(e.number).concat("quote"===e.type?"&quoted=1":""))},tooltip:"Edit"}),n.push({context:"secondary",icon:"info",onClick:function(n){return p().push("/dashboard/issues/view?id=".concat(e.number))},tooltip:"Info"}),n},ea=function(e,n){return e.map(function(e){var t,i,o,s,d,l,c,u,p,h,m,x,f,v,g,b,j=e.manager?e.manager.fullName:"Unassigned",y=e.scheduledAt?P()(e.scheduledAt).format("YYYY-MM-DD"):P()(e.timingStart).format("YYYY-MM-DD"),Z=n&&(null==e?void 0:e.supplierOffers.length)>0?null===(t=null==e?void 0:e.supplierOffers[0].supplier)||void 0===t?void 0:t.name:null==e?void 0:e.supplierOffers;return(0,a.Z)((0,r.Z)({},!n&&{id:e.id}),{type:e.type,number:e.number,invoiceNumber:null===(i=e.invoices)||void 0===i?void 0:null===(o=i[0])||void 0===o?void 0:o.invoiceNumber,creator:null===(s=e.timings)||void 0===s?void 0:null===(d=s[0])||void 0===d?void 0:null===(l=d.user)||void 0===l?void 0:l.fullName,propertyId:null===(c=e.location)||void 0===c?void 0:c.id,managerId:null===(u=e.manager)||void 0===u?void 0:u.id,customerId:null===(p=e.customer)||void 0===p?void 0:p.id,priority:(null===(h=e.sla)||void 0===h?void 0:h.name)||"-",supplierId:e.supplier?e.supplier.id:"",service:(null===(m=e.service)||void 0===m?void 0:m.name)||"-",description:(null===(x=e.shortJobDesc)||void 0===x?void 0:null===(f=x[0])||void 0===f?void 0:f.taxonomy.name)||"-",manager:j,location:(null===(v=e.location)||void 0===v?void 0:v.name)||"-",customer:(null===(g=e.customer)||void 0===g?void 0:g.name)||"-",supplier:e.supplier?e.supplier.name:"-",supplierUser:e.supplierUser?e.supplierUser.fullName:"-",scheduleDate:y,date:P()(e.createdAt).format("YYYY-MM-DD"),status:(null==e?void 0:e.job)?null===(b=e.job)||void 0===b?void 0:b.status:e.status,offerTo:S?Z:""})})},es=function(e){e.stopPropagation(),Q(!0),eo()};return(0,i.jsx)(x.Z,{children:(0,i.jsxs)(b.Z,{expanded:c,onChange:u,sx:{maxHeight:"calc(100vh - 32px)",overflow:"scroll"},children:[(0,i.jsx)(y.Z,{expandIcon:(0,i.jsx)(A.Z,{}),children:(0,i.jsxs)(g.Z,{width:"100%",direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(w.Z,{variant:"h6",children:"Work Orders"}),(0,i.jsx)(g.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:(0,i.jsx)(Z.Z,{disableMinWidth:!0,disabled:H,size:"small",color:"success",variant:"contained",onClick:es,sx:{mr:2},children:H?(0,i.jsx)(f.Z,{size:20,color:"secondary"}):"CSV"})})]})}),(0,i.jsx)(j.Z,{children:(0,i.jsx)(q.i,{autoHeight:!1,loading:et,ref:V,columns:[{minWidth:60,field:"id",headerName:"Job ID",renderCell:function(e){var n=e.row;return(0,i.jsx)(T.D,{id:n.id,number:n.number,openCanvas:!0,type:n.type,numberPrefix:k,numberSuffix:E})}},{minWidth:60,field:"invoiceNumber",headerName:"Invoice ID",renderCell:function(e){return e.row.invoiceNumber},sortable:!1},{maxWidth:80,field:"priority",headerName:"Priority",sortName:'{"SLA": {"name": "ORDER"}}'},{minWidth:200,field:"service",headerName:"Service",sortName:'{"Service": {"name": "ORDER"}}'},{minWidth:80,field:"type",headerName:"Type",sortable:!1},{minWidth:200,flex:1,field:"description",headerName:"Description",sortable:!1},{minWidth:130,flex:1,field:"manager",headerName:"Assigned to",sortName:'{"Manager": {"nameFirst": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,i.jsx)(U.r,{color:"secondary",href:"/dashboard/users/view?id=".concat(n.managerId),children:n.manager})}},{minWidth:200,flex:1,field:"location",headerName:S?"Customer":"Location",sortName:'{"Customer": {"name": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,i.jsxs)(g.Z,{children:[S&&(0,i.jsx)(U.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(n.customerId),children:n.customer}),(0,i.jsx)(U.r,{noWrap:R||M,color:"secondary",href:"/dashboard/properties/view?id=".concat(n.propertyId),children:n.location})]})}},{minWidth:140,flex:1,field:"supplier",headerName:"Supplier",sortName:'{"Supplier": {"name": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,i.jsx)(U.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(n.supplierId),children:n.supplier})}},{flex:1,minWidth:120,field:"supplierUser",headerName:"Assigned to",sortName:'{"SupplierUser": {"nameFirst": "ORDER"}}'},{minWidth:160,field:"scheduleDate",headerName:"Scheduled",sortable:!1},{minWidth:120,flex:1,field:"date",headerName:"Created",sortName:"createdAt"},{minWidth:120,flex:1,field:"status",headerName:"Status",renderCell:function(e){var n,t,o=e.row;return(0,i.jsxs)(g.Z,{children:[(0,i.jsx)(x.Z,{children:(0,i.jsx)(B.B,{value:o.status})}),S&&"offered"===o.status&&o.offerTo&&o.offerTo.length>0&&(0,i.jsx)(U.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(null===(n=o.offerTo[0].supplier)||void 0===n?void 0:n.id),children:null===(t=o.offerTo[0].supplier)||void 0===t?void 0:t.name})]})}},{width:50,field:"actions",headerName:"",sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsx)(Y.C,{actionsData:er,row:n})}}],rows:ea(ee,!1),meta:en,refetch:ei,columnVisibilityModel:{priority:S,manager:S,supplier:S,supplierUser:R}})})]})})};H.defaultProps={editable:!1,expanded:!1,onChangeExpanded:function(){}},H.propTypes={editable:c().bool,expanded:c().bool,onChangeExpanded:c().func,asset:c().object,assetId:c().number.isRequired};var Q=t(46003),G=t(69308),V=function(e){var n=e.filename,t=e.initialCoordinates,o=e.color,r=e.editable,a=e.handleChangeCoordinates,s=(0,_.useRef)(null),d=(0,_.useRef)(null),l=(0,_.useState)(t),c=l[0],u=l[1];(0,_.useEffect)(function(){u(t)},[t]);var p=function(e){if(r){var n=s.current,t=n.clientHeight,i=n.clientWidth,o=d.current,l=o.clientHeight,c=o.clientWidth,p={x:(e.nativeEvent.offsetX-i/2)*100/c,y:(e.nativeEvent.offsetY-t)*100/l};u(p),a(p)}};return(0,i.jsx)(x.Z,{sx:{position:"relative"},children:n&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{ref:d,component:"img",src:n,sx:{width:"100%"},onClick:p}),(0,i.jsx)(G.Z,{ref:s,color:o,sx:{position:"absolute",width:"8%",height:"auto",top:"".concat(c.y,"%"),left:"".concat(c.x,"%")}})]})})};V.defaultProps={initialCoordinates:{x:0,y:0},color:"warning",editable:!1,handleChangeCoordinates:function(){}},V.propTypes={filename:c().string.isRequired,initialCoordinates:c().shape({x:c().number.isRequired,y:c().number.isRequired}).isRequired,color:c().string,editable:c().bool,handleChangeCoordinates:c().func};var X=t(76256),J=t(50319),K=function(e){var n,t,o,d,l,c=e.assetId,u=e.asset,p=e.markerColor,f=e.editable,v=e.expanded,I=e.onChangeExpanded,P=(0,S.a)(),R=(0,z.x)().user,M=(0,_.useState)(null),k=M[0],E=M[1],D=(0,h.a)(m.Jt,{variables:{adminId:R.adminId,entityId:c,entity:"Asset",category:"assetFloorplan",type:"image"}}),N=D.data,q=(void 0===N?{items:[]}:N).items,O=D.refetch,T=(0,s.Z)((0,J.D)(m.Wx),1)[0],W=function(e){e.stopPropagation(),P.show({content:(0,i.jsx)(X.z,{accept:"image/*",adminId:R.adminId,category:"assetFloorplan",entity:"Asset",entityId:c,expiryShow:!1,mediaMeta:null,multiple:!1,showAdminOnly:!1,onSuccess:function(){P.close(),O()},type:"image"}),title:"Upload floorplan image"})},B=function(e){k&&clearTimeout(k),E(setTimeout(function(){T({variables:{id:c,changes:{meta:(0,a.Z)((0,r.Z)({},u.meta),{coordinates:e})}}})},1e3))},U="".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(null==q?void 0:null===(n=q[0])||void 0===n?void 0:null===(t=n.item)||void 0===t?void 0:t.filename);return(0,i.jsx)(x.Z,{children:(0,i.jsxs)(b.Z,{expanded:v,onChange:I,children:[(0,i.jsx)(y.Z,{expandIcon:(0,i.jsx)(A.Z,{}),children:(0,i.jsxs)(g.Z,{width:"100%",direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(w.Z,{variant:"h6",children:"Place asset on floorplan"}),f&&(0,i.jsx)(Z.Z,{disableMinWidth:!0,size:"small",color:"secondary",variant:"contained",onClick:W,sx:{mr:2},children:(0,i.jsx)(C.Z,{sx:{height:"17px",width:"17px"}})})]})}),(0,i.jsx)(j.Z,{children:(0,i.jsx)(g.Z,{alignItems:"center",children:(null==q?void 0:null===(o=q[0])||void 0===o?void 0:null===(d=o.item)||void 0===d?void 0:d.filename)?(0,i.jsx)(V,{editable:f,filename:U,initialCoordinates:null===(l=u.meta)||void 0===l?void 0:l.coordinates,markerColor:p,handleChangeCoordinates:B}):(0,i.jsx)(w.Z,{color:"muiGray.main",children:"No image available"})})})]})})};K.defaultProps={asset:{},editable:!1,expanded:!1,onChangeExpanded:function(){}},K.defaultProps={assetId:c().number.isRequired,asset:c().shape({meta:c().shape({coordinates:c().shape({x:c().number.isRequired,y:c().number.isRequired}).isRequired}).isRequired}).isRequired,markerColor:c().string,editable:c().bool,expanded:c().bool,onChangeExpanded:c().func};var $=t(93946),ee=t(56693),en=t(23054),et=t(874),ei=function(e){var n=e.currentStep,t=e.color,o=e.circularProgressSx,s=e.labelComponent;return(0,i.jsx)(g.Z,{direction:"row",justifyContent:"space-around",alignItems:"center",width:"100%",height:"150px",children:(0,i.jsxs)(g.Z,{sx:{position:"relative",display:"inline-flex",width:"50%%",height:"100%",justifyContent:"center",alignItems:"center"},children:[(0,i.jsx)(f.Z,(0,a.Z)((0,r.Z)({variant:"determinate"},e),{sx:(0,a.Z)((0,r.Z)({},o),{width:"150px",borderRadius:"50%",boxShadow:"inset 0 0 0 13px #BFBFBF "}),size:"large",value:n})),(0,i.jsx)(x.Z,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",color:void 0===t?"success":t},children:(0,i.jsx)(s,{})})]})})},eo=t(62077),er=t(40656),ea=t(98571),es=t(31679),ed={bubblesWrapper:{backgroundColor:"rgb(191, 207, 231, 0.7)",padding:"10px",borderRadius:"10px"},bubble:{display:"flex",justifyContent:"space-between",minWidth:"100px",padding:"3px 7px",backgroundColor:"green",borderRadius:"10px"},tile:{width:"40%",minHeight:"70px",border:"1px solid black",borderRadius:"10px",padding:"10px",textAlign:"center",backgroundColor:"rgb(191, 207, 231, 0.7)"},bold:{fontWeight:"600!important"},thin:{fontWeight:300}},el=function(e){var n,t,o,d,l,c,u,h,m,f,v,Z,C,I,R,M,k,D,N,q=e.expanded,O=e.onChangeExpanded,T=e.asset,W=e.qrCodeValue,B=e.jobsTotalByMonths,U=(0,es.useMainContext)().setPredefinedAssetForWorkOrder,Y=(0,z.x)(),F=Y.user,L=Y.hasRole,_=(0,S.a)(),H=T.condition?(0,eo.wo)(eo.Fn,T.condition):{backgroundColor:"success",color:"success"},Q=T.preparationStatus?(0,eo.wo)(eo.of,T.preparationStatus):{backgroundColor:"success",color:"success"},G=(Object.entries(B).reduce(function(e,n){var t=(0,s.Z)(n,2);return e+(t[0],t[1])},0)/(null===(n=T.meta)||void 0===n?void 0:null===(t=n.assetAdditional)||void 0===t?void 0:t.estimatedAnnualMaintenance)*100).toFixed(0),V=function(){_.show({title:"Main photo",content:(0,i.jsx)(E.G,{entity:"Asset",entityId:T.id,category:"assetMainPhoto",onlySingleMedia:!0})})},X=P()(null===(o=T.meta)||void 0===o?void 0:null===(d=o.assetAdditional)||void 0===d?void 0:d.datePutInService),J=P()(null===(l=T.meta)||void 0===l?void 0:null===(c=l.assetAdditional)||void 0===c?void 0:c.estimatedEndDate),K=Math.abs(X.diff(J,"days")),el=J.diff(new Date,"days"),ec=function(e){e.stopPropagation();var n={customer:T.customer,location:T.location,sublocation:T.sublocation,category:T.category,asset:{id:T.id,name:T.name},assetCategory:T.category,customerUser:L("admin")?{id:T.location.customerUser.id,name:"".concat(T.location.customerUser.nameFirst," ").concat(T.location.customerUser.nameLast)}:{id:F.id,name:"".concat(F.nameFirst," ").concat(F.nameLast)}};U(n),p().push("/dashboard/issues/manage")},eu=function(){var e,n;return(null===(e=T.meta)||void 0===e?void 0:null===(n=e.assetAdditional)||void 0===n?void 0:n.datePutInService)?(0,i.jsxs)(w.Z,{children:[el,"/",K," days"]}):null};return(0,i.jsxs)(b.Z,{expanded:q,onChange:O,children:[(0,i.jsx)(y.Z,{expandIcon:(0,i.jsx)(A.Z,{}),children:(0,i.jsx)(w.Z,{typography:"h6",children:"Information"})}),(0,i.jsx)(j.Z,{children:(0,i.jsxs)(g.Z,{rowGap:2,children:[(0,i.jsx)(w.Z,{typography:"h6",children:T.name}),(0,i.jsx)(g.Z,{sx:ed.bubblesWrapper,rowGap:2,children:(0,i.jsxs)(g.Z,{direction:"row",columnGap:1,children:[(0,i.jsx)(et.Z,{}),(0,i.jsxs)(w.Z,{typography:"h6",children:[T.location.name,T.sublocation?"/".concat(null===(u=T.sublocation)||void 0===u?void 0:u.name,"/"):"",null===(h=T.parentAsset)||void 0===h?void 0:h.name]})]})}),(0,i.jsx)(g.Z,{rowGap:2,children:(0,i.jsxs)(g.Z,{direction:"row",columnGap:2,children:[(0,i.jsxs)(x.Z,{sx:(0,a.Z)((0,r.Z)({},ed.bubble),{backgroundColor:Q.color,color:Q.fontColor}),children:[(0,i.jsx)(w.Z,{typography:"subtitle1",sx:ed.bold,children:"Status:\xa0"}),(0,i.jsx)(w.Z,{typography:"subtitle1",sx:ed.thin,children:T.preparationStatus?null==Q?void 0:Q.label:"N/A"})]}),(0,i.jsxs)(x.Z,{sx:(0,a.Z)((0,r.Z)({},ed.bubble),{backgroundColor:H.color,color:H.fontColor}),children:[(0,i.jsx)(w.Z,{typography:"subtitle1",sx:ed.bold,children:"Condition:\xa0"}),(0,i.jsx)(w.Z,{typography:"subtitle1",sx:ed.thin,children:T.condition?null==H?void 0:H.label:"N/A"})]})]})}),(0,i.jsxs)(g.Z,{direction:"row",justifyContent:"space-between",sx:{overflowX:"auto"},children:[(0,i.jsx)(ea.Pd,{id:"download-asset-qrcode-".concat(T.id),value:W}),(0,i.jsx)(ea.eI,{id:"download-asset-barcode-".concat(T.id),value:T.id}),(0,i.jsx)($.Z,{onClick:V,size:"large",sx:{borderRadius:"10px!important",width:"130px"},children:(0,i.jsxs)(g.Z,{alignItems:"center",children:[(0,i.jsx)(ee.Z,{sx:{width:"50px",height:"50px"},color:"secondary"}),(0,i.jsx)(w.Z,{children:"Main photo"})]})}),(0,i.jsx)($.Z,{onClick:ec,size:"large",sx:{borderRadius:"10px!important",width:"130px"},children:(0,i.jsxs)(g.Z,{alignItems:"center",children:[(0,i.jsx)(en.Z,{sx:{width:"50px",height:"50px"},color:"secondary"}),(0,i.jsx)(w.Z,{children:"Work order"})]})})]}),(0,i.jsxs)(g.Z,{direction:"row",rowGap:6,flexWrap:"wrap",justifyContent:"space-around",children:[(0,i.jsxs)(x.Z,{sx:ed.tile,children:[(0,i.jsx)(w.Z,{typography:"h6",children:"Initial cost"}),(0,i.jsx)(w.Z,{typography:"subtitle1",sx:ed.bold,children:(null===(m=T.meta)||void 0===m?void 0:null===(f=m.assetAdditional)||void 0===f?void 0:f.initialCost)?"\xa3".concat(T.meta.assetAdditional.initialCost):"N/A"})]}),(0,i.jsxs)(x.Z,{sx:ed.tile,children:[(0,i.jsx)(w.Z,{typography:"h6",children:"Annual cost"}),(0,i.jsx)(w.Z,{typography:"subtitle1",sx:ed.bold,children:(null===(v=T.meta)||void 0===v?void 0:null===(Z=v.assetAdditional)||void 0===Z?void 0:Z.estimatedAnnualMaintenance)?"\xa3".concat(T.meta.assetAdditional.estimatedAnnualMaintenance):"N/A"})]}),(0,i.jsxs)(x.Z,{sx:ed.tile,children:[(0,i.jsx)(w.Z,{typography:"h6",children:"Residual value"}),(0,i.jsx)(w.Z,{typography:"subtitle1",sx:ed.bold,children:(null===(C=T.meta)||void 0===C?void 0:null===(I=C.assetAdditional)||void 0===I?void 0:I.residualValue)?"\xa3".concat(T.meta.assetAdditional.residualValue):"N/A"})]}),(0,i.jsxs)(x.Z,{sx:ed.tile,children:[(0,i.jsx)(w.Z,{typography:"h6",children:"Versus budget"}),(0,i.jsx)(w.Z,{typography:"subtitle1",sx:(0,r.Z)({color:G<=100?er.Q.COLOUR.success:er.Q.COLOUR.danger},ed.bold),children:(null===(R=T.meta)||void 0===R?void 0:null===(M=R.assetAdditional)||void 0===M?void 0:M.estimatedAnnualMaintenance)?"".concat(G,"%"):"N/A"})]})]}),(0,i.jsx)(x.Z,{sx:(0,a.Z)((0,r.Z)({},ed.tile),{width:"90%",margin:"20px auto"}),children:(0,i.jsxs)(g.Z,{rowGap:2,children:[(0,i.jsx)(w.Z,{typography:"h6",children:"Useful time remaining"}),(0,i.jsx)(ei,{labelComponent:eu,currentStep:(null===(k=T.meta)||void 0===k?void 0:k.assetAdditional)?el/K*100:0,circularProgressSx:{color:P()().add(6,"months").isSameOrBefore(J)?er.Q.COLOUR.success:er.Q.COLOUR.danger}})]})})]})})]})},ec=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e};return e.reduce(function(e,i){var s=n(i),l=t(s);return e[l]?(0,a.Z)((0,r.Z)({},e),(0,o.Z)({},l,(0,d.Z)(e[l]).concat([i]))):(0,a.Z)((0,r.Z)({},e),(0,o.Z)({},l,[i]))},{})},eu=function(e){var n,t,l,c,u,b,j,y,Z,w,C=e.id,I=e.editable,A=e.showMediaButtons,S=(0,_.useState)(["asset-details","asset-qr-code","asset-bar-code","asset-floorplan","asset-media","asset-work-orders","asset-information","asset-charts"]),R=S[0],M=S[1],D=(0,h.a)(m.yC,{variables:{id:C}}),N=D.loading,q=D.data,O=(void 0===q?{asset:{}}:q).asset,z=null!==(w=null===(n=O.assetEntity)||void 0===n?void 0:n.map(function(e){return e.job}).filter(function(e){var n=e.timingStart,t=e.timingEnd;return P()(n).isSameOrAfter(P()().subtract(12,"month"))&&P()().isSameOrBefore(P()(t))}))&&void 0!==w?w:[],T=Object.entries(ec(z,function(e){return e.timingStart},function(e){return P()(e.timingStart).format("MM.YYYY")})).reduce(function(e,n){var t=(0,s.Z)(n,2),i=t[0],d=t[1].reduce(function(e,n){var t,i,o,r;return Math.round(e+(null!==(r=null===(t=n.customerFinances)||void 0===t?void 0:null===(i=t.amountInfo)||void 0===i?void 0:i.vatTotal)&&void 0!==r?r:0/((null===(o=n.assets)||void 0===o?void 0:o.length)||1)))},0);return(0,a.Z)((0,r.Z)({},e),(0,o.Z)({},i,d))},{});if(!N&&!(null==O?void 0:O.id))return p().push("/404"),null;var W=function(e){return function(n,t){t?M(function(n){return(0,d.Z)(n).concat([e])}):M(function(n){return n.filter(function(n){return n!==e})})}},B="".concat(Q.C1.portalUrl,"/dashboard/assets/view?id=").concat(C),U=(null===(t=O.category)||void 0===t?void 0:t.childs)||[],Y=(null===(l=O.meta)||void 0===l?void 0:l.categoryQuestions)||{};return N?(0,i.jsx)(g.Z,{height:"100%",justifyContent:"center",alignItems:"center",children:(0,i.jsx)(f.Z,{color:"secondary"})}):(0,i.jsxs)(v.ZP,{container:!0,spacing:4,children:[(0,i.jsx)(v.ZP,{item:!0,xs:12,md:6,lg2:3,children:(0,i.jsxs)(g.Z,{spacing:2,children:[(0,i.jsx)(el,{asset:O,qrCodeValue:B,expanded:R.includes("asset-information"),onChangeExpanded:W("asset-information"),jobsTotalByMonths:T}),(0,i.jsx)(k,{editable:I,expanded:R.includes("asset-details"),onChangeExpanded:W("asset-details"),assetId:O.id,name:O.name,description:O.description,parentAsset:null===(c=O.parentAsset)||void 0===c?void 0:c.name,customer:null===(u=O.customer)||void 0===u?void 0:u.name,location:null===(b=O.location)||void 0===b?void 0:b.name,sublocation:null===(j=O.sublocation)||void 0===j?void 0:j.name,category:null===(y=O.category)||void 0===y?void 0:y.name,createdAt:O.createdAt,status:O.status,categoryQuestions:U,categoryAnswers:Y,assetAdditional:null==O?void 0:null===(Z=O.meta)||void 0===Z?void 0:Z.assetAdditional})]})}),(0,i.jsx)(v.ZP,{item:!0,xs:12,md:6,lg2:4,children:(0,i.jsxs)(g.Z,{spacing:2,children:[(0,i.jsx)(K,{editable:I,expanded:R.includes("asset-floorplan"),onChangeExpanded:W("asset-floorplan"),assetId:C,asset:O}),(0,i.jsx)(x.Z,{children:(0,i.jsx)(E.G,{showActionButtons:A,expanded:R.includes("asset-media"),onChangeExpanded:W("asset-media"),details:!0,entity:"Asset",category:"media",entityId:parseInt(C)})})]})}),(0,i.jsx)(v.ZP,{item:!0,xs:12,md:6,lg2:5,children:(0,i.jsx)(H,{editable:I,expanded:R.includes("asset-work-orders"),onChangeExpanded:W("asset-work-orders"),assetId:C,asset:O})})]})};eu.defaultProps={showMediaButtons:!0},eu.propTypes={id:c().number.isRequired,editable:c().bool.isRequired,showMediaButtons:c().bool.isRequired};var ep=t(58849),eh=function(){var e,n,t=(0,z.x)(),o=t.user,r=t.hasRole,a=(0,u.useRouter)().query,s=(0,W.q)(),d=null==s?void 0:null===(e=s.admin)||void 0===e?void 0:null===(n=e.modules)||void 0===n?void 0:n.assets,l=r("admin"),c=r("tenant");return o?d?(0,i.jsx)(eu,{id:a.id,editable:l,showMediaButtons:!c}):(p().push("/404"),null):(p().push("/account/sign-in"),null)},em=eh;eh.getLayout=function(e){return(0,i.jsx)(ep.Z,{children:e})}}},function(e){e.O(0,[3662,2283,212,619,8890,2583,4135,8579,6043,1564,4244,1336,3911,3776,5370,2329,778,6540,4046,1023,9957,1870,2797,653,8062,1207,2429,4061,597,3723,3977,32,8344,8849,6733,1741,5656,9774,2888,179],function(){return e(e.s=38727)}),_N_E=e.O()}]);