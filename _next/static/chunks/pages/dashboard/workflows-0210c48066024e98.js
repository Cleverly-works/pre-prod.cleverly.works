(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2744],{29325:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/workflows",function(){return n(68676)}])},52971:function(e,t,n){"use strict";n.d(t,{V:function(){return w}});var r=n(26042),o=n(69396),i=n(29815),a=n(85893),l=n(45697),s=n.n(l),u=n(93946),c=n(51233),d=n(15861),p=n(21023),v=n(96540),f=n(67294),m=n(12547),g=n(42283),x=n(79665),h=n(11057),b=n(50135),y=n(77957),j=n(41733),Z=n(74231),T=Z.Ry({name:Z.Z_().required(),url:Z.Z_().url().required()}),C=function(e){var t=e.noEdit,n=e.noDelete,i=e.onDelete,l=e.id,s=e.isAdded,d=e.url,v=e.name,Z=e.onSave,C=(0,f.useState)(s),w=C[0],k=C[1],S=(0,g.cI)({resolver:(0,x.S)(T)}),I=S.control,q=S.handleSubmit,P=S.errors,D=function(e){e.stopPropagation(),k(!0)},R=function(e){e.stopPropagation(),k(!1),v&&d||i()},O=function(e){Z(e),k(!1)};return(0,a.jsx)("form",{children:w?(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)(c.Z,{spacing:1,children:[(0,a.jsx)(g.Qr,{control:I,name:"name",defaultValue:v,render:function(e){var t;return(0,a.jsx)(b.Z,(0,o.Z)((0,r.Z)({fullWidth:!0,label:"Name",variant:"standard",color:"secondary"},e),{error:P.name,helperText:null===(t=P.name)||void 0===t?void 0:t.message}))}}),(0,a.jsx)(g.Qr,{control:I,name:"url",defaultValue:d,render:function(e){var t;return(0,a.jsx)(b.Z,(0,o.Z)((0,r.Z)({fullWidth:!0,label:"Link",variant:"standard",color:"secondary"},e),{error:P.url,helperText:null===(t=P.url)||void 0===t?void 0:t.message}))}})]}),(0,a.jsxs)(c.Z,{direction:"row",justifyContent:"flex-end",spacing:1,mt:2,children:[(0,a.jsx)(h.Z,{variant:"contained",color:"danger",size:"small",onClick:R,children:"Cancel"}),(0,a.jsx)(h.Z,{variant:"contained",size:"small",onClick:q(O),children:"Save"})]})]}):(0,a.jsxs)(c.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsx)(m.r,{target:"_blank",variant:"body1",color:"secondary",href:d,sx:{textDecoration:"auto",fontWeight:700},children:v}),!t&&(0,a.jsx)(p.Z,{title:"Edit",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:D,children:(0,a.jsx)(y.Z,{sx:{fontSize:"16px"}})})}),!n&&(0,a.jsx)(p.Z,{title:"Delete",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:function(){return i(l)},children:(0,a.jsx)(j.Z,{sx:{fontSize:"16px"}})})})]})})};C.defaultProps={isAdded:!1,noEdit:!1,noDelete:!1,url:"",name:"",onSave:function(){},onCancel:function(){},onDelete:function(){}},C.propTypes={isAdded:s().bool,noEdit:s().bool,noDelete:s().bool,url:s().string,name:s().string,onSave:s().func,onCancel:s().func,onDelete:s().func};var w=function(e){var t=e.values,n=e.setValue,l=e.name,s=e.title,m=e.displayMode,g=e.noDeleteEdit,x=e.titleSx,h=(0,f.useState)([]),b=h[0],y=h[1];(0,f.useEffect)(function(){Array.isArray(t)&&y(t)},[t]);var j=function(e){e.stopPropagation(),y(function(e){return(0,i.Z)(e).concat([{name:"",link:"",isAdded:!0}])})},Z=function(e,t){var r=(0,i.Z)(b);r.splice(e,1,t),n(l,r)};return(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)(c.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsxs)(d.Z,{sx:x,children:[s,":"]}),!m&&(0,a.jsx)(p.Z,{title:"Add new link",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:j,children:(0,a.jsx)(v.Z,{})})})]}),(0,a.jsx)(c.Z,{pl:2,spacing:.8,children:(null==b?void 0:b.length)?b.map(function(e,i){var s;return(0,a.jsx)(C,(0,o.Z)((0,r.Z)({index:i},e),{noEdit:g||m,noDelete:g||m,onDelete:function(){var e=t.filter(function(e,t){return t!==i});n(l,e),y(e)},onSave:function(e){return Z(i,e)}}))}):(0,a.jsx)(d.Z,{typography:"subtitle2",children:"No data"})})]})};w.defaultProps={values:[],setValue:function(){},title:"Related links",displayMode:!1,noDeleteEdit:!1,titleSx:{}},w.propTypes={values:s().arrayOf(s().shape({isAdded:s().bool,noEdit:s().bool,url:s().string,name:s().string})),titleSx:s().object,setValue:s().func,noDeleteEdit:s().bool}},5336:function(e,t,n){"use strict";n.d(t,{C:function(){return P}});var r=n(85893),o=n(67294),i=n(45697),a=n.n(i),l=n(93946),s=n(25464),u=n(18972),c=n(57976),d=n(73890),p=n(69008),v=n(41687),f=n(60888),m=n(40535),g=n(63441),x=n(41733),h=n(77957),b=n(2548),y=n(24519),j=n(2391),Z=n(69308),T=n(79369),C=n(22961),w=n(28201),k=n(51233),S=n(15861),I={add:(0,r.jsx)(v.Z,{}),archive:(0,r.jsx)(d.Z,{}),avatar:(0,r.jsx)(w.Z,{}),check:(0,r.jsx)(f.Z,{}),delete:(0,r.jsx)(x.Z,{}),description:(0,r.jsx)(m.Z,{}),download:(0,r.jsx)(g.Z,{}),info:(0,r.jsx)(b.Z,{}),edit:(0,r.jsx)(h.Z,{}),location:(0,r.jsx)(Z.Z,{}),unarchive:(0,r.jsx)(p.Z,{}),uploadFile:(0,r.jsx)(y.Z,{}),receipt:(0,r.jsx)(j.Z,{}),visibility:(0,r.jsx)(C.Z,{})},q={default:(0,r.jsx)(c.Z,{}),defaultHoriz:(0,r.jsx)(T.Z,{}),description:(0,r.jsx)(m.Z,{})},P=function(e){var t=e.actionsData,n=e.icon,i=e.row,a=e.disabled,c=(0,o.useState)(null),d=c[0],p=c[1],v=function(e){e.stopPropagation(),p(e.currentTarget)},f=function(){p(null)};return(0,r.jsxs)("div",{children:[(0,r.jsx)(l.Z,{sx:{":hover":{backgroundColor:"#DDDDDD"}},disabled:a,"aria-controls":"simple-menu","aria-haspopup":"true",onClick:v,children:q[n]}),(0,r.jsx)(s.Z,{id:"simple-menu",anchorEl:d,keepMounted:!0,open:Boolean(d),onClose:f,PaperProps:{sx:{borderRadius:2}},children:t(i).map(function(e,t){return(0,r.jsx)(u.Z,{disabled:e.disabled,onClick:function(t){e.onClick(t),f()},sx:{pl:3,pr:4},children:(0,r.jsxs)(k.Z,{direction:"row",alignItems:"center",spacing:2,children:[(null==I?void 0:I[e.icon])||null,(0,r.jsx)(S.Z,{children:e.tooltip})]})},t)})})]})};P.propTypes={actionsData:a().func.isRequired,icon:a().oneOf(["default","description"]),row:a().any.isRequired,disabled:a().bool},P.defaultProps={actionsData:function(){return[{disabled:!1,onClick:function(){},icon:"edit",tooltip:"Edit"}]},icon:"default",disabled:!1}},48580:function(e,t,n){"use strict";n.d(t,{q:function(){return f}});var r=n(26042),o=n(69396),i=n(99534),a=n(85893),l=n(87918),s=n(98456),u=n(23776),c=n(50135),d=n(67294),p=n(45697),v=n.n(p),f=function(e){var t=e.loading,n=e.setSearch,p=e.textFieldProps,v=(0,i.Z)(e,["loading","setSearch","textFieldProps"]),f=(0,d.useState)(""),m=f[0],g=f[1];return(0,d.useEffect)(function(){var e=setTimeout(function(){n(m)},500);return function(){return clearTimeout(e)}},[m,n]),(0,a.jsx)(u.Z,(0,o.Z)((0,r.Z)({isOptionEqualToValue:function(e,t){return e.value===t.value}},v),{loading:t,onInputChange:function(e,t){g(t)},getOptionLabel:function(e){return"".concat(e.label)},renderTags:function(e,t){return e.map(function(e,n){return(0,a.jsx)(l.Z,(0,r.Z)({size:"small",label:e.label},t({index:n})))})},renderInput:function(e){return(0,a.jsx)(c.Z,(0,o.Z)((0,r.Z)({},e,p),{InputProps:(0,o.Z)((0,r.Z)({},e.InputProps,p.InputProps||{}),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[t?(0,a.jsx)(s.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}}))};f.defaultProps={color:"secondary",onChange:function(){},options:[],onOpen:function(){},setSearch:function(){},textFieldProps:{}},f.propTypes={multiple:v().bool,limitTags:v().number,filterSelectedOptions:v().bool,color:v().string,loading:v().bool,value:v().oneOf([v().array,v().object]),onChange:v().func,options:v().arrayOf(v().shape({value:v().any.isRequired,label:v().string.isRequired})).isRequired,onOpen:v().func,setSearch:v().func,textFieldProps:v().shape({label:v().string,variant:v().oneOf(["standard"]),color:v().string,error:v().bool,helperText:v().string})}},12547:function(e,t,n){"use strict";n.d(t,{r:function(){return d}});var r=n(26042),o=n(69396),i=n(85893),a=n(45697),l=n.n(a),s=n(41664),u=n.n(s),c=n(23795),d=function(e){var t=e.children,n=e.href,a=e.noWrap,l=e.target,s=e.sx,d=void 0===s?{}:s;return a?(0,i.jsx)(i.Fragment,{children:t}):n?(0,i.jsx)(u(),{href:n,target:l,passHref:!0,children:(0,i.jsx)(c.Z,(0,o.Z)((0,r.Z)({sx:d},e),{children:t}))}):(0,i.jsx)(c.Z,(0,o.Z)((0,r.Z)({sx:d},e),{children:t}))};d.defaultProps={onClick:function(e){e.stopPropagation()}},d.propTypes={onClick:l().func,href:l().string,noWrap:l().bool,color:l().string}},93884:function(e,t,n){"use strict";n.d(t,{C:function(){return v}});var r=n(26042),o=n(69396),i=n(85893);n(67294);var a=n(45697),l=n(90948),s=n(15861),u=n(51233),c=n(11057),d=n(61730),p=(0,l.ZP)("img")({width:"300px",height:"250px"}),v=function(e){var t=e.imageSrc,n=e.sx,a=e.imageSx,l=e.title,v=e.titleSx,f=e.subtitleFirstLine,m=e.subtitleFirstLineSx,g=e.subtitleSecondLine,x=e.subtitleSecondLineSx,h=e.buttonText,b=e.onAction,y=(0,d.Z)("(max-width: 400px)");return(0,i.jsxs)(u.Z,{sx:(0,o.Z)((0,r.Z)({},n),{width:"100%",height:"100%"}),justifyContent:"center",alignItems:"center",spacing:2,color:"#757575",children:[(0,i.jsx)(p,{src:t,sx:(0,o.Z)((0,r.Z)({},a),{width:y?"250px":"300px"})}),(0,i.jsx)(s.Z,{typography:"h5",sx:(0,r.Z)({},v),children:l}),(0,i.jsxs)(u.Z,{alignItems:"center",sx:{padding:"0px 10px",textAlign:"center"},children:[(0,i.jsx)(s.Z,{sx:(0,r.Z)({},m),children:f}),(0,i.jsx)(s.Z,{sx:(0,r.Z)({},x),children:g})]}),h&&b&&(0,i.jsx)(c.Z,{variant:"contained",color:"secondary",onClick:b,children:h})]})};v.propTypes={imageSrc:a.string,title:a.string,subtitleFirstLine:a.string,subtitleSecondLine:a.string,onAction:a.func,sx:a.object,imageSx:a.object,titleSx:a.object,subtitleFirstLineSx:a.object,subtitleSecondLineSx:a.object},v.defaultProps={title:"",subtitleFirstLine:"",subtitleSecondLine:"",sx:{},imageSx:{},titleSx:{},subtitleFirstLineSx:{},subtitleSecondLineSx:{},onAction:null}},66321:function(e,t,n){"use strict";n.d(t,{E:function(){return g}});var r=n(26042),o=n(69396),i=n(85893),a=n(45697),l=n.n(a),s=n(94054),u=n(50480),c=n(56815),d=n(40476),p=n(79717),v=n(36872),f=n(51233),m=n(15861),g=function(e){var t=e.label,n=e.options,a=e.error,l=e.helperText,g=e.stackProps,h=e.formControlProps,b=e.labelLeft,y=function(e){var t=e.children;return(0,i.jsx)(i.Fragment,{children:t})};return(0,i.jsxs)(s.Z,(0,o.Z)((0,r.Z)({sx:{m:3},error:a,variant:"standard"},void 0===h?{}:h),{children:[(0,i.jsxs)(f.Z,(0,o.Z)((0,r.Z)({},b&&x),{children:[t&&(0,i.jsx)(d.Z,{id:"radio-group",color:"secondary",children:t}),(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},e),{"aria-labelledby":"radio-group",children:(0,i.jsx)(f.Z,(0,o.Z)((0,r.Z)({},void 0===g?{}:g),{children:n.map(function(e){var t=e.value,n=e.label,r=e.icon,o=e.ParentComponent;return(0,i.jsx)(void 0===o?y:o,{children:(0,i.jsx)(u.Z,{value:t,control:(0,i.jsx)(v.Z,{color:"secondary"}),label:(0,i.jsxs)(f.Z,{direction:"row",alignItems:"center",spacing:1,children:[r,(0,i.jsx)(m.Z,{children:n})]})})})})}))}))]})),(0,i.jsx)(c.Z,{children:l})]}))};g.defaultProps={options:[],error:!1,helperText:"",stackProps:{},formControlProps:{},labelLeft:!1},g.propTypes={label:l().string,options:l().arrayOf(l().shape({label:l().string.isRequired,value:l().any.isRequired,ParentComponent:l().elementType})).isRequired,error:l().bool,helperText:l().string,stackProps:l().object,formControlProps:l().object,labelLeft:l().bool};var x={direction:"row",alignItems:"center",flexWrap:"wrap",spacing:1}},92321:function(e,t,n){"use strict";n.d(t,{P:function(){return Z}});var r=n(26042),o=n(69396),i=n(85893),a=n(67294),l=n(10166),s=n(45697),u=n.n(s),c=n(94054),d=n(47312),p=n(18972),v=n(18360),f=n(56815),m=n(51233),g=n(15861),x=n(5616),h=n(87918),b=n(69368),y={text:function(e){var t=e.option,n=e.multiple,r=e.index;return n&&r>0?", ".concat(t.label):t.label},textWithIcon:function(e){var t=e.option;return(0,i.jsxs)(m.Z,{direction:"row",alignItems:"center",spacing:1,children:[t.icon,(0,i.jsxs)(g.Z,{children:[" ",t.label]})]})},chip:function(e){var t=e.chipProps,n=e.option;return(0,a.createElement)(h.Z,(0,o.Z)((0,r.Z)({},t),{key:n.value,label:n.label,icon:n.icon,sx:{color:n.color,bgcolor:n.bgcolor}}))}},j={text:function(e){return e.option.label},textWithIcon:function(e){var t=e.option;return(0,i.jsxs)(m.Z,{direction:"row",alignItems:"center",spacing:1,children:[t.icon,(0,i.jsxs)(g.Z,{children:[" ",t.label]})]})},chip:function(e){var t=e.chipProps,n=e.option;return(0,a.createElement)(h.Z,(0,o.Z)((0,r.Z)({},t),{key:n.value,label:n.label,icon:n.icon,sx:{color:n.color,bgcolor:n.bgcolor}}))},checkbox:function(e){var t=e.option,n=e.value;return(0,i.jsxs)(m.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,i.jsx)(b.Z,{color:"secondary",sx:{height:"10px"},checked:n.indexOf(t.value)>-1}),(0,i.jsxs)(g.Z,{children:[" ",t.label]})]})}},Z=function(e){var t=e.label,n=e.value,a=e.onChange,l=e.leftSideLabel,s=e.options,u=e.inputComponent,c=e.selectComponent,d=e.withoutSelectIcon,m=e.formControl,h=e.chipProps,b=e.selectProps,Z=function(e){return s.find(function(t){return t.value===e})};return(0,i.jsxs)(T,(0,o.Z)((0,r.Z)({},m),{leftSideLabel:l,withoutSelectIcon:d,children:[t&&l&&(0,i.jsx)(g.Z,{children:t}),t&&!l&&(0,i.jsx)(C,{shrink:""!==n&&void 0!==n,children:t}),(0,i.jsx)(v.Z,(0,o.Z)((0,r.Z)({displayEmpty:!0},b),{value:n,onChange:a,inputProps:{shrink:!0},renderValue:function(){if(Array.isArray(n))return(0,i.jsx)(x.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:n.map(function(e,t){var n=Z(e);return n?y[u]({chipProps:h,option:n,multiple:!0,index:t}):""})});var e=Z(n);return e?(0,i.jsx)(x.Z,{children:y[u]({chipProps:h,option:e})}):""},children:s.map(function(e){return(0,i.jsx)(p.Z,{value:e.value,children:j[c]({chipProps:h,option:e,value:n})},e.value)})})),(null==m?void 0:m.helperText)&&(0,i.jsx)(f.Z,{children:m.helperText})]}))};Z.defaultProps={label:"",onChange:function(){},leftSideLabel:!1,options:[],inputComponent:"text",selectComponent:"text",withoutSelectIcon:!1,formControl:{error:!1,helperText:""},chipProps:{size:"small"},selectProps:{}},Z.propTypes={label:u().string,value:u().oneOfType([u().string,u().array]),onChange:u().func,leftSideLabel:u().bool,options:u().arrayOf(u().shape({label:u().string.isRequired,value:u().string.isRequired,color:u().string,bgcolor:u().string,icon:u().node}).isRequired),inputComponent:u().oneOf(["text","textWithIcon","chip"]),selectComponent:u().oneOf(["text","textWithIcon","chip","checkbox"]),withoutSelectIcon:u().bool,formControl:u().object,chipProps:u().object,selectProps:u().object};var T=(0,l.Z)(c.Z)(function(e){e.theme;var t=e.leftSideLabel,n=e.withoutSelectIcon;return{"&.MuiFormControl-root":(0,r.Z)({display:"flex",flexDirection:"column",alignItems:"flex-start"},t&&{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"}),"& .MuiSelect-icon":(0,r.Z)({},n&&{display:"none"})}}),C=(0,l.Z)(d.Z)(function(e){return{"&.MuiFormLabel-root.MuiInputLabel-root.Mui-focused":{color:e.theme.palette.secondary.main}}})},15033:function(e,t,n){"use strict";n.d(t,{i:function(){return w}});var r=n(14924),o=n(26042),i=n(69396),a=n(85893),l=n(67294),s=n(11163),u=n(45697),c=n.n(u),d=n(61870),p=n(5616),v=n(51233),f=n(15861),m=n(90948),g=n(41796),x=n(29217),h=n(45111),b=n(46003),y=n(70872),j=n(58886),Z=n(61730),T=function(e){var t=e.currentPage,n=e.totalCount,r=e.pageSize,i=e.onPageChange,l=(0,Z.Z)("(max-width:400px)"),s=(0,Z.Z)("(max-width:500px)");return(0,a.jsx)(C,{mb:2,page:t,count:Math.ceil(n/r),onChange:function(e,t){return i(t)},variant:"outlined",shape:"rounded",size:l?"small":"medium",hidePrevButton:1===t,hideNextButton:t===Math.ceil(n/r),siblingCount:s?0:1,renderItem:function(e){return(0,a.jsx)(j.Z,(0,o.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})};T.defaultProps={currentPage:1,totalCount:0,pageSize:50,onPageChange:function(){}},T.propTypes={currentPage:c().number,totalCount:c().number,pageSize:c().number,onPageChange:c().func};var C=(0,m.ZP)(y.Z)(function(e){var t,n=e.hidePrevButton,i=e.hideNextButton,a=e.theme;return t={},(0,r.Z)(t,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,r.Z)(t,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,r.Z)(t,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,r.Z)(t,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,r.Z)(t,"& button.Mui-selected",(0,o.Z)({color:a.palette.white.main,backgroundColor:a.palette.secondary.main},i?{borderRadius:"0 5px 5px 0"}:{},n?{borderRadius:"5px 0 0 5px"}:{})),t}),w=(0,l.forwardRef)(function(e,t){var n=e.columns,r=e.history,i=e.initialSort,u=e.meta,c=e.refetch,d=e.paginationSize,p=e.containerHeight,m=e.noResultsMessage,g=e.autoHeight,y=(0,s.useRouter)(),j=y.query,Z=void 0===j?{}:j,C=(0,l.useState)(parseInt(null==Z?void 0:Z.page,10)||1),w=C[0],I=C[1],q=(0,l.useState)(d||b.C1.paginationSize),P=q[0],D=q[1];i||(i={item:"createdAt",order:"desc"});var R=(0,l.useState)({item:i.item,order:i.order}),O=R[0],_=R[1],E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=y.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},L=function(){_({item:i.item,order:i.order}),I(1);var e=E();y.push(e),D(d||b.C1.paginationSize)};(0,l.useImperativeHandle)(t,function(){return{currentPage:w,pageSize:P,sort:O,resetPagination:function(){L()}}});var Q=function(e){var t=E(e);r&&y.push(t),I(e),!r&&c&&c()},W=function(e){e&&e.field&&e.sort?(_({item:n.find(function(t){return t.field===e.field}).sortName||e.field||e.item||i.item,order:e.sort||e.order||i.order}),c&&c()):(_({item:i.item,order:i.order}),c&&c())};return(0,a.jsxs)(k,{containerHeight:p,children:[(0,a.jsx)(S,(0,o.Z)({hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0,autoHeight:g,sortingMode:"server",onSortModelChange:function(e){return W(e[0])},columns:n,pageSize:P,slots:{columnSortedAscendingIcon:function(){return(0,a.jsx)(x.Z,{})},columnSortedDescendingIcon:function(){return(0,a.jsx)(h.Z,{})},columnUnsortedIcon:function(){return(0,a.jsxs)(v.Z,{alignItems:"center",sx:{width:"33px"},children:[(0,a.jsx)(x.Z,{sx:{marginBottom:"-15px"}}),(0,a.jsx)(h.Z,{})]})},noResultsOverlay:function(){return(0,a.jsx)(v.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(f.Z,{children:m})})},noRowsOverlay:function(){return(0,a.jsx)(v.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(f.Z,{children:m})})}}},e)),u&&Math.ceil(u.aggregate.totalCount/P)>1&&(0,a.jsx)(T,{currentPage:w,totalCount:u.aggregate.totalCount,pageSize:P,onPageChange:Q})]})});w.propTypes={history:c().bool,initialSort:c().object,loading:c().bool,meta:c().object,refetch:c().func,paginationSize:c().number,noResultsMessage:c().string,columns:c().array.isRequired,rows:c().array.isRequired,autoHeight:c().bool},w.defaultProps={columns:[],history:!1,loading:!1,rows:[],noResultsMessage:"There are no results.",autoHeight:!0};var k=(0,m.ZP)(p.Z)(function(e){return{height:e.containerHeight,display:"flex",flexDirection:"column"}}),S=(0,m.ZP)(d.s)(function(e){var t,n=e.theme,a=e.hideHeader,l=(e.rows,e.loading,e.rowHeight),s=e.isPdf;return t={"--DataGrid-overlayHeight":"40px"},(0,r.Z)(t,"&.MuiDataGrid-root",(0,o.Z)({color:n.palette.black.main,border:"none"},s&&{"@media print":{display:"block"}})),(0,r.Z)(t,"& .MuiDataGrid-main",(0,o.Z)({},s&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(t,"& .MuiDataGrid-columnHeaders",(0,i.Z)((0,o.Z)({},a&&{display:"none"}),{"& .MuiDataGrid-iconButtonContainer":{visibility:"visible","& .MuiButtonBase-root.MuiIconButton-root":{backgroundColor:"inherit",color:n.palette.black.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}}})),(0,r.Z)(t,"& .MuiDataGrid-virtualScroller",(0,o.Z)({},a&&{marginTop:"0 !important"},s&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(t,"& .MuiDataGrid-iconSeparator",{opacity:0}),(0,r.Z)(t,"& .MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(t,"& .MuiButtonBase-root.MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(t,"& .MuiDataGrid-virtualScrollerContent",(0,o.Z)({},s&&{height:"initial !important",minHeight:"initial !important"})),(0,r.Z)(t,"& .MuiDataGrid-virtualScrollerRenderZone",(0,o.Z)({},s&&{position:"relative"})),(0,r.Z)(t,"& .MuiDataGrid-overlayWrapper",(0,r.Z)({},"& .MuiCircularProgress-root",{color:n.palette.secondary.main})),(0,r.Z)(t,"& .MuiDataGrid-row",(0,o.Z)({},s&&{minHeight:"".concat(l,"cm !important"),maxHeight:"".concat(l,"cm !important")})),(0,r.Z)(t,"& .MuiDataGrid-row > .MuiDataGrid-cell",(0,o.Z)({},s&&{minHeight:"".concat(l,"cm !important"),maxHeight:"".concat(l,"cm !important")})),(0,r.Z)(t,"& .MuiDataGrid-row.even",{backgroundColor:n.palette.muiLightGray.main,"&:hover, &.Mui-hovered":{backgroundColor:(0,g.Fq)(n.palette.muiLightGray.main,.3),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,g.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,g.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity+n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,g.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity)}}}}),t})},20705:function(e,t,n){"use strict";n.d(t,{x:function(){return c}});var r=n(14924),o=n(26042),i=n(69396),a=n(67294),l=n(96486),s=n(46003),u=function(e){try{return JSON.parse(e)}catch(t){return!1}},c=function(e){var t,n,c,d,p,v,f,m,g,x,h,b=e.filters,y=e.newFilters,j=e.initialSort,Z=(0,a.useRef)(),T=(0,a.useState)({}),C=T[0],w=T[1],k=(0,a.useState)({}),S=k[0],I=k[1],q=j||{item:"createdAt",order:"desc"},P=(0,r.Z)({},(null===(t=Z.current)||void 0===t?void 0:t.sort.item)||q.item,q.inneritem?(0,r.Z)({},q.inneritem,(null===(n=Z.current)||void 0===n?void 0:n.sort.order)||q.order):(null===(c=Z.current)||void 0===c?void 0:c.sort.order)||q.order);return(0,a.useEffect)(function(){var e=!(0,l.isEqual)(C,b),t=!(0,l.isEqual)(S,y);if(e&&(w(b),null==Z||null===(r=Z.current)||void 0===r||r.resetPagination()),t&&(I(y),null==Z||null===(o=Z.current)||void 0===o||o.resetPagination()),(null==Z?void 0:null===(n=Z.current)||void 0===n?void 0:n.setSort)&&!(e||t)){var n,r,o,i,a,s,u,c,d,p,v,f=(null===(i=Z.current)||void 0===i?void 0:null===(a=i.sort)||void 0===a?void 0:a.item)&&(null===(s=Z.current)||void 0===s?void 0:null===(u=s.sort)||void 0===u?void 0:u.order)?{item:null===(c=Z.current)||void 0===c?void 0:null===(d=c.sort)||void 0===d?void 0:d.item,order:null===(p=Z.current)||void 0===p?void 0:null===(v=p.sort)||void 0===v?void 0:v.order}:P;Z.current.setSort(f)}},[b,y]),{initialData:(0,i.Z)((0,o.Z)({},b),{newFilters:(null==y?void 0:y.length)>0?y:void 0,limit:(null===(d=Z.current)||void 0===d?void 0:d.pageSize)==="Infinity"?null:parseInt(null===(p=Z.current)||void 0===p?void 0:p.pageSize,10)||s.C1.paginationSize,offset:((null===(v=Z.current)||void 0===v?void 0:v.currentPage)-1||0)*((null===(f=Z.current)||void 0===f?void 0:f.pageSize)||s.C1.paginationSize),orderBy:u(null===(m=Z.current)||void 0===m?void 0:null===(g=m.sort)||void 0===g?void 0:null===(x=g.item)||void 0===x?void 0:x.replace(/ORDER/i,null===(h=Z.current)||void 0===h?void 0:h.sort.order))||P}),initialSort:j,ref:Z}}},22186:function(e,t,n){"use strict";n.d(t,{V:function(){return d}});var r=n(26042),o=n(69396),i=n(85893),a=n(67294),l=n(45697),s=n.n(l),u=n(87918),c=n(41796),d=function(e){var t,n=e.chipProps,l=e.tagEntityId,s=e.name,d=e.color,p=e.onDelete,v=(0,a.useMemo)(function(){return p?(0,o.Z)((0,r.Z)({},n),{onDelete:function(e){e.stopPropagation(),p(l)}}):(0,r.Z)({},n)},[n,p,l]);return(0,i.jsx)(u.Z,(0,o.Z)((0,r.Z)({},v),{size:"small",label:s,sx:{fontSize:"11px",color:(t=d,(0,c.mi)(t,"#FFFFFF")>2.5?"#FFFFFF":"#000"),bgcolor:d,borderRadius:"0px 16px 16px 0px"}}))};d.defaultProps={chipProps:{},onDelete:null,color:"#f2f2f2"},d.propTypes={chipProps:s().object,tagEntityId:s().string.isRequired,name:s().string.isRequired,color:s().string.isRequired,onDelete:s().func.isRequired}},28864:function(e,t,n){"use strict";n.d(t,{T:function(){return h}});var r=n(85893),o=n(45697),i=n.n(o),a=n(93946),l=n(97212),s=n(98619),u=n(59334),c=n(51233),d=n(50135),p=n(50594),v=n(40055),f=n(5336),m=n(10166),g=n(67294),x=n(42283),h=function(e){var t=e.tagEntityId,n=e.tagId,o=e.name,i=e.color,u=e.editable,m=e.onDelete,h=e.onColorChange,y=e.onNameChange,j=(0,x.cI)({defaultValues:{name:o,color:i}}),Z=j.register,T=j.handleSubmit,C=(0,g.useState)(null),w=C[0],k=C[1],S=function(){return[{icon:"delete",onClick:function(e){e.stopPropagation(),m(t)},tooltip:"Remove"},{icon:"edit",onClick:function(e){e.stopPropagation(),k("rename")},tooltip:"Rename"},{icon:"visibility",onClick:function(e){e.stopPropagation(),k("changeColor")},tooltip:"Change color"}]},I=function(e){e.stopPropagation(),k(null)},q=function(e){h({tagId:n,color:e.color}),k(null)},P=function(e){y({tagId:n,name:e.name}),k(null)};return(0,r.jsx)(l.ZP,{disablePadding:!0,secondaryAction:!u||!w&&(0,r.jsx)(f.C,{icon:"defaultHoriz",actionsData:S}),children:w?({changeColor:function(){return(0,r.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,r.jsx)("input",{name:"color",ref:Z,type:"color",style:{padding:0,border:"none","background-color":"unset"}}),(0,r.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,r.jsx)(a.Z,{size:"small",color:"danger",onClick:I,children:(0,r.jsx)(p.Z,{})}),(0,r.jsx)(a.Z,{size:"small",color:"success",onClick:T(q),children:(0,r.jsx)(v.Z,{})})]})]})},rename:function(){return(0,r.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,r.jsx)(d.Z,{name:"name",inputRef:Z,variant:"standard",color:"secondary"}),(0,r.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,r.jsx)(a.Z,{size:"small",color:"danger",onClick:I,children:(0,r.jsx)(p.Z,{})}),(0,r.jsx)(a.Z,{size:"small",color:"success",onClick:T(P),children:(0,r.jsx)(v.Z,{})})]})]})}})[w]():(0,r.jsx)(s.Z,{children:(0,r.jsx)(b,{primary:o,color:i})})},n)};h.defaultProps={onDelete:function(){},onColorChange:function(){},onNameChange:function(){},editable:!0},h.propTypes={tagEntityId:i().string.isRequired,tagId:i().string.isRequired,name:i().string.isRequired,color:i().string.isRequired,editable:i().bool,onDelete:i().func.isRequired,onColorChange:i().func.isRequired,onNameChange:i().func.isRequired};var b=(0,m.Z)(u.Z)(function(e){return e.theme,{"&.MuiListItemText-root .MuiListItemText-primary":{fontWeight:700,color:e.color}}})},48381:function(e,t,n){"use strict";n.d(t,{K:function(){return R}});var r=n(828),o=n(29815),i=n(85893),a=n(45697),l=n.n(a),s=n(50319),u=n(51738),c=n(26042),d=n(69396),p=n(67294),v=n(6812),f=n(11961),m=n(93362),g=n(23776),x=n(5616),h=n(98456),b=n(93946),y=n(78462),j=n(18972),Z=n(14564),T=n(51233),C=n(50135),w=n(28864),k=n(10166),S=n(2845),I=(0,m.D)(),q=function(e){var t=e.entityId,n=(e.getTagsForEntityQuery,e.getTagsForEntityVariables,e.refetchQueries),a=e.entity,l=e.handleDeleteTagEntity,m=(0,S.x)().user,Z=(0,p.useState)(null),k=Z[0],q=Z[1],D=(0,p.useState)(""),R=D[0],O=D[1],_=(0,p.useState)(""),E=_[0],L=_[1],Q=(0,p.useState)(""),W=Q[0],A=Q[1],U=(0,v.a)(u.BU,{skip:!k,variables:{entityId:t,entity:a}}),F=U.data,M=(void 0===F?{tags:[]}:F).tags,N=U.loading,V=(0,v.a)(u.gI,{skip:!k,variables:{entityId:t,entity:a,q:""!==W?"%".concat(W,"%"):null}}),$=V.data,G=(void 0===$?{tags:[]}:$).tags,H=V.loading,z=(0,r.Z)((0,s.D)(u.LE,{refetchQueries:["GetAllTags"].concat((0,o.Z)(n)),onCompleted:function(){L(""),O(null)}}),2),B=z[0],J=z[1].loading,X=(0,r.Z)((0,s.D)(u.g$,{refetchQueries:["GetAllTags"].concat((0,o.Z)(n))}),2),Y=X[0],K=X[1].loading;(0,p.useEffect)(function(){var e=setTimeout(function(){A(E)},500);return function(){return clearTimeout(e)}},[E]);var ee=function(e){e.stopPropagation(),q(e.currentTarget)},et=function(){q(null)},en=function(e,n){"string"==typeof n?O({label:n}):n&&n.inputValue?(B({variables:{objects:[{entity:a,entityId:t,Taxonomy:{data:{type:"tags",status:"active",name:n.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:m.adminId}}}]}}),O(null)):n&&n.value&&(B({variables:{objects:[{entity:a,entityId:t,taxonomyId:n.value}]}}),O(null))},er=function(e,t){var n=I(e,t),r=t.inputValue,o=e.some(function(e){return r===e.label});return""===r||o||n.push({inputValue:r,label:'Add "'.concat(r,'"')}),n},eo=function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},ei=function(e){var t;Y({variables:{tagId:e.tagId,object:{meta:{color:e.color}}}})},ea=function(e){var t;Y({variables:{tagId:e.tagId,object:{name:e.name}}})},el=Boolean(k),es=null==G?void 0:G.map(function(e){return{label:e.name,value:e.id}});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(P,{id:el?"tags-popover":void 0,open:el,anchorEl:k,onClose:et,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,i.jsxs)(x.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,i.jsx)(g.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:es,value:R,onChange:en,onInputChange:function(e,t){L(t)},filterOptions:er,getOptionLabel:eo,renderOption:function(e,t){return(0,i.jsx)(j.Z,(0,d.Z)((0,c.Z)({},e),{children:t.label}))},renderInput:function(e){return(0,i.jsx)(C.Z,(0,d.Z)((0,c.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,d.Z)((0,c.Z)({},e.InputProps),{endAdornment:(0,i.jsxs)(i.Fragment,{children:[H||J?(0,i.jsx)(h.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),N||K?(0,i.jsx)(T.Z,{width:"100%",alignItems:"center",p:4,children:(0,i.jsx)(h.Z,{color:"secondary"})}):(0,i.jsx)(y.Z,{children:M.map(function(e){var t;return(0,i.jsx)(w.T,{tagEntityId:e.id,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,onDelete:l,onColorChange:ei,onNameChange:ea})})})]})}),(0,i.jsx)(b.Z,{color:"black",onClick:ee,children:(0,i.jsx)(f.Z,{sx:{height:"16px",width:"16px"}})})]})};q.defaultProps={entityId:null,entity:null,refetchQueries:[],handleDeleteTagEntity:function(){}},q.propTypes={entityId:l().number,entity:l().string,getTagsForEntityQuery:l().object,getTagsForEntityVariables:l().object,refetchQueries:l().array,handleDeleteTagEntity:l().func};var P=(0,k.Z)(Z.ZP)(function(e){return e.theme,{"& .MuiPaper-root":{borderRadius:"12px"}}}),D=n(11975),R=function(e){var t=e.row,n=e.refetchQueries,a=e.entity,l=(0,r.Z)((0,s.D)(u.cS,{refetchQueries:["GetTaskTags"].concat((0,o.Z)(n))}),1)[0],c=function(e){l({variables:{tagEntityId:e}})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(D.P,{tags:t.tags,title:t.title,handleDeleteTagEntity:c}),(0,i.jsx)(q,{entityId:t.id,refetchQueries:n,handleDeleteTagEntity:c,entity:a})]})};R.propTypes={row:l().object,refetchQueries:l().array},R.defaultProps={row:{},displayOnly:!1,refetchQueries:[],handleDeleteTagEntity:function(){}}},11975:function(e,t,n){"use strict";n.d(t,{P:function(){return v}});var r=n(85893),o=n(67294),i=n(45697),a=n.n(i),l=n(15861),s=n(14564),u=n(78462),c=n(51233),d=n(22186),p=n(28864),v=function(e){var t=e.tags,n=(e.title,e.handleDeleteTagEntity),i=(0,o.useState)(null),a=i[0],v=i[1],f=null==t?void 0:t.slice(0,5),m=(null==t?void 0:t.length)-(null==f?void 0:f.length),g=Boolean(a);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{direction:"row",spacing:1,children:f.map(function(e,t){var o;return(0,r.jsx)(d.V,{tagEntityId:e.id||t,name:e.tag.name,color:null===(o=e.tag.meta)||void 0===o?void 0:o.color,onDelete:n})})}),m>0&&(0,r.jsxs)(l.Z,{fontWeight:700,ml:1,onMouseEnter:function(e){v(e.currentTarget),e.stopPropagation()},children:["+",m]}),(0,r.jsx)(s.ZP,{id:g?"tags-in-table-popover":void 0,open:g,anchorEl:a,onClose:function(){return v(null)},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,r.jsx)(u.Z,{children:null==t?void 0:t.map(function(e){var t;return(0,r.jsx)(p.T,{tagEntityId:e.id,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,editable:!1},e.tag.id)})})})]})};v.propTypes={tags:a().object,title:a().string},v.defaultProps={tags:{},displayOnly:!1,refetchQueries:[],handleDeleteTagEntity:function(){}}},89256:function(e,t,n){"use strict";n.d(t,{n:function(){return O}});var r=n(47568),o=n(26042),i=n(69396),a=n(828),l=n(29815),s=n(97582),u=n(85893),c=n(45697),d=n.n(c),p=n(96486),v=n(6812),f=n(50319),m=n(11961),g=n(93362),x=n(23776),h=n(5616),b=n(98456),y=n(93946),j=n(78462),Z=n(18972),T=n(14564),C=n(51233),w=n(50135),k=n(67294),S=n(10166),I=n(2845),q=n(28864),P=n(51738),D=n(11975),R=(0,g.D)(),O=function(e){var t=e.entityId,n=e.entity,c=e.values,d=void 0===c?[]:c,g=e.name,T=void 0===g?"tags":g,S=e.setValue,O=(0,I.x)().user,E=(0,k.useState)(null),L=E[0],Q=E[1],W=(0,k.useState)(""),A=W[0],U=W[1],F=(0,k.useState)(""),M=F[0],N=F[1],V=(0,k.useState)(""),$=V[0],G=V[1],H=(0,v.a)(P.BU,{skip:!t,variables:{entityId:t,entity:n},onCompleted:function(e){S(T,e.tags)}}),z=H.data,B=(void 0===z?{tags:[]}:z).tags,J=H.loading,X=H.refetch,Y=(0,v.a)(P.gI,{skip:!L,variables:{entityId:t,entity:n,q:""!==$?"%".concat($,"%"):null}}),K=Y.data,ee=(void 0===K?{tags:[]}:K).tags,et=Y.loading,en=(0,a.Z)((0,f.D)(P.Zm,{refetchQueries:["GetAllTags"]}),2),er=en[0],eo=en[1].loading,ei=(0,a.Z)((0,f.D)(P.LE,{onCompleted:function(){X()}}),2),ea=ei[0],el=ei[1].loading,es=(0,a.Z)((0,f.D)(P.cS,{onCompleted:function(){X()}}),2),eu=es[0],ec=es[1].loading,ed=(0,a.Z)((0,f.D)(P.g$,{refetchQueries:["GetAllTags"]}),2),ep=ed[0],ev=ed[1].loading;(0,k.useEffect)(function(){var e=setTimeout(function(){G(M)},500);return function(){return clearTimeout(e)}},[M]);var ef,em,eg,ex=function(e){e.stopPropagation(),Q(e.currentTarget)},eh=function(){Q(null)},eb=(ef=(0,r.Z)(function(e,r){var o,i,a;return(0,s.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof r)return[3,1];return U({label:r}),[3,6];case 1:if(!(r&&r.inputValue&&t))return[3,2];return ea({variables:{objects:[{entity:n,entityId:t,Taxonomy:{data:{type:"tags",status:"active",name:r.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:O.adminId}}}]}}),U(null),[3,6];case 2:if(!(r&&r.value&&t))return[3,3];return ea({variables:{objects:[{entity:n,entityId:t,taxonomyId:r.value}]}}),U(null),[3,6];case 3:if(!(r&&r.inputValue))return[3,5];return[4,er({variables:{objects:[{type:"tags",status:"active",name:r.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:O.adminId}]}})];case 4:return a=e.sent().data.insert_Taxonomy,S(T,(0,l.Z)(d).concat([{id:null,tag:{id:a.returning[0].id,name:a.returning[0].name,meta:a.returning[0].meta}}])),U(null),[3,6];case 5:r&&r.value&&(S(T,(0,l.Z)(d).concat([{id:null,tag:{id:r.value,name:r.label,meta:r.meta}}])),U(null)),e.label=6;case 6:return[2]}})}),function(e,t){return ef.apply(this,arguments)}),ey=(0,k.useCallback)(function(e,t){var n=R(e,t),r=t.inputValue,o=e.some(function(e){return r===e.label});return""===r||o||n.push({inputValue:r,label:'Add "'.concat(r,'"')}),n},[]),ej=(0,k.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),eZ=function(e){t?eu({variables:{tagEntityId:e}}):S(T,d.filter(function(t,n){return n!==e}))},eT=(em=(0,r.Z)(function(e){var t,n,r,a,l,u;return(0,s.__generator)(this,function(n){switch(n.label){case 0:return[4,ep({variables:{tagId:t=e.tagId,object:{meta:{color:e.color}}}})];case 1:return l=n.sent().data.update_Taxonomy_by_pk,S(T,d.map(function(e){return e.tag.id===t?(0,i.Z)((0,o.Z)({},e),{tag:(0,o.Z)({},l)}):e})),[2]}})}),function(e){return em.apply(this,arguments)}),eC=(eg=(0,r.Z)(function(e){var t,n,r,a,l,u;return(0,s.__generator)(this,function(r){switch(r.label){case 0:return[4,ep({variables:{tagId:t=e.tagId,object:{name:n=e.name}}})];case 1:return l=r.sent().data.update_Taxonomy_by_pk,S(n,d.map(function(e){return e.tag.id===t?(0,i.Z)((0,o.Z)({},e),{tag:(0,o.Z)({},l)}):e})),[2]}})}),function(e){return eg.apply(this,arguments)}),ew=Boolean(L),ek=(0,k.useMemo)(function(){return ee.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[ee]),eS=(0,k.useMemo)(function(){return p.uniqBy((0,l.Z)(B).concat((0,l.Z)(d)),function(e){var t;return null===(t=e.tag)||void 0===t?void 0:t.id})},[B,d]);return(0,u.jsxs)(C.Z,{direction:"row",alignItems:"center",children:[(0,u.jsx)(D.P,{tags:eS,handleDeleteTagEntity:eZ}),(0,u.jsx)(_,{id:ew?"tags-popover":void 0,open:ew,anchorEl:L,onClose:eh,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,u.jsxs)(h.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,u.jsx)(x.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,l.Z)(ek),value:A,onChange:eb,onInputChange:function(e,t){N(t)},filterOptions:ey,getOptionLabel:ej,renderOption:function(e,t){return(0,u.jsx)(Z.Z,(0,i.Z)((0,o.Z)({},e),{children:t.label}))},renderInput:function(e){return(0,u.jsx)(w.Z,(0,i.Z)((0,o.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,i.Z)((0,o.Z)({},e.InputProps),{endAdornment:(0,u.jsxs)(u.Fragment,{children:[et||eo||el?(0,u.jsx)(b.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),J||ec||ev?(0,u.jsx)(C.Z,{width:"100%",alignItems:"center",p:4,children:(0,u.jsx)(b.Z,{color:"secondary"})}):(0,u.jsx)(j.Z,{children:null==eS?void 0:eS.map(function(e,t){var n;return(0,u.jsx)(q.T,{tagEntityId:e.id||t,tagId:e.tag.id,name:e.tag.name,color:null===(n=e.tag.meta)||void 0===n?void 0:n.color,onDelete:eZ,onColorChange:eT,onNameChange:eC})})})]})}),(0,u.jsx)(y.Z,{color:"black",onClick:ex,children:(0,u.jsx)(m.Z,{sx:{height:"16px",width:"16px"}})})]})};O.defaultProps={entityId:null},O.propTypes={entityId:d().number};var _=(0,S.Z)(T.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}})},57179:function(e,t,n){"use strict";n.d(t,{r:function(){return m}});var r=n(26042),o=n(69396),i=n(828),a=n(85893),l=n(67294),s=n(42283),u=n(73359),c=n(23776),d=n(98456),p=n(50135),v=n(87918),f=n(51738),m=function(e){var t=e.control,n=(0,l.useState)(""),m=n[0],g=n[1],x=(0,l.useState)(""),h=x[0],b=x[1],y=(0,i.Z)((0,u.t)(f.lx,{variables:{q:""!==h?"%".concat(h,"%"):null}}),2),j=y[0],Z=y[1],T=Z.loading,C=Z.data,w=(void 0===C?{items:[]}:C).items;return(0,l.useEffect)(function(){var e=setTimeout(function(){b(m)},500);return function(){return clearTimeout(e)}},[m]),(0,a.jsx)(s.Qr,{control:t,name:"tags",render:function(e){var t=e.value,n=e.onChange;return(0,a.jsx)(c.Z,{multiple:!0,limitTags:6,color:"secondary",onOpen:function(){return j()},options:w,value:t||[],inputValue:m,onChange:function(e,t){n(t)},onInputChange:function(e,t){g(t)},getOptionLabel:function(e){return e.label},renderTags:function(e,t){return e.map(function(e,n){return(0,a.jsx)(v.Z,(0,r.Z)({size:"small",label:e.label},t({index:n})),n)})},renderInput:function(e){return(0,a.jsx)(p.Z,(0,o.Z)((0,r.Z)({},e),{variant:"standard",color:"secondary",label:"Select tags",InputProps:(0,o.Z)((0,r.Z)({},e.InputProps),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[T?(0,a.jsx)(d.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}})}})}},66137:function(e,t,n){"use strict";n.d(t,{Y:function(){return r}});var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Job",n="";return(null==e?void 0:e.length)&&(n="\n      Taxonomy: {\n      _and: [\n        { entity: { _eq: ".concat(t,' } }\n        {\n          Taxonomy: {\n            status: { _eq: "active" }\n            _and: [{ id: { _in: [').concat(e,'] } }, { type: { _eq: "tags" } }]\n          }\n        }\n      ]\n    }\n  ')),n}},51738:function(e,t,n){"use strict";n.d(t,{Aw:function(){return Z},BU:function(){return g},C3:function(){return j},LE:function(){return h},Zm:function(){return m},cS:function(){return b},g$:function(){return y},gI:function(){return f},lx:function(){return x}});var r=n(7297),o=n(75063);function i(){var e=(0,r.Z)(['\n  query GetTagsForEntity($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    tags: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']);return i=function(){return e},e}function a(){var e=(0,r.Z)(["\n  mutation CreateTag($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        name\n        meta\n      }\n    }\n  }\n"]);return a=function(){return e},e}function l(){var e=(0,r.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n']);return l=function(){return e},e}function s(){var e=(0,r.Z)(['\n  query GetTagsForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']);return s=function(){return e},e}function u(){var e=(0,r.Z)(["\n  mutation CreateTagsAgainstEntity($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return e},e}function c(){var e=(0,r.Z)(["\n  mutation DeleteTagAgainstEntity($tagEntityId: Int!) {\n    delete_Taxonomy_Entity_by_pk(id: $tagEntityId) {\n      id\n      taxonomyId\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,r.Z)(["\n  mutation UpdateTagAgainstEntity($tagId: Int!, $object: Taxonomy_set_input!) {\n    update_Taxonomy_by_pk(pk_columns: { id: $tagId }, _set: $object) {\n      id\n      name\n      meta\n    }\n  }\n"]);return d=function(){return e},e}function p(){var e=(0,r.Z)(["\n  mutation CreateTagsAgainstEntityWithFollowing($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return p=function(){return e},e}function v(){var e=(0,r.Z)(["\n  mutation DeleteTagAgainstEntityWithFollowing($where: Taxonomy_Entity_bool_exp!) {\n    delete_Taxonomy_Entity(where: $where) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return v=function(){return e},e}var f=(0,o.Ps)(i()),m=(0,o.Ps)(a()),g=(0,o.Ps)(l()),x=(0,o.Ps)(s()),h=(0,o.Ps)(u()),b=(0,o.Ps)(c()),y=(0,o.Ps)(d()),j=(0,o.Ps)(p()),Z=(0,o.Ps)(v())},62551:function(e,t,n){"use strict";n.d(t,{d:function(){return a}});var r=n(85893),o=n(11994),i=n(67294);function a(){var e=(0,i.useState)(null),t=e[0],n=e[1],a=(0,i.useCallback)(function(){n(null)},[]),l=(0,i.useMemo)(function(){if(null===t)return null;var e=t.content,n=t.keepMounted;return(0,r.jsx)(o.Z,{open:!0,keepMounted:n,onClose:a,children:e})},[t,a]),s=(0,i.useCallback)(function(e){var t=e.content,r=e.keepMounted;n({keepMounted:void 0===r||r,content:t({onClose:a})})},[a]);return[l,s]}},59938:function(e,t,n){"use strict";n.d(t,{X:function(){return f}});var r=n(14924),o=n(82670),i=n(828),a=n(7297),l=n(67294),s=n(6812),u=n(50319),c=n(75063),d=n(18586);function p(){var e=(0,a.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]);return p=function(){return e},e}function v(){var e=(0,a.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"]);return v=function(){return e},e}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",a=(0,d.q)().user,c=(0,l.useState)(function(){try{switch(n){case"network":case"state":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(r){return t}}),p=c[0],v=c[1],f=function(t){try{var i=(0,o.Z)(t,Function)?t(p):t;switch(v(i),n){case"network":x({variables:{accountUserId:null==a?void 0:a.accountUserId,filters:(0,r.Z)({},e,i)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(i))}}catch(l){}};(0,s.a)(m,{variables:{accountUserId:null==a?void 0:a.accountUserId},skip:"network"!==n,onCompleted:function(n){var r=n.accountUser;r&&v(r.filters[e]||t)}});var x=(0,i.Z)((0,u.D)(g),1)[0];return[p,f]}var m=(0,c.Ps)(p()),g=(0,c.Ps)(v())},22244:function(e,t,n){"use strict";n.d(t,{AK:function(){return s},DJ:function(){return d},E6:function(){return o},cj:function(){return l},hD:function(){return c},iz:function(){return i},l8:function(){return u},yW:function(){return a}});var r=n(40656),o=[{text:"Quotation Requested",value:"supplierQuoteRequested",context:"info"},{text:"Quotation Completed",value:"supplierQuoteComplete",context:"help"},{text:"Draft Quotation",value:"supplierQuoteDraft",context:"info"},{text:"Awaiting threshold approval",value:"waitingThresholdApproval",context:"info"},{text:"Quotation Refused",value:"supplierQuoteRefused",context:"danger"},{text:"Quotation Sent",value:"supplierQuoteSent",context:"success"},{text:"Quotation Accepted",value:"quotationAccepted",context:"success"},{text:"Quotation Rejected",value:"quotationRejected",context:"danger"},{text:"Quotation Updated",value:"supplierQuoteUpdated",context:"success"}],i=[{text:"New Quote",value:"quoteNew",customerText:"Quote issued",supplierText:null},{text:"Sent to Supplier(s)",value:"quoteOffered",customerText:"Quote issued",supplierText:"Quote offered"},{text:"Received from Supplier(s)",value:"quoteReceived",customerText:"Final review",supplierText:"Quote submitted"},{text:"Sent to Customer",value:"quoteSent",customerText:"Awaiting approval",supplierText:"Awaiting approval"},{text:"Quote Accepted",value:"quoteAccepted",customerText:"Quote accepted",supplierText:"Quote accepted"},{text:"Quote Rejected",value:"quoteRejected",customerText:"Quote rejected",supplierText:"Quote rejected"},{text:"Canceled",value:"quoteCancelled",customerText:"Cancelled",supplierText:null},{text:"Closed",value:"quoteClosed",customerText:"Closed",supplierText:"Closed"}],a=[{text:"Pending",value:"pending",colour:r.Q.COLOUR.info},{text:"Raised",value:"raised",colour:r.Q.COLOUR.info},{text:"Offered",value:"offered",colour:r.Q.COLOUR.warning},{text:"Accepted",value:"accepted",colour:r.Q.COLOUR.success},{text:"In Progress",value:"inProgress",colour:r.Q.COLOUR.primary},{text:"Completed",value:"completed",colour:r.Q.COLOUR.muiLightGray},{text:"Awaiting threshold approval",value:"waitingThresholdApproval",colour:r.Q.COLOUR.info},{text:"Report Sent",value:"reportSent",colour:r.Q.COLOUR.muiGray},{text:"Invoice Sent",value:"invoiceSent",colour:r.Q.COLOUR.secondary},{text:"Customer Paid",value:"customerPaid",colour:r.Q.COLOUR.help},{text:"Supplier Paid",value:"supplierPaid",colour:r.Q.COLOUR.help},{text:"Canceled",value:"canceled",colour:r.Q.COLOUR.black},{text:"Closed",value:"closed",colour:r.Q.COLOUR.black},{text:"On Hold",value:"onHold",colour:r.Q.COLOUR.black},{text:"Continued",value:"continued",colour:r.Q.COLOUR.primary},{text:"Paused",value:"paused",colour:r.Q.COLOUR.black}],l=[{label:"Pending",value:"pending"},{label:"Raised",value:"raised"},{label:"Offered",value:"offered"},{label:"Accepted",value:"accepted"},{label:"In Progress",value:"inProgress"},{label:"Completed",value:"completed"},{label:"Awaiting threshold approval",value:"waitingThresholdApproval"},{label:"Report Sent",value:"reportSent"},{label:"Invoice Sent",value:"invoiceSent"},{label:"Customer Paid",value:"customerPaid"},{label:"Supplier Paid",value:"supplierPaid"},{label:"Quote",value:"quote"},{label:"Site Visit",value:"siteVisit"},{label:"Canceled",value:"canceled"},{label:"Closed",value:"closed"},{label:"On Hold",value:"onHold"},{label:"Continued",value:"continued"},{label:"Paused",value:"paused"}],s=[{text:"Uplift Draft",value:"upliftDraft",context:"info"},{text:"Supplier Uplift Requested",value:"supplierUpliftRequested",context:"secondary"},{text:"Uplift Requested Send to Customer",value:"upliftRequestSendCustomer",context:"secondary"},{text:"Uplift Approved",value:"customerUpliftApproved",context:"success"},{text:"Uplift Rejected",value:"customerUpliftRejected",context:"danger"}],u=[{text:"Offered",value:"offered",context:"info"},{text:"Raised",value:"raised",context:"info"},{text:"Pending",value:"pending",context:"info"},{text:"Accepted",value:"accepted",context:"info"},{text:"Uplift Requested by Supplier",value:"supplierUpliftRequested",context:"info"},{text:"Uplift Draft",value:"upliftDraft",context:"info"},{text:"Uplift Requested Send Customer",value:"upliftRequestSendCustomer",context:"info"},{text:"Uplift Requested Approved",value:"customerUpliftApproved",context:"success"},{text:"In Dispute",value:"inDispute",context:"info"},{text:"Resumed",value:"resumed",context:"Danger"},{text:"Quote Sent",value:"quoteSent",context:"info"},{text:"Quote Offered",value:"quoteOffered",context:"info"},{text:"Report Sent Supplier",value:"reportSentSupplier",context:"info"},{text:"Dispute Resolved",value:"disputeResolved",context:"info"},{text:"Validated",value:"validated",context:"success"},{text:"Un Validated",value:"unvalidated",context:"success"},{text:"Paused",value:"paused",context:"info"},{text:"TimingChanged",value:"timingChanged",context:"info"},{text:"Customer Paid",value:"customerPaid",context:"info"},{text:"In Progress",value:"inProgress",context:"info"},{text:"PPM Invoice Created",value:"ppmInvoiceCreated",context:"success"},{text:"Late Arrival",value:"lateArrival",context:"info"},{text:"Pricing Changed",value:"pricingChanged",context:"info"},{text:"Report Sent",value:"reportSent",context:"info"},{text:"Invoice Sent Supplier",value:"invoiceSentSupplier",context:"info"},{text:"Invoice Sent",value:"invoiceSent",context:"info"},{text:"Invoice Sent Customer",value:"invoiceSentCustomer",context:"info"},{text:"Quote Accepted",value:"quoteAccepted",context:"info"},{text:"On Hold",value:"onHold",context:"info"},{text:"Continued",value:"continued",context:"info"},{text:"Quote Received",value:"quoteReceived",context:"info"},{text:"Quote New",value:"quoteNew",context:"info"},{text:"Closed",value:"closed",context:"danger"},{text:"Re posted",value:"reposted",context:"info"},{text:"Supplier Paid",value:"supplierPaid",context:"info"},{text:"Rejected",value:"rejected",context:"info"},{text:"Completed",value:"completed",context:"info"},{text:"Canceled",value:"canceled",context:"danger"}],c=[{value:"complete",text:"Complete"},{value:"returnVisitByAnother",text:"Return Visit By Another"},{value:"returnVisit",text:"Return Visit"},{value:"completeCertificate",text:"Complete Certificate"},{value:"couldNotDo",text:"Could Not Do"}],d=[{text:"Not yet offered",value:"pending",colour:r.Q.COLOUR.muiGray},{text:"Not yet offered",value:"raised",colour:r.Q.COLOUR.muiGray},{text:"Offered",value:"offered",colour:r.Q.COLOUR.warning},{text:"Not yet started",value:"accepted",colour:r.Q.COLOUR.white},{text:"In Progress",value:"inProgress",colour:r.Q.COLOUR.primary},{text:"Completed",value:"completed",colour:r.Q.COLOUR.secondary},{text:"Requires approval",value:"waitingThresholdApproval",colour:r.Q.COLOUR.info},{text:"Completed",value:"reportSent",colour:r.Q.COLOUR.secondary},{text:"Completed",value:"invoiceSent",colour:r.Q.COLOUR.secondary},{text:"Completed",value:"customerPaid",colour:r.Q.COLOUR.secondary},{text:"Completed",value:"supplierPaid",colour:r.Q.COLOUR.secondary},{text:"Quote",value:"quote",colour:r.Q.COLOUR.white},{text:"Not yet started",value:"siteVisit",colour:r.Q.COLOUR.white},{text:"Closed",value:"canceled",colour:r.Q.COLOUR.black},{text:"Closed",value:"closed",colour:r.Q.COLOUR.black},{text:"On Hold",value:"onHold",colour:r.Q.COLOUR.help},{text:"In Progress",value:"continued",colour:r.Q.COLOUR.primary},{text:"Closed",value:"paused",colour:r.Q.COLOUR.black},{text:"Not yet offered",value:"quoteNew",colour:r.Q.COLOUR.muiGray},{text:"Offered",value:"quoteOffered",colour:r.Q.COLOUR.warning},{text:"Completed",value:"quoteReceived",colour:r.Q.COLOUR.secondary},{text:"Requires approval",value:"quoteSent",colour:r.Q.COLOUR.info},{text:"Not yet started",value:"quoteAccepted",colour:r.Q.COLOUR.white},{text:"Closed",value:"quoteRejected",colour:r.Q.COLOUR.black},{text:"Closed",value:"quoteCancelled",colour:r.Q.COLOUR.black},{text:"Closed",value:"quoteClosed",colour:r.Q.COLOUR.black},{text:"Not yet started",value:"ppmNew",colour:r.Q.COLOUR.white}]},97092:function(e,t,n){"use strict";n.d(t,{FX:function(){return f},cj:function(){return d},jb:function(){return v}});var r=n(85893),o=n(40656),i=n(96540),a=n(90244),l=n(98441),s=n(422),u=n(38780),c=n(10105),d={DONE:"done",NEW:"new",IN_PROGRESS:"inprogress",TO_DO:"todo",BLOCKED:"blocked"},p={URGENT:"urgent",HIGH:"high",NORMAL:"normal",LOW:"low"},v=[{value:d.NEW,label:"New",icon:(0,r.jsx)(i.Z,{color:"white"}),color:o.Q.COLOUR.white,bgcolor:"#83BBDC"},{value:d.TO_DO,label:"To do",icon:(0,r.jsx)(a.Z,{color:"white"}),color:o.Q.COLOUR.white,bgcolor:o.Q.COLOUR.secondary},{value:d.IN_PROGRESS,label:"In progress",icon:(0,r.jsx)(l.Z,{color:"white"}),color:o.Q.COLOUR.white,bgcolor:o.Q.COLOUR.info},{value:d.DONE,label:"Done",icon:(0,r.jsx)(s.Z,{color:"white"}),color:o.Q.COLOUR.white,bgcolor:o.Q.COLOUR.success},{value:d.BLOCKED,label:"Blocked",icon:(0,r.jsx)(u.Z,{color:"white"}),color:o.Q.COLOUR.white,bgcolor:o.Q.COLOUR.danger}],f=[{value:p.URGENT,label:"Urgent",icon:(0,r.jsx)(c.Z,{color:"danger"})},{value:p.HIGH,label:"High",icon:(0,r.jsx)(c.Z,{color:"info"})},{value:p.NORMAL,label:"Normal",icon:(0,r.jsx)(c.Z,{color:"secondary"})},{value:p.LOW,label:"Low",icon:(0,r.jsx)(c.Z,{color:"muiGray"})}]},68676:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return tf}});var r=n(85893),o=n(26042),i=n(828),a=n(45697),l=n.n(a),s=n(20705),u=n(67294),c=n(15033),d=n(11057),p=n(90629),v=n(51233),f=n(15861),m=n(5336),g=n(6812),x=n(50319),h=n(93884),b=n(62551),y=n(81261),j=n(48381),Z=n(47568),T=n(69396),C=n(97582),w=n(67720),k=n(86886),S=n(50135),I=n(90948),q=n(69661),P=n(93946),D=n(84808),R=n(98456),O=n(5616),_=n(92321),E=n(42283),L=n(40075),Q=n(6103),W=n(30381),A=n.n(W),U=n(97092),F=n(69368),M=n(66321),N=n(33754),V=n(2845),$=n(52971),G=n(89256),H=n(22244),z=[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],B=[{label:"Job status changes",value:"jobStatusChanges"},{label:"Quote status changes",value:"quoteStatusChanges"},{label:"Date is",value:"dateIs"}],J={jobStatusChanges:H.yW,quoteStatusChanges:H.iz},X=[{label:"Reactive",value:"reactive"},{label:"PPM",value:"ppm"}],Y=[{label:"Account manager is",value:"accountManager"},{label:"Priority is",value:"priority"},{label:"Customer is",value:"customer"},{label:"Supplier is",value:"supplier"},{label:"Location is",value:"location"},{label:"Short job description is",value:"shortJobDescription"},{label:"Service is",value:"service"},{label:"Job date is",value:"jobDateIs"},{label:"Job type is",value:"jobTypeIs"},{label:"Job status is",value:"jobStatusIs"}],K=[{label:"Every",value:"every"},{label:"First",value:"first"},{label:"Second",value:"second"},{label:"Third",value:"third"},{label:"Fourth",value:"fourth"},{label:"Last",value:"last"}],ee=[{label:"Day",value:"day"},{label:"Monday",value:"monday"},{label:"Tuesday",value:"tuesday"},{label:"Wednesday",value:"wednesday"},{label:"Thursday",value:"thursday"},{label:"Friday",value:"friday"},{label:"Saturday",value:"saturday"},{label:"Sunday",value:"sunday"},{label:"Weekday",value:"weekday"},{label:"Weekend day",value:"weekend"}],et=[{label:"Week",value:"week"},{label:"Month",value:"month"},{label:"Year",value:"year"}],en=[{label:"today",value:"today"},{label:"tomorrow",value:"tomorrow"},{label:"yesterday",value:"yesterday"},{label:"last 7 days",value:"lastSevenDays"},{label:"last month",value:"lastMonth"},{label:"last 30 days",value:"lastThirtyDays"},{label:"last 90 days",value:"lastNinetyDays"},{label:"last year",value:"lastYear"},{label:"in next 7 days",value:"inNextSevenDays"},{label:"in this month",value:"inThisMonth"},{label:"in next month",value:"inNextMonth"},{label:"in next 30 days",value:"inNextThirtyDays"},{label:"in next 90 days",value:"inNextNinetyDays"},{label:"in next year",value:"inNextYear"}],er=[{label:"Create a task",value:"createTask"},{label:"Send an email",value:"sendEmail"}],eo=[{label:"Admin",value:"admin"},{label:"Customer",value:"customer"},{label:"Supplier",value:"supplier"},{label:"Tenant",value:"tenant"},{label:"Specific email address",value:"customEmail"}],ei=[{value:"jobNumber",label:"Job ID"},{value:"jobType",label:"Job type"},{value:"invoiceNumber",label:"Invoice number"},{value:"invoiceType",label:"Invoice type"},{value:"invoiceStatus",label:"Invoice status"},{value:"invoiceAmount",label:"Invoice amount"},{value:"outstandingDays",label:"Outstanding days"},{value:"customerName",label:"Customer"},{value:"customerManagerName",label:"Account Manager"},{value:"supplierName",label:"Supplier"},{value:"locationName",label:"Location"},{value:"addressMainName",label:"Address"},{value:"addressMainPostCode",label:"Post code"},{value:"addressInvoiceName",label:"Invoice address"},{value:"sublocationName",label:"Sublocation"},{value:"jobPriority",label:"Priority"},{value:"jobStatus",label:"Status"},{value:"jobTotal",label:"Job total"},{value:"dueFromCustomer",label:"Due from customer"},{value:"outstandingAmount",label:"Outstanding amount"},{value:"jobNetRevenue",label:"Net revenue"},{value:"supplierAmount",label:"Supplier total"},{value:"jobExpensesCustomer",label:"Expenses (Customer)"},{value:"jobExpensesSupplier",label:"Expenses (Supplier)"},{value:"jobServiceName",label:"Service line"},{value:"jobDate",label:"Job date"},{value:"jobReference",label:"Customer reference"},{value:"jobDescription",label:"Job description"},{value:"jobShortDescription",label:"Issue reported"},{value:"jobSource",label:"Source"},{value:"jobCostCategory",label:"Cost category"},{value:"adminUser",label:"Assigned to (Admin)"},{value:"customerUser",label:"Assigned to (Customer)"},{value:"supplierUser",label:"Assigned to (Supplier)"},{value:"jobCreatedAtDate",label:"Job created"},{value:"jobCreatedBy",label:"Created by"},{value:"jobPaidDate",label:"Paid date"},{value:"jobCompletedDate",label:"Completed date"},{value:"jobInvoicedDate",label:"Invoice date"},{value:"jobClosedDate",label:"Closed date"}],ea=[{value:"daysAfterTriggerDay",label:"Days after trigger day"},{value:"onTriggerDate",label:"On trigger date"},{value:"chooseDate",label:"Choose a date"}],el=[{value:"customer",label:"Customer"},{value:"supplier",label:"Supplier"},{value:"location",label:"Location"},{value:"job",label:"Quote or work order id"},{value:"externalURL",label:"External URL"}],es=n(48580),eu=n(4972),ec=function(e){var t,n,i,a=e.workflowId,l=e.register,s=e.watch,c=e.setValue,d=e.control,p=e.errors,m=(0,u.useState)(""),x=m[0],h=m[1],b=(0,V.x)().user,y=s("taskTemplate.workflowTags"),j=s("taskTemplate.relatedLinks"),Z=s("taskTemplate.dueDateType"),C=s("taskTemplate.relatedLinksType"),w=(0,g.a)(eu.A5,{variables:{accountId:b.adminId,q:""!==x?"%".concat(x,"%"):null}}),k=w.loading,I=w.data,q=(void 0===I?{items:[]}:I).items;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(v.Z,{direction:"column",spacing:3,pb:3,children:[(0,r.jsx)(E.Qr,{control:d,name:"taskTemplate.title",render:function(e){var t,n,o,i=e.value,a=e.onChange;return(0,r.jsx)(S.Z,{variant:"standard",color:"secondary",label:"Title",value:i,onChange:a,error:null===(t=p.taskTemplate)||void 0===t?void 0:t.title,helperText:null===(n=p.taskTemplate)||void 0===n?void 0:null===(o=n.title)||void 0===o?void 0:o.message,sx:{mt:"0 !important"}})}}),(0,r.jsx)(E.Qr,{control:d,name:"taskTemplate.content",render:function(e){var t,n,o,i=e.value,a=e.onChange;return(0,r.jsx)(S.Z,{multiline:!0,minRows:8,variant:"filled",color:"secondary",label:"Content",value:i,onChange:a,error:null===(t=p.taskTemplate)||void 0===t?void 0:t.content,helperText:null===(n=p.taskTemplate)||void 0===n?void 0:null===(o=n.content)||void 0===o?void 0:o.message})}}),(0,r.jsx)(E.Qr,{control:d,name:"taskTemplate.priority",render:function(e){var t,n,o,i=e.value,a=e.onChange;return(0,r.jsx)(M.E,{label:"Priority:",labelLeft:!0,stackProps:{direction:"row",flexWrap:"wrap"},options:U.FX,value:i,onChange:a,error:null===(t=p.taskTemplate)||void 0===t?void 0:t.priority,helperText:null===(n=p.taskTemplate)||void 0===n?void 0:null===(o=n.priority)||void 0===o?void 0:o.message})}}),(0,r.jsx)(E.Qr,{control:d,name:"taskTemplate.dueDateType",defaultValue:null,render:function(e){var t,n,o,i=e.value,a=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:null===(t=p.taskTemplate)||void 0===t?void 0:t.dueDateType,helperText:null===(n=p.taskTemplate)||void 0===n?void 0:null===(o=n.dueDateType)||void 0===o?void 0:o.message,fullWidth:!0},selectProps:{fullWidth:!0},label:"Due date",value:i,onChange:a,options:ea||[]})}}),"daysAfterTriggerDay"===Z&&(0,r.jsx)(E.Qr,{control:d,name:"taskTemplate.dueDateDaysAfterTriggerDay",render:function(e){var t,n,o,i=e.value,a=e.onChange;return(0,r.jsx)(S.Z,{type:"number",placeholder:"Enter number of days",color:"secondary",variant:"standard",value:i,onChange:a,error:null===(t=p.taskTemplate)||void 0===t?void 0:t.dueDateDaysAfterTriggerDay,helperText:null===(n=p.taskTemplate)||void 0===n?void 0:null===(o=n.dueDateDaysAfterTriggerDay)||void 0===o?void 0:o.message})}}),"chooseDate"===Z&&(0,r.jsx)(E.Qr,{control:d,name:"taskTemplate.dueDateChooseDate",defaultValue:null,render:function(e){var t=e.value,n=e.onChange;return(0,r.jsx)(N.M,{label:"Due date",inputFormat:"Do MMM YYYY",minDate:A()(),value:t,onChange:n,renderInput:function(e){var t,n,i;return(0,r.jsx)(S.Z,(0,T.Z)((0,o.Z)({},e),{color:"secondary",variant:"standard",error:null===(t=p.taskTemplate)||void 0===t?void 0:t.dueDateChooseDate,helperText:null===(n=p.taskTemplate)||void 0===n?void 0:null===(i=n.dueDateChooseDate)||void 0===i?void 0:i.message}))}})}}),(0,r.jsx)(E.Qr,{name:"taskTemplate.assignedUser",control:d,render:function(e){var t,n,o,i=e.value,a=e.onChange;return(0,r.jsx)(es.q,{value:i,onChange:function(e,t){return a(t)},loading:k,options:q,setSearch:h,isOptionEqualToValue:function(e,t){return e.value===t.value},textFieldProps:{color:"secondary",variant:"standard",label:"Assigned to",error:null===(t=p.taskTemplate)||void 0===t?void 0:t.assignedUser,helperText:null===(n=p.taskTemplate)||void 0===n?void 0:null===(o=n.assignedUser)||void 0===o?void 0:o.message}})}}),(0,r.jsx)(v.Z,{direction:"row",width:"100%",alignItems:"center",children:(0,r.jsx)(G.n,{entityId:a,entity:"Workflow",name:"taskTemplate.workflowTags",values:y,setValue:c})}),(0,r.jsx)("input",(0,T.Z)((0,o.Z)({},l("taskTemplate.workflowTags")),{type:"hidden"})),(0,r.jsx)(E.Qr,{name:"taskTemplate.relatedLinksType",control:d,render:function(e){var t=e.value,n=e.onChange;return(0,r.jsx)(es.q,{multiple:!0,value:t||[],onChange:function(e,t){return n(t)},options:el,color:"secondary",textFieldProps:{color:"secondary",variant:"standard",label:"Select link type"},sx:{width:"100%"},isOptionEqualToValue:function(e,t){return e.value===t.value},renderOption:function(e,t,n){var i=n.selected;return(0,u.createElement)("li",(0,T.Z)((0,o.Z)({},e),{key:t.value,children:[(0,r.jsx)(F.Z,{color:"secondary",style:{height:10,marginRight:8},checked:i}),t.label]}))}})}}),(null==C?void 0:C.some(function(e){return"externalURL"===e.value}))&&(0,r.jsxs)(O.Z,{children:[(0,r.jsx)($.V,{values:j,setValue:c,name:"taskTemplate.relatedLinks"}),(0,r.jsx)("input",(0,T.Z)((0,o.Z)({},l("taskTemplate.relatedLinks")),{type:"hidden"})),(null===(t=p.taskTemplate)||void 0===t?void 0:t.relatedLinks)&&(null==j?void 0:j.length)===0&&(0,r.jsx)(f.Z,{variant:"subtitle2",color:"warning.main",children:null===(n=p.taskTemplate)||void 0===n?void 0:null===(i=n.relatedLinks)||void 0===i?void 0:i.message})]})]})})};ec.defaultProps={register:function(){return{}},watch:function(){},setValue:function(){},control:{},errors:{}},ec.propTypes={register:l().func,watch:l().func,setValue:l().func,control:l().object,errors:l().object};var ed=n(79665),ep=n(74231),ev=ep.Ry({title:ep.Z_().required("Title is required field"),status:ep.Z_().oneOf(z.map(function(e){return e.value})).required("Status is required field"),action:ep.Z_().when("trigger.type",{is:"dateIs",then:ep.Z_().oneOf(["sendEmail"],"Invalid action").required("Action is required"),otherwise:ep.Z_().oneOf(er.map(function(e){return e.value}),"Invalid action").required("Action is required")}),trigger:ep.Ry({type:ep.Z_().oneOf(B.map(function(e){return e.value})).required("Trigger is required field"),from:ep.Z_().when(["type"],function(e,t){var n;return"jobStatusChanges"===e||"quoteStatusChanges"===e?t.oneOf(null===(n=J[e])||void 0===n?void 0:n.map(function(e){return e.value})).required("From status is required field"):t}),to:ep.Z_().when(["type"],function(e,t){var n;return"jobStatusChanges"===e||"quoteStatusChanges"===e?t.oneOf(null===(n=J[e])||void 0===n?void 0:n.map(function(e){return e.value})).notOneOf([ep.iH("from")],'To status must be different from "From" status').required("To status is required field"):t}),frequency:ep.Z_().when(["type"],function(e,t){return"dateIs"===e?t.oneOf(K.map(function(e){return e.value})).required("Frequency is required field"):t}),daysIn:ep.Z_().when(["type"],function(e,t){return"dateIs"===e?t.oneOf(ee.map(function(e){return e.value})).required("Day is required field"):t}),inThePeriod:ep.Z_().when(["type"],function(e,t){return"dateIs"===e?t.oneOf(et.map(function(e){return e.value})).required("Period is required field"):t}),jobType:ep.IX().when(["type"],function(e,t){return"jobStatusChanges"===e?t.of(ep.Z_().oneOf(X.map(function(e){return e.value})).required("Job type is required field")).required("Job type is required field"):t})}),condition:ep.IX().of(ep.Ry({type:ep.Ry({value:ep.Z_().required("Condition type is required field"),label:ep.Z_().required("Condition type is required field")}).required("Condition type is required field").typeError("Condition type is required field"),value:ep.Ry({value:ep.Z_().required("Condition value is required field"),label:ep.Z_().required("Condition value is required field")}).required("Condition value is required field").typeError("Condition value is required field")})),taskTemplate:ep.nK().when("action",{is:"createTask",then:ep.Ry({title:ep.Z_().required("Title is required"),content:ep.Z_().required("Content is required"),priority:ep.Z_().oneOf(U.FX.map(function(e){return e.value})).required("Priority is required"),dueDateType:ep.Z_().oneOf(ea.map(function(e){return e.value})).required("Due date type is required").typeError("Due date type is required"),dueDateDaysAfterTriggerDay:ep.nK().when("dueDateType",{is:"daysAfterTriggerDay",then:ep.Rx().integer("Days after trigger day must be an integer").min(0,"Days after trigger day must be greater than or equal to 0").required("Days after trigger day is required")}),dueDateChooseDate:ep.hT().when("dueDateType",{is:"chooseDate",then:ep.hT().required("Due date is required")}),assignedUser:ep.Ry().shape({value:ep.Z_().required(),label:ep.Z_().required()}).required("Assigned user is required").typeError("Assigned user is required"),workflowTags:ep.IX().of(ep.Ry().shape({id:ep.Rx().integer().nullable(),tag:ep.Ry().shape({id:ep.Rx().integer().required(),name:ep.Z_().required()}).required()})),relatedLinksType:ep.IX().of(ep.Ry().shape({value:ep.Z_().oneOf(el.map(function(e){return e.value})).required(),label:ep.Z_().required()})),relatedLinks:ep.nK().when("relatedLinksType",{is:function(e){return(null==e?void 0:e.length)>0&&e.some(function(e){return"externalURL"===e.value})},then:ep.IX().of(ep.Ry().shape({name:ep.Z_().required("Title is required"),url:ep.Z_().url("Invalid URL").required("URL is required")})).min(1,"Related links is required").required("Related links is required")})})}),emailTemplate:ep.nK().when("action",{is:"sendEmail",then:ep.Ry({sendToCategory:ep.Z_().oneOf(eo.map(function(e){return e.value})).required("Send to category is required"),sendTo:ep.nK().when("sendToCategory",{is:"customEmail",then:ep.Z_().email("Invalid email address").required("Email is required"),otherwise:ep.IX().of(ep.Ry({value:ep.Rx().integer().required("Value is required field"),label:ep.Z_().required("Label is required field")})).required("Send to is required")}),subject:ep.Z_().required("Subject is required"),content:ep.Z_().required("Content is required"),buttonTitle:ep.Z_().required("Button title is required"),buttonLink:ep.Z_().url("Invalid URL").required("Button link is required"),columns:ep.IX().of(ep.Ry({value:ep.Z_().required("Value is required field"),label:ep.Z_().required("Label is required field")})),sendToTestEmail:ep.Z_().when("$sendTestEmailIsRequired",{is:!0,then:ep.Z_().email("Invalid email address").required("Email is required")})})})}),ef=n(20320),em=function(e){var t=e.control,n=e.errors,i=e.watch,a=e.setValue,l=e.reset,s=["jobStatusChanges","quoteStatusChanges"],c=i("action"),d=i("trigger.type"),p=i("trigger.from"),m=i("trigger.to"),g=(0,u.useMemo)(function(){return B.filter(function(e){var t=e.value;return"sendEmail"===c?"dateIs"===t:void 0===c||"dateIs"!==t})},[c]),x=(0,u.useMemo)(function(){var e,t;return null===(t=null===(e=J[d])||void 0===e?void 0:e.filter(function(e){return e.value!==m}))||void 0===t?void 0:t.map(function(e){var t;return{label:e.text,value:e.value}})},[d,m]),h=(0,u.useMemo)(function(){var e,t;return null===(t=null===(e=J[d])||void 0===e?void 0:e.filter(function(e){return e.value!==p}))||void 0===t?void 0:t.map(function(e){var t;return{label:e.text,value:e.value}})},[d,p]);return(0,r.jsx)(eg,{sx:{pt:1,pb:2,pr:2,pl:2},children:(0,r.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,r.jsxs)(v.Z,{spacing:1,width:"100%",children:[(0,r.jsx)(E.Qr,{name:"trigger.type",control:t,render:function(e){var t,o,i,l=e.value,s=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:null===(t=n.trigger)||void 0===t?void 0:t.type,helperText:null===(o=n.trigger)||void 0===o?void 0:null===(i=o.type)||void 0===i?void 0:i.message},selectProps:{fullWidth:!0},label:"Select trigger",value:l,onChange:function(e){a("trigger.from",""),a("trigger.to",""),s(e)},options:g||[]})}}),!!s.includes(d)&&(0,r.jsxs)(v.Z,{direction:"row",alignItems:"flex-end",width:"100%",children:[(0,r.jsx)(f.Z,{sx:{fontWeight:700,mb:"5px",mr:"24px"},children:"From"}),(0,r.jsx)(E.Qr,{name:"trigger.from",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:null===(t=n.trigger)||void 0===t?void 0:t.from,helperText:null===(o=n.trigger)||void 0===o?void 0:null===(i=o.from)||void 0===i?void 0:i.message,fullWidth:!0},selectProps:{fullWidth:!0},label:"Select status",value:a,onChange:l,options:x||[]})}})]}),!!s.includes(d)&&(0,r.jsxs)(v.Z,{direction:"row",alignItems:"flex-end",width:"100%",children:[(0,r.jsx)(f.Z,{sx:{fontWeight:700,mb:"5px",mr:"40px"},children:"To"}),(0,r.jsx)(E.Qr,{name:"trigger.to",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:null===(t=n.trigger)||void 0===t?void 0:t.to,helperText:null===(o=n.trigger)||void 0===o?void 0:null===(i=o.to)||void 0===i?void 0:i.message,fullWidth:!0},selectProps:{fullWidth:!0},label:"Select status",value:a,onChange:l,options:h||[]})}})]}),"dateIs"===d&&(0,r.jsxs)(v.Z,{direction:"row",alignItems:"baseline",width:"100%",spacing:2,children:[(0,r.jsx)(E.Qr,{name:"trigger.frequency",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:null===(t=n.trigger)||void 0===t?void 0:t.frequency,helperText:null===(o=n.trigger)||void 0===o?void 0:null===(i=o.frequency)||void 0===i?void 0:i.message,fullWidth:!0},selectProps:{fullWidth:!0},label:"Repeat",value:a,onChange:l,options:K||[]})}}),(0,r.jsx)(E.Qr,{name:"trigger.daysIn",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:null===(t=n.trigger)||void 0===t?void 0:t.daysIn,helperText:null===(o=n.trigger)||void 0===o?void 0:null===(i=o.daysIn)||void 0===i?void 0:i.message,fullWidth:!0},selectProps:{fullWidth:!0},label:"Day",value:a,onChange:l,options:ee||[]})}}),(0,r.jsx)(f.Z,{sx:{textWrap:"nowrap"},children:"in the"}),(0,r.jsx)(E.Qr,{name:"trigger.inThePeriod",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:null===(t=n.trigger)||void 0===t?void 0:t.inThePeriod,helperText:null===(o=n.trigger)||void 0===o?void 0:null===(i=o.inThePeriod)||void 0===i?void 0:i.message,fullWidth:!0},selectProps:{fullWidth:!0},label:"Period",value:a,onChange:l,options:et||[]})}})]}),"jobStatusChanges"===d&&(0,r.jsx)(E.Qr,{name:"trigger.jobType",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:null===(t=n.trigger)||void 0===t?void 0:t.jobType,helperText:null===(o=n.trigger)||void 0===o?void 0:null===(i=o.jobType)||void 0===i?void 0:i.message,fullWidth:!0},selectComponent:"checkbox",selectProps:{fullWidth:!0,multiple:!0},label:"Select job type",value:a||[],onChange:function(e){var t=e.target.value;l("string"==typeof t?t.split(","):t)},options:X||[]})}})]}),(0,r.jsx)(v.Z,{children:(0,r.jsx)(P.Z,{sx:{mb:"-8px"},onClick:function(){l((0,T.Z)((0,o.Z)({},i()),{trigger:{type:"",from:"",to:"",frequency:"",daysIn:"",inThePeriod:"",jobType:[]},condition:[]}))},children:(0,r.jsx)(ef.Z,{sx:{color:"danger.main"}})})})]})})};em.propTypes={control:l().object.isRequired,errors:l().object.isRequired,watch:l().func.isRequired,setValue:l().func.isRequired,reset:l().func.isRequired},em.defaultProps={errors:{}};var eg=(0,I.ZP)(p.Z)(function(){return{borderRadius:"12px",boxShadow:"0px 3px 3px -2px rgba(0,0,0,0.2),\n  0px 0px 4px 0px rgba(0,0,0,0.14),\n  0px 1px 8px 0px rgba(0,0,0,0.12)"}}),ex={"jobStatusChanges-reactive":"reactive",quoteStatusChanges:"quote"},eh={"jobStatusChanges-reactive":["jobTypeIs","jobStatusIs"],"jobStatusChanges-ppm":["priority","jobTypeIs","jobStatusIs"],quoteStatusChanges:["jobTypeIs","jobStatusIs"],dateIs:[]},eb=function(e){var t=e.index,n=e.field,o=e.control,i=e.errors,a=e.watch,l=e.remove,s=(0,V.x)().user,c=(0,u.useState)(""),d=c[0],p=c[1],f=a("trigger.type"),m=a("trigger.jobType"),x=a("condition[".concat(t,"].type")),h=(0,u.useMemo)(function(){return Y.filter(function(e){var t=e.value,n=eh["".concat(f).concat(m?"-"+m:"")];return!(null==n?void 0:n.includes(t))})},[f,m]),b=(0,u.useMemo)(function(){return ex["".concat(f).concat(m?"-"+m:"")]},[f,m]),y=(0,g.a)(eu.yR,{skip:(null==x?void 0:x.value)!=="accountManager",variables:{accountId:s.adminId,limit:50,offset:0}}),j=y.loading,Z=y.data,T=(void 0===Z?{items:[]}:Z).items,C=(0,g.a)(eu.SW,{skip:(null==x?void 0:x.value)!=="customer",variables:{q:""!==d?"%".concat(d,"%"):null,limit:50,offset:0}}),w=C.loading,k=C.data,S=(void 0===k?{items:[]}:k).items,I=(0,g.a)(eu._d,{skip:(null==x?void 0:x.value)!=="location",variables:{where:{name:{_ilike:""!==d?"%".concat(d,"%"):null},status:{_eq:"active"}},limit:50,offset:0}}),q=I.loading,D=I.data,R=(void 0===D?{items:[]}:D).items,O=(0,g.a)(eu.by,{skip:(null==x?void 0:x.value)!=="supplier",variables:{where:{name:{_ilike:""!==d?"%".concat(d,"%"):null},type:{_eq:"supplier"}},limit:50,offset:0}}),_=O.loading,L=O.data,Q=(void 0===L?{items:[]}:L).items,W=(0,g.a)(eu.T_,{skip:(null==x?void 0:x.value)!=="priority"&&!b,variables:{where:{name:{_ilike:""!==d?"%".concat(d,"%"):null},subtype:{_eq:b}},limit:50,offset:0}}),A=W.loading,U=W.data,F=(void 0===U?{items:[]}:U).items,M=(0,g.a)(eu._f,{skip:(null==x?void 0:x.value)!=="shortJobDescription",variables:{where:{name:{_ilike:""!==d?"%".concat(d,"%"):null},status:{_eq:"active"},type:{_eq:"jobTags"}},orderBy:{name:"asc"},limit:50,offset:0}}),N=M.loading,$=M.data,G=(void 0===$?{items:[]}:$).items,H=(0,g.a)(eu.kx,{skip:(null==x?void 0:x.value)!=="service",variables:{q:""!==d?"%".concat(d,"%"):null,limit:50,offset:0}}),z=H.loading,B=H.data,K=(void 0===B?{items:[]}:B).items,ee=(0,u.useCallback)(function(){if(!(null==x?void 0:x.value))return[];switch(x.value){case"priority":return F;case"accountManager":return T;case"customer":return S;case"supplier":return Q;case"location":return R;case"shortJobDescription":return G;case"service":return K;case"jobDateIs":return en;case"jobTypeIs":return X;case"jobStatusIs":return J.jobStatusChanges.map(function(e){var t;return{label:e.text,value:e.value}})}},[null==x?void 0:x.value,F,T,S,Q,R,G,K]);return(0,r.jsx)(ey,{sx:{pt:1,pb:2,pr:2,pl:2},children:(0,r.jsxs)(v.Z,{width:"100%",spacing:1,children:[(0,r.jsxs)(v.Z,{width:"100%",direction:"row",alignItems:"center",children:[(0,r.jsx)(E.Qr,{defaultValue:null==n?void 0:n.type,name:"condition[".concat(t,"].type"),control:o,render:function(e){var n,o,a,l,s,u,c,d,v,f=e.value,m=e.onChange;return(0,r.jsx)(es.q,{fullWidth:!0,color:"secondary",value:f,onChange:function(e,t){p(""),m(t)},isOptionEqualToValue:function(e,t){return e.value===t.value},options:h,textFieldProps:{label:"Condition",variant:"standard",color:"secondary",error:null===(n=i.condition)||void 0===n?void 0:null===(o=n[t])||void 0===o?void 0:o.type,helperText:(null===(a=i.condition)||void 0===a?void 0:null===(l=a[t])||void 0===l?void 0:null===(s=l.type)||void 0===s?void 0:s.message)||(null===(u=i.condition)||void 0===u?void 0:null===(c=u[t])||void 0===c?void 0:null===(d=c.type)||void 0===d?void 0:null===(v=d.value)||void 0===v?void 0:v.message)}})}}),(0,r.jsx)(P.Z,{sx:{mb:"-8px"},onClick:function(){return l(t)},children:(0,r.jsx)(ef.Z,{sx:{color:"danger.main"}})})]}),!!x&&(0,r.jsx)(E.Qr,{defaultValue:null==n?void 0:n.value,name:"condition[".concat(t,"].value"),control:o,render:function(e){var n,o,a,l,s,u,c,d,v,f=e.value,m=e.onChange;return(0,r.jsx)(es.q,{color:"secondary",filterSelectedOptions:!0,loading:j||w||q||_||A||N||z,value:f,onChange:function(e,t){m(t)},isOptionEqualToValue:function(e,t){return e.value===t.value},options:ee(),setSearch:p,textFieldProps:{label:"Select ".concat(null==x?void 0:x.label),variant:"standard",color:"secondary",error:null===(n=i.condition)||void 0===n?void 0:null===(o=n[t])||void 0===o?void 0:o.value,helperText:(null===(a=i.condition)||void 0===a?void 0:null===(l=a[t])||void 0===l?void 0:null===(s=l.value)||void 0===s?void 0:s.message)||(null===(u=i.condition)||void 0===u?void 0:null===(c=u[t])||void 0===c?void 0:null===(d=c.value)||void 0===d?void 0:null===(v=d.value)||void 0===v?void 0:v.message)}})}})]})})};eb.propTypes={index:l().number,field:l().object,control:l().object,errors:l().object,watch:l().func,remove:l().func};var ey=(0,I.ZP)(p.Z)(function(){return{borderRadius:"12px",boxShadow:"0px 3px 3px -2px rgba(0,0,0,0.2),\n  0px 0px 4px 0px rgba(0,0,0,0.14),\n  0px 1px 8px 0px rgba(0,0,0,0.12)"}}),ej=n(7297),eZ=n(75063);function eT(){var e=(0,ej.Z)(["\n  mutation CreateTaskWorkflow($data: jsonb!) {\n    createTaskWorkflow(data: $data) {\n      success\n      data\n    }\n  }\n"]);return eT=function(){return e},e}function eC(){var e=(0,ej.Z)(["\n  mutation CreateEmailWorkflow($data: jsonb!) {\n    createEmailWorkflow(data: $data) {\n      success\n      data\n    }\n  }\n"]);return eC=function(){return e},e}function ew(){var e=(0,ej.Z)(["\n  mutation UpdateTaskWorkflow($data: jsonb!) {\n    updateTaskWorkflow(data: $data) {\n      success\n      data\n    }\n  }\n"]);return ew=function(){return e},e}function ek(){var e=(0,ej.Z)(["\n  mutation UpdateEmailWorkflow($data: jsonb!) {\n    updateEmailWorkflow(data: $data) {\n      success\n      data\n    }\n  }\n"]);return ek=function(){return e},e}function eS(){var e=(0,ej.Z)(["\n  mutation SnedTestEmailWorkflow($data: jsonb!) {\n    sendTestEmailWorkflow(data: $data) {\n      success\n      data\n    }\n  }\n"]);return eS=function(){return e},e}var eI=(0,eZ.Ps)(eT()),eq=(0,eZ.Ps)(eC()),eP=(0,eZ.Ps)(ew()),eD=(0,eZ.Ps)(ek()),eR=(0,eZ.Ps)(eS()),eO=n(39641);function e_(){var e=(0,ej.Z)(["\n  fragment WorkflowFields on Workflow {\n    id\n    status\n    title\n    action\n    fired\n    taskTemplate\n    emailTemplate\n    meta\n    createdAt\n    updatedAt\n    userId\n    adminId\n  }\n"]);return e_=function(){return e},e}function eE(){var e=(0,ej.Z)(["\n  fragment WorkflowConditionFields on WorkflowCondition {\n    id\n    isTrigger\n    trigger\n    condition\n    meta\n    createdAt\n    updatedAt\n    workflowId\n  }\n"]);return eE=function(){return e},e}function eL(){var e=(0,ej.Z)(['\n  query GetWorkflow($id: Int!) {\n    workflow: Workflow_by_pk(id: $id) {\n      ...WorkflowFields\n      conditions: WorkflowConditions {\n        ...WorkflowConditionFields\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Workflow" }\n          Taxonomy: { status: { _eq: "active" }, type: { _eq: "taskTags" } }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n        }\n      }\n      user: User {\n        id\n        fullName\n      }\n    }\n  }\n  ',"\n  ","\n"]);return eL=function(){return e},e}function eQ(){var e=(0,ej.Z)(["\n  query GetWorkflows(\n    $q: String\n    $status: workflow_status\n    $tags: [Int]\n    $limit: Int = 50\n    $offset: Int = 0\n    $orderBy: [Workflow_order_by!]\n  ) {\n    workflows: Workflow(\n      where: { title: { _ilike: $q }, status: { _eq: $status }, ",' }\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n    ) {\n      ...WorkflowFields\n      conditions: WorkflowConditions {\n        ...WorkflowConditionFields\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Workflow" }\n          Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n        }\n      }\n      user: User {\n        fullName\n      }\n    }\n    meta: Workflow_aggregate(\n      where: { title: { _ilike: $q }, status: { _eq: $status },  '," })\n      {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n\n  ","\n  ","\n"]);return eQ=function(){return e},e}function eW(){var e=(0,ej.Z)(["\n  mutation DeleteWorkflow($workflowId: Int!) {\n    delete_Workflow_by_pk(id: $workflowId) {\n      id\n    }\n  }\n"]);return eW=function(){return e},e}var eA=(0,eZ.Ps)(e_()),eU=(0,eZ.Ps)(eE()),eF=(0,eZ.Ps)(eL(),eA,eU),eM=function(e){var t=e.tagsWhere;return(0,eZ.Ps)(eQ(),t,t,eA,eU)},eN=(0,eZ.Ps)(eW()),eV=function(e){var t=e.control,n=e.errors,o=(0,e.watch)("trigger.type"),i=(0,u.useMemo)(function(){return er.filter(function(e){var t=e.value;return"dateIs"===o?"sendEmail"===t:"jobStatusChanges"!==o&&"quoteStatusChanges"!==o||"createTask"===t})},[o]);return(0,r.jsx)(e$,{sx:{pt:1,pb:2,pr:2,pl:2},children:(0,r.jsx)(v.Z,{width:"100%",spacing:1,children:(0,r.jsx)(v.Z,{width:"100%",direction:"row",alignItems:"flex-end",children:(0,r.jsx)(E.Qr,{name:"action",control:t,render:function(e){var t,o=e.value,a=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:n.action,helperText:null===(t=n.action)||void 0===t?void 0:t.message,fullWidth:!0},selectProps:{fullWidth:!0},label:"Select action",value:o,onChange:a,options:i})}})})})})};eV.propTypes={control:l().object.isRequired,errors:l().object.isRequired,watch:l().func.isRequired};var e$=(0,I.ZP)(p.Z)(function(){return{borderRadius:"12px",boxShadow:"0px 3px 3px -2px rgba(0,0,0,0.2),\n  0px 0px 4px 0px rgba(0,0,0,0.14),\n  0px 1px 8px 0px rgba(0,0,0,0.12)"}}),eG=n(21023),eH=(0,I.ZP)(w.Z)(function(){return{width:"50%",height:"40px",borderRightWidth:"2px",borderStyle:"dashed"}}),ez=n(74721),eB=function(e){e.register;var t=e.control,n=e.errors,i=e.watch,a=e.setValue,l=e.sendTestEmail,s=(0,V.x)().user,c=(0,u.useState)(""),p=c[0],m=c[1],x=(0,u.useState)(""),h=x[0],b=x[1],y=i("emailTemplate.sendToCategory"),j=(0,g.a)(eu.qd,{skip:!y||"customEmail"===y||"admin"===y,variables:{q:""!==p?"%".concat(p,"%"):null,type:y,limit:50,offset:0}}),Z=j.loading,C=j.data,k=(void 0===C?{items:[]}:C).items,I=(0,g.a)(eu.yR,{skip:"admin"!==y,variables:{q:""!==h?"%".concat(h,"%"):null,accountId:s.adminId,limit:50,offset:0}}),q=I.loading,D=I.data,R=(void 0===D?{items:[]}:D).items;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eH,{orientation:"vertical",variant:"middle"}),(0,r.jsx)(eJ,{sx:{pt:1,pb:2,pr:2,pl:2},children:(0,r.jsxs)(v.Z,{spacing:1,children:[(0,r.jsxs)(v.Z,{direction:"row",width:"100%",alignItems:"baseline",children:[(0,r.jsx)(f.Z,{sx:{fontWeight:700,mb:"5px",mr:"24px",textWrap:"nowrap"},children:"Send to"}),(0,r.jsx)(E.Qr,{name:"emailTemplate.sendToCategory",control:t,render:function(e){var t,o,i,l=e.value,s=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:null===(t=n.emailTemplate)||void 0===t?void 0:t.sendToCategory,helperText:null===(o=n.emailTemplate)||void 0===o?void 0:null===(i=o.sendToCategory)||void 0===i?void 0:i.message,fullWidth:!0},selectProps:{fullWidth:!0},label:"Select category",value:l,onChange:function(e){a("emailTemplate.sendTo",null),s(e.target.value)},options:eo||[]})}})]}),["customer","supplier","tenant"].includes(y)&&(0,r.jsx)(E.Qr,{name:"emailTemplate.sendTo",control:t,render:function(e){var t,i,a,l=e.value,s=e.onChange;return(0,r.jsx)(es.q,{multiple:!0,disableCloseOnSelect:!0,color:"secondary",filterSelectedOptions:!0,loading:Z,value:Array.isArray(l)?l:[],onChange:function(e,t){s(t)},options:k,setSearch:m,textFieldProps:{label:"Select ".concat(y),variant:"standard",color:"secondary",error:null===(t=n.emailTemplate)||void 0===t?void 0:t.sendTo,helperText:null===(i=n.emailTemplate)||void 0===i?void 0:null===(a=i.sendTo)||void 0===a?void 0:a.message},isOptionEqualToValue:function(e,t){return e.value===t.value},renderOption:function(e,t,n){var i=n.selected;return(0,u.createElement)("li",(0,T.Z)((0,o.Z)({},e),{key:t.value,children:[(0,r.jsx)(F.Z,{color:"secondary",style:{height:10,marginRight:8},checked:i}),t.label]}))}})}}),"admin"===y&&(0,r.jsx)(E.Qr,{name:"emailTemplate.sendTo",control:t,render:function(e){var t,i,a,l=e.value,s=e.onChange;return(0,r.jsx)(es.q,{multiple:!0,disableCloseOnSelect:!0,color:"secondary",loading:q,value:Array.isArray(l)?l:[],onChange:function(e,t){s(t)},options:R,setSearch:b,textFieldProps:{label:"Select ".concat(y),variant:"standard",color:"secondary",error:null===(t=n.emailTemplate)||void 0===t?void 0:t.sendTo,helperText:null===(i=n.emailTemplate)||void 0===i?void 0:null===(a=i.sendTo)||void 0===a?void 0:a.message},isOptionEqualToValue:function(e,t){return e.value===t.value},renderOption:function(e,t,n){var i=n.selected;return(0,u.createElement)("li",(0,T.Z)((0,o.Z)({},e),{key:t.value,children:[(0,r.jsx)(F.Z,{color:"secondary",style:{height:10,marginRight:8},checked:i}),t.label]}))}})}}),"customEmail"===y&&(0,r.jsx)(E.Qr,{name:"emailTemplate.sendTo",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(S.Z,{color:"secondary",variant:"standard",label:"Specific email address",value:a,onChange:l,error:!!(null===(t=n.emailTemplate)||void 0===t?void 0:t.sendTo),helperText:null===(o=n.emailTemplate)||void 0===o?void 0:null===(i=o.sendTo)||void 0===i?void 0:i.message})}})]})}),(0,r.jsx)(eH,{orientation:"vertical",variant:"middle"}),(0,r.jsx)(eJ,{sx:{pt:1,pb:2,pr:2,pl:2},children:(0,r.jsxs)(v.Z,{spacing:4,children:[(0,r.jsx)(E.Qr,{name:"emailTemplate.subject",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(S.Z,{fullWidth:!0,color:"secondary",variant:"standard",label:"Subject",value:a,onChange:l,error:!!(null===(t=n.emailTemplate)||void 0===t?void 0:t.subject),helperText:null===(o=n.emailTemplate)||void 0===o?void 0:null===(i=o.subject)||void 0===i?void 0:i.message})}}),(0,r.jsx)(E.Qr,{name:"emailTemplate.content",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(S.Z,{fullWidth:!0,multiline:!0,minRows:6,color:"secondary",variant:"filled",label:"Content",value:a,onChange:l,error:!!(null===(t=n.emailTemplate)||void 0===t?void 0:t.content),helperText:null===(o=n.emailTemplate)||void 0===o?void 0:null===(i=o.content)||void 0===i?void 0:i.message})}}),(0,r.jsxs)(v.Z,{spacing:1,children:[(0,r.jsxs)(v.Z,{direction:"row",alignItems:"flex-end",spacing:1,children:[(0,r.jsx)(E.Qr,{name:"emailTemplate.buttonTitle",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(S.Z,{fullWidth:!0,color:"secondary",variant:"standard",label:"Button title",value:a,onChange:l,error:!!(null===(t=n.emailTemplate)||void 0===t?void 0:t.buttonTitle),helperText:null===(o=n.emailTemplate)||void 0===o?void 0:null===(i=o.buttonTitle)||void 0===i?void 0:i.message})}}),(0,r.jsx)(eG.Z,(0,T.Z)((0,o.Z)({title:"This is the text that will show on the button in the email.",placement:"left-end",leaveDelay:1500,arrow:!0},eX),{children:(0,r.jsx)(P.Z,{size:"small",children:(0,r.jsx)(ez.Z,{color:"secondary"})})}))]}),(0,r.jsxs)(v.Z,{direction:"row",alignItems:"flex-end",spacing:1,children:[(0,r.jsx)(E.Qr,{name:"emailTemplate.buttonLink",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(S.Z,{fullWidth:!0,color:"secondary",variant:"standard",label:"Button link",value:a,onChange:l,error:!!(null===(t=n.emailTemplate)||void 0===t?void 0:t.buttonLink),helperText:null===(o=n.emailTemplate)||void 0===o?void 0:null===(i=o.buttonLink)||void 0===i?void 0:i.message})}}),(0,r.jsx)(eG.Z,(0,T.Z)((0,o.Z)({title:"This is where the user will be directed upon clicking the button.",placement:"left-end",leaveDelay:1500,arrow:!0},eX),{children:(0,r.jsx)(P.Z,{size:"small",children:(0,r.jsx)(ez.Z,{color:"secondary"})})}))]})]})]})}),(0,r.jsx)(eH,{orientation:"vertical",variant:"middle"}),(0,r.jsx)(eJ,{sx:{pt:1,pb:2,pr:2,pl:2},children:(0,r.jsxs)(v.Z,{spacing:1,children:[(0,r.jsx)(f.Z,{variant:"h6",children:"Column selector"}),(0,r.jsx)(f.Z,{children:"Select the columns you would like to see in the report"}),(0,r.jsx)(w.Z,{}),(0,r.jsx)(E.Qr,{name:"emailTemplate.columns",control:t,render:function(e){var t=e.value,n=e.onChange;return(0,r.jsx)(es.q,{multiple:!0,disableCloseOnSelect:!0,value:t||[],onChange:function(e,t){return n(t)},options:ei,color:"secondary",textFieldProps:{color:"secondary",variant:"standard",label:"Columns"},sx:{width:"100%"},isOptionEqualToValue:function(e,t){return e.value===t.value},renderOption:function(e,t,n){var i=n.selected;return(0,u.createElement)("li",(0,T.Z)((0,o.Z)({},e),{key:t.value,children:[(0,r.jsx)(F.Z,{color:"secondary",style:{height:10,marginRight:8},checked:i}),t.label]}))}})}})]})}),(0,r.jsx)(eH,{orientation:"vertical",variant:"middle"}),(0,r.jsx)(eJ,{sx:{pt:1,pb:2,pr:2,pl:2},children:(0,r.jsxs)(v.Z,{direction:"row",alignItems:"flex-end",spacing:2,children:[(0,r.jsx)(E.Qr,{name:"emailTemplate.sendToTestEmail",control:t,render:function(e){var t,o,i,a=e.value,l=e.onChange;return(0,r.jsx)(S.Z,{fullWidth:!0,color:"secondary",variant:"standard",label:"Send test email",error:!!(null===(t=n.emailTemplate)||void 0===t?void 0:t.sendToTestEmail),helperText:null===(o=n.emailTemplate)||void 0===o?void 0:null===(i=o.sendToTestEmail)||void 0===i?void 0:i.message,value:a,onChange:l})}}),(0,r.jsx)(d.Z,{color:"secondary",variant:"contained",sx:{width:120},type:"submit",onClick:l,children:"Send test"})]})})]})};eB.defaultProps={sendTestEmail:function(){}},eB.propTypes={register:l().func.isRequired,control:l().object.isRequired,errors:l().object.isRequired,watch:l().func.isRequired,setValue:l().func.isRequired};var eJ=(0,I.ZP)(p.Z)(function(){return{borderRadius:"12px",boxShadow:"0px 3px 3px -2px rgba(0,0,0,0.2),\n  0px 0px 4px 0px rgba(0,0,0,0.14),\n  0px 1px 8px 0px rgba(0,0,0,0.12)"}}),eX={slotProps:{tooltip:{sx:{backgroundColor:"secondary.main"}},arrow:{sx:{color:"secondary.main"}}}},eY=function(e){var t,n;return{title:e.title,status:e.status,action:e.action,trigger:{type:e.trigger.type,from:e.trigger.from,to:e.trigger.to,jobType:e.trigger.jobType},conditions:null===(t=e.condition)||void 0===t?void 0:t.map(function(e){var t;return{type:e.type,value:e.value}}),taskTemplate:{status:"new",title:e.taskTemplate.title,content:e.taskTemplate.content,priority:e.taskTemplate.priority,dueDateType:e.taskTemplate.dueDateType,dueDateDaysAfterTriggerDay:e.taskTemplate.dueDateDaysAfterTriggerDay,dueDateChooseDate:e.taskTemplate.dueDateChooseDate,assignedUser:{value:e.taskTemplate.assignedUser.value,label:e.taskTemplate.assignedUser.label},relatedLinksType:e.taskTemplate.relatedLinksType,relatedLinks:e.taskTemplate.relatedLinks},tags:null===(n=e.taskTemplate.workflowTags)||void 0===n?void 0:n.map(function(e){return{entity:"Workflow",taxonomyId:e.tag.id}})}},eK=function(e){var t;return{title:e.title,status:e.status,action:e.action,trigger:{type:e.trigger.type,frequency:e.trigger.frequency,daysIn:e.trigger.daysIn,inThePeriod:e.trigger.inThePeriod},conditions:null===(t=e.condition)||void 0===t?void 0:t.map(function(e){var t;return{type:e.type,value:e.value}}),emailTemplate:{sendToCategory:e.emailTemplate.sendToCategory,sendTo:e.emailTemplate.sendTo,subject:e.emailTemplate.subject,content:e.emailTemplate.content,buttonTitle:e.emailTemplate.buttonTitle,buttonLink:e.emailTemplate.buttonLink,columns:e.emailTemplate.columns}}},e0=function(e){var t;return{title:e.title,status:e.status,action:e.action,trigger:{type:e.trigger.type,from:e.trigger.from,to:e.trigger.to,jobType:e.trigger.jobType},conditions:null===(t=e.condition)||void 0===t?void 0:t.map(function(e){var t;return{type:e.type,value:e.value}}),taskTemplate:{status:"new",title:e.taskTemplate.title,content:e.taskTemplate.content,priority:e.taskTemplate.priority,dueDateType:e.taskTemplate.dueDateType,dueDateDaysAfterTriggerDay:e.taskTemplate.dueDateDaysAfterTriggerDay,dueDateChooseDate:e.taskTemplate.dueDateChooseDate,assignedUser:{value:e.taskTemplate.assignedUser.value,label:e.taskTemplate.assignedUser.label},relatedLinksType:e.taskTemplate.relatedLinksType,relatedLinks:e.taskTemplate.relatedLinks}}},e1=function(e){var t;return{title:e.title,status:e.status,action:e.action,trigger:{type:e.trigger.type,frequency:e.trigger.frequency,daysIn:e.trigger.daysIn,inThePeriod:e.trigger.inThePeriod},conditions:null===(t=e.condition)||void 0===t?void 0:t.map(function(e){var t;return{type:e.type,value:e.value}}),emailTemplate:{sendToCategory:e.emailTemplate.sendToCategory,sendTo:e.emailTemplate.sendTo,subject:e.emailTemplate.subject,content:e.emailTemplate.content,buttonTitle:e.emailTemplate.buttonTitle,buttonLink:e.emailTemplate.buttonLink,columns:e.emailTemplate.columns}}},e2=function(e){var t;return{sendToTestEmail:e.emailTemplate.sendToTestEmail,title:e.title,status:e.status,action:e.action,trigger:{type:e.trigger.type,frequency:e.trigger.frequency,daysIn:e.trigger.daysIn,inThePeriod:e.trigger.inThePeriod},conditions:null===(t=e.condition)||void 0===t?void 0:t.map(function(e){var t;return{type:e.type,value:e.value}}),emailTemplate:{sendToCategory:e.emailTemplate.sendToCategory,sendTo:e.emailTemplate.sendTo,subject:e.emailTemplate.subject,content:e.emailTemplate.content,buttonTitle:e.emailTemplate.buttonTitle,buttonLink:e.emailTemplate.buttonLink,columns:e.emailTemplate.columns}}},e6=function(e){var t,n,a=e.workflowId,l=e.close,s=(0,eO.D)(),c=(0,u.useState)(!1),p=c[0],m=c[1],h=(0,E.cI)({defaultValues:{status:"active",taskTemplate:{status:"new",priority:"urgent",workflowTags:[],relatedLinks:[]}},context:{sendTestEmailIsRequired:p},resolver:(0,ed.S)(ev)}),b=h.handleSubmit,y=h.register,j=h.watch,w=h.setValue,I=h.reset,P=h.control,W=h.errors,A=(0,E.Dq)({control:P,name:"condition"}),U=A.fields,F=A.append,M=A.remove,N=(0,g.a)(eF,{skip:!a,variables:{id:a},onCompleted:function(){var e,t,n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{workflow:{}}).workflow,r=(null===(e=n.conditions)||void 0===e?void 0:e.find(function(e){return e.isTrigger}))||{},i=(null===(t=n.conditions)||void 0===t?void 0:t.filter(function(e){return!e.isTrigger}))||[];I({title:n.title,status:n.status,action:n.action,trigger:r.trigger,condition:i.map(function(e){return{type:e.condition.type,value:e.condition.value}}),taskTemplate:(0,T.Z)((0,o.Z)({},n.taskTemplate||{}),{workflowTags:n.tags}),emailTemplate:(0,o.Z)({},n.emailTemplate||{})})}}).loading,V=(0,i.Z)((0,x.D)(eI,{refetchQueries:["GetWorkflow","GetWorkflows"],onError:function(e){s.show({content:"Error: ".concat(e.message),color:"error"})},onCompleted:function(){s.show({content:"Workflow was created"}),l()}}),2),$=V[0],G=V[1].loading,H=(0,i.Z)((0,x.D)(eq,{refetchQueries:["GetWorkflow","GetWorkflows"],onError:function(e){s.show({content:"Error: ".concat(e.message),color:"error"})},onCompleted:function(){s.show({content:"Workflow was created"}),l()}}),2),B=H[0],J=H[1].loading,X=(0,i.Z)((0,x.D)(eP,{refetchQueries:["GetWorkflow","GetWorkflows"],onError:function(e){s.show({content:"Error: ".concat(e.message),color:"error"})},onCompleted:function(){s.show({content:"Workflow was updated"}),l()}}),2),Y=X[0],K=X[1].loading,ee=(0,i.Z)((0,x.D)(eD,{refetchQueries:["GetWorkflow","GetWorkflows"],onError:function(e){s.show({content:"Error: ".concat(e.message),color:"error"})},onCompleted:function(){s.show({content:"Workflow was updated"}),l()}}),2),et=ee[0],en=ee[1].loading,er=(0,i.Z)((0,x.D)(eR,{onError:function(e){s.show({content:"Error: ".concat(e.message),color:"error"})},onCompleted:function(){s.show({content:"Email was sent"})}}),2),eo=er[0],ei=er[1].loading,ea=(t=(0,Z.Z)(function(e){var t,n,r,i;return(0,C.__generator)(this,function(l){if(a)switch(e.action){case"createTask":r=e0(e),Y({variables:{data:(0,T.Z)((0,o.Z)({},r),{workflowId:a})}});break;case"sendEmail":i=e1(e),et({variables:{data:(0,T.Z)((0,o.Z)({},i),{workflowId:a})}})}else switch(e.action){case"createTask":t=eY(e),$({variables:{data:t}});break;case"sendEmail":n=eK(e),B({variables:{data:n}})}return[2]})}),function(e){return t.apply(this,arguments)}),el=(n=(0,Z.Z)(function(e){var t;return(0,C.__generator)(this,function(n){return t=e2(e),eo({variables:{data:t}}),[2]})}),function(e){return n.apply(this,arguments)}),es=j("trigger.type"),eu=j("action");return(0,r.jsxs)(r.Fragment,{children:[(N||G||J||K||en||ei)&&(0,r.jsx)(D.Z,{sx:{zIndex:1e5},open:!0,children:(0,r.jsx)(R.Z,{color:"secondary"})}),(0,r.jsx)("form",{onSubmit:b(p?el:ea),children:(0,r.jsx)(e5,{children:(0,r.jsxs)(v.Z,{height:"100%",width:"100%",spacing:2,children:[(0,r.jsx)(O.Z,{sx:{pl:1,pr:1},children:(0,r.jsxs)(k.ZP,{container:!0,columnSpacing:2,children:[(0,r.jsx)(k.ZP,{item:!0,xs:9,children:(0,r.jsx)(E.Qr,{name:"title",control:P,render:function(e){var t,n=e.value,o=e.onChange;return(0,r.jsx)(S.Z,{fullWidth:!0,color:"secondary",variant:"standard",label:"Title",value:n,onChange:o,error:W.title,helperText:null===(t=W.title)||void 0===t?void 0:t.message,InputLabelProps:{shrink:""!==n&&void 0!==n}})}})}),(0,r.jsx)(k.ZP,{item:!0,xs:3,children:(0,r.jsx)(E.Qr,{name:"status",control:P,render:function(e){var t,n=e.value,o=e.onChange;return(0,r.jsx)(_.P,{formControl:{variant:"standard",color:"secondary",error:W.status,helperText:null===(t=W.status)||void 0===t?void 0:t.message},selectProps:{fullWidth:!0},label:"Status",value:n,onChange:o,options:z})}})})]})}),(0,r.jsxs)(k.ZP,{container:!0,sx:{height:"100%",overflow:"auto",p:1},children:[(0,r.jsxs)(k.ZP,{item:!0,xs:5.5,children:[(0,r.jsx)(e4,{sx:{pt:1,pb:1,pr:2,pl:2},children:(0,r.jsxs)(v.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,r.jsx)(q.Z,{src:"/static/logo/icon-white.png"}),(0,r.jsxs)(v.Z,{children:[(0,r.jsx)(f.Z,{variant:"h6",sx:{lineHeight:1},children:"When"}),(0,r.jsx)(f.Z,{sx:{color:"#757575"},children:"This happens"})]})]})}),(0,r.jsx)(eH,{orientation:"vertical",variant:"middle"}),(0,r.jsx)(em,{control:P,errors:W,watch:j,setValue:w,reset:I,remove:M}),U.map(function(e,t){return(0,r.jsxs)("div",{children:[(0,r.jsx)(eH,{orientation:"vertical",variant:"middle"}),(0,r.jsx)(eb,{index:t,field:e,control:P,errors:W,watch:j,remove:M})]},e.id)}),(0,r.jsxs)(v.Z,{width:"100%",heigth:"100%",children:[(0,r.jsx)(eH,{orientation:"vertical",variant:"middle"}),(0,r.jsx)(e3,{disabled:!es,onClick:function(){return F({type:null,value:null})},children:(0,r.jsx)(Q.Z,{sx:{alignSelf:"center"}})})]})]}),(0,r.jsx)(k.ZP,{item:!0,xs:1,children:(0,r.jsx)(e9,{orientation:"vertical",children:(0,r.jsx)(e8,{children:(0,r.jsx)(L.Z,{})})})}),(0,r.jsxs)(k.ZP,{item:!0,xs:5.5,children:[(0,r.jsx)(e4,{sx:{pt:1,pb:1,pr:2,pl:2},children:(0,r.jsxs)(v.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,r.jsx)(q.Z,{src:"/static/logo/icon-white.png"}),(0,r.jsxs)(v.Z,{children:[(0,r.jsx)(f.Z,{variant:"h6",sx:{lineHeight:1},children:"Then"}),(0,r.jsx)(f.Z,{sx:{color:"#757575"},children:"Do the following"})]})]})}),(0,r.jsx)(eH,{orientation:"vertical",variant:"middle"}),(0,r.jsx)(eV,{control:P,errors:W,watch:j}),"createTask"===eu&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eH,{orientation:"vertical",variant:"middle"}),(0,r.jsx)(e4,{sx:{pt:1,pb:1,pr:2,pl:2},children:(0,r.jsx)(ec,{workflowId:a,register:y,watch:j,setValue:w,control:P,errors:W})})]}),"sendEmail"===eu&&(0,r.jsx)(eB,{workflowId:a,register:y,watch:j,setValue:w,control:P,errors:W,sendTestEmail:function(){m(!0)}})]})]}),(0,r.jsxs)(v.Z,{width:"100%",direction:"row",justifyContent:"center",spacing:2,children:[(0,r.jsx)(d.Z,{variant:"outlined",color:"black",size:"medium",onClick:l,children:"Cancel"}),(0,r.jsx)(d.Z,{variant:"contained",color:"secondary",size:"medium",type:"submit",onClick:function(){m(!1)},children:a?"Update":"Create"})]})]})})})]})};e6.defaultProps={close:function(){}},e6.propTypes={workflowId:l().number,close:l().func};var e5=(0,I.ZP)(p.Z)(function(){return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"90vw",height:"90vh",padding:"35px 27px 16px 27px",borderRadius:"8px"}}),e9=(0,I.ZP)(w.Z)(function(){return{display:"flex",alignItems:"center"}}),e8=(0,I.ZP)("div")(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"50px",height:"50px",borderRadius:"50%",border:"1px solid #949494","& .MuiSvgIcon-root":{width:"70%",height:"70%",fill:"#949494"}}}),e3=(0,I.ZP)(P.Z)(function(){return{alignSelf:"center",display:"flex",alignItems:"center",justifyContent:"center",width:"25px",height:"25px",borderRadius:"4px",padding:0,boxShadow:"0px 3px 3px -2px rgba(0,0,0,0.2),\n  0px 0px 4px 0px rgba(0,0,0,0.14),\n  0px 1px 8px 0px rgba(0,0,0,0.12)","&.Mui-disabled":{cursor:"not-allowed",pointerEvents:"unset"},"& .MuiSvgIcon-root":{width:"100%",height:"100%",fill:"#949494"}}}),e4=(0,I.ZP)(p.Z)(function(){return{borderRadius:"12px",boxShadow:"0px 3px 3px -2px rgba(0,0,0,0.2),\n  0px 0px 4px 0px rgba(0,0,0,0.14),\n  0px 1px 8px 0px rgba(0,0,0,0.12)"}}),e7=n(11994),te=n(59938),tt=n(57179),tn=function(e){var t=e.open,n=e.close,a=e.initialFilters,l=e.setFilters,s=(0,i.Z)((0,te.X)("form_data_".concat(a.filterType),a),2),u=s[0],c=s[1],p=(0,E.cI)({defaultValues:u}),f=p.control,m=p.handleSubmit,g=p.reset,x=p.getValues,h=function(e){try{var t,r,i={q:e.search?"%".concat(e.search,"%"):null,status:e.status,tags:(null===(t=e.tags)||void 0===t?void 0:t.length)>0?null===(r=e.tags)||void 0===r?void 0:r.map(function(e){return e.value}):null},a=x();l(function(e){return(0,o.Z)({},e,i)}),c(function(e){return(0,o.Z)({},e,a)})}finally{n()}},b=function(){l(a),g(a),c(a),n()};return(0,r.jsx)(e7.Z,{open:t,onClose:n,keepMounted:!0,children:(0,r.jsx)("form",{onSubmit:m(h),children:(0,r.jsx)(to,{children:(0,r.jsxs)(k.ZP,{container:!0,rowGap:4,columnSpacing:4,children:[(0,r.jsx)(k.ZP,{item:!0,xs:12,children:(0,r.jsx)(E.Qr,{control:f,name:"search",render:function(e){var t=e.value,n=e.onChange;return(0,r.jsx)(S.Z,{fullWidth:!0,label:"Title",variant:"standard",color:"secondary",value:t,onChange:n})}})}),(0,r.jsx)(k.ZP,{item:!0,xs:12,xs2:6,children:(0,r.jsx)(E.Qr,{control:f,name:"status",render:function(e){var t=e.value,n=e.onChange;return(0,r.jsx)(_.P,{label:"Status",value:t,onChange:n,options:tr,formControl:{fullWidth:!0,variant:"standard",color:"secondary"},selectProps:{fullWidth:!0}})}})}),(0,r.jsx)(k.ZP,{item:!0,xs:12,xs2:6,children:(0,r.jsx)(tt.r,{control:f})}),(0,r.jsx)(k.ZP,{container:!0,item:!0,xs:12,children:(0,r.jsxs)(v.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,r.jsx)(d.Z,{variant:"contained",color:"danger",onClick:b,children:"Cancel"}),(0,r.jsx)(d.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})})]})})})})};tn.propTypes={open:l().bool,close:l().func,initialFilters:l().object,setFilters:l().func};var tr=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],to=(0,I.ZP)(p.Z)(function(){return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"100vw",maxWidth:"600px",maxHeight:"100vh",padding:"16px",borderRadius:"8px",overflow:"auto"}}),ti=n(87918),ta=function(e){var t=e.conditions,n=(0,u.useMemo)(function(){return t.find(function(e){return e.isTrigger})},[t]),o=(0,u.useMemo)(function(){return t.filter(function(e){return!e.isTrigger})},[t]),i=(0,u.useCallback)(function(e){var t=e.trigger,n=(B.find(function(e){return e.value===t.type})||{label:""}).label;switch(t.type){case"jobStatusChanges":case"quoteStatusChanges":var r=J[t.type].find(function(e){return e.value===t.from}),o=J[t.type].find(function(e){return e.value===t.to});return"When ".concat(n.toLowerCase()," from ").concat(r.text," to ").concat(o.text);case"dateIs":var i=K.find(function(e){return e.value===t.frequency}),a=ee.find(function(e){return e.value===t.daysIn}),l=et.find(function(e){return e.value===t.inThePeriod});return"When ".concat(n.toLowerCase(),"\n        ").concat(i.label.toLowerCase(),"\n        ").concat(a.label.toLowerCase()," in\n        ").concat(l.label.toLowerCase())}},[]),a=(0,u.useCallback)(function(e){var t=e.type;return(Y.find(function(e){return e.value===t.value})||{label:""}).label},[]);return(0,r.jsxs)(r.Fragment,{children:[!!n&&(0,r.jsx)(ti.Z,{label:"".concat(i(n)),sx:{mr:1}}),o.map(function(e){return(0,r.jsx)(ti.Z,{label:"".concat(a(e.condition)," ").concat(e.condition.value.label),sx:{mr:1}})})]})};ta.defaultProps={conditions:[]},ta.propTypes={conditions:l().array};var tl=n(66137),ts=function(e){var t=e.initialFilters,n=e.containerHeight,a=e.tableHeight,l=(0,i.Z)((0,b.d)(),2),Z=l[0],T=l[1],C=(0,eO.D)(),w=(0,u.useState)(!1),k=w[0],S=w[1],I=(0,u.useState)((0,o.Z)({},t)),q=I[0],P=I[1],D=(0,s.x)({filters:q}),R=D.initialData,O=D.ref,_=(0,tl.Y)(R.tags,"Workflow"),E=(0,g.a)(eM({tagsWhere:_}),{variables:R}),L=E.data,Q=void 0===L?{workflows:[],meta:{aggregate:{totalCount:0}}}:L,W=Q.workflows,U=Q.meta,F=E.loading,M=E.refetch,N=(0,i.Z)((0,x.D)(eN,{refetchQueries:["GetWorkflow","GetWorkflows"],onError:function(e){C.show({content:"Error: ".concat(e.message),color:"error"})},onCompleted:function(){C.show({content:"Workflow was deleted"}),close()}}),1)[0],V=(0,u.useCallback)(function(e){var t=e.workflowId;T({content:function(e){var n=e.onClose;return(0,r.jsx)(e6,{workflowId:t,close:n})}})},[T]),$=(0,u.useCallback)(function(e){return[{icon:"edit",onClick:function(t){t.stopPropagation(),V({workflowId:e.id})},tooltip:"Edit"},{icon:"delete",onClick:function(t){t.stopPropagation(),N({variables:{workflowId:e.id}})},tooltip:"Delete"}]},[N,V]),G=(0,u.useMemo)(function(){return[{flex:1,field:"title",headerName:"Title"},{sortable:!1,flex:1,field:"conditions",headerName:"Trigger",renderCell:function(e){var t=e.row;return(0,r.jsx)(ta,{conditions:t.conditions})}},{sortable:!1,flex:1,field:"tags",headerName:"Tags",renderCell:function(e){var t=e.row;return"sendEmail"!==t.action?(0,r.jsx)(j.K,{row:t,entity:"Workflow",refetchQueries:["GetWorkflows"]}):null}},{flex:1,field:"fired",headerName:"Fired"},{flex:1,field:"createdBy",headerName:"Created by",sortName:'{"User": {"fullName": "ORDER"}}'},{flex:1,field:"createdAt",headerName:"Created at"},{flex:1,field:"status",headerName:"Status"},{width:50,field:"actions",headerName:"Actions",sortable:!1,renderCell:function(e){var t=e.row;return(0,r.jsx)(m.C,{row:t,actionsData:$})}}]},[$]),H=(0,u.useMemo)(function(){return W.map(function(e){return{id:e.id,title:e.title,conditions:e.conditions,tags:e.tags,fired:e.fired,createdBy:e.user.fullName,createdAt:A()(e.createdAt).format("YYYY-MM-DD"),status:e.status,action:e.action}})},[W]),z=function(e){e.stopPropagation(),T({content:function(e){var t=e.onClose;return(0,r.jsx)(e6,{close:t})}})};return(0,r.jsxs)(r.Fragment,{children:[Z,(0,r.jsx)(tn,{open:k,close:function(){return S(!1)},initialFilters:t,filters:q,setFilters:P}),(0,r.jsxs)(v.Z,{width:"100%",spacing:2,children:[(0,r.jsxs)(v.Z,{direction:"row",justifyContent:"space-between",children:[(0,r.jsx)(d.Z,{variant:"contained",startIcon:(0,r.jsx)(y.Z,{}),onClick:function(){return S(!0)},children:"Filters"}),(0,r.jsx)(d.Z,{variant:"contained",color:"secondary",onClick:z,children:"Add Automation"})]}),(0,r.jsxs)(p.Z,{sx:{paddingTop:"16px",paddingBottom:"16px",height:n},children:[!!(null==H?void 0:H.length)&&(0,r.jsx)(v.Z,{direction:"row",justifyContent:"space-between",children:(0,r.jsx)(f.Z,{ml:2,variant:"h5",sx:{fontWeight:600},children:"Automation"})}),(null==H?void 0:H.length)?(0,r.jsx)(c.i,{autoHeight:!1,loading:F,ref:O,columns:G,rows:H,meta:U,refetch:M,onRowClick:function(e){return V({workflowId:e.row.id})},containerHeight:a}):!F&&(0,r.jsx)(h.C,{imageSrc:"/static/icons/no_automations_found.svg",title:"Create your first automation",subtitleFirstLine:"Task automations help you stay on top of work;\n              streamline your workflow",subtitleSecondLine:"processes and integrate with other apps\n              for increased productivity.",buttonText:"Add Automation",onAction:z})]})]})]})};ts.defaultProps={initialFilters:{},containerHeight:"calc(100vh - 86px)",tableHeight:"calc(100% - 32px)"},ts.propTypes={initialFilters:l().object,containerHeight:l().string,tableHeight:l().string};var tu=n(58849),tc=n(18586),td=n(11163),tp=n.n(td),tv=function(){var e,t,n=(0,tc.q)();return(null==n?void 0:null===(e=n.admin)||void 0===e?void 0:null===(t=e.modules)||void 0===t?void 0:t.workflows)?(0,r.jsx)(ts,{initialFilters:{filterType:"workflow_table"}}):(tp().push("/404"),null)};tv.getLayout=function(e){return(0,r.jsx)(tu.Z,{children:e})};var tf=tv}},function(e){e.O(0,[3662,2283,212,619,8890,2583,4135,8579,6043,4244,3911,3776,2329,778,1023,9957,1870,8062,2429,5497,8324,3219,8849,4972,9774,2888,179],function(){return e(e.s=29325)}),_N_E=e.O()}]);