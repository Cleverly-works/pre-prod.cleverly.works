(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8971],{11082:function(e,t){"use strict";var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GBP";return new Intl.NumberFormat(["en-GB"],{currency:t,currencyDisplay:"symbol",style:"currency"}).format(e)};t.Z=n},55328:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/customers/view",function(){return n(24056)}])},70692:function(e,t,n){"use strict";n.d(t,{N:function(){return s}});var i=n(85893),r=n(45697),o=n(58594),a=[{id:"assignedToMe",label:"Assigned to me",value:"assignedToMe"}],s=function(e){var t=e.data,n=e.errors,r=e.name,s=e.onChange,c=e.register;return(0,i.jsx)(o.Z,{errors:n,data:t||a,legend:"",name:r,onChange:s,register:c})};s.propTypes={data:r.object,errors:r.object.isRequired,name:r.string,onChange:r.func,register:r.func.isRequired},s.defaultProps={name:"assignedToMe"}},22595:function(e,t,n){"use strict";n.d(t,{E:function(){return i}});var i=function(e,t){if(Array.isArray(t)){var n,i=null;return t.forEach(function(t){var n,r=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});i=(null==r?void 0:r.createdAt)||i}),i}var r=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});return(null==r?void 0:r.createdAt)||null}},71306:function(e,t,n){"use strict";n.d(t,{V:function(){return G}});var i=n(26042),r=n(828),o=n(85893),a=n(67294),s=n(45697),c=n(30381),d=n.n(c),l=n(11163),u=n.n(l),m=n(57460),p=n.n(m),f=n(6812),h=n(73359),v=n(7297),x=n(75063);function g(){var e=(0,v.Z)(['\n  query GetLocations(\n    $accountId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Location_order_by!\n  ) {\n    properties: Location(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      id\n      access\n      contactUserId\n      createdAt\n      name\n      status\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n      customer: Account_Locations {\n        id\n        account: Account {\n          id\n          name\n        }\n      }\n      compliances: Compliances(\n        where: { entity: { _eq: "Location" } }\n        order_by: { expiryAt: asc }\n      ) {\n        id\n        expiryAt\n        compliance: Compliance {\n          id\n          name\n        }\n      }\n      bookings: Jobs(\n        where: { Invoices: { invoiceType: { _in: ["customerVat", "ProformaInvoiceCustomer"] } } }\n      ) {\n        id\n      }\n      user: User {\n        id\n        fullName\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return g=function(){return e},e}var b=(0,x.Ps)(g()),y=n(12547),j=n(90629),Z=n(15861),I=n(98456),C=n(51233),A=n(11057),w=n(93946),_=n(5616),S=n(61730),q=n(2548),k=n(81261),T=n(25993),N=n(15033),L=n(69396),M=n(42283),D=n(11994),P=n(90948),E=n(50135),F=n(48580),R=n(59938),H=n(4972),$=function(e){var t=e.initialFilters,n=e.filters,s=e.setFilters,c=e.open,d=e.onClose,u=(0,l.useRouter)().query,m=(0,S.Z)("(max-width: 400px)"),p=(0,a.useMemo)(function(){return(null==u?void 0:u.tab)==="locations"},[u]),f=(0,r.Z)((0,R.X)("form_data_".concat(t.filterType).concat(p?"_".concat(t.accountId):""),t),2),v=f[0],x=f[1],g=(0,a.useState)(),b=g[0],y=g[1],Z=(0,M.cI)({defaultValues:v}),I=Z.control,w=Z.handleSubmit,_=Z.register,q=Z.reset,k=Z.errors,T=(0,r.Z)((0,h.t)(H.SW,{variables:{where:{name:{_ilike:""!==b?"%".concat(b,"%"):null}}}}),2),N=T[0],D=T[1],P=D.loading,$=D.data,W=(void 0===$?{items:[]}:$).items,V=function(){s(t),q(),d(),x((0,L.Z)((0,i.Z)({},t),{filterType:t.filterType}))},B=function(e){var r,o=(0,L.Z)((0,i.Z)({},n,e),{accountId:p?t.accountId:null===(r=e.customer)||void 0===r?void 0:r.value,q:e.q});s((0,L.Z)((0,i.Z)({},o),{q:e.q?"%".concat(e.q,"%"):null})),x((0,L.Z)((0,i.Z)({},o),{customer:p?null:e.customer,filterType:t.filterType})),q(),d()};return(0,o.jsx)(O,{open:c,onClose:d,children:(0,o.jsx)(j.Z,{sx:{minWidth:m?"300px":"400px",padding:"20px 40px"},children:(0,o.jsxs)("form",{onSubmit:w(B),children:[(0,o.jsxs)(C.Z,{spacing:p?8:4,children:[(0,o.jsx)(E.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search...",name:"q",inputRef:_}),!p&&(0,o.jsx)(M.Qr,{name:"customer",control:I,render:function(e){var t,n=e.value,i=e.onChange;return(0,o.jsx)(F.q,{limitTags:6,color:"secondary",value:n,onChange:function(e,t){return i(t)},label:"Select customer",loading:P,onOpen:function(){return N()},options:W,setSearch:y,textFieldProps:{label:"Select customer",variant:"standard",color:"secondary",error:k.customer,helperText:null===(t=k.customer)||void 0===t?void 0:t.message}})}})]}),(0,o.jsxs)(C.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,sx:{margin:"20px 0"},children:[(0,o.jsx)(A.Z,{variant:"contained",color:"danger",onClick:function(){return V()},children:"Cancel"}),(0,o.jsx)(A.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})},O=(0,P.ZP)(D.Z)(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}});$.propTypes={open:s.bool,onClose:s.func,initialFilters:s.object,setFilters:s.func.isRequired};var W=n(75832),V=n(20705),B=n(9492),U=n(63139),z=n(93884),Y=n(64872),J=function(e){return d()(e).format("YYYY-MM-DD")},G=function(e){var t,n=e.accountId,s=e.accountName,c=e.initialFilters,d=e.columnVisibilityModel,l=e.tableContainerHeight,m=(0,a.useState)(!1),v=m[0],x=m[1],g=(0,a.useState)(!1),L=g[0],M=g[1],D=(0,a.useState)((0,i.Z)({},c)),P=D[0],E=D[1],F=(0,V.x)({filters:P}),R=F.initialData,H=F.ref,O=(0,Y.a)(),G=(0,S.Z)("(max-width: 400px)"),Q=(0,U.s)(),X=(0,f.a)(b,{variables:R}),K=X.data,ee=void 0===K?{properties:[],meta:{aggregate:{totalCount:0}}}:K,et=ee.properties,en=ee.meta,ei=X.loading,er=X.refetch,eo=(0,r.Z)((0,h.t)(b,{fetchPolicy:"no-cache",variables:{accountId:R.accountId,q:R.q,orderBy:R.orderBy},onCompleted:function(e){try{var t=p().unparse(ed(e.properties)),n="data:application/octet-stream,"+encodeURIComponent(t);(0,B.S)(n,"locations.csv")}finally{M(!1)}}}),1)[0],ea=function(e){e.stopPropagation(),M(!0),eo()},es=(0,a.useCallback)(function(e,t){e.stopPropagation(),O.show({content:(0,o.jsx)(T.V,{accountId:n,accountName:s,data:null==t?void 0:t.data,entity:"Location",refetch:er}),title:(null==t?void 0:t.data)?"Edit location":"Create location"})},[O,n,s,er]),ec=function(e){var t=e.row;u().push("".concat("/dashboard/properties/","view?id=").concat(t.data.id,"&tab=details"))},ed=function(e){return e.map(function(e){var t,n,i=null===(t=null==e?void 0:e.addresses[0])||void 0===t?void 0:t.address;return{name:e.name||"Not Specified",customer:e.customer[0].account.name,address:i?"".concat(i.addressLine1," - ").concat(i.postCode):"",bookings:null===(n=e.bookings)||void 0===n?void 0:n.length,totalSpent:(0,W.T)(0),createdAt:J(e.createdAt)}})},el=(0,a.useCallback)(function(){return et.map(function(e){var t,n,i,r;return{id:e.id,data:e,name:e.name||"Not Specified",address:(null===(t=e.addresses[0])||void 0===t?void 0:t.address)?"\n            ".concat(null===(n=e.addresses[0])||void 0===n?void 0:n.address.addressLine1," -\n            ").concat(null===(i=e.addresses[0])||void 0===i?void 0:i.address.postCode):"Please Add",customer:e.customer[0].account.name,customerId:e.customer[0].account.id,workOrders:null===(r=e.bookings)||void 0===r?void 0:r.length,totalSpent:(0,W.T)(0),compliancesList:e.compliances,createdAt:J(e.createdAt),status:e.status,actions:""}})},[et]),eu=(0,a.useMemo)(function(){var e={};return!el().length&&(null==R?void 0:R.q)?{title:"No results",subtitleFirstLine:"The filters you have applied have returned no results",subtitleSecondLine:"Please amend and try again if necessary."}:{title:"No locations",subtitleFirstLine:"You currently have no locations set up in the system",subtitleSecondLine:"Click\xa0create location\xa0to get started building.",buttonText:"Create location",onAction:es}},[es,null==R?void 0:R.q,el]),em=(0,i.Z)({},d);return(0,o.jsxs)(o.Fragment,{children:[v&&(0,o.jsx)($,{initialFilters:c,open:v,filters:P,setFilters:E,onClose:function(){return x(!1)}}),(0,o.jsxs)(C.Z,{width:"100%",spacing:2,sx:{height:"100%"},children:[(0,o.jsxs)(C.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,o.jsx)(A.Z,{variant:"contained",startIcon:(0,o.jsx)(k.Z,{}),onClick:function(){return x(!0)},children:"Filters"}),(0,o.jsxs)(C.Z,{direction:"row",spacing:2,children:[(0,o.jsx)(A.Z,{variant:"contained",color:"secondary",onClick:es,children:"Create Location"}),!Q&&(0,o.jsx)(A.Z,{startIcon:!L&&(0,o.jsx)("img",{src:"/static/icons/csv.svg"}),disabled:L,variant:"contained",color:"success",onClick:ea,children:L?(0,o.jsx)(I.Z,{size:20,color:"secondary"}):"Export"})]})]}),(0,o.jsxs)(j.Z,{sx:{padding:"16px 0px",height:l},children:[(0,o.jsx)(Z.Z,{ml:2,variant:"h5",sx:{fontWeight:600,marginBottom:"15px"},children:"Locations"}),(null===(t=el())||void 0===t?void 0:t.length)?(0,o.jsx)(N.i,{ref:H,loading:ei,columns:[{headerName:"Name",field:"name",minWidth:370,flex:1},{headerName:"Address",field:"address",minWidth:300,flex:1,sortable:!1},{headerName:"Customer",field:"customer",sortable:!1,flex:1,minWidth:G?100:"auto",renderCell:function(e){var t=e.row,n=t.customer,i=t.customerId;return(0,o.jsx)(y.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(i),children:n})}},{headerName:"Work Orders",field:"workOrders",sortable:!1,minWidth:G?100:"auto",renderCell:function(e){var t=e.row.workOrders;return(0,o.jsx)(_.Z,{sx:{marginLeft:"3em"},children:t})},flex:1},{headerName:"Total Spent",field:"totalSpent",sortable:!1,minWidth:G?140:"auto",renderCell:function(e){var t=e.row.totalSpent;return(0,o.jsx)(_.Z,{sx:{marginLeft:"1.5em"},children:t})},flex:1},{field:"createdAt",headerName:"Created At",minWidth:G?200:"auto",flex:1,sortable:!0},{field:"actions",headerName:"Actions",sortable:!1,minWidth:G?80:"auto",renderCell:function(e){var t=e.row;return(0,o.jsx)(w.Z,{sx:{marginLeft:"1em"},onClick:function(){return ec({row:t})},children:(0,o.jsx)(q.Z,{})})},flex:1}],rows:el(),columnVisibilityModel:em,meta:en,refetch:er,autoHeight:!1,containerHeight:"calc(100% - 52px)",onRowClick:ec}):!ei&&(0,o.jsx)(z.C,(0,i.Z)({imageSrc:"/static/icons/no_locations_found.svg"},eu))]})]})]})};G.propTypes={accountId:s.number,accountName:s.string,initialFilters:s.object,columnVisibilityModel:s.object,tableContainerHeight:s.string},G.defaultProps={columnVisibilityModel:{},tableContainerHeight:"calc(100% - 52px)"}},24056:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return td}});var i=n(85893),r=n(58849),o=n(9270),a=n(62140),s=n(67294),c=n(11163),d=n.n(c),l=n(6812),u=n(66779),m=n(41085),p=n(55862),f=n(26042),h=n(7297),v=n(45697),x=n.n(v),g=n(75063);function b(){var e=(0,h.Z)(['\n  query GetPropertiesCompliance(\n    $accountId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Location_order_by!\n    $now: date\n    $nextMonth: date\n  ) {\n    properties: Location(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      id\n      access\n      contactUserId\n      createdAt\n      name\n\n      jobs: Jobs(where: { Compliances: { id: { _is_null: false }, entity: { _eq: "Job" } } }) {\n        id\n        number\n        amount\n        timingStart\n        scheduledAt\n      }\n      upComing: Compliances_aggregate(\n        where: {\n          entity: { _eq: "Location" }\n          _and: [{ expiryAt: { _gt: $now } }, { expiryAt: { _lt: $nextMonth } }]\n        }\n      ) {\n        aggregate {\n          count\n        }\n      }\n      overdue: Compliances_aggregate(\n        where: { expiryAt: { _lt: $now }, entity: { _eq: "Location" } }\n      ) {\n        aggregate {\n          count\n        }\n      }\n\n      compliances: Compliances(\n        where: { entity: { _eq: "Location" } }\n        order_by: { expiryAt: asc }\n      ) {\n        id\n        expiryAt\n        compliance: Compliance {\n          id\n          name\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return b=function(){return e},e}var y=(0,g.Ps)(b()),j=n(11640),Z=n(10367),I=n(11082),C=n(26186),A=n(11585),w=n(91272),_=n(36769),S=n(51466),q=n(11587),k=n(43235),T=n(5054);function N(){var e=(0,h.Z)(["\n  margin: 0;\n"]);return N=function(){return e},e}function L(){var e=(0,h.Z)(["\n  align-items: center;\n  display: flex;\n"]);return L=function(){return e},e}function M(){var e=(0,h.Z)(["\n  flex-direction: column;\n  margin-left: 1rem;\n"]);return M=function(){return e},e}var D=function(e){var t=(0,T.O)();return parseInt(e.filter(function(e){return(0,T.O)(e.expiryAt)>=t}).length/e.length*100)},P=function(e){var t=e.row.compliancesList;if(!t||0===t.length)return null;var n=D(t);return(0,i.jsxs)(R,{children:[(0,i.jsx)(F,{content:"".concat(t.length," : ").concat(n.toString(),"%"),context:$(n),size:"sm"}),E(t)]})},E=function(e){var t=e.find(function(e){var t=(0,k.r)(e.expiryAt);return e});return t&&(0,i.jsxs)(H,{children:[(0,i.jsx)(S.Z,{content:(0,C.Z)(t.expiryAt),context:O(t.expiryAt),size:"sm"}),(0,i.jsx)(S.Z,{content:t.compliance.name,size:"sm"})]})},F=(0,Z.ZP)(q.Z).withConfig({displayName:"helper__StyledBadge",componentId:"sc-7f3be2d3-0"})(N()),R=Z.ZP.div.withConfig({displayName:"helper__Wrapper",componentId:"sc-7f3be2d3-1"})(L()),H=Z.ZP.div.withConfig({displayName:"helper__Next",componentId:"sc-7f3be2d3-2"})(M()),$=function(e){return e>79?"success":e>49?"info":"danger"},O=function(e){var t=(0,k.r)(e);return t>14?"success":t>=0?"info":"danger"},W=n(20705),V=n(73303),B=n.n(V),U=n(2845),z=n(18586);function Y(){var e=(0,h.Z)(["\n  display: block;\n  cursor: pointer;\n  color: ",";\n  &:hover {\n    background: rgb(221, 221, 221);\n  }\n"]);return Y=function(){return e},e}var J="/dashboard/properties/",G=new Date,Q=(0,j.Z)(G,1),X=(0,j.Z)(G,-12),K=function(e){var t=e.accountId,n=(e.accountName,e.filters);e.showAddButton;var r=(0,U.x)().hasRole,o=(0,z.q)().hasUserModule,a=r("customer_user"),s=o("finances"),c=(0,W.x)({filters:n}),u=c.initialData,m=c.ref,p=(0,l.a)(y,{variables:(0,f.Z)({accountId:t,now:G,nextMonth:Q},u)}),h=p.data,v=void 0===h?{properties:[],meta:{aggregate:{totalCount:0}}}:h,x=v.properties,g=v.meta,b=p.loading,j=p.refetch,Z=function(e){return B()(null==e?void 0:e.filter(function(e){return new Date(e.timingStart)>X&&new Date(e.timingStart)<G}),function(e){return Number(e.amount)})},S=function(e){return null==e?void 0:e.find(function(e){return new Date(null==e?void 0:e.timingStart)>G})},q=function(e){d().push("".concat(J,"view?id=").concat(e.data.id,"&tab=compliance"))},k=function(e){var t=e.e,n=e.id,i=e.item;t.stopPropagation(),d().push("".concat(J,"view?id=").concat(n,"&tab=compliance&").concat(i,"=1"))},T=function(e,t){return(0,i.jsx)(ee,{onClick:function(n){return k({e:n,id:e.data.id,item:t})},children:e[t]})};return(0,i.jsxs)(A.Z,{fitParentHeight:!0,open:!0,title:"Locations Compliance",children:[(0,i.jsx)(_.p,{customerId:t,hideFinance:!s&a}),(0,i.jsx)(w.t,{columns:[{hidden:!0},{hidden:!0},{text:"Name"},{text:"Overdue",formatter:function(e){return T(e.row,"overdue")}},{text:"Upcoming",formatter:function(e){return T(e.row,"upcoming")}},{text:"Unconfirmed"},{text:"Next Visit"},{text:"Work orders"},{hidden:a&&!s,text:"Total Spent",formatter:function(e){var t=e.row;return(0,I.Z)(Z(t.data.jobs))}},{formatter:P,text:"Compliance"},{text:"Created"}],loading:b,meta:g,ref:m,refetch:j,rowClick:q,rows:x.map(function(e){var t,n,i,r,o,a;return{data:e,locationId:e.id,location:e.name||"Not Specified",overdue:null===(t=e.overdue)||void 0===t?void 0:t.aggregate.count,upcoming:null===(n=e.upComing)||void 0===n?void 0:n.aggregate.count,unconfirmed:e.jobs.filter(function(e){return!e.scheduledAt}).length,nextVisit:(null===(r=S(null===(i=e.data)||void 0===i?void 0:i.jobs))||void 0===r?void 0:r.timingStart)?(0,C.Z)(null===(o=S(e.data.jobs))||void 0===o?void 0:o.timingStart):"-",jobs:null===(a=e.jobs)||void 0===a?void 0:a.length,totalSpent:(0,I.Z)(Z),compliancesList:e.compliances,createdAt:(0,C.Z)(e.createdAt)}})})]})},ee=Z.ZP.a.withConfig({displayName:"table__StyledLink",componentId:"sc-4f12bd14-0"})(Y(),function(e){return e.theme.COLOUR.secondary});K.propTypes={accountId:v.number,accountName:v.string,filters:v.object,showAddButton:v.bool},K.defaultProps={hiddenColumns:[],isCompliance:!1,showAddButton:!1,showMediaButton:!1,showOverallRating:!1};var et=n(16540),en=n(1306),ei=n(71225);function er(){var e=(0,h.Z)(["\n  query GetComplianceRating($accountId: Int!) {\n    properties: Account_Location_aggregate(where: { accountId: { _eq: $accountId } }) {\n      nodes {\n        location: Location {\n          compliances: Compliances_aggregate {\n            aggregate {\n              count\n            }\n          }\n          compliance: Compliances {\n            id\n            expiryAt\n          }\n        }\n      }\n    }\n  }\n"]);return er=function(){return e},e}var eo=(0,g.Ps)(er()),ea=n(30430);function es(){var e=(0,h.Z)(["\n  cursor: pointer;\n  text-decoration: none;\n"]);return es=function(){return e},e}var ec=function(e){var t=e.customerId,n=(0,l.a)(eo,{variables:{accountId:t}}).data,r=(void 0===n?{properties:[]}:n).properties,o=function(){d().push("/dashboard/customers/view?id=".concat(t,"&tab=compliance"))};return(0,i.jsx)(A.Z,{open:!0,title:"Compliance Score",children:(0,i.jsx)(ed,{onClick:o,children:(0,i.jsx)(S.Z,(0,f.Z)({},(0,ea.Bo)(r)))})})},ed=Z.ZP.a.withConfig({displayName:"rating__Link",componentId:"sc-b882f7fa-0"})(es());ec.propTypes={customerId:v.number.isRequired};var el=n(41890),eu=n(30381),em=n.n(eu),ep=n(36641),ef=n(85113),eh=function(e){var t,n,r,o,a,s,c,l,u,m,p,f,h=e.customer,v=e.offCanvas,x=e.refetch,g=(0,ef.WE)(h,"registered"),b=(0,ef.WE)(h,"trading"),y=(0,ef.WE)(h,"invoice"),j=function(e){e&&x()};return[{id:1,label:"Create account",date:h.createdAt},{id:2,label:"Complete profile",info:"",date:(null==g?void 0:g.createdAt)||null,actions:[{id:1,active:!0,content:"Registered address",context:"secondary",handleClick:function(){var e;v.show({content:(0,i.jsx)(ep.H,{addressId:(null==g?void 0:null===(e=g.address)||void 0===e?void 0:e.id)||null,entity:"Account",entityId:h.id,id:(null==g?void 0:g.id)||null,onSubmit:j,type:"registered"}),submit:!1,title:"Manage addresses"})},type:"button"},{id:2,active:!0,content:"Trading address",context:"secondary",handleClick:function(){var e;v.show({content:(0,i.jsx)(ep.H,{addressId:(null==b?void 0:null===(e=b.address)||void 0===e?void 0:e.id)||null,entity:"Account",entityId:h.id,id:(null==b?void 0:b.id)||null,onSubmit:j,type:"trading"}),submit:!1,title:"Manage addresses"})},type:"button"},{id:3,active:!0,content:"Invoice address",context:"secondary",handleClick:function(){var e;v.show({content:(0,i.jsx)(ep.H,{addressId:(null==y?void 0:null===(e=y.address)||void 0===e?void 0:e.id)||null,entity:"Account",entityId:h.id,id:(null==y?void 0:y.id)||null,onSubmit:j,type:"invoice"}),submit:!1,title:"Manage addresses",width:"50%"})},type:"button"}]},{id:3,label:"Add location",info:"",date:(null===(t=h.propertiesMeta)||void 0===t?void 0:null===(n=t.aggregate)||void 0===n?void 0:n.count)?h.createdAt:null,content:[{id:1,active:(null===(r=h.propertiesMeta)||void 0===r?void 0:null===(o=r.aggregate)||void 0===o?void 0:o.count)>0,data:"".concat(null===(a=h.propertiesMeta)||void 0===a?void 0:null===(s=a.aggregate)||void 0===s?void 0:s.count," properties added")}],actions:[{id:1,active:!0,content:"Submit location",context:"secondary",handleClick:function(){d().push("".concat("/dashboard/customers/","view?id=").concat(h.id,"&tab=locations"))},type:"button"}]},{id:6,label:"Start issuing work orders",info:"submit work orders",date:(null===(c=h.jobsMeta)||void 0===c?void 0:null===(l=c.aggregate)||void 0===l?void 0:l.count)?h.createdAt:null,content:[{id:1,active:(null===(u=h.jobsMeta)||void 0===u?void 0:null===(m=u.aggregate)||void 0===m?void 0:m.count)>0,data:"".concat(null===(p=h.jobsMeta)||void 0===p?void 0:null===(f=p.aggregate)||void 0===f?void 0:f.count," jobs created")}]}]},ev=function(e,t,n){var i=eh({customer:e,offCanvas:t,refetch:n});return i.forEach(function(e){e.date&&(e.date=em()(e.date).format("D MMM YYYY HH:mm"))}),i},ex=n(64872),eg=function(e){var t,n=e.customer,r=e.refetch,o=(0,ex.a)();return(0,i.jsx)(A.Z,{open:!0,title:"Profile",children:(0,i.jsx)(el.Z,{items:ev(n,o,r),summary:(t=n,[{label:"Account manager: ",value:t.manager?"".concat(t.manager.nameFirst," ").concat(t.manager.nameLast," "):"Unassigned"},{label:"Users: ",value:t.usersMeta?t.usersMeta.aggregate.count:0},{label:"Status: ",value:t.status||""}])},"stepper-".concat(n.id))})},eb=n(35418),ey=n(30016),ej=n(4380),eZ=n(20402),eI=function(e){var t,n=e.customer,r=e.hasRole,s=e.refetch,c=(0,ef.WE)(n,"registered"),d=(0,ef.WE)(n,"trading"),l=[{key:"Company Number",value:n.companyNumber},{key:"VAT",value:n.vatId}];return n.clientType&&l.push({key:"Customer Type",value:n.clientType.name}),(null===(t=n.meta)||void 0===t?void 0:t.xeroContactId)&&l.push({key:"Xero Contact ID",value:n.meta.xeroContactId}),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(o.Z,{children:[(0,i.jsxs)(a.Z,{md:4,children:[(0,i.jsx)(ej.g,{avatar:(0,ei.Q)(n.media),editable:r("admin"),entity:n,entityName:"Account",icons:r("admin")?(0,eZ.Y)(n):[]}),n.contactUsers&&(0,i.jsx)(A.Z,{title:"Contact",children:n.contactUsers.map(function(e){var t;return(0,i.jsxs)("div",{children:[(0,i.jsx)(et.Z,{rows:[{key:"Name",value:"".concat(e.user.nameFirst," ").concat(e.user.nameLast)},{key:"Phone",value:e.user.phone},{key:"Email",value:e.user.email}]}),(0,i.jsx)("br",{})]},e.userId)})}),(0,i.jsx)(A.Z,{title:"Company",children:(0,i.jsx)(et.Z,{rows:l})}),c&&(0,i.jsx)(en.f,{address:c.address,entity:"Account",entityId:n.id,id:c.id,refetch:s,title:"Registered Address",type:"registered"}),d&&(0,i.jsx)(en.f,{address:d.address,entity:"Account",entityId:n.id,id:d.id,refetch:s,title:"Trading Address",type:"trading"}),r("admin")&&(0,i.jsx)(ey.E,{entity:"Account",entityId:n.id,open:!0,title:"Notes"})]}),(0,i.jsx)(a.Z,{md:4,children:(0,i.jsx)(eg,{refetch:s,customer:n})}),(0,i.jsxs)(a.Z,{md:4,children:[(0,i.jsx)(eb.G,{details:!0,entity:"Account",entityId:n.id}),(0,i.jsx)(ec,{customerId:n.id})]})]})})};eI.propTypes={customer:v.object.isRequired};var eC=n(59577),eA=n(69396),ew=n(828),e_=n(73359),eS=n(57460),eq=n.n(eS),ek=n(77439),eT=n(40826),eN=n(62466),eL=n(68956),eM=n(9492),eD=n(50459),eP=n(45154),eE=n(13077),eF=n(45416),eR=n(63139),eH=function(e){var t,n,r,o=e.filters,a=e.workorderVisibility,s=(0,U.x)(),c=s.hasRole,m=s.user,p=(0,z.q)(),h=p.admin,v=p.hasUserModule,x=null===(t=h.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,g=null===(n=h.jobSetting)||void 0===n?void 0:n.jobNumberSuffix,b=c("customer_user"),y=v("finances"),j=(0,W.x)({filters:o}),Z=j.initialData,_=j.ref,q=(0,l.a)(u.G5,{variables:(0,eA.Z)((0,f.Z)({},Z),{number:Z.id?String(Z.id):null,startDate:Z.startDate,endDate:Z.endDate,adminId:m.adminId})}),k=q.data,T=void 0===k?{jobs:[],meta:{aggregate:{totalCount:0}}}:k,N=T.jobs,L=T.meta,M=q.loading,D=q.refetch,P=function(){var e=(0,U.x)().user,t=Z.customerId,n=Z.endDate,r=Z.locationId,o=Z.orderBy,s=Z.startDate,c=Z.status,d=Z.supplierId,l=(0,ew.Z)((0,e_.t)(u.G5,{variables:{adminId:e.adminId,customerId:t,endDate:n,locationId:r,orderBy:o,startDate:s,status:c,supplierId:d},onCompleted:function(t){var n,i,r=(0,eP.c)(t.jobs,e.accountType,{numberPrefix:x,numberSuffix:g}),o=(null===(n=t.jobs[0])||void 0===n?void 0:null===(i=n.customer)||void 0===i?void 0:i.name)||"Customer",a=eq().unparse(r),s="data:application/octet-stream,"+encodeURIComponent(a);(0,eM.S)(s,"".concat(o,"-BookingData.csv"))}}),1)[0];return(0,i.jsxs)(i.Fragment,{children:[!(0,eR.s)()&&(0,i.jsx)(ek.Z,{context:"light",onClick:function(e){e.stopPropagation(),l()},title:"Export to CSV",size:"md",children:(0,i.jsx)(eT.Z,{context:"secondary",icon:"file-csv",size:"lg"})}),a&&(0,i.jsx)(ek.Z,{content:"Create Work Order",context:"secondary",size:"sm",onClick:R})]})},E=function(e){d().push("".concat("/dashboard/issues/","manage?id=").concat(e.number))},F=[{hidden:!0},{hidden:!0},{hidden:!0},{text:"ID",formatter:function(e){var t=e.row;return(0,i.jsx)(eF.D,{id:t.id,invoiceNumber:t.invoiceNumber,number:t.number,numberPrefix:x,numberSuffix:g,openCanvas:!0,type:t.type})}},{text:"Reference"},{text:"Description"},{sortable:!0,sortName:'{"Job": { "Service": {"name": "ORDER"} }}',text:"Service"},{sortable:!0,sortName:'{"Job": { "SLA": {"name": "ORDER"} }}',text:"Priority"},{formatter:(0,eN.Z)("/dashboard/properties/view","propertyId","location"),sortable:!0,sortName:'{"Job":{"Location": {"name": "ORDER"}}}',text:"Location"},{hidden:b&&!y,text:"Total \xa3",formatter:function(e){var t,n,r=e.row;return t=r.customerVatTotal,n=r.customerExpensesTotal,(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(S.Z,{size:"xs",children:["Job total ",(0,I.Z)(t)]}),(0,i.jsxs)(S.Z,{size:"xs",children:["Expense customer ",(0,I.Z)(n)]})]})}},{hidden:!0},{hidden:!c("admin"),text:"Supplier \xa3",formatter:function(e){var t,n,r=e.row;return t=r.supplierVatTotal,n=r.supplierExpensesTotal,(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(S.Z,{size:"xs",children:["Amount ",(0,I.Z)(t)]}),(0,i.jsxs)(S.Z,{size:"xs",children:["Expense amount ",(0,I.Z)(n)]})]})}},{hidden:!0},{hidden:!c("admin"),text:"Revenue",formatter:function(e){var t=e.row;return(0,I.Z)(t.revenue)}},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{text:"Scheduled"},{sortable:!0,sortName:"createdAt",text:"Created"},{sortable:!0,sortName:"status",formatter:function(e){var t=e.row;return(0,eE.B)({value:t.status})},text:"Status"},{hidden:!c("admin"),formatter:eL.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(e,t){return E(t)},tooltip:"Edit"},{context:"secondary",icon:["fas","receipt"],onClick:function(e,t){return d().push("/dashboard/issues/view?id=".concat(t.number))},tooltip:"info"}],text:"Actions"}],R=function(e){e.stopPropagation();var t=(0,eD.Uu)(o);d().push("/dashboard/issues/manage".concat(t))};return(0,i.jsx)(A.Z,{fitParentHeight:!0,open:!0,title:"Work Orders",toolbar:(0,i.jsx)(P,{}),children:(0,i.jsx)(w.t,{columns:F,loading:M,meta:L,ref:_,refetch:D,rows:null==N?void 0:N.map(function(e){var t,n,i,r,o,a,s,c,d,l=e.scheduledAt?(0,C.Z)(e.scheduledAt,!0):e.timingStart?(0,C.Z)(e.timingStart,!0):"-",u=e.customerRebateAmount>0?e.customerVatTotal-e.customerRebateAmount-e.supplierTotal:e.customerTotal-e.supplierTotal;return{id:e.id,type:e.type,number:e.number,invoiceNumber:null===(t=e.invoices)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.invoiceNumber,ref:e.reference||"-",description:e.description||"-",service:(null===(i=e.service)||void 0===i?void 0:i.name)||"-",priority:(null===(r=e.sla)||void 0===r?void 0:r.name)||"-",location:(null===(o=e.location)||void 0===o?void 0:o.name)||"-",customerVatTotal:e.customerVatTotal||0,customerExpensesTotal:e.customerExpensesTotal||0,supplierVatTotal:e.supplierVatTotal||0,supplierExpensesTotal:e.supplierExpensesTotal||0,revenue:u||0,propertyId:null===(a=e.location)||void 0===a?void 0:a.id,managerId:null===(s=e.manager)||void 0===s?void 0:s.id,customerId:null===(c=e.customer)||void 0===c?void 0:c.id,supplierId:(null===(d=e.supplier)||void 0===d?void 0:d.id)||"",scheduleDate:l,date:(0,C.Z)(e.createdAt),status:e.status,actions:""}})})})};eH.propTypes={filters:v.object},eH.defaultProps={filters:{assetId:null,managerId:null}};var e$=n(29815),eO=n(52019),eW=n(49501),eV=n(84043),eB=n(83894),eU=n(70692),ez=n(21300),eY=n(66812),eJ=n(92148),eG=function(e){var t=e.initialValues,n=e.control,r=e.errors,c=e.register,d=e.setFilters,l=e.watch,u=e.setValue,m=e.show,p=e.reset,h=(0,s.useContext)(eO.Z).hasRole,v={control:n,errors:r,register:c},x=l("customerId"),g=l("locationId"),b=l("supplierId"),y=l("userId"),j=function(e){var t=e.map(function(e){return e.value});d(function(e){return(0,eA.Z)((0,f.Z)({},e),{status:t.length>0?t:null})}),d(function(e){return(0,eA.Z)((0,f.Z)({},e),{isChangedStatusSelect:!0})}),u("status",e),e.length||d(function(e){return(0,eA.Z)((0,f.Z)({},e),{isChangedStatusSelect:!1})})};return(0,s.useEffect)(function(){t.customerId||d(function(e){return(0,eA.Z)((0,f.Z)({},e),{customerId:"number"==typeof x?x:(null==x?void 0:x.value)||null})})},[x]),(0,s.useEffect)(function(){d(function(e){return(0,eA.Z)((0,f.Z)({},e),{locationId:"number"==typeof g?g:(null==g?void 0:g.value)||null})})},[g]),(0,s.useEffect)(function(){d(function(e){return(0,eA.Z)((0,f.Z)({},e),{supplierId:"number"==typeof b?b:(null==b?void 0:b.value)||null})})},[b]),(0,s.useEffect)(function(){d(function(e){return(0,eA.Z)((0,f.Z)({},e),{userId:"number"==typeof y?y:(null==y?void 0:y.value)||null})})},[y]),(0,s.useEffect)(function(){return function(){d(t),p(t)}},[m]),(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(a.Z,{md:6,children:(0,i.jsx)(eW.Z,{label:null,children:(0,i.jsx)(eV.Z,(0,eA.Z)((0,f.Z)({},v),{placeholder:"Select status",name:"status",isMulti:!0,onChange:j,options:(0,eD.lR)(m)}))})}),h(["supplier"].concat((0,e$.Z)(eJ.n)))&&(0,i.jsx)(a.Z,{md:6,children:(0,i.jsx)(eY.P,(0,eA.Z)((0,f.Z)({},v),{errors:(0,f.Z)({},r),label:"",userId:t.userId,name:"userId",placeholder:"Select user",type:"user"}))}),!t.customerId&&h("admin")&&(0,i.jsx)(a.Z,{md:6,children:(0,i.jsx)(eY.P,(0,eA.Z)((0,f.Z)({},v),{errors:(0,f.Z)({},r),label:"",name:"customerId",placeholder:"Select customer",type:"customer"}))}),h("admin")&&(0,i.jsx)(a.Z,{md:6,children:(0,i.jsx)(eY.P,(0,eA.Z)((0,f.Z)({},v),{errors:(0,f.Z)({},r),label:"",accountId:t.customerId,name:"locationId",placeholder:"Select location",type:"property"}))}),h("admin")&&(0,i.jsx)(a.Z,{md:6,children:(0,i.jsx)(eY.P,(0,eA.Z)((0,f.Z)({},v),{errors:(0,f.Z)({},r),label:"",name:"supplierId",placeholder:"Select supplier",type:"supplier"}))}),(0,i.jsx)(a.Z,{md:12,children:(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(a.Z,{md:6,children:(0,i.jsx)(ez.M,(0,eA.Z)((0,f.Z)({},v),{name:"startDate",onChange:function(e){d(function(t){return(0,eA.Z)((0,f.Z)({},t),{startDate:e||null})}),u("startDate",e)},placeholder:"Start date"}))}),(0,i.jsx)(a.Z,{md:6,children:(0,i.jsx)(ez.M,(0,eA.Z)((0,f.Z)({},v),{name:"endDate",onChange:function(e){var t=e?(0,eB.Z)(e):e;d(function(e){return(0,eA.Z)((0,f.Z)({},e),{endDate:t})}),u("endDate",t)},placeholder:"End date"}))})]})}),!t.noAssignToMeFilter&&h((0,e$.Z)(eJ.SA).concat((0,e$.Z)(eJ.n),(0,e$.Z)(eJ.nx)))&&(0,i.jsx)(a.Z,{md:12,children:(0,i.jsx)(eU.N,(0,eA.Z)((0,f.Z)({},v),{name:"managerId",onChange:function(e){return d(function(t){return(0,eA.Z)((0,f.Z)({},t),{managerId:e.target.checked})})}}))})]})};eG.propTypes={control:v.object.isRequired,errors:v.object.isRequired,register:v.func.isRequired,setFilters:v.func.isRequired};var eQ=n(67259),eX=n(71306),eK=n(6924),e0=n(93243),e1=n(1589),e2=n(10925),e3=n(11057),e6=n(87918),e5=n(90629),e4=n(51233),e8=n(15861),e9=n(15033),e7=n(32784),te=n(62551),tt=n(5336),tn=n(33214),ti=n(36663),tr=n(15843),to=function(e){var t=e.editable,n=e.initialFilters,r=e.parentEntity,o=e.entity,a=e.entityId,c=e.tableHeight,d=e.paperHeight,u=(0,ew.Z)((0,te.d)(),2),m=u[0],p=u[1],h=(0,s.useState)({}),v=h[0],x=h[1],g=(0,s.useState)(!1),b=g[0],y=g[1],j=(0,W.x)({filters:v}),Z=j.ref,I=j.initialData,C=(0,l.a)(e7.MD,{variables:(0,eA.Z)((0,f.Z)({},I),{entity:r,childEntityId:a,childEntity:o,includeLocations:"Customer"===o})}),A=C.data,w=void 0===A?{schedules:[],meta:{aggregate:{totalCount:0}}}:A,_=w.schedules,S=w.meta,q=C.loading,k=C.refetch,T=(0,s.useCallback)(function(e){t&&p({content:function(t){var n=t.onClose;return(0,i.jsx)(tn.t,{isEdit:e.isChild,scheduleId:e.id,entity:o,entityId:a,close:n})}})},[o,a,t,p]),N=(0,s.useCallback)(function(e){return[{icon:"edit",onClick:function(t){t.stopPropagation(),T(e)},tooltip:"Edit Schedule"}]},[T]),L=(0,s.useMemo)(function(){return[{sortable:!1,flex:1,minWidth:180,field:"serviceLine",headerName:"Service line"},{sortable:!1,flex:1,minWidth:180,field:"schedule",headerName:"Schedule"},{sortable:!1,flex:1,minWidth:180,field:"rate",headerName:"\xa3/H",renderCell:function(e){var t=e.row;return(0,i.jsxs)(e4.Z,{children:[(0,i.jsxs)(e8.Z,{children:["First hour: \xa3 ",t.rate.firstHour]}),(0,i.jsxs)(e8.Z,{children:["Subsequent hours: \xa3 ",t.rate.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:180,field:"rateOOH",headerName:"\xa3/H OOH",renderCell:function(e){var t=e.row;return(0,i.jsxs)(e4.Z,{children:[(0,i.jsxs)(e8.Z,{children:["First hour: \xa3 ",t.rateOOH.firstHour]}),(0,i.jsxs)(e8.Z,{children:["Subsequent hours: \xa3 ",t.rateOOH.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:180,field:"ratePremium",headerName:"\xa3/H Premium",renderCell:function(e){var t=e.row;return(0,i.jsxs)(e4.Z,{children:[(0,i.jsxs)(e8.Z,{children:["First hour: \xa3 ",t.ratePremium.firstHour]}),(0,i.jsxs)(e8.Z,{children:["Subsequent hours: \xa3 ",t.ratePremium.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:150,field:"locations",headerName:"Locations"},{sortable:!1,flex:1,minWidth:150,field:"coverageArea",headerName:"Coverage area"},{sortable:!1,flex:1,field:"minimumDuration",headerName:"Min duration"},{sortable:!1,flex:1,field:"minimumIncrement",headerName:"Min increment"},{sortable:!1,flex:1,minWidth:100,field:"status",headerName:"Status",renderCell:function(e){var t=e.row;return(0,i.jsx)(e6.Z,{label:"active"===t.status?"Active":"Inactive",color:"active"===t.status?"success":"danger",size:"small"})}},{sortable:!1,width:100,field:"actions",headerName:"Actions",renderCell:function(e){var t=e.row;return(0,i.jsx)(tt.C,{row:t,actionsData:N})}}]},[N]),M=(0,s.useMemo)(function(){return _.map(function(e){var t,n,i=null===(t=e.childSchedules)||void 0===t?void 0:t[0];return i?{id:i.id,serviceLine:e.service.name,schedule:i.name,rate:i.normal,rateOOH:i.ooh,ratePremium:i.premium,locations:(null===(n=i.locations)||void 0===n?void 0:n.map(function(e){return e.location.name}).join(", "))||"-",coverageArea:e.postcodeAreas.map(function(e){return e.postcode.area}).join(", "),minimumDuration:i.minimumDuration,minimumIncrement:i.minimumIncrement,status:i.status,serviceId:i.serviceId,isChild:!0}:{id:e.id,serviceLine:e.service.name,schedule:e.name,rate:e.normal,rateOOH:e.ooh,ratePremium:e.premium,locations:"-",coverageArea:e.postcodeAreas.map(function(e){return e.postcode.area}).join(", "),minimumDuration:e.minimumDuration,minimumIncrement:e.minimumIncrement,status:e.status,serviceId:e.serviceId}})},[_]);return(0,i.jsxs)(i.Fragment,{children:[m,(0,i.jsx)(ti.X,{open:b,close:function(){return y(!1)},initialFilters:n,setFilters:x}),(0,i.jsx)(e4.Z,{width:"100%",spacing:2,children:(0,i.jsxs)(e5.Z,{sx:{paddingTop:"16px",paddingBottom:"16px",height:d},children:[(0,i.jsxs)(e4.Z,{direction:"row",justifyContent:"space-between",pl:2,pr:2,children:[(0,i.jsx)(e8.Z,{variant:"h5",sx:{fontWeight:600},children:"Services"}),(0,i.jsx)(e3.Z,{startIcon:(0,i.jsx)(tr.Z,{}),variant:"contained",onClick:function(){return y(!0)},children:"Filters"})]}),(0,i.jsx)(e9.i,{autoHeight:!1,loading:q,ref:Z,columns:L,rows:M,meta:S,refetch:k,containerHeight:c,columnVisibilityModel:{locations:"Customer"===o,actions:t},onRowClick:function(e){return T(e.row)}})]})})]})};to.propTypes={editable:x().bool,initialFilters:x().object,parentEntity:x().oneOf(["System-Customer"]).isRequired,entity:x().oneOf(["Customer","Location"]).isRequired,entityId:x().string,tableHeight:x().string,paperHeight:x().string},to.defaultProps={editable:!1,tableHeight:"calc(100% - 42px)",paperHeight:"calc(100% - 32px)"};var ta=function(){var e,t=(0,U.x)(),n=t.hasRole,r=t.user,o=(0,z.q)(),a=o.hasUserModule,d=o.admin,f=(0,c.useRouter)().query,h=(0,s.useMemo)(function(){return f.tab||"details"},[f.tab]),v=(null==d?void 0:null===(e=d.modules)||void 0===e?void 0:e.sageIntegration)||!1,x="customer"===r.accountType?r.accountId:f.id,g=n("admin"),b=n("customer_user"),y=a("finances"),j=a("quotes"),Z=(0,l.a)(u.UB,{fetchPolicy:"no-cache",variables:{id:x}}),I=Z.loading,C=Z.data,A=(void 0===C?{customer:{}}:C).customer,w=Z.error,_=Z.refetch;if(w)return"Error! ".concat(w);var S={accountId:A.id,q:null,filterType:"customer_locations_tab"},q=[(0,i.jsx)("div",{active:"details"===h||!h,label:"Details",children:(0,i.jsx)(eI,{customer:A,hasRole:n,refetch:_})}),(0,i.jsx)("div",{hide:b&&!y,active:"finance"===h,label:"Finance",children:(0,i.jsx)(eC.b,{type:"customer",accountId:A.id,accountName:A.name,accountRefetch:_,meta:A.meta,hasSageIntegration:v})}),(0,i.jsx)("div",{active:"users"===h,label:"Users",children:(0,i.jsx)(e1.q,{accountType:"customer",filters:{accountId:A.id}})}),(0,i.jsx)("div",{active:"locations"===h,label:"Locations",children:(0,i.jsx)(eX.V,{accountId:A.id,accountName:A.name,columnVisibilityModel:{customer:!1,totalSpent:!b||y},initialFilters:S,tableContainerHeight:"calc(80vh - 22px)"})}),(0,i.jsxs)("div",{active:"compliance"===h,label:"Compliance",children:[(0,i.jsx)(K,{accountId:A.id,filters:{accountId:A.id},hiddenColumns:["Address","Customer"],initialFilters:{accountId:A.id,filterType:"customer_compliance_tab"},showMediaButton:!0,showOverallRating:!0,sortOrder:{item:"expiryAt",order:"desc"}}),(0,i.jsx)(p.J,{FiltersComp:eG,initialFilters:{customerId:A.id,startDate:null,endDate:null,status:null,locationId:null,supplierId:null,noAssignToMeFilter:!0,id:null,filterType:"customer_bookings_quotes_tab"},TableComp:eH,workorderVisibility:!0})]}),(0,i.jsx)("div",{active:"work-orders"===h,label:"Work Orders",children:(0,i.jsx)(eQ.A,{filtersVisibilityModel:{customer:!1,user:n("customer"),location:n(["admin","customer"]),accountManager:!1,manager:!1,customerManager:!1},entityRelationToFetch:{customerId:A.id},initialFilters:{startDate:null,endDate:null,status:null,customerId:A.id,locationId:null,supplierId:null,noAssignToMeFilter:!0,id:null,filterType:"locations_work_orders_tab"},columnVisibilityModel:{customerNet:Boolean(!b||y),amountOutstanding:Boolean(!b||y)}})}),(0,i.jsx)("div",{active:"slas"===h,label:"SLAs",children:(0,i.jsxs)(m.Z,{handleChange:!1,children:[(0,i.jsx)("div",{active:!0,label:"Work Order SLAs",children:(0,i.jsx)(e2.H,{title:"Work Order SLAs",subtype:"reactive",isEntity:!0,entity:"Account",entityId:A.id})}),(0,i.jsx)("div",{label:"Quote SLAs",children:(0,i.jsx)(e2.H,{title:"Quote SLAs",subtype:"quote",isEntity:!0,entity:"Account",entityId:A.id})})]})}),(0,i.jsx)("div",{hide:b&&!y,active:"services"===h,label:"Services",children:(0,i.jsx)(to,{editable:g,initialFilters:{filterType:"customer"},parentEntity:"System-Customer",entity:"Customer",entityId:A.id,paperHeight:"calc(100vh - 90px)"})}),(0,i.jsx)("div",{hide:b&&!j,active:"quotes"===h,label:"Quotes",children:(0,i.jsx)(p.J,{FiltersComp:eK.r,initialFilters:{customerId:A.id,supplierId:null,status:null,id:null,filterType:"customer_quote_tab"},TableComp:e0.v})})];return!I&&(0,i.jsx)(m.Z,{children:q.filter(function(e){return!e.props.hide})},h)},ts=function(){return(0,i.jsx)(o.Z,{children:(0,i.jsx)(a.Z,{md:12,children:(0,i.jsx)(ta,{})})})},tc=function(){return(0,i.jsx)(ts,{})};tc.getLayout=function(e){return(0,i.jsx)(r.Z,{children:e})};var td=tc}},function(e){e.O(0,[3662,367,2283,212,619,8890,2583,4135,8579,6043,1564,4244,1336,3911,3776,5370,2329,778,6540,4046,1023,9957,1870,2797,9241,653,8062,1207,2429,4061,597,4211,1303,6656,8344,8849,6733,1741,7305,2781,8151,2629,1675,6625,1105,8004,5441,2622,9774,2888,179],function(){return e(e.s=55328)}),_N_E=e.O()}]);