"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5201],{48218:function(e,n,t){t.d(n,{L:function(){return o}});var o=function(e){for(var n="",t=e.slice().sort(function(e,n){return Number(e.id)-Number(n.id)}),o=t.length-1;o>=0;o--){var r=t[o].status;if("onHold"===r||"resumed"===r||"paused"===r||"continued"===r){n=t[o].status;break}}return n}},22595:function(e,n,t){t.d(n,{E:function(){return o}});var o=function(e,n){if(Array.isArray(n)){var t,o=null;return n.forEach(function(n){var t,r=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});o=(null==r?void 0:r.createdAt)||o}),o}var r=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==r?void 0:r.createdAt)||null}},90114:function(e,n,t){t.d(n,{OQ:function(){return s},Pn:function(){return r},TT:function(){return a},Xd:function(){return i},aH:function(){return o},nN:function(){return l}});var o=function(e,n,t){var o,r=null===(o=null==n?void 0:n.slice())||void 0===o?void 0:o.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdApproval")&&t===n.quoteId})},r=function(e,n,t){var o,r=null===(o=null==n?void 0:n.slice())||void 0===o?void 0:o.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdApproved")&&t===n.quoteId})},a=function(e,n,t){var o,r=null===(o=null==n?void 0:n.slice())||void 0===o?void 0:o.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdRejected")&&t===n.quoteId})},i=function(e,n){var t,o=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});return null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdApproval")})},l=function(e,n){var t,o=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});if(Array.isArray(e)){var r=null;return e.forEach(function(e){r=(null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdApproved")}))||r}),r}return null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdApproved")})},s=function(e,n){var t,o=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});return null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdRejected")})}},13262:function(e,n,t){t.d(n,{f:function(){return _}});var o=t(26042),r=t(69396),a=t(29815),i=t(85893),l=t(67294),s=t(45697),u=t.n(s),d=t(15861),c=t(93946),p=t(51233),m=t(21023),h=t(96540),v=t(79665),f=t(50135),x=t(11057),g=t(90948),b=t(42283),y=t(41733),j=t(40656),Z=t(74231),w=Z.Ry().shape({caption:Z.Z_()}),C=(0,g.ZP)(d.Z)({backgroundColor:j.Q.COLOUR.secondary,color:j.Q.COLOUR.white,textAlign:"center",minWidth:"64px",borderRadius:"4px",margin:"10px 0",padding:"4px 10px",boxShadow:"0px 3px 1px -2px rgba(0,0,0,0.2),\n    0px 2px 2px 0px rgba(0,0,0,0.14),\n    0px 1px 5px 0px rgba(0,0,0,0.12)"}),I=(0,g.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),S=function(e){var n,t=e.noDelete,a=e.onDelete,s=e.isAdded,u=e.media,h=e.caption,g=e.onSave,Z=(0,l.useState)(null),S=Z[0],_=Z[1],k=(0,l.useState)(""),D=k[0],q=k[1],P=(0,l.useState)(s),O=P[0],T=P[1],M=(0,b.cI)({resolver:(0,v.S)(w)}),F=M.register,A=M.errors,E=M.handleSubmit,R=M.reset,N=function(e){e.stopPropagation(),_(null),R()},W=function(e){e.stopPropagation(),T(!1),a()},$=function(e){S&&(g((0,r.Z)((0,o.Z)({},e),{media:S,type:D})),T(!1))},J=(0,l.useCallback)(function(e){return function(n){n.stopPropagation();var t=n.target.files[0];q(e),_(t)}},[_]);return(0,i.jsx)("form",{children:O?(0,i.jsx)(p.Z,{children:(0,i.jsxs)(p.Z,{rowGap:2,children:[(0,i.jsx)(f.Z,{fullWidth:!0,label:"Caption",variant:"standard",color:"secondary",name:"caption",inputRef:F,error:A.name,helperText:null===(n=A.name)||void 0===n?void 0:n.message}),S?(0,i.jsxs)(p.Z,{rowGap:3,children:[(0,i.jsxs)(p.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(d.Z,{sx:{color:j.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:S.name}),(0,i.jsx)(m.Z,{title:"Delete",placement:"top-start",children:(0,i.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:N,children:(0,i.jsx)(y.Z,{})})})]}),(0,i.jsxs)(p.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,i.jsx)(x.Z,{variant:"contained",color:"danger",size:"small",onClick:W,children:"Cancel"}),(0,i.jsx)(x.Z,{variant:"contained",size:"small",onClick:E($),children:"Save"})]})]}):(0,i.jsxs)(p.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,i.jsxs)(C,{component:"label",children:["Add image\xa0",(0,i.jsx)(I,{onChange:J("image"),type:"file",accept:"image/*, .heic"})]}),(0,i.jsxs)(C,{component:"label",children:["Add document\xa0",(0,i.jsx)(I,{onChange:J("document"),type:"file",accept:".pdf, .doc, .docx, .xlsx",multiple:!0})]})]})]})}):(0,i.jsxs)(p.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:1,children:[(0,i.jsx)(d.Z,{sx:{color:j.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:h||(null==u?void 0:u.name)||"No caption"}),!t&&(0,i.jsx)(m.Z,{title:"Delete",placement:"top-start",children:(0,i.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:a,children:(0,i.jsx)(y.Z,{sx:{fontSize:"16px"}})})})]})})};S.propTypes={noDelete:u().func,onDelete:u().func,isAdded:u().bool,media:u().object,onSave:u().func};var _=function(e){var n=e.values,t=e.setValue,s=e.name,u=e.title,v=e.titleSx,f=e.onDeleteExistingMedia,x=(0,l.useState)([]),g=x[0],b=x[1];(0,l.useEffect)(function(){Array.isArray(n)&&b(n)},[n]);var y=function(e){e.stopPropagation(),b(function(e){return(0,a.Z)(e).concat([{mediaId:null,caption:"",media:null,type:"",isAdded:!0}])})},j=function(e,n){var o=(0,a.Z)(g);o.splice(e,1,n),t(s,o)};return(0,i.jsxs)(p.Z,{children:[(0,i.jsxs)(p.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,i.jsx)(d.Z,{sx:v,children:u?u+":":""}),(0,i.jsx)(m.Z,{title:"Add new attachment",placement:"top-start",children:(0,i.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:y,children:(0,i.jsx)(h.Z,{})})})]}),(0,i.jsx)(p.Z,{pl:2,spacing:.8,children:(null==g?void 0:g.length)?g.map(function(e,n){var a;return(0,i.jsx)(S,(0,r.Z)((0,o.Z)({index:n},e),{onDelete:function(){f&&g[n].mediaId&&f(g[n].mediaId);var e=g.filter(function(e,t){return t!==n});t(s,e),b(e)},onSave:function(e){return j(n,e)}}),e.caption+n)}):(0,i.jsx)(d.Z,{typography:"subtitle2",children:"No data"})})]})};_.propTypes={values:u().array,setValue:u().func,name:u().string,title:u().string,titleSx:u().object,onDeleteExistingMedia:u().func},_.defaultProps={name:"attachments",title:"Attachments",titleSx:{}}},10545:function(e,n,t){t.d(n,{c:function(){return b}});var o=t(14924),r=t(26042),a=t(69396),i=t(828),l=t(29815),s=t(85893),u=t(87109),d=t(21023),c=t(39522),p=t(40876),m=t(67294),h=t(48580),v=t(73359),f=t(4972),x=t(11163),g=t.n(x),b=function(e){var n=e.withoutRightBorderRadius,t=e.fullWidth,o=e.locationId,r=e.locationName,a=(0,m.useState)(""),x=a[0],b=a[1],j=(0,m.useState)(o?{label:r,value:o}:{label:"All locations",value:"all"})[0],Z=(0,i.Z)((0,v.t)(f._d,{variables:{where:{name:{_ilike:""!==x?"%".concat(x,"%"):null}},offset:0,limit:50}}),2),w=Z[0],C=Z[1],I=C.data,S=(void 0===I?{items:[]}:I).items,_=C.loading,k=function(e,n){if(!(null==n?void 0:n.value))return null;if("/dashboard/scheduledjob"===g().pathname){if("all"===n.value)return null;g().push("/dashboard/properties/view?id=".concat(n.value,"&tab=planned-maintenance"))}else"all"===n.value?g().push("/dashboard/scheduledjob"):g().push("/dashboard/properties/view?id=".concat(n.value,"&tab=planned-maintenance"))};return(0,s.jsx)(d.Z,{followCursor:!0,title:j.label,children:(0,s.jsx)(h.q,{loading:_,options:[{label:"All locations",value:"all"}].concat((0,l.Z)(S)),value:j,onChange:k,setSearch:b,onOpen:w,isOptionEqualToValue:function(e,n){return e.value===n.value},popupIcon:(0,s.jsx)(p.Z,{}),clearIcon:null,textFieldProps:{placeholder:"Location name",InputProps:{startAdornment:(0,s.jsx)(u.Z,{position:"start",children:(0,s.jsx)(c.Z,{color:"white.main"})})}},size:"small",sx:y({withoutRightBorderRadius:n,fullWidth:t})})})},y=function(e){var n=e.withoutRightBorderRadius,t=e.fullWidth;return(0,a.Z)((0,r.Z)({height:"32px",width:t?"100%":"220px",backgroundColor:"secondary.main",borderRadius:1},n&&{borderTopRightRadius:0,borderBottomRightRadius:0}),(0,o.Z)({"& .MuiInputBase-root":{color:"white.main"},"& .MuiOutlinedInput-root.MuiInputBase-sizeSmall":{paddingTop:"4px"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}},"& .MuiAutocomplete-endAdornment .MuiSvgIcon-root,\n  .MuiInputAdornment-root.MuiInputAdornment-positionStart",{color:"white.main"}))}},5201:function(e,n,t){t.d(n,{A:function(){return iW}});var o,r,a,i=t(26042),l=t(85893),s=t(67294),u=t(51233),d=t(90629),c=t(90948),p=t(3892),m=t(40044),h=t(10545),v=t(69396),f=t(828),x=t(45697),g=t.n(x),b=t(30381),y=t.n(b),j=t(6812),Z=t(73359),w=t(50319),C=t(90263),I=t(5616),S=t(15861),_=t(93946),k=t(11057),D=t(84808),q=t(98456),P=t(41899),O=t(41733),T=t(91379),M=t(77957),F=t(81261),A=t(24519),E=t(6775),R=t(57460),N=t.n(R),W=t(12547),$=t(29815),J=t(86886),L=t(86532),Y=t(38895),B=t(22797),H=t(61730),V=t(11163),G=t.n(V),Q=t(2388),z=t(66242),U=t(44267),K=t(22244),X=t(11383);function ee(){return(ee=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let en=e=>s.createElement("svg",ee({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 23 22",width:"1em",height:"1em"},e),s.createElement("path",{fill:"#C1C1C1",d:"M10.504.223a2.35 2.35 0 0 1 1.994 0l9.277 4.34c.36.168.59.533.59.937s-.23.769-.59.937l-9.277 4.34a2.35 2.35 0 0 1-1.994 0l-9.277-4.34a1.04 1.04 0 0 1-.59-.937c0-.4.229-.77.59-.937zm9.013 8.783 2.258 1.057c.36.168.59.533.59.937s-.23.769-.59.937l-9.277 4.34a2.35 2.35 0 0 1-1.994 0l-9.277-4.34A1.04 1.04 0 0 1 .637 11c0-.4.229-.77.59-.937l2.257-1.057 6.45 3.017a3.7 3.7 0 0 0 3.133 0zm-6.45 8.517 6.45-3.017 2.258 1.057c.36.168.59.533.59.937s-.23.769-.59.937l-9.277 4.34a2.35 2.35 0 0 1-1.994 0l-9.277-4.34a1.04 1.04 0 0 1-.59-.937c0-.4.229-.77.59-.937l2.257-1.057 6.45 3.017a3.7 3.7 0 0 0 3.133 0"}));var et=t(83985),eo=t(2845),er=t(8842),ea={jobTitle:{color:"#5C5C5C",fontSize:"14px",marginBottom:"12px"},status:{fontWeight:"600",textTransform:"capitalize"},link:{textDecoration:"none"},assignedToLabel:{fontWeight:"300",whiteSpace:"nowrap"}},ei=function(e){var n=e.id,t=e.number,o=e.status,r=e.description,a=e.supplierId,s=e.supplierName,d=e.onSelectJob,c=e.selected,p=e.onClose,m=(0,eo.x)().hasRole,h=m("supplier"),f=m("customer"),x=m("tenant"),g=(0,X.b)(o),b=((0,$.Z)(K.iz).concat((0,$.Z)(K.yW),(0,$.Z)(K.l8)).find(function(e){return e.value===o})||{statusText:""}).text,y=function(e){e.stopPropagation(),G().push("/dashboard/issues/view?id=".concat(t)).then(function(){return p()})};return(0,l.jsxs)(u.Z,{direction:"row",width:"100%",spacing:1,onClick:function(){return d({id:n,number:t})},children:[(0,l.jsx)(el,{selected:c,children:(0,l.jsxs)(U.Z,{children:[(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",columnGap:2,mb:1.5,children:[(0,l.jsx)(k.Z,{onClick:y,color:g,variant:"contained",size:"small",endIcon:(0,l.jsx)(er.Z,{}),children:t}),(0,l.jsx)(S.Z,{sx:ea.status,variant:"subtitle1",children:b})]}),(0,l.jsx)(et.O,{maxLength:10,sx:ea.jobTitle,children:r}),!f&&!x&&(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(S.Z,{variant:"subtitle2",sx:ea.assignedToLabel,children:"Assigned to:\xa0"}),(0,l.jsx)(et.O,(0,v.Z)((0,i.Z)({maxLength:24,variant:"subtitle2"},a&&!h&&{href:"/dashboard/suppliers/view?id=".concat(a),color:"secondary",sx:{"& .MuiTypography-root":{fontSize:"12px"},"&:hover":{cursor:"pointer"}}}),{children:s||"-"}))]})]})}),c&&(0,l.jsx)(es,{}),!c&&(0,l.jsx)(eu,{children:(0,l.jsx)(U.Z,{children:(0,l.jsx)(en,{className:"stacked-layers"})})})]})};ei.propTypes={id:g().number.isRequired,number:g().string.isRequired,status:g().string.isRequired,description:g().string.isRequired,supplierId:g().number,supplierName:g().string,onSelectJob:g().func.isRequired,selected:g().bool,onClose:g().func.isRequired};var el=(0,c.ZP)(z.Z)(function(e){var n=e.selected;return(0,i.Z)({position:"relative",width:"calc(100% - 60px)",display:"flex",flexDirection:"column",justifyContent:"center",height:"140px",backgroundColor:"#F9F9F9"},!n&&{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-10px)",boxShadow:"0 8px 16px rgba(0, 0, 0, 0.2)"}},n&&{width:"100%",border:"1px solid #50AEFC"})}),es=(0,c.ZP)("div")({position:"relative",width:"12px",marginLeft:"0px !important","&:after":{content:'""',position:"absolute",bottom:"50%",left:"-6px",width:0,height:0,borderLeft:"12px solid transparent",borderRight:"0px solid transparent",borderBottom:"12px solid #50AEFC",transform:"rotate(-45deg)"}}),eu=(0,c.ZP)(z.Z)(function(){return{width:"60px",display:"flex",justifyContent:"center",alignItems:"center",height:"140px",backgroundColor:"#F9F9F9",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-10px)",boxShadow:"0 8px 16px rgba(0, 0, 0, 0.2)"},"& .MuiCardContent-root":{padding:"0px",display:"flex",justifyContent:"center",alignItems:"center"},"& .stacked-layers":{fontSize:"24px"}}}),ed=t(48580),ec=t(75759),ep=t(7297),em=t(75063);function eh(){var e=(0,ep.Z)(["\n  fragment JobScheduleFields on JobSchedule {\n    contractId\n    createdAt\n    customerMonthlyCharge\n    dates\n    estimatedDuration\n    estimatedDurationUnit\n    finalInvoiceDate\n    firstInvoiceDate\n    frequency\n    frequencyDescription\n    id\n    invoiceBasis\n    locationId\n    meta\n    paymentMethod\n    reference\n    status\n    sublocationId\n    supplierMonthlyCharge\n    updatedAt\n    scheduleStart\n    scheduleEnd\n    assetCategoryId\n    description\n    customerId\n  }\n"]);return eh=function(){return e},e}var ev=(0,em.Ps)(eh());function ef(){var e=(0,ep.Z)(['\n  query GetCalendarJobs($locationId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        Location: { id: { _eq: $locationId } }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n']);return ef=function(){return e},e}function ex(){var e=(0,ep.Z)(['\n  query GetJobSchedule($jobScheduleId: Int!) {\n    jobSchedule: JobSchedule_by_pk(id: $jobScheduleId) {\n      ...JobScheduleFields\n      assetCategory: AssetCategory {\n        id\n        name\n      }\n      assets: Assets(where: { entity: { _eq: "JobSchedule" } }) {\n        asset: Asset {\n          id\n          name\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      media: Media(where: { entity: { _eq: "JobSchedule" } }) {\n        id\n      }\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        number\n        status\n      }\n    }\n  }\n  ',"\n"]);return ex=function(){return e},e}function eg(){var e=(0,ep.Z)(['\n  query GetJobSchedules(\n    $orderBy: JobSchedule_order_by!\n    $where: JobSchedule_bool_exp!\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(limit: $limit, offset: $offset, where: $where, order_by: [$orderBy]) {\n      ...JobScheduleFields\n      location: Location {\n        id\n        access\n        customer: Account_Locations {\n          account: Account {\n            id\n            managerId\n          }\n        }\n        user: User {\n          id\n          nameLast\n          nameFirst\n        }\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      assetCategory: AssetCategory {\n        id\n        name\n      }\n      assets: Assets {\n        asset: Asset {\n          id\n          name\n        }\n      }\n\n      media: Media(where: { entity: { _eq: "JobSchedule" } }) {\n        id\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        unit\n        vat\n      }\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        number\n        rag\n        title\n        timingStart\n        status\n        statusData\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n    }\n    meta: JobSchedule_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"]);return eg=function(){return e},e}function eb(){var e=(0,ep.Z)(["\n  query GetJobSchedule(\n    $locationId: Int\n    $orderBy: JobSchedule_order_by!\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(\n      where: { locationId: { _eq: $locationId } }\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n    ) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      reference\n      estimatedDuration\n      estimatedDurationUnit\n      dates\n      sublocation: Sublocation {\n        id\n        name\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return eb=function(){return e},e}function ey(){var e=(0,ep.Z)(["\n  mutation CopyScheduleItems(\n    $originLocationId: Int!\n    $copyLocationIds: [Int!]!\n    $selectType: String!\n    $scheduleIds: [Int]\n  ) {\n    copyScheduleItems(\n      originLocationId: $originLocationId\n      copyLocationIds: $copyLocationIds\n      selectType: $selectType\n      scheduleIds: $scheduleIds\n    ) {\n      data\n      success\n    }\n  }\n"]);return ey=function(){return e},e}function ej(){var e=(0,ep.Z)(['\n  query GetJobsListFromSchedule(\n    $jobScheduleId: Int!\n    $supplierId: Int\n    $status: [String]\n    $startDate: timestamptz\n    $endDate: timestamptz\n  ) {\n    jobs: Job(\n      where: {\n        jobScheduleId: { _eq: $jobScheduleId }\n        status: { _in: $status, _neq: "canceled" }\n        timingStart: { _gte: $startDate, _lte: $endDate }\n        _or: [\n          { supplierId: { _eq: $supplierId } }\n          { SupplierOffers: { accountId: { _eq: $supplierId } }, status: { _eq: "offered" } }\n        ]\n      }\n      order_by: { id: asc }\n    ) {\n      id\n      number\n      status\n      description\n      supplier: Supplier {\n        id\n        name\n      }\n    }\n  }\n']);return ej=function(){return e},e}function eZ(){var e=(0,ep.Z)(['\n  query GetJobFromSchedule($jobId: Int!) {\n    job: Job_by_pk(id: $jobId) {\n      id\n      status\n      type\n      description\n      timingStatus\n      correctStart\n      correctEnd\n      timingStart\n      timingEnd\n      scheduledAt\n      number\n      customerVatTotal: customerFinances(path: "amountInfo.vatTotal")\n      arrivalAnytime: meta(path: "arrivalAnytime")\n      supplier: Supplier {\n        id\n        name\n      }\n      supplierUser: SupplierUser {\n        id\n        fullName\n      }\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n        invoiceType\n        createdAt\n        amounts\n        accountEntry: AccountEntry {\n          id\n          meta\n        }\n        reconciledAmount: AccountEntry {\n          reconciliations: InvoiceReconciliations_aggregate {\n            aggregate {\n              sum {\n                amount\n              }\n            }\n          }\n        }\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n      }\n      compliances: Compliances(where: { entity: { _eq: "Job" } }) {\n        id\n      }\n      timings: JobTimings(order_by: { id: desc }) {\n        id\n        status\n        notes\n        meta\n        quoteId\n        createdAt\n        user: User {\n          id\n          fullName\n        }\n      }\n    }\n  }\n']);return eZ=function(){return e},e}function ew(){var e=(0,ep.Z)(["\n  query CountTotalJobs($where: Job_bool_exp) {\n    jobs: Job_aggregate(where: $where) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return ew=function(){return e},e}function eC(){var e=(0,ep.Z)(["\n  query CountTotalJobsList($where: Job_bool_exp, $limit: Int = 50, $offset: Int = 0) {\n    jobs: Job(where: $where, limit: $limit, offset: $offset) {\n      id\n      number\n      title\n      status\n    }\n  }\n"]);return eC=function(){return e},e}function eI(){var e=(0,ep.Z)(['\n  query GetNextJob($locationId: Int, $now: timestamptz!) {\n    nextJob: Job(\n      where: {\n        type: { _eq: "ppm" }\n        status: { _nin: ["closed", "canceled"] }\n        locationId: { _eq: $locationId }\n        timingStart: { _gt: $now }\n      }\n      order_by: { timingStart: asc }\n      limit: 1\n    ) {\n      id\n      number\n      title\n      status\n      scheduledAt\n    }\n  }\n']);return eI=function(){return e},e}function eS(){var e=(0,ep.Z)(['\n  query GetLocationInfo($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      monthlyAmount: meta(path: "monthlyAmount")\n      meta\n      customer: Account_Locations(where: { Account: { type: { _eq: "customer" } } }) {\n        account: Account {\n          id\n          name\n          meta\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, invoice: { _eq: true } }) {\n        id\n        address: Address {\n          id\n          name\n          postCode\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n        }\n      }\n    }\n  }\n']);return eS=function(){return e},e}function e_(){var e=(0,ep.Z)(["\n  mutation AddJobSchedule($objects: [JobSchedule_insert_input!]!) {\n    insert_JobSchedule(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return e_=function(){return e},e}function ek(){var e=(0,ep.Z)(["\n  mutation UpdateJobSchedule($data: jsonb!) {\n    updateJobSchedule(data: $data) {\n      success\n      data\n    }\n  }\n"]);return ek=function(){return e},e}function eD(){var e=(0,ep.Z)(["\n  mutation DeleteJobSchedule($id: Int!) {\n    delete_JobSchedule_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return eD=function(){return e},e}function eq(){var e=(0,ep.Z)(["\n  mutation GeneratePpmJobs($jobScheduleId: Int!) {\n    createPpmJobs(jobScheduleId: $jobScheduleId) {\n      success\n      data\n    }\n  }\n"]);return eq=function(){return e},e}function eP(){var e=(0,ep.Z)(['\n  query GetScheduledJobs($where: Job_bool_exp, $limit: Int, $offset: Int, $orderBy: Job_order_by!) {\n    jobs: Job(where: $where, limit: $limit, offset: $offset, order_by: [$orderBy]) {\n      id\n      number\n      type\n      timingStart\n      createdAt\n      status\n      invoices: Invoices {\n        invoiceNumber\n      }\n      service: Service {\n        name\n      }\n      assetCategory: AssetCategory {\n        id\n        name\n      }\n      assets: Assets {\n        asset: Asset {\n          id\n          name\n        }\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      manager: Manager {\n        id\n        fullName\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      customer: Customer {\n        id\n        name\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: { _and: [{ status: { _eq: "active" } }, { type: { _eq: "tags" } }] }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n    }\n    meta: Job_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return eP=function(){return e},e}function eO(){var e=(0,ep.Z)(['\n  query GetScheduleItemsForCalendar(\n    $locationId: Int\n    $where: JobSchedule_bool_exp!\n    $jobWhere: Job_bool_exp!\n    $offset: Int = 0\n    $limit: Int = 50\n  ) {\n    jobSchedules: JobSchedule(\n      where: $where\n      offset: $offset\n      limit: $limit\n      order_by: { id: desc }\n    ) {\n      id\n      title: meta(path: "$.shortDescriptionName")\n      description: meta(path: "$.description")\n      serviceName: meta(path: "$.serviceName")\n      jobs: Jobs(where: $jobWhere) {\n        id\n        timingStart\n        statusData\n      }\n    }\n    meta: JobSchedule_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return eO=function(){return e},e}function eT(){var e=(0,ep.Z)(['\n  query GetCustomerFinances($locationId: Int!, $limit: Int, $offset: Int) {\n    invoices: AccountEntry(\n      where: { type: { _eq: "customerPpmInvoice" }, locationId: { _eq: $locationId } }\n      offset: $offset\n      limit: $limit\n      order_by: { id: desc }\n    ) {\n      id\n      invoiceNumber\n      debit\n      paymentStatus\n      outstandingAmount\n      outstandingdays\n      meta\n      createdAt\n    }\n    meta: AccountEntry_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return eT=function(){return e},e}function eM(){var e=(0,ep.Z)(["\n  query GetScheduleItemsTotalByJobsForCalendar(\n    $whereComplete: Job_bool_exp!\n    $whereIncomplete: Job_bool_exp!\n    $whereFollowOn: Job_bool_exp!\n    $whereIncompleteCompliance: Job_bool_exp!\n  ) {\n    jobsCompleteCount: Job_aggregate(where: $whereComplete) {\n      aggregate {\n        count\n      }\n    }\n    jobsIncompleteCount: Job_aggregate(where: $whereIncomplete) {\n      aggregate {\n        count\n      }\n    }\n    jobsFollowOnCount: Job_aggregate(where: $whereFollowOn) {\n      aggregate {\n        count\n      }\n    }\n    jobsIncompleteComplianceCount: Job_aggregate(where: $whereIncompleteCompliance) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return eM=function(){return e},e}function eF(){var e=(0,ep.Z)(["\n  query GetScheduleItemsCountTotalForCalendar($where: Job_bool_exp!) {\n    jobs: Job_aggregate(where: $where) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return eF=function(){return e},e}function eA(){var e=(0,ep.Z)(["\n  query GetSupplierForInvoice($supplierId: Int!) {\n    supplier: Account_by_pk(id: $supplierId) {\n      id\n      name\n      vatId\n    }\n  }\n"]);return eA=function(){return e},e}function eE(){var e=(0,ep.Z)(['\n  query GetSupplierPpmInvoices(\n    $jobScheduleId: Int!\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $orderBy: AccountEntry_order_by!\n  ) {\n    invoices: AccountEntry(\n      where: {\n        type: { _eq: "supplierPpmInvoice" }\n        jobScheduleId: { _eq: $jobScheduleId }\n        locationId: { _eq: $locationId }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n    ) {\n      id\n      invoiceNumber\n      invoicedDate\n      debit\n      paymentStatus\n      outstandingAmount\n      outstandingdays\n    }\n    meta: AccountEntry_aggregate(\n      where: {\n        type: { _eq: "supplierPpmInvoice" }\n        jobScheduleId: { _eq: $jobScheduleId }\n        locationId: { _eq: $locationId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return eE=function(){return e},e}function eR(){var e=(0,ep.Z)(["\n  query GetSupplierPpmInvoiceById($id: Int!) {\n    invoice: AccountEntry_by_pk(id: $id) {\n      id\n      invoiceNumber\n      invoicedDate\n      debit\n      paymentStatus\n      outstandingAmount\n      outstandingdays\n      items\n      meta\n      location: Location {\n        id\n        name\n      }\n      account: Account {\n        id\n        name\n        vatId\n      }\n    }\n  }\n"]);return eR=function(){return e},e}function eN(){var e=(0,ep.Z)(["\n  mutation UpsertSupplierPPMInvoice($data: jsonb!) {\n    upsertSupplierPpmInvoice(data: $data) {\n      success\n      data\n    }\n  }\n"]);return eN=function(){return e},e}function eW(){var e=(0,ep.Z)(['\n  query GetJobSchedules(\n    $orderBy: JobSchedule_order_by!\n    $locationId: Int\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(\n      limit: $limit\n      offset: $offset\n      where: { locationId: { _eq: $locationId } }\n      order_by: [$orderBy]\n    ) {\n      ...JobScheduleFields\n      invoicesReceived\n      invoicesPaid\n      jobs: Jobs(where: { status: { _neq: "canceled" } }, order_by: { timingStart: desc }) {\n        id\n        status\n        timingStart\n        statusData\n        supplierGross: supplierFinances(path: "amountInfo.vatTotal")\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"]);return eW=function(){return e},e}function e$(){var e=(0,ep.Z)(["\n  query SupplierInvoiceTotalByMonth(\n    $locationId: Int!\n    $supplierId: Int\n    $startDate: timestamptz!\n    $endDate: timestamptz!\n  ) {\n    items: select_supplier_ppm_invoice_totals_by_month(\n      args: {\n        supplierid: $supplierId\n        locationid: $locationId\n        startdate: $startDate\n        enddate: $endDate\n      }\n      order_by: { month: asc }\n    ) {\n      locationId\n      month\n      totalPaid\n      totalUnpaid\n      totalPartial\n    }\n  }\n"]);return e$=function(){return e},e}function eJ(){var e=(0,ep.Z)(["\n  query CustomerInvoiceTotalByMonth(\n    $locationId: Int!\n    $customerId: Int\n    $startDate: timestamptz!\n    $endDate: timestamptz!\n  ) {\n    items: select_customer_ppm_invoice_totals_by_month(\n      args: {\n        customerid: $customerId\n        locationid: $locationId\n        startdate: $startDate\n        enddate: $endDate\n      }\n      order_by: { month: asc }\n    ) {\n      locationId\n      month\n      totalPaid\n      totalUnpaid\n      totalPartial\n    }\n  }\n"]);return eJ=function(){return e},e}function eL(){var e=(0,ep.Z)(["\n  query GetAccountByLocation($locationId: Int!) {\n    account: Account(where: { Account_Locations: { Location: { id: { _eq: $locationId } } } }) {\n      id\n      name\n    }\n  }\n"]);return eL=function(){return e},e}function eY(){var e=(0,ep.Z)(["\n  mutation UpdateMonthlyAmount($locationId: Int!, $monthlyAmount: numeric!) {\n    ifNull: update_Location(\n      where: { id: { _eq: $locationId }, meta: { _is_null: true } }\n      _set: { meta: {} }\n    ) {\n      affected_rows\n    }\n    update_Location_by_pk(\n      pk_columns: { id: $locationId }\n      _append: { meta: { monthlyAmount: $monthlyAmount } }\n    ) {\n      id\n    }\n  }\n"]);return eY=function(){return e},e}(0,em.Ps)(ef());var eB=(0,em.Ps)(ex(),ev),eH=(0,em.Ps)(eg(),ev),eV=(0,em.Ps)(eb()),eG=(0,em.Ps)(ey()),eQ=(0,em.Ps)(ej()),ez=(0,em.Ps)(eZ()),eU=(0,em.Ps)(ew()),eK=(0,em.Ps)(eC()),eX=(0,em.Ps)(eI()),e0=(0,em.Ps)(eS()),e1=(0,em.Ps)(e_()),e2=(0,em.Ps)(ek()),e5=(0,em.Ps)(eD()),e3=(0,em.Ps)(eq()),e6=(0,em.Ps)(eP()),e4=(0,em.Ps)(eO()),e9=(0,em.Ps)(eT()),e7=(0,em.Ps)(eM());(0,em.Ps)(eF());var e8=(0,em.Ps)(eA()),ne=(0,em.Ps)(eE()),nn=(0,em.Ps)(eR()),nt=(0,em.Ps)(eN()),no=(0,em.Ps)(eW(),ev),nr=(0,em.Ps)(e$()),na=(0,em.Ps)(eJ()),ni=(0,em.Ps)(eL()),nl=(0,em.Ps)(eY()),ns=t(4972),nu=[{label:"All jobs",value:null},{label:"Raised jobs",value:"raised"},{label:"Offered jobs",value:"offered"},{label:"Accepted jobs",value:"accepted"},{label:"In progress jobs",value:"inProgress"},{label:"Completed jobs",value:"completed"},{label:"Report sent jobs",value:"reportSent"},{label:"Follow on jobs",value:"followOn"}],nd=t(11082),nc=t(22595),np=t(35381),nm=t(48218),nh=t(90114),nv=t(98552),nf=function(e){var n,t=e.timings,o=(void 0===t?[]:t).find(function(e){return"reportSentSupplier"===e.status});return o&&"Report Sent by ".concat((null==o?void 0:null===(n=o.user)||void 0===n?void 0:n.fullName)||"")},nx=function(e){var n,t=e.timings,o=void 0===t?[]:t,r=null==o?void 0:o.find(function(e){return"invoiceSent"===e.status});return r&&"Invoice sent by ".concat((null==r?void 0:null===(n=r.user)||void 0===n?void 0:n.fullName)||"")},ng=function(e){var n,t,o,r,a=e.supplier,i=e.supplierUser,l=e.customerVatTotal,s=e.timings,u=void 0===s?[]:s,d=e.timingStatus,c=e.correctStart,p=e.correctEnd,m=e.scheduledAt,h=e.arrivalAnytime,v=e.compliances,f=void 0===v?[]:v,x=e.supplierOffers,g=void 0===x?[]:x,b=e.invoices,j=e.user,Z=(0,eo.x)().hasRole,w=Z("customer"),C=Z("tenant"),I=Z("supplier"),S=null==j?void 0:j.invoiceThreshold,_="onHold"===(0,nm.L)(u),k=(0,nc.E)({timings:u},"accepted"),D=(0,nc.E)({timings:u},"closed"),q="incorrect"===d?p:(0,nc.E)({timings:u},"completed"),P=(0,nc.E)({timings:u},"complianceRejected"),O=(0,nc.E)({timings:u},"complianceApproved"),T=(0,nc.E)({timings:u},"complianceRequestedDocumentation"),M=(0,nc.E)({timings:u},"customerPaid"),F=(null==f?void 0:f.length)>0,A="incorrect"===d?c:(0,nc.E)({timings:u},"inProgress"),E=(0,nc.E)({timings:u},"invoiceSent"),R=(0,nc.E)({timings:u},"offered"),N=(0,nc.E)({timings:u},"pricingChanged"),W=(0,nc.E)({timings:u},"quoteAccepted"),$=(0,nc.E)({timings:u},"rejected"),J=(0,nc.E)({timings:u},"reportSent"),L=(0,nc.E)({timings:u},"reportSentSupplier"),Y=(0,nc.E)({timings:u},"supplierPaid"),B=(0,nc.E)({timings:u},"timingChanged"),H=(0,nc.E)({timings:u},"validated"),V=(0,nc.E)({timings:u},"updateAcceptOfferInput"),G=(0,nc.E)({timings:u},"supplierCancel"),Q=(0,nc.E)({timings:u},"expensesPendingAmount"),z=(0,nc.E)({timings:u},"expensesPendingAmountResolved"),U=m?h?"".concat(y()(m).format("D MMM YYYY")," (anytime)"):y()(m).format("D MMM YYYY HH:mm"):y()(W||k).format("D MMM YYYY HH:mm"),K=g.filter(function(e){return"cancelled"!==e.status}).length,X=(0,nh.Xd)("adminInvoice",u),ee=(0,nh.nN)(["adminUplift","adminInvoice"],u),en=(0,nh.OQ)("adminInvoice",u),et=null==b?void 0:b.filter(function(e){return nv.SR.customer.includes(e.invoiceType)}),er=null==b?void 0:b.filter(function(e){return nv.SR.supplier.includes(e.invoiceType)}),ea=(null==et?void 0:et.reduce(function(e,n){var t,o,r,a;return e+((null==n?void 0:null===(t=n.reconciledAmount)||void 0===t?void 0:null===(o=t.reconciliations)||void 0===o?void 0:null===(r=o.aggregate)||void 0===r?void 0:null===(a=r.sum)||void 0===a?void 0:a.amount)||0)},0))||null,ei=(null==er?void 0:er.reduce(function(e,n){var t,o,r,a;return e+((null==n?void 0:null===(t=n.reconciledAmount)||void 0===t?void 0:null===(o=t.reconciliations)||void 0===o?void 0:null===(r=o.aggregate)||void 0===r?void 0:null===(a=r.sum)||void 0===a?void 0:a.amount)||0)},0))||null,el=(null==et?void 0:et.reduce(function(e,n){var t;return e+((null==n?void 0:null===(t=n.amounts)||void 0===t?void 0:t.vatTotal)||0)},0))||null,es=(null==er?void 0:er.reduce(function(e,n){var t;return e+((null==n?void 0:null===(t=n.amounts)||void 0===t?void 0:t.vatTotal)||0)},0))||null;return[{id:1,label:"Job raised",date:(0,nc.E)({timings:u},["raised","quoteNew"]),content:[{id:1,active:!0,data:"Created By ".concat((null===(n=u[0])||void 0===n?void 0:null===(t=n.user)||void 0===t?void 0:t.fullName)||"")}]},{id:2,label:"Job offered",info:"no assigned suppliers",date:R,content:[{id:1,active:!_&&R&&!A&&!k&&!B&&!N&&g&&g.length>0,data:"Offered to ".concat(K," suppliers")},{id:2,active:!_&&$,data:"Job rejected by supplier"}]},{id:3,label:"Accepted",info:"waiting for supplier to accept",date:(0,nc.E)({timings:u},"accepted"),content:[{id:1,active:(k||W||B||N)&&a&&!w&&!C,data:"Assigned to ".concat(null==a?void 0:a.name)},{id:2,active:(k||W)&&i&&!w&&!C,data:"Operative: ".concat(null==i?void 0:i.fullName)},{id:3,active:k||W,data:"Arrival time: ".concat(U)},{id:4,active:B&&!k&&a,data:"Job timing has changed, supplier needs to Accept the job again and set new\n          attendance time"},{id:5,active:N&&!k&&a,data:"Job service or pricing has changed, supplier needs to Accept the job again and\n          confirm attendance and operative"},{id:6,active:V,data:"Attendance and operative has changed by ".concat((0,np.j$)({timings:u},"updateAcceptOfferInput"))},{id:7,active:G,data:"Job canceled by ".concat((0,np.j$)({timings:u},"supplierCancel"))},{id:8,active:!0}]},{id:4,label:"In progress",info:"waiting for supplier to start",date:A},{id:7,label:"Complete",info:"waiting for supplier to complete",date:q},{id:8,label:"Report sent",info:"after job complete",date:J,content:[{id:1,active:L,data:"Report submitted by supplier"},{id:2,active:!0,data:nf({timings:u})}]},{id:9,label:"Customer Sign Off",info:"",date:F&&(O||P),active:F,content:[{id:1,active:O,data:"Compliance sing off by ".concat((0,np.j$)({timings:u},"complianceApproved"))},{id:2,active:P,data:"Compliance rejected by ".concat((0,np.j$)({timings:u},"complianceRejected"))},{id:3,active:!_&&F&&T&&!(O||P)}]},{id:10,label:"Threshold approval",info:"",date:(null==ee?void 0:ee.createdAt)||(null==en?void 0:en.createdAt),active:!!(X||ee||en),content:[{id:1,active:X&&!ee&&!en,data:"Awaiting threshold approval"},{id:2,active:ee,data:"Threshold approved by ".concat(null==ee?void 0:null===(o=ee.user)||void 0===o?void 0:o.fullName)},{id:3,active:en,data:"Threshold rejected by ".concat(null==en?void 0:null===(r=en.user)||void 0===r?void 0:r.fullName)},{id:4,active:!_&&X&&(0,np.il)(S,l||0)}]},{id:11,label:"Awaiting expenses pricing",info:"",date:z,active:!!(Q||z)},{id:12,label:"Invoices sent",info:"after validation",date:E,content:[{id:1,active:H,data:"Job validated"},{id:2,active:!0,data:nx({timings:u})}]},{id:13,label:"Customer ".concat(M?"paid":ea>0?"partially paid":"not paid"),date:M,active:!I,content:[{id:1,active:!M&&ea,data:"Reconciled amount ".concat((0,nd.Z)(ea))},{id:2,active:!M&&ea,data:"Amount outstanding ".concat((0,nd.Z)(el))}]},{id:14,label:"Supplier ".concat(Y?"paid":ei>0?"partially paid":"not paid"),date:Y,active:!w&&!C,content:[{id:1,active:!Y&&ei,data:"Reconciled amount ".concat((0,nd.Z)(ei))},{id:2,active:!Y&&ei,data:"Amount outstanding ".concat((0,nd.Z)(es))}]},{id:15,label:"Closed",info:"automatically after steps complete",date:D}]},nb=t(93884),ny=t(38736),nj={wrapper:{marginBottom:"10px"},subtitle:{fontWeight:"300"},title:{fontWeight:"500"},selector:function(e){return{width:e?"100%":"300px"}},jobCountLabel:{fontWeight:"300"},accordion:{borderTop:"0px",boxShadow:"none"},jobNumber:function(e,n){return{color:e,backgroundColor:n,width:"67px",cursor:"pointer",padding:"0 10px",borderRadius:"5px"}}},nZ=function(e){var n,t,o,r=e.jobScheduleId,a=e.status,d=e.startDate,c=e.endDate,p=e.onClose,m=e.hideFilters,h=(0,eo.x)().hasRole,v=h("supplier"),x=h("customer"),g=h("tenant"),b=(0,s.useState)(null),w=b[0],C=b[1],_=(0,s.useState)(a),D=_[0],P=_[1],O=(0,s.useState)(null),T=O[0],M=O[1],F=(0,H.Z)("(max-width: 600px)"),A=(0,eo.x)().user,E=(0,V.useRouter)().query,R=(0,j.a)(eQ,{variables:{jobScheduleId:r,supplierId:null==T?void 0:T.value,status:D||a,startDate:d,endDate:c}}),N=R.data,G=(void 0===N?{jobs:[]}:N).jobs,z=R.loading;(0,s.useEffect)(function(){E.scheduledTab||p()},[null==E?void 0:E.scheduledTab,p]);var U=(0,j.a)(ez,{skip:!w,variables:{jobId:null==w?void 0:w.id}}),K=U.data,ee=(void 0===K?{job:{}}:K).job,en=U.loading,er=(0,f.Z)((0,Z.t)(ns.by,{variables:{where:{type:{_eq:"supplier"}}}}),2),ea=er[0],el=er[1],es=el.loading,eu=el.data,ep=(void 0===eu?{items:[]}:eu).items,em=(0,s.useMemo)(function(){return{title:"No ppm jobs found",subtitleFirstLine:"Jobs for applied filters was not found or wasn`t created",subtitleSecondLine:"Please click Create jobs on PPM item or amend filters"}},[]),eh=G.length,ev=(0,s.useCallback)(function(e){return null==e?void 0:e.reduce(function(e,n){var t=nu.find(function(e){return e.value===n});return t?(0,$.Z)(e).concat([{value:n,label:t.label}]):e},[])},[]);return z?(0,l.jsx)(u.Z,{height:"100%",justifyContent:"center",alignItems:"center",children:(0,l.jsx)(q.Z,{color:"secondary"})}):(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(u.Z,{direction:F?"column":"row",alignItems:F?"space-between":"flex-end",spacing:1,children:[!m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ed.q,{multiple:!0,limitTags:1,value:ev(D)||[],sx:nj.selector(F),onChange:function(e,n){n.length?P((0,$.Z)(n.map(function(e){return e.value}))):P(a)},textFieldProps:{color:"secondary",variant:"standard",label:"Select status"},options:nu}),!v&&!x&&!g&&(0,l.jsx)(ed.q,{value:T,sx:nj.selector(F),onChange:function(e,n){return M(n)},textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"},loading:es,onOpen:function(){return ea()},options:ep})]}),(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:nj.jobCountLabel,mt:F?2:0,children:["Item has ",eh," scheduled jobs"]})]}),(null==G?void 0:G.length)?(0,l.jsxs)(J.ZP,{container:!0,mt:3,children:[(0,l.jsx)(J.ZP,{item:!0,xs:12,md:5,lg:5,sx:{height:F?"auto":"750px",padding:"15px 10px",overflow:"scroll"},children:(0,l.jsx)(u.Z,{rowGap:2,children:null==G?void 0:G.map(function(e){var n,t;return(0,l.jsx)(ei,{id:e.id,number:e.number,status:e.status,description:e.description,supplierId:null===(n=e.supplier)||void 0===n?void 0:n.id,supplierName:null===(t=e.supplier)||void 0===t?void 0:t.name,onSelectJob:C,selected:(null==w?void 0:w.id)===e.id,onClose:p})})})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,md:6,lg:6,ml:3,children:w&&!en&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(u.Z,{sx:nj.wrapper,spacing:1,children:[(0,l.jsx)(W.r,{href:"/dashboard/issues/view?id=".concat(null==w?void 0:w.number),children:(0,l.jsx)(k.Z,{color:(0,X.b)(ee.status),variant:"contained",size:"small",endIcon:(0,l.jsx)(ny.Z,{}),children:ee.number})}),(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(S.Z,{typography:"subtitle2",sx:nj.subtitle,children:"Description"}),(0,l.jsx)(et.O,{maxLength:40,sx:{wordBreak:"break-all"},children:ee.description})]}),!x&&!g&&(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(S.Z,{typography:"subtitle2",sx:nj.subtitle,children:"Supplier"}),(0,l.jsx)(S.Z,{typography:"subtitle2",children:(0,l.jsx)(W.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(null===(n=ee.supplier)||void 0===n?void 0:n.id),noWrap:!(null===(t=ee.supplier)||void 0===t?void 0:t.id)||v,fontSize:"12px",children:(null===(o=ee.supplier)||void 0===o?void 0:o.name)||"-"})})]}),(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(S.Z,{typography:"subtitle2",sx:nj.subtitle,children:"Scheduled start"}),(0,l.jsx)(S.Z,{typography:"subtitle2",children:ee.timingStart?y()(ee.timingStart).format("D MMM YYYY HH:mm"):"-"})]}),(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(S.Z,{typography:"subtitle2",sx:nj.subtitle,children:"Scheduled End"}),(0,l.jsx)(S.Z,{typography:"subtitle2",children:ee.timingEnd?y()(ee.timingEnd).format("D MMM YYYY HH:mm"):"-"})]}),(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(S.Z,{typography:"subtitle2",sx:nj.subtitle,children:"Supplier arrival"}),(0,l.jsx)(S.Z,{typography:"subtitle2",children:ee.scheduledAt?"".concat(y()(ee.scheduledAt).format("D MMM YYYY")," ").concat(ee.arrivalAnytime?"(anytime)":""):"-"})]})]}),(0,l.jsxs)(L.Z,{sx:nj.accordion,expanded:!0,children:[(0,l.jsx)(Y.Z,{children:(0,l.jsxs)(u.Z,{direction:"row",spacing:3,children:[(0,l.jsx)(S.Z,{variant:"h6",children:"Workflow"}),(0,l.jsx)(ec.B,{value:ee.status})]})}),(0,l.jsx)(B.Z,{children:(0,l.jsx)(Q.v,{steps:ng({supplier:ee.supplier,supplierUser:ee.supplierUser,customerVatTotal:ee.customerVatTotal,timings:ee.timings,timingStatus:ee.timingStatus,correctStart:ee.correctStart,correctEnd:ee.correctEnd,scheduledAt:ee.scheduledAt,arrivalAnytime:ee.arrivalAnytime,compliances:ee.compliances,supplierOffers:ee.supplierOffers,invoices:ee.invoices,user:A})})})]})]})})]}):(0,l.jsx)(I.Z,{p:3,children:(0,l.jsx)(nb.C,(0,i.Z)({imageSrc:"/static/icons/no_locations_found.svg"},em))})]})};nZ.propTypes={jobScheduleId:g().string.isRequired,status:g().array,startDate:g().string,endDate:g().string,onClose:g().func.isRequired,hideFilters:g().bool};var nw=t(23776),nC=t(50135),nI=t(22961),nS=[{name:"setLocation",hasRequiredFields:!0,requiredFields:function(){return["location"]},value:1},{name:"workDescription",hasRequiredFields:!0,requiredFields:function(){return["shortDescription","description","estimatedDuration","estimatedDurationUnit"]},value:2},{name:"selectService",hasRequiredFields:!0,requiredFields:function(){return["costCategory","service","supplier"]},value:3},{name:"setSchedule",hasRequiredFields:!0,requiredFields:function(){return["frequency","frequencyDescription"]},value:4},{name:"invoicing",hasRequiredFields:!0,requiredFields:function(e){return"onCompletion"===e.invoicingBasis?["costCustomer","costSupplier"]:["customerMonthlyCharge","supplierMonthlyCharge","firstInvoiceDate","finalInvoiceDate"]},value:5}],n_=function(e){switch(e){case"raised":return{backgroundColor:"rgb(249, 156, 35)",color:"#ffffff"};case"offered":return{backgroundColor:"rgb(230, 8, 17)",color:"#ffffff"};case"accepted":return{backgroundColor:"rgb(0, 180, 60)",color:"#ffffff"};case"inProgress":return{backgroundColor:"rgb(0, 204, 188)",color:"#ffffff"};case"completed":return{backgroundColor:"rgb(217, 217, 217)",color:"#000000"};case"reportSent":return{backgroundColor:"rgb(153, 153, 153)",color:"#000000"};default:return{backgroundColor:"#C1C1C1",color:"#000000"}}},nk={subtitle:{color:"#323E4E",fontWeight:"300"},statusSquaredIcon:function(e,n,t){return{backgroundColor:n,color:e,borderRadius:"5px",height:"30px","& .Mui-disabled":{backgroundColor:"".concat(n,"!important"),opacity:.5},"&:hover":{opacity:.8,backgroundColor:n}}},selectStatusAutocomplete:function(e,n){return{width:"170px","& .MuiInputBase-root":{border:"0px!important solid transparent",backgroundColor:"".concat(n,"!important"),padding:"3px!important",color:"".concat(e,"!important"),"-webkit-text-fill-color":"".concat(e,"!important"),input:{padding:"3px!important"},svg:{color:"".concat(e,"!important")}},"& .Mui-disabled":{opacity:.5}}}},nD=function(e){var n,t,o,r,a,d=e.row,c=e.handleOpenJobsFromSchedule,p=e.sessionData,m=e.saveSessionData,h=(0,s.useState)(null!=p?p:nu[0]),v=h[0],f=h[1],x=n_(null==v?void 0:v.value),g=x.color,b=x.backgroundColor;return(0,l.jsxs)(u.Z,{columnGap:1,children:[!!(null===(n=d.jobs)||void 0===n?void 0:n.length)&&(0,l.jsx)(S.Z,{typography:"subtitle1",children:"".concat(null===(t=d.jobs)||void 0===t?void 0:t.length," Jobs ").concat(d.completeCount," completed")}),(0,l.jsx)(S.Z,{typography:"subtitle2",sx:nk.subtitle,children:"Check a status of selected job"}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",columnGap:1,children:[(0,l.jsx)(nw.Z,{disableClearable:!0,disabled:!(null==d?void 0:null===(o=d.jobs)||void 0===o?void 0:o.length),sx:nk.selectStatusAutocomplete(g,b),value:v,onChange:function(e,n){e.stopPropagation(),m(d.id,n),f(n)},options:nu,renderInput:function(e){return(0,l.jsx)(nC.Z,(0,i.Z)({},e))}}),(0,l.jsx)(_.Z,{disabled:!(null==d?void 0:null===(r=d.jobs)||void 0===r?void 0:r.length),sx:nk.statusSquaredIcon(g,b),onClick:function(e){var n,t;e.stopPropagation(),c({jobScheduleId:d.id,jobStatus:v.value,description:d.shortDescription.label,totalJobCount:null!==(t=null===(n=d.jobs)||void 0===n?void 0:n.length)&&void 0!==t?t:0})},children:(0,l.jsx)(nI.Z,{sx:{color:g,opacity:(null==d?void 0:null===(a=d.jobs)||void 0===a?void 0:a.length)?1:.5}})})]})]})},nq=t(47568),nP=t(97582),nO=t(42283),nT=t(79665),nM=t(69368),nF=t(15033),nA=t(20705),nE=t(74231),nR=nE.Ry({locations:nE.IX().of(nE.Ry({value:nE.Rx().integer().required(),label:nE.Z_().required()}).required()).min(1).required()}),nN=nE.Ry().shape({location:nE.Ry().required(),sublocation:nE.Ry().nullable(),assetCategory:nE.Ry().nullable(),assets:nE.IX().nullable(),shortDescription:nE.Ry().required(),reference:nE.Z_().nullable(),description:nE.Z_().required(),estimatedDuration:nE.Rx().min(0).required(),estimatedDurationUnit:nE.Z_().oneOf(["hours","minutes","days"]).required(),compliance:nE.O7().nullable(),complianceSelect:nE.Ry().nullable(),costCategory:nE.Ry().required(),service:nE.Ry().required(),supplier:nE.Ry().required(),frequencyDescription:nE.Z_().nullable(),frequency:nE.Z_().required(),costCustomer:nE.Rx().transform(function(e){return isNaN(e)?null:e}).nullable(),costSupplier:nE.Rx().transform(function(e){return isNaN(e)?null:e}).nullable(),firstInvoiceDate:nE.hT().nullable(),finalInvoiceDate:nE.hT().nullable(),customerMonthlyCharge:nE.Rx().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierMonthlyCharge:nE.Rx().transform(function(e){return isNaN(e)?null:e}).nullable()}),nW=nE.Ry().shape({reference:nE.Z_(),description:nE.Z_().required(),dueDate:nE.hT().when("$isSupplier",{is:!0,then:nE.hT().nullable()}),supplier:nE.Ry().when("$isSupplier",{is:!0,then:nE.Ry().nullable(),otherwise:nE.Ry().required()})}),n$=nE.Ry().shape({description:nE.Z_().required(),rate:nE.Rx().min(0).required(),quantity:nE.Rx().integer().min(0).required(),vatType:nE.Z_().oneOf(["default","custom"]).required(),vatPercentage:nE.Rx().min(0).required()}),nJ=t(39641),nL={item:"createdAt",order:"asc"},nY=function(e){var n,t=e.locationId,o=(0,nJ.D)(),r=(0,(0,eo.x)().hasRole)("admin"),a=(0,s.useState)("selectAll"),c=a[0],p=a[1],m=(0,s.useState)([]),h=m[0],x=m[1],g=(0,s.useState)(""),b=g[0],y=g[1],Z=(0,nA.x)({initialSort:nL}),C=Z.initialData,I=Z.ref,_=(0,nO.cI)({defaultValues:{locations:[]},resolver:(0,nT.S)(nR)}),k=_.handleSubmit,P=_.control,O=_.errors,T=(0,f.Z)((0,w.D)(eG,{onCompleted:function(){o.show({content:"Success. This planned maintenance schedule\n        has been copied to the selected locations.\n        Please note that you will still need to click on the relevant\n        item in the location to create the individual jobs."})},onError:function(e){o.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),M=T[0],F=T[1].loading,A=(0,j.a)(eV,{variables:(0,v.Z)((0,i.Z)({},C),{locationId:t})}),E=A.data,R=void 0===E?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:E,N=R.jobSchedule,W=R.meta,L=A.loading,Y=A.refetch,B=(0,j.a)(ns._d,{variables:{where:{status:{_eq:"active"},name:{_ilike:""!==b?"%".concat(b,"%"):null}},limit:50,offset:0}}),H=B.loading,V=B.data,G=(void 0===V?{items:[]}:V).items,Q=function(e){var n=e.row;return"selectAll"===c||"excludeAll"!==c&&("selectSome"===c?h.includes(n.id):"excludeSome"===c&&!h.includes(n.id))},z=function(e){var n=e.row;return function(e,t){var o=h.includes(n.id)&&1===h.length;return"selectAll"!==c&&"excludeSome"!==c||t?"excludeSome"===c&&t?(o&&p("selectAll"),x(function(e){return e.filter(function(e){return e!==n.id})})):("excludeAll"===c||"selectSome"===c)&&t?(p("selectSome"),x(function(e){return(0,$.Z)(e).concat([n.id])})):"selectSome"!==c||t?void 0:(o&&p("excludeAll"),x(function(e){return e.filter(function(e){return e!==n.id})})):(p("excludeSome"),x(function(e){return(0,$.Z)(e).concat([n.id])}))}},U=N.map(function(e,n){return{index:n,id:e.id,title:e.meta.shortDescriptionName,description:e.meta.description,sublocation:e.sublocation,service:e.meta.serviceName,supplier:e.meta.supplierName,frequencyDescription:e.frequencyDescription}}),K=(n=(0,nq.Z)(function(e){return(0,nP.__generator)(this,function(n){switch(n.label){case 0:if("excludeAll"===c)return[2];return[4,M({variables:{originLocationId:t,copyLocationIds:e.locations.map(function(e){return e.value}),selectType:c,scheduleIds:h}})];case 1:return n.sent(),[2]}})}),function(e){return n.apply(this,arguments)}),X=(0,s.useMemo)(function(){return G.map(function(e){var n,t,o=null===(n=e.registeredAddress)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.address;return{label:"".concat(e.label,", ").concat((null==o?void 0:o.addressLine1)||""),value:e.value}})},[G]);return(0,l.jsxs)("form",{id:"offCanvasForm",onSubmit:k(K),children:[F&&(0,l.jsx)(D.Z,{sx:{zIndex:1e5},open:!0,children:(0,l.jsx)(q.Z,{color:"secondary"})}),(0,l.jsxs)(J.ZP,{container:!0,rowSpacing:4,children:[(0,l.jsx)(J.ZP,{item:!0,xs:12,children:(0,l.jsx)(nO.Qr,{name:"locations",control:P,render:function(e){var n,t=e.value,o=e.onChange;return(0,l.jsx)(ed.q,{multiple:!0,limitTags:6,color:"secondary",filterSelectedOptions:!0,loading:H,value:t||[],onChange:function(e,n){o(n)},options:X,setSearch:y,textFieldProps:{label:"Select locations",variant:"standard",color:"secondary",error:O.locations,helperText:null===(n=O.locations)||void 0===n?void 0:n.message}})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,children:(0,l.jsx)(d.Z,{elevation:5,sx:{pb:1},children:(0,l.jsx)(nF.i,{paginationSize:10,ref:I,getRowHeight:function(e){return e.model.sublocation?72:52},getRowClassName:function(e){return e.row.index%2==0?"even":"odd"},loading:L,columns:[{width:50,field:"select",sortable:!1,renderHeader:function(){return(0,l.jsx)(nM.Z,{color:"secondary",checked:"selectAll"===c,onChange:function(e,n){n?(p("selectAll"),x([])):(p("excludeAll"),x([]))}})},renderCell:function(e){var n=e.row;return(0,l.jsx)(nM.Z,{color:"secondary",checked:Q({row:n}),onChange:z({row:n})})}},{minWidth:40,width:40,field:"index",headerName:"Id",sortable:!1,renderCell:function(e){return e.row.index+1+C.offset}},{flex:1,field:"job",headerName:"Job",sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(S.Z,{fontWeight:700,children:n.title}),(0,l.jsx)(S.Z,{children:n.description}),n.sublocation&&(0,l.jsxs)(u.Z,{direction:"row",spacing:1,children:[(0,l.jsx)(S.Z,{fontWeight:700,children:"Sublocation:"}),(0,l.jsxs)(S.Z,{children:[" ",n.sublocation.name]})]})]})}},{flex:1,field:"service",headerName:"Service",sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(S.Z,{children:n.service}),r&&(0,l.jsxs)(S.Z,{children:["Assigned to: ",n.supplier]})]})}},{flex:1,field:"frequencyDescription",headerName:"Frequency",sortable:!1}],rows:U,meta:W,refetch:Y})})})]})]})};nY.defaultProps={},nY.propTypes={locationId:g().number.isRequired};var nB=t(60888),nH=t(50480),nV=t(21023),nG=t(87109),nQ=t(36872),nz=t(33754),nU=t(53485),nK=t(36968),nX=t.n(nK),n0=t(81836),n1=function(e){var n=e.onDate.date;return y().isMoment(y()(n))||(n=new Date().setMilliseconds(0)),{dtstart:y()(n).toDate()}},n2=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n5=function(e){var n={};switch(e.which){case"First":n.bysetpos=1;break;case"Second":n.bysetpos=2;break;case"Third":n.bysetpos=3;break;case"Fourth":n.bysetpos=4;break;case"Last":n.bysetpos=-1}switch(e.day){case"Monday":n.byweekday=[0];break;case"Tuesday":n.byweekday=[1];break;case"Wednesday":n.byweekday=[2];break;case"Thursday":n.byweekday=[3];break;case"Friday":n.byweekday=[4];break;case"Saturday":n.byweekday=[5];break;case"Sunday":n.byweekday=[6];break;case"Day":n.byweekday=[0,1,2,3,4,5,6];break;case"Weekday":n.byweekday=[0,1,2,3,4];break;case"Weekend day":n.byweekday=[5,6]}return n.bymonth=n2.indexOf(e.month)+1,n},n3=function(e){var n,t=e.mode,o=e.on,r=e.onThe;switch(e.excludingWeekends,t){case"on":return(0,i.Z)({freq:n0.Ci.YEARLY},(n=o,{bymonth:n2.indexOf(n.month)+1,bymonthday:n.day}));case"anyTimeOption":return{freq:n0.Ci.YEARLY};default:return(0,i.Z)({freq:n0.Ci.YEARLY},n5(r))}},n6=function(e){var n={};switch(e.which){case"First":n.bysetpos=1;break;case"Second":n.bysetpos=2;break;case"Third":n.bysetpos=3;break;case"Fourth":n.bysetpos=4;break;case"Last":n.bysetpos=-1}switch(e.day){case"Monday":n.byweekday=[0];break;case"Tuesday":n.byweekday=[1];break;case"Wednesday":n.byweekday=[2];break;case"Thursday":n.byweekday=[3];break;case"Friday":n.byweekday=[4];break;case"Saturday":n.byweekday=[5];break;case"Sunday":n.byweekday=[6];break;case"Day":n.byweekday=[0,1,2,3,4,5,6];break;case"Weekday":n.byweekday=[0,1,2,3,4];break;case"Weekend day":n.byweekday=[5,6]}return n},n4=function(e){var n,t=e.mode,o=e.interval,r=e.on,a=e.onThe,l=e.excludingWeekends;switch(t){case"on":return(0,i.Z)({freq:n0.Ci.MONTHLY,interval:o},(n=r,{bymonthday:n.day}));case"anyTimeOption":return(0,i.Z)({freq:n0.Ci.MONTHLY,interval:o},l&&{byweekday:[n0.Ci.MO,n0.Ci.TU,n0.Ci.WE,n0.Ci.TH,n0.Ci.FR],bysetpos:[1]},!l&&{bymonthday:[1]});default:return(0,i.Z)({freq:n0.Ci.MONTHLY,interval:o},n6(a))}},n9=t(52628),n7=t.n(n9),n8=function(e){var n=e.mode,t=e.interval,o=e.days,r=e.excludingWeekends;return"anyTimeOption"===n?(0,i.Z)({freq:n0.Ci.WEEKLY,interval:t,bysetpos:[1]},r&&{byweekday:[n0.Ci.MO,n0.Ci.TU,n0.Ci.WE,n0.Ci.TH,n0.Ci.FR]},!r&&{byweekday:[n0.Ci.MO,n0.Ci.TU,n0.Ci.WE,n0.Ci.TH,n0.Ci.FR,n0.Ci.SA,n0.Ci.SU]}):(0,i.Z)({freq:n0.Ci.WEEKLY,interval:t,byweekday:n7()(o).reduce(function(e,n,t){return n?(0,$.Z)(e).concat([t]):e},[])},r&&{byweekday:[n0.Ci.MO,n0.Ci.TU,n0.Ci.WE,n0.Ci.TH,n0.Ci.FR],bysetpos:[1]})},te=function(e){var n=e.interval;return e.excludingWeekends,{freq:n0.Ci.DAILY,interval:n}},tn=function(e){var n=e.interval,t=e.excludingWeekends;return(0,i.Z)({freq:n0.Ci.HOURLY,interval:n},t&&{byweekday:[n0.Ci.MO,n0.Ci.TU,n0.Ci.WE,n0.Ci.TH,n0.Ci.FR],bysetpos:[1]})},tt=function(e){var n=e.frequency,t=e.yearly,o=e.monthly,r=e.weekly,a=e.daily,i=e.hourly;switch(n){case"Yearly":return n3(t);case"Monthly":return n4(o);case"Weekly":return n8(r);case"Daily":return te(a);case"Hourly":return tn(i);default:return{}}},to=function(e){var n=e.mode,t=e.after,o=e.onDate.date,r={};return"After"===n&&(r.count=t),"On date"===n&&(r.until=y()(o).toDate()),r},tr=function(e){var n=e.hideStart,t=e.weekStartsOnSunday,o={};return n&&(o.dtstart=null),t&&(o.wkst=n0.Ci.SU),o},ta=function(e){var n=e.start,t=e.repeat,o=e.end,r=e.options,a=(0,i.Z)({},n1(n),tt(t),to(o),tr(r)),l=new n0.Ci(a);return{rruleString:l.toString(),rruleText:l.toText()}},ti=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.start)||void 0===o?void 0:null===(r=o.onDate)||void 0===r?void 0:r.date)?t.start.onDate.date:n.dtstart?n.dtstart:e.start.onDate.date},tl=function(e,n,t){var o;if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:o.frequency)return t.repeat.frequency;switch(n.freq){case 0:return"Yearly";case 1:return"Monthly";case 2:return"Weekly";case 3:return"Daily";case 4:return"Hourly";default:return e.repeat.frequency}},ts=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:r.mode)?t.repeat.yearly.mode:0===n.freq&&n.bymonth?n.bymonthday?"on":"on the":e.repeat.yearly.mode},tu=function(e,n,t){var o,r,a;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.on)||void 0===a?void 0:a.month)?t.repeat.yearly.on.month:0===n.freq&&n.bymonthday&&"number"==typeof n.bymonth?n2[n.bymonth-1]:e.repeat.yearly.on.month},td=function(e,n,t){var o,r,a;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.on)||void 0===a?void 0:a.day)?t.repeat.yearly.on.day:0===n.freq&&n.bymonthday&&"number"==typeof n.bymonthday?n.bymonthday:e.repeat.yearly.on.day},tc=function(e,n,t){var o,r,a,i;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.month)?t.repeat.yearly.onThe.month:0===n.freq&&n.byweekday?"number"==typeof n.bymonth?n2[n.bymonth-1]:(null===(i=n.bymonth)||void 0===i?void 0:i[0])?n2[n.bymonth[0]-1]:e.repeat.yearly.onThe.month:e.repeat.yearly.onThe.month},tp=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.day)return t.repeat.yearly.onThe.day;if(0!==n.freq||!n.byweekday)return e.repeat.yearly.onThe.day;var o,r,a,i=n.byweekday.map(function(e){return e.weekday}).join(",");switch(i){case"0":return"Monday";case"1":return"Tuesday";case"2":return"Wednesday";case"3":return"Thursday";case"4":return"Friday";case"5":return"Saturday";case"6":return"Sunday";case"0,1,2,3,4,5,6":return"Day";case"0,1,2,3,4":return"Weekday";case"5,6":return"Weekend day";default:return e.repeat.yearly.onThe.day}},tm=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.which)return t.repeat.yearly.onThe.which;if(0!==n.freq||!n.byweekday)return e.repeat.yearly.onThe.which;var o,r,a,i="number"==typeof n.bysetpos?n.bysetpos:n.bysetpos[0];switch(i){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case -1:return"Last";default:return e.repeat.yearly.onThe.which}},th=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:r.mode)?t.repeat.monthly.mode:1!==n.freq?e.repeat.monthly.mode:n.bymonthday?"on":"on the"},tv=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:r.interval)?t.repeat.monthly.interval:1!==n.freq?e.repeat.monthly.interval:n.interval},tf=function(e,n,t){var o,r,a;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:null===(a=r.on)||void 0===a?void 0:a.day)?t.repeat.monthly.on.day:1===n.freq&&n.bymonthday?"number"==typeof n.bymonthday?n.bymonthday:n.bymonthday[0]:e.repeat.monthly.on.day},tx=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.day)return t.repeat.monthly.onThe.day;if(1!==n.freq||!n.byweekday)return e.repeat.monthly.onThe.day;var o,r,a,i=n.byweekday.map(function(e){return e.weekday}).join(",");switch(i){case"0":return"Monday";case"1":return"Tuesday";case"2":return"Wednesday";case"3":return"Thursday";case"4":return"Friday";case"5":return"Saturday";case"6":return"Sunday";case"0,1,2,3,4,5,6":return"Day";case"0,1,2,3,4":return"Weekday";case"5,6":return"Weekend day";default:return e.repeat.monthly.onThe.day}},tg=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.which)return t.repeat.monthly.onThe.which;if(1!==n.freq||!n.bysetpos)return e.repeat.monthly.onThe.which;var o,r,a,i="number"==typeof n.bysetpos?n.bysetpos:n.bysetpos[0];switch(i){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case -1:return"Last";default:return e.repeat.monthly.onThe.which}},tb=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.weekly)||void 0===r?void 0:r.interval)?t.repeat.weekly.interval:2!==n.freq?e.repeat.weekly.interval:n.interval},ty=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.weekly)||void 0===r?void 0:r.days)return t.repeat.weekly.days;var o,r,a=[];return 2!==n.freq?e.repeat.weekly.days:(n.byweekday&&(a=n.byweekday.map(function(e){return e.weekday})),{mon:a.includes(0),tue:a.includes(1),wed:a.includes(2),thu:a.includes(3),fri:a.includes(4),sat:a.includes(5),sun:a.includes(6)})},tj=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.weekly)||void 0===r?void 0:r.weekStartsOnSunday)?t.repeat.weekly.weekStartsOnSunday:n.wkst?6===n.wkst:e.repeat.weekly.options.weekStartsOnSunday},tZ=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.daily)||void 0===r?void 0:r.interval)?t.repeat.daily.interval:3!==n.freq?e.repeat.daily.interval:n.interval},tw=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.hourly)||void 0===r?void 0:r.interval)?t.repeat.hourly.interval:4!==n.freq?e.repeat.daily.interval:n.interval},tC=function(e,n,t){var o;return(null==t?void 0:null===(o=t.end)||void 0===o?void 0:o.after)?t.end.after:n.count||0===n.count?n.count:e.end.after},tI=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.end)||void 0===o?void 0:null===(r=o.onDate)||void 0===r?void 0:r.date)?t.end.onDate.date:n.end.onDate.date?n.end.onDate.date:e.end.onDate.date},tS=function(e,n,t){if(!n&&!t)return e;try{var o,r,a,l,s,u,d,c,p,m,h,f,x,g,b,j,Z,w,C,I,S,_,k,D,q,P,O,T,M,F,A,E,R,N,W,$,J,L,Y,B,H,V,G,Q,z,U=(0,n0.SA)(n).origOptions;o=(0,v.Z)((0,i.Z)({},e),{start:(0,v.Z)((0,i.Z)({},e.start),{onDate:{date:y()(ti(e,U,t)),options:(0,v.Z)((0,i.Z)({},e.start.onDate.options),{weekStartsOnSunday:tj(e,U,t)})}}),repeat:(0,v.Z)((0,i.Z)({},e.repeat),{frequency:tl(e,U,t),yearly:(0,v.Z)((0,i.Z)({},e.repeat.yearly),{mode:ts(e,U,t),excludingWeekends:null==t?void 0:null===(r=t.repeat)||void 0===r?void 0:null===(a=r.yearly)||void 0===a?void 0:a.excludingWeekends,hourStart:(null==t?void 0:null===(l=t.repeat)||void 0===l?void 0:null===(s=l.yearly)||void 0===s?void 0:s.hourStart)?new Date(null==t?void 0:null===(u=t.repeat)||void 0===u?void 0:null===(d=u.yearly)||void 0===d?void 0:d.hourStart):null,hourEnd:(null==t?void 0:null===(c=t.repeat)||void 0===c?void 0:null===(p=c.yearly)||void 0===p?void 0:p.hourEnd)?new Date(null==t?void 0:null===(m=t.repeat)||void 0===m?void 0:null===(h=m.yearly)||void 0===h?void 0:h.hourEnd):null,on:{month:tu(e,U,t),day:td(e,U,t)},onThe:{month:tc(e,U,t),day:tp(e,U,t),which:tm(e,U,t)}}),monthly:(0,v.Z)((0,i.Z)({},e.repeat.monthly),{mode:th(e,U,t),excludingWeekends:null==t?void 0:null===(f=t.repeat)||void 0===f?void 0:null===(x=f.monthly)||void 0===x?void 0:x.excludingWeekends,hourStart:(null==t?void 0:null===(g=t.repeat)||void 0===g?void 0:null===(b=g.monthly)||void 0===b?void 0:b.hourStart)?new Date(null==t?void 0:null===(j=t.repeat)||void 0===j?void 0:null===(Z=j.monthly)||void 0===Z?void 0:Z.hourStart):null,hourEnd:(null==t?void 0:null===(w=t.repeat)||void 0===w?void 0:null===(C=w.monthly)||void 0===C?void 0:C.hourEnd)?new Date(null==t?void 0:null===(I=t.repeat)||void 0===I?void 0:null===(S=I.monthly)||void 0===S?void 0:S.hourEnd):null,interval:tv(e,U,t),on:{day:tf(e,U,t)},onThe:{day:tx(e,U,t),which:tg(e,U,t)}}),weekly:{mode:null==t?void 0:null===(_=t.repeat)||void 0===_?void 0:null===(k=_.weekly)||void 0===k?void 0:k.mode,excludingWeekends:null==t?void 0:null===(D=t.repeat)||void 0===D?void 0:null===(q=D.weekly)||void 0===q?void 0:q.excludingWeekends,hourStart:(null==t?void 0:null===(P=t.repeat)||void 0===P?void 0:null===(O=P.weekly)||void 0===O?void 0:O.hourStart)?new Date(null==t?void 0:null===(T=t.repeat)||void 0===T?void 0:null===(M=T.weekly)||void 0===M?void 0:M.hourStart):null,hourEnd:(null==t?void 0:null===(F=t.repeat)||void 0===F?void 0:null===(A=F.weekly)||void 0===A?void 0:A.hourEnd)?new Date(null==t?void 0:null===(E=t.repeat)||void 0===E?void 0:null===(R=E.weekly)||void 0===R?void 0:R.hourEnd):null,interval:tb(e,U,t),days:ty(e,U,t),options:{weekStartsOnSunday:tj(e,U,t)}},daily:{mode:null==t?void 0:null===(N=t.repeat)||void 0===N?void 0:null===(W=N.daily)||void 0===W?void 0:W.mode,interval:tZ(e,U,t),excludingWeekends:null==t?void 0:null===($=t.repeat)||void 0===$?void 0:null===(J=$.daily)||void 0===J?void 0:J.excludingWeekends,hourStart:(null==t?void 0:null===(L=t.repeat)||void 0===L?void 0:null===(Y=L.daily)||void 0===Y?void 0:Y.hourStart)?new Date(null==t?void 0:null===(B=t.repeat)||void 0===B?void 0:null===(H=B.daily)||void 0===H?void 0:H.hourStart):null,hourEnd:(null==t?void 0:null===(V=t.repeat)||void 0===V?void 0:null===(G=V.daily)||void 0===G?void 0:G.hourEnd)?new Date(null==t?void 0:null===(Q=t.repeat)||void 0===Q?void 0:null===(z=Q.daily)||void 0===z?void 0:z.hourEnd):null},hourly:{interval:tw(e,U,t)}}),end:(0,v.Z)((0,i.Z)({},e.end),{mode:"On date",after:tC(e,U,t),onDate:{date:y()(tI(e,U,t)),options:(0,v.Z)((0,i.Z)({},e.end.onDate.options),{weekStartsOnSunday:tj(e,U,t)})}}),options:(0,v.Z)((0,i.Z)({},e.options),{weekStartsOnSunday:tj(e,U,t)}),error:null})}catch(K){return(0,v.Z)((0,i.Z)({},e),{error:{value:n,message:K}})}return o},t_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{start:{onDate:{date:y()(),options:{weekStartsOnSunday:e.weekStartsOnSunday}}},repeat:{frequency:e.repeat?e.repeat[0]:"Yearly",yearly:{mode:e.yearly||"on",on:{month:"Jan",day:1},onThe:{month:"Jan",day:"Monday",which:"First"},options:{modes:e.yearly}},monthly:{mode:e.monthly||"on",interval:1,on:{day:1},onThe:{day:"Monday",which:"First"},options:{modes:e.monthly}},weekly:{interval:1,days:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},options:{weekStartsOnSunday:e.weekStartsOnSunday}},daily:{interval:1},hourly:{interval:1},options:{frequency:e.repeat}},end:{mode:"On date",onDate:{date:y()(),options:{weekStartsOnSunday:e.weekStartsOnSunday}},options:{modes:e.end}},options:{hideStart:void 0===e.hideStart||e.hideStart,hideEnd:e.hideEnd,hideError:e.hideError,weekStartsOnSunday:e.weekStartsOnSunday},error:null}},tk=t(7654),tD=t.n(tk),tq=function(e){return function(n){var t=+n.target.value;!tD()(t)&&!(t>=1e3)&&e({target:{value:t,name:n.target.name}})}},tP=t(15772),tO=function(e){var n=e.defaultOptions,t=e.handleChange,o=(0,e.watch)("repeat.daily.mode"),r=function(e){var n,o=e.name;t({target:{name:o,value:e.value?"anyTimeOption":null}})},a=n.control,s=n.register;return(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(u.Z,{width:"100%",direction:"row",alignItems:"center",columnGap:2,mt:2,children:[(0,l.jsx)(S.Z,{children:"every"}),(0,l.jsx)(nC.Z,{fullWidth:!0,name:"repeat.daily.interval",inputRef:s,onChange:function(e){return tq(t(e))},color:"secondary",size:"small"}),(0,l.jsx)(S.Z,{children:"day(s)"})]}),(0,l.jsx)(nO.Qr,{control:a,name:"repeat.daily.mode",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nH.Z,{label:"any time",control:(0,l.jsx)(nM.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;r({name:"repeat.daily.mode",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),o&&(0,l.jsxs)(u.Z,{spacing:1,children:[(0,l.jsx)(S.Z,{children:"Between hours of"}),(0,l.jsxs)(u.Z,{direction:"row",columnGap:2,children:[(0,l.jsx)(nO.Qr,{control:a,name:"repeat.daily.hourStart",render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(tP.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.daily.hourStart",value:e}})},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{label:"Start",color:"secondary",size:"small",sx:{width:"100px"}}))}})}}),(0,l.jsx)(nO.Qr,{control:a,name:"repeat.daily.hourEnd",render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(tP.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.daily.hourEnd",value:e}})},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{label:"End",color:"secondary",size:"small",sx:{width:"100px"}}))}})}})]})]})]})};tO.propTypes={defaultOptions:x.object.isRequired,handleChange:x.func.isRequired};var tT=function(e){var n=e.defaultOptions,t=e.handleChange,o=n.register;return(0,l.jsxs)(u.Z,{width:"100%",direction:"row",alignItems:"center",columnGap:2,mt:2,children:[(0,l.jsx)(S.Z,{children:"every"}),(0,l.jsx)(nC.Z,{fullWidth:!0,name:"repeat.hourly.interval",inputRef:o,onChange:function(e){return tq(t(e))},color:"secondary",size:"small"}),(0,l.jsx)(S.Z,{children:"hours(s)"})]})};tT.propTypes={defaultOptions:x.object.isRequired,handleChange:x.func.isRequired};var tM=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"},{label:"6",value:"6"},{label:"7",value:"7"},{label:"8",value:"8"},{label:"9",value:"9"},{label:"10",value:"10"},{label:"11",value:"11"},{label:"12",value:"12"},{label:"13",value:"13"},{label:"14",value:"14"},{label:"15",value:"15"},{label:"16",value:"16"},{label:"17",value:"17"},{label:"18",value:"18"},{label:"19",value:"19"},{label:"20",value:"20"},{label:"21",value:"21"},{label:"22",value:"22"},{label:"23",value:"23"},{label:"24",value:"24"},{label:"25",value:"25"},{label:"26",value:"26"},{label:"27",value:"27"},{label:"28",value:"28"},{label:"29",value:"29"},{label:"30",value:"30"},{label:"31",value:"31"}],tF=[{label:"Yearly",value:"Yearly"},{label:"Monthly",value:"Monthly"},{label:"Weekly",value:"Weekly"},{label:"Daily",value:"Daily"},{label:"Hourly",value:"Hourly"}],tA=[{label:"First",value:"First"},{label:"Second",value:"Second"},{label:"Third",value:"Third"},{label:"Fourth",value:"Fourth"},{label:"Last",value:"Last"}],tE=[{label:"Monday",value:"Monday"},{label:"Tuesday",value:"Tuesday"},{label:"Wednesday",value:"Wednesday"},{label:"Thursday",value:"Thursday"},{label:"Friday",value:"Friday"},{label:"Saturday",value:"Saturday"},{label:"Day",value:"Day"},{label:"Weekday",value:"Weekday"},{label:"Weekend day",value:"Weekend day"}],tR=[{label:"Mon",value:"mon"},{label:"Tue",value:"tue"},{label:"Wed",value:"wed"},{label:"Thu",value:"thu"},{label:"Fri",value:"fri"},{label:"Sat",value:"sat"},{label:"Sun",value:"sun"}],tN={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Firday:5,Saturday:6},tW=t(79717),t$={radio:{"&.MuiRadioGroup-root":{"label:first-child":{marginTop:"0px"},"label:not(:first-child)":{marginTop:"10px"},"label:last-child":{"& .MuiTypography-body1":{width:"200px"}}}}},tJ=function(e){var n=e.defaultOptions,t=e.handleChange,o=(0,e.watch)("repeat.monthly.mode"),r=function(e){var n,o=e.name;t({target:{name:o,value:e.value}})},a=n.control,s=n.register;return(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(u.Z,{width:"100%",direction:"row",alignItems:"center",justifyContent:"flex-start",columnGap:2,mt:2,children:[(0,l.jsx)(S.Z,{children:"every"}),(0,l.jsx)(nC.Z,{fullWidth:!0,name:"repeat.monthly.interval",inputRef:s,onChange:function(e){return tq(t(e))},color:"secondary",size:"small"}),(0,l.jsx)(S.Z,{children:"month(s)"})]}),(0,l.jsxs)(J.ZP,{container:!0,mt:2,children:[(0,l.jsx)(J.ZP,{item:!0,md:3,children:(0,l.jsx)(nO.Qr,{name:"repeat.monthly.mode",control:a,render:function(e){var n=e.value,o=e.onChange;return(0,l.jsxs)(tW.Z,{sx:t$.radio,stackProps:{width:"100%",height:"100%"},value:n,onChange:function(e,n){o(n),t({target:{name:"repeat.monthly.mode",value:n}})},children:[(0,l.jsx)(nH.Z,{label:"on day",control:(0,l.jsx)(nQ.Z,{value:"on",color:"secondary",sx:{width:"40px"}})}),(0,l.jsx)(nH.Z,{label:"on the",control:(0,l.jsx)(nQ.Z,{value:"on the",label:"on the",color:"secondary",sx:{width:"40px"}})}),(0,l.jsx)(nH.Z,{label:"any time (during month)",control:(0,l.jsx)(nQ.Z,{value:"anyTimeOption",color:"secondary",sx:{width:"40px"}})})]})}})}),(0,l.jsxs)(J.ZP,{item:!0,md:9,children:[(0,l.jsx)(nO.Qr,{name:"repeat.monthly.on.day",control:a,render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(ed.q,{fullWidth:!0,value:n,disableClearable:!0,options:tM,onChange:function(e,n){t({target:{name:"repeat.monthly.on.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,l.jsxs)(u.Z,{direction:"row",columnGap:2,mt:2,children:[(0,l.jsx)(nO.Qr,{name:"repeat.monthly.onThe.which",control:a,render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(ed.q,{fullWidth:!0,value:n,options:tA,disableClearable:!0,onChange:function(e,n){t({target:{name:"repeat.monthly.onThe.which",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,l.jsx)(nO.Qr,{name:"repeat.monthly.onThe.day",control:a,render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(ed.q,{fullWidth:!0,value:n,disableClearable:!0,options:tE,onChange:function(e,n){t({target:{name:"repeat.monthly.onThe.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}})]})]})]}),"anyTimeOption"===o&&(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(nO.Qr,{control:a,name:"repeat.monthly.excludingWeekends",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nH.Z,{label:"excluding weekends",control:(0,l.jsx)(nM.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;r({name:"repeat.monthly.excludingWeekends",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),(0,l.jsxs)(u.Z,{spacing:1,children:[(0,l.jsx)(S.Z,{children:"Between hours of"}),(0,l.jsxs)(u.Z,{direction:"row",spacing:2,children:[(0,l.jsx)(nO.Qr,{control:a,name:"repeat.monthly.hourStart",render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(tP.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.monthly.hourStart",value:e}})},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{color:"secondary",size:"small",label:"Start",sx:{width:"100px"}}))}})}}),(0,l.jsx)(nO.Qr,{control:a,name:"repeat.monthly.hourEnd",render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(tP.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.monthly.hourEnd",value:e}})},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{color:"secondary",size:"small",label:"End",sx:{width:"100px"}}))}})}})]})]})]})]})};tJ.propTypes={defaultOptions:x.object.isRequired,handleChange:x.func.isRequired};var tL=function(e){var n=e.currentWeeklyDays,t=e.defaultOptions,o=e.handleChange,r=(0,e.watch)("repeat.weekly.mode"),a=function(e){Object.keys(n).forEach(function(e){return n[e]=!1}),e.forEach(function(e){n[e.value]=!0}),o({target:{value:n,name:"repeat.weekly.days"}})},s=function(e){var n,t=e.name;o({target:{name:t,value:e.value?"anyTimeOption":null}})},d=function(e){var n,t=e.name;o({target:{name:t,value:e.value}})},c=t.register,p=t.control;return(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(u.Z,{width:"100%",direction:"row",alignItems:"center",spacing:2,mt:2,children:[(0,l.jsx)(S.Z,{children:"every"}),(0,l.jsx)(nC.Z,{name:"repeat.weekly.interval",inputRef:c,onChange:function(e){return tq(o(e))},color:"secondary",size:"small"}),(0,l.jsx)(S.Z,{children:"week(s)"})]}),(0,l.jsx)(nO.Qr,{fullWidth:!0,name:"repeat.weekly.days",control:p,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{multiple:!0,limitTags:2,value:n,sx:{width:"100%",marginTop:"10px"},disabled:r,options:tR,onChange:function(e,n){a(n),t(n)},size:"small",textFieldProps:{color:"secondary",label:"Day of the week"}})}}),(0,l.jsx)(nO.Qr,{control:p,name:"repeat.weekly.mode",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nH.Z,{label:"any time",control:(0,l.jsx)(nM.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;s({name:"repeat.weekly.mode",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),r&&(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(nO.Qr,{control:p,name:"repeat.weekly.excludingWeekends",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nH.Z,{label:"excluding weekends",control:(0,l.jsx)(nM.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;d({name:"repeat.weekly.excludingWeekends",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),(0,l.jsxs)(u.Z,{spacing:1,children:[(0,l.jsx)(S.Z,{children:"Between hours of"}),(0,l.jsxs)(u.Z,{direction:"row",spacing:2,children:[(0,l.jsx)(nO.Qr,{control:p,name:"repeat.weekly.hourStart",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(tP.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){t(e),o({target:{name:"repeat.weekly.hourStart",value:e}})},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{color:"secondary",size:"small",label:"Start",sx:{width:"100px"}}))}})}}),(0,l.jsx)(nO.Qr,{control:p,name:"repeat.weekly.hourEnd",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(tP.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){t(e),o({target:{name:"repeat.weekly.hourEnd",value:e}})},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{color:"secondary",size:"small",label:"End",sx:{width:"100px"}}))}})}})]})]})]})]})};tL.propTypes={currentWeeklyDays:x.object.isRequired,defaultOptions:x.object.isRequired,handleChange:x.func.isRequired,setValue:x.func.isRequired};var tY=[{label:"Jan",value:"Jan"},{label:"Feb",value:"Feb"},{label:"Mar",value:"Mar"},{label:"Apr",value:"Apr"},{label:"May",value:"May"},{label:"Jun",value:"Jun"},{label:"Jul",value:"Jul"},{label:"Aug",value:"Aug"},{label:"Sep",value:"Sep"},{label:"Oct",value:"Oct"},{label:"Nov",value:"Nov"},{label:"Dec",value:"Dec"}],tB=[{label:"January",value:"january"},{label:"February",value:"february"},{label:"March",value:"march"},{label:"April",value:"april"},{label:"May",value:"may"},{label:"June",value:"june"},{label:"July",value:"july"},{label:"August",value:"august"},{label:"September",value:"september"},{label:"October",value:"october"},{label:"November",value:"november"},{label:"December",value:"december"}],tH={radio:{"&.MuiRadioGroup-root":{"label:first-child":{marginTop:"0px"},"label:not(:first-child)":{marginTop:"10px"},"label:last-child":{"& .MuiTypography-body1":{width:"200px"}}}}},tV=function(e){var n=e.defaultOptions,t=e.handleChange,o=(0,e.watch)("repeat.yearly.mode"),r=function(e){var n,o=e.name;t({target:{name:o,value:e.value}})},a=n.control;return(0,l.jsxs)(u.Z,{direction:"column",children:[(0,l.jsxs)(J.ZP,{container:!0,children:[(0,l.jsx)(J.ZP,{item:!0,md:4,mt:2,children:(0,l.jsx)(nO.Qr,{name:"repeat.yearly.mode",control:a,render:function(e){var n=e.value,o=e.onChange;return(0,l.jsxs)(tW.Z,{sx:tH.radio,value:n,onChange:function(e,n){o(n),t({target:{name:"repeat.yearly.mode",value:n}})},children:[(0,l.jsx)(nH.Z,{label:"on",control:(0,l.jsx)(nQ.Z,{value:"on",color:"secondary",sx:{width:"40px"}})}),(0,l.jsx)(nH.Z,{label:"on the",control:(0,l.jsx)(nQ.Z,{value:"on the",label:"on the",color:"secondary",sx:{width:"40px"}})}),(0,l.jsx)(nH.Z,{label:"any time (during month)",control:(0,l.jsx)(nQ.Z,{value:"anyTimeOption",color:"secondary",sx:{width:"40px"}})})]})}})}),(0,l.jsxs)(J.ZP,{item:!0,md:8,children:[(0,l.jsxs)(u.Z,{direction:"row",columnGap:2,mt:2,children:[(0,l.jsx)(nO.Qr,{fullWidth:!0,name:"repeat.yearly.on.month",control:a,render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(ed.q,{value:n,disableClearable:!0,options:tY,onChange:function(e,n){tq(t({target:{name:"repeat.yearly.on.month",value:n.value}})),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,l.jsx)(nO.Qr,{fullWidth:!0,name:"repeat.yearly.on.day",control:a,render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(ed.q,{value:n,disableClearable:!0,options:tM,onChange:function(e,n){t({target:{name:"repeat.yearly.on.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}})]}),(0,l.jsxs)(u.Z,{direction:"row",columnGap:2,mt:2,children:[(0,l.jsx)(nO.Qr,{fullWidth:!0,name:"repeat.yearly.onThe.which",control:a,render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(ed.q,{value:n,disableClearable:!0,options:tA,onChange:function(e,n){t({target:{name:"repeat.yearly.onThe.which",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,l.jsx)(nO.Qr,{fullWidth:!0,name:"repeat.yearly.onThe.day",control:a,render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(ed.q,{value:n,options:tE,disableClearable:!0,onChange:function(e,n){t({target:{name:"repeat.yearly.onThe.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,l.jsx)(nO.Qr,{fullWidth:!0,name:"repeat.yearly.onThe.month",control:a,render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(ed.q,{value:n,disableClearable:!0,options:tY,onChange:function(e,n){tq(t({target:{name:"repeat.yearly.onThe.month",value:n.value}})),o(n)},size:"small",textFieldProps:{color:"secondary"}})}})]})]})]}),"anyTimeOption"===o&&(0,l.jsxs)(u.Z,{mt:2,rowGap:1,children:[(0,l.jsx)(nO.Qr,{control:a,name:"repeat.yearly.excludingWeekends",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nH.Z,{label:"excluding weekends",control:(0,l.jsx)(nM.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;r({name:"repeat.yearly.excludingWeekends",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),(0,l.jsxs)(u.Z,{spacing:1,children:[(0,l.jsx)(S.Z,{children:"Between hours of"}),(0,l.jsxs)(u.Z,{direction:"row",spacing:2,children:[(0,l.jsx)(nO.Qr,{control:a,name:"repeat.yearly.hourStart",render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(tP.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.yearly.hourStart",value:e}})},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{label:"Start",color:"secondary",size:"small",sx:{width:"100px"}}))}})}}),(0,l.jsx)(nO.Qr,{control:a,name:"repeat.yearly.hourEnd",render:function(e){var n=e.value,o=e.onChange;return(0,l.jsx)(tP.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){o(e),t({target:{name:"repeat.yearly.hourEnd",value:e}})},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{label:"End",color:"secondary",size:"small",sx:{width:"100px"}}))}})}})]})]})]})]})};tV.propTypes={defaultOptions:x.object,handleChange:x.func};var tG=function(e){var n=e.data,t=e.defaultOptions,o=e.handleChange,r=e.watch,a=t.control;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(I.Z,{mt:2,children:(0,l.jsx)(nO.Qr,{fullWidth:!0,name:"repeat.frequency",control:a,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{value:n,disableClearable:!0,options:tF,onChange:function(e,n){o({target:{name:"repeat.frequency",value:n.value}}),t(n)},textFieldProps:{color:"secondary",label:"Repeat"}})}})}),function(){switch(n.repeat.frequency){case"Yearly":return(0,l.jsx)(tV,{defaultOptions:t,handleChange:o,watch:r});case"Monthly":return(0,l.jsx)(tJ,{defaultOptions:t,handleChange:o,watch:r});case"Weekly":return(0,l.jsx)(tL,{currentWeeklyDays:n.repeat.weekly.days,defaultOptions:t,handleChange:o,watch:r});case"Daily":return(0,l.jsx)(tO,{defaultOptions:t,handleChange:o,watch:r});case"Hourly":return(0,l.jsx)(tT,{defaultOptions:t,handleChange:o})}}()]})};tG.propTypes={data:x.object.isRequired,defaultOptions:x.object.isRequired,handleChange:x.func.isRequired};var tQ=function(e,n){var t=[];for(var o in e)!0===e[o]&&t.push(o);return n.filter(function(e){return t.includes(e.value)})},tz={hideStart:!1},tU=function(e){var n=e.disableStartEndValidation,t=e.setValueParent,o=e.setOuterStartEndDates,r=e.setRRuleMeta,a=e.setFrequencyError,d=e.rruleMeta,c=e.frequency,p=(0,s.useState)(null),m=p[0],h=p[1],f=(0,nO.cI)(),x=f.control,g=f.errors,b=f.register,j=f.watch,Z=f.reset,w=j("end.onDate.date"),C=j("start.onDate.date"),I=n||y()(C).isAfter(y()().subtract(1,"day").startOf("day")),S=n||y()(w).isAfter(y()(C));(0,s.useEffect)(function(){var e,n=t_(tz),o=tS(n,c,d),a=ta(o),l=a.rruleString,s=a.rruleText;h((0,i.Z)({},o)),r((0,i.Z)({},o)),t("frequency",l),t("frequencyDescription",s),Z((0,i.Z)({},{"start.onDate.date":new Date(o.start.onDate.date),"repeat.frequency":{label:o.repeat.frequency,value:o.repeat.frequency},"repeat.yearly.mode":o.repeat.yearly.mode,"repeat.yearly.excludingWeekends":o.repeat.yearly.excludingWeekends,"repeat.yearly.hourStart":o.repeat.yearly.hourStart,"repeat.yearly.hourEnd":o.repeat.yearly.hourEnd,"repeat.yearly.on.month":{label:o.repeat.yearly.on.month,value:o.repeat.yearly.on.month},"repeat.yearly.on.day":{label:o.repeat.yearly.on.day,value:o.repeat.yearly.on.day},"repeat.yearly.onThe.which":{label:o.repeat.yearly.onThe.which,value:o.repeat.yearly.onThe.which},"repeat.yearly.onThe.day":{label:o.repeat.yearly.onThe.day,value:o.repeat.yearly.onThe.day},"repeat.yearly.onThe.month":{label:o.repeat.yearly.onThe.month,value:o.repeat.yearly.onThe.month},"repeat.monthly.interval":o.repeat.monthly.interval,"repeat.monthly.mode":o.repeat.monthly.mode,"repeat.monthly.excludingWeekends":o.repeat.monthly.excludingWeekends,"repeat.monthly.hourStart":o.repeat.monthly.hourStart,"repeat.monthly.hourEnd":o.repeat.monthly.hourEnd,"repeat.monthly.on.day":{label:o.repeat.monthly.on.day,value:o.repeat.monthly.on.day},"repeat.monthly.onThe.which":{label:o.repeat.monthly.onThe.which,value:o.repeat.monthly.onThe.which},"repeat.monthly.onThe.day":{label:o.repeat.monthly.onThe.day,value:o.repeat.monthly.onThe.day},"repeat.weekly.interval":o.repeat.weekly.interval,"repeat.weekly.mode":o.repeat.weekly.mode,"repeat.weekly.excludingWeekends":o.repeat.weekly.excludingWeekends,"repeat.weekly.hourStart":o.repeat.weekly.hourStart,"repeat.weekly.hourEnd":o.repeat.weekly.hourEnd,"repeat.weekly.days":tQ(o.repeat.weekly.days,tR),"repeat.daily.interval":o.repeat.daily.interval,"repeat.daily.mode":o.repeat.daily.mode,"repeat.daily.excludingWeekends":o.repeat.daily.excludingWeekends,"repeat.daily.hourStart":o.repeat.daily.hourStart,"repeat.daily.hourEnd":o.repeat.daily.hourEnd,"repeat.hourly.interval":o.repeat.hourly.interval,"end.mode":"On date","end.onDate.date":new Date(o.end.onDate.date)}))},[c,Z,d,r,t]),(0,s.useEffect)(function(){o({scheduleStart:C,scheduleEnd:w})},[C,w,o]),(0,s.useEffect)(function(){a(!I||!S)},[I,S,a]);var _=(0,s.useCallback)(function(e){var n=e.target,o=(0,i.Z)({},m);nX()(o,n.name,n.value);var a=ta(o),l=a.rruleString,s=a.rruleText;h((0,i.Z)({},o)),r((0,i.Z)({},o)),t("frequency",l),t("frequencyDescription",s)},[m,r,t]);return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("form",{id:"Form",style:{marginTop:"10px"},children:[(0,l.jsxs)(u.Z,{direction:"row",columnGap:2,children:[(0,l.jsx)(nO.Qr,{name:"start.onDate.date",control:x,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nz.M,{minDate:y()().subtract(1,"day").startOf("day").toDate(),value:n,onChange:function(e){var n=y()(e).utc(!0).startOf("day");n.isValid()&&(_({target:{name:"start.onDate.date",value:n.toDate()}}),t(n.toDate()),o(function(e){return(0,v.Z)((0,i.Z)({},e),{scheduleStart:n.toDate()})}))},label:"Start date",renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{sx:{width:"100%"},color:"secondary",error:!I,helperText:!I&&"Start date should be later than today"}))}})}}),(0,l.jsx)(nO.Qr,{name:"end.onDate.date",control:x,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nz.M,{minDate:C,value:n,onChange:function(e){var n=y()(e).utc(!0).startOf("day");n.isValid()&&(_({target:{name:"end.onDate.date",value:n.toDate()}}),t(n.toDate()),o(function(e){return(0,v.Z)((0,i.Z)({},e),{scheduleEnd:n.toDate()})}))},label:"End date",renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{sx:{width:"100%"},color:"secondary",error:!S,helperText:!S&&"End date should be later than Start date"}))}})}})]}),m&&(0,l.jsx)(tG,{data:m,defaultOptions:{control:x,errors:g,register:b,watch:j},handleChange:_,watch:j})]})})};tU.propTypes={defaultOptions:x.object.isRequired,setValueParent:x.func.isRequired,watchParent:x.func.isRequired};var tK=t(82749),tX=function(e){var n=e.postCode,t=e.country,o=tK.O.get(t),r=(null==n?void 0:n.match(o))||"";return{area:r[1],district:r&&r.length>2?r[2]:""}},t0=function(e){var n,t,o,r,a=e.watchLocation,i=e.watchAssetsCategory,l=e.watchService,u=(0,s.useState)(""),d=u[0],c=u[1],p=(0,s.useState)(""),m=p[0],h=p[1],v=(0,s.useState)(""),x=v[0],g=v[1],b=(0,s.useState)(""),y=b[0],w=b[1],C=(0,s.useState)(""),I=C[0],S=C[1],_=(0,s.useState)(""),k=_[0],D=_[1],q=(0,s.useState)(""),P=q[0],O=q[1],T=(0,s.useState)(""),M=T[0],F=T[1],A=(0,s.useState)(""),E=A[0],R=A[1],N=(0,f.Z)((0,Z.t)(ns._d,{variables:{where:{status:{_eq:"active"},name:{_ilike:""!==d?"%".concat(d,"%"):null}},limit:50,offset:0}}),2),W=N[0],$=N[1],J=$.loading,L=$.data,Y=(void 0===L?{items:[]}:L).items,B=(0,j.a)(ni,{skip:!(null==a?void 0:a.value),variables:{locationId:null==a?void 0:a.value}}).data,H=(void 0===B?{account:[]}:B).account,V=(0,f.Z)((0,Z.t)(ns.zR,{variables:{locationId:null==a?void 0:a.value,q:""!==m?"%".concat(m,"%"):null,limit:50,offset:0}}),2),G=V[0],Q=V[1],z=Q.loading,U=Q.data,K=(void 0===U?{items:[]}:U).items,X=(0,f.Z)((0,Z.t)(ns.UM,{variables:{q:""!==x?"%".concat(x,"%"):null,limit:50,offset:0}}),2),ee=X[0],en=X[1],et=en.loading,eo=en.data,er=(void 0===eo?{items:[]}:eo).items,ea=(0,f.Z)((0,Z.t)(ns.UH,{variables:{locationId:null==a?void 0:a.value,categoryId:null==i?void 0:i.value,q:""!==y?"%".concat(y,"%"):null,limit:50,offset:0}}),2),ei=ea[0],el=ea[1],es=el.loading,eu=el.data,ed=(void 0===eu?{items:[]}:eu).items,ec=(0,f.Z)((0,Z.t)(ns._f,{variables:{where:{type:{_eq:"jobTags"},status:{_eq:"active"},name:{_ilike:""!==I?"%".concat(I,"%"):null}},limit:50,offset:0,orderBy:{name:"asc"},includeMeta:!0}}),2),ep=ec[0],em=ec[1],eh=em.loading,ev=em.data,ef=(void 0===ev?{items:[]}:ev).items,ex=(0,f.Z)((0,Z.t)(ns._f,{variables:{where:{type:{_eq:"costCategory"},status:{_eq:"active"},name:{_ilike:""!==k?"%".concat(k,"%"):null}},limit:50,offset:0,orderBy:{name:"asc"}}}),2),eg=ex[0],eb=ex[1],ey=eb.loading,ej=eb.data,eZ=(void 0===ej?{items:[]}:ej).items,ew=(0,f.Z)((0,Z.t)(ns.kx,{variables:{q:""!==P?"%".concat(P,"%"):null,limit:50,offset:0}}),2),eC=ew[0],eI=ew[1],eS=eI.loading,e_=eI.data,ek=(void 0===e_?{items:[]}:e_).items,eD=(0,f.Z)((0,Z.t)(ns.Oq,{variables:{locationId:null==a?void 0:a.value,q:""!==E?"%".concat(E,"%"):null,limit:50,offset:0}}),2),eq=eD[0],eP=eD[1],eO=eP.loading,eT=eP.data,eM=(void 0===eT?{items:[]}:eT).items,eF=(0,j.a)(ns.nP,{skip:!(null==a?void 0:a.value),variables:{id:null==a?void 0:a.value}}).data,eA=(void 0===eF?{item:{}}:eF).item,eE=null==eA?void 0:null===(n=eA.registeredAddress)||void 0===n?void 0:n[0],eR=tX({postCode:null==eE?void 0:null===(t=eE.address)||void 0===t?void 0:t.postCode,country:null==eE?void 0:null===(o=eE.address)||void 0===o?void 0:null===(r=o.country)||void 0===r?void 0:r.code}),eN=(0,f.Z)((0,Z.t)(ns.by,{variables:{where:{type:{_eq:"supplier"},status:{_eq:"active"},PostcodeAreas:{PostcodeArea:{area:{_eq:null==eR?void 0:eR.area}},entity:{_eq:"Account"},status:{_eq:"active"}},ServiceSchedule:{status:{_eq:"active"},serviceId:{_eq:null==l?void 0:l.value},entity:{_eq:"Supplier"},PostcodeAreas:{PostcodeArea:{area:{_eq:null==eR?void 0:eR.area}}}},name:{_ilike:""!==M?"%".concat(M,"%"):null}},limit:50,offset:0}}),2),eW=eN[0],e$=eN[1],eJ=e$.loading,eL=e$.data;return{locationsProps:{onOpen:W,loading:J,options:Y,setSearch:c},sublocationsProps:{onOpen:G,loading:z,options:K,setSearch:h},assetsCategoryProps:{onOpen:ee,loading:et,options:er,setSearch:g},assetsProps:{onOpen:ei,loading:es,options:ed,setSearch:w},shortDescriptionProps:{onOpen:ep,loading:eh,options:ef,setSearch:S},costCategoryProps:{onOpen:eg,loading:ey,options:eZ,setSearch:D},servicesProps:{onOpen:eC,loading:eS,options:ek,setSearch:O},supplierProps:{onOpen:eW,loading:eJ,options:(void 0===eL?{items:[]}:eL).items,setSearch:F},compliancesProps:{onOpen:eq,loading:eO,options:eM,setSearch:R},customer:null==H?void 0:H[0]}},t1=function(e,n,t){var o=n0.ZP.fromString(e.replace(/[\s\n]/gm,"\n")),r=o.origOptions,a=r.freq,i=r.until,l=r.dtstart,s=y()(l),u=o.all();t&&(s.day()===tN.Saturday||s.day()===tN.Sunday)&&s.add(s.day()===tN.Saturday?2:1,"day");var d=1===y()(l).date(),c=s.isSame(l,"month");if(a===n0.Di.MONTHLY&&n&&!d&&c){var p=i?(0,$.Z)(u):u.slice(0,-1);return p.unshift(s),p}return a===n0.Di.YEARLY&&n?u.map(function(e,n){var o=y()(e);return n>0&&o.startOf("month"),t&&(o.day()===tN.Saturday||o.day()===tN.Sunday)&&o.add(o.day()===tN.Saturday?2:1,"day"),o}):u},t2=function(e){var n,t,o,r,a,i,l,s,u=null==e?void 0:null===(n=e.repeat)||void 0===n?void 0:null===(t=n.frequency)||void 0===t?void 0:null===(o=t.toLocaleLowerCase)||void 0===o?void 0:o.call(t);return{isAnyTime:(null==e?void 0:null===(r=e.repeat)||void 0===r?void 0:null===(a=r[u])||void 0===a?void 0:a.mode)==="anyTimeOption",excludingWeekends:null==e?void 0:null===(i=e.repeat)||void 0===i?void 0:null===(l=i[u])||void 0===l?void 0:l.excludingWeekends}},t5=t(83704),t3=t.n(t5);t3()(y());var t6={jobIds:function(e){var n,t;return null===(t=null===(n=e.jobs)||void 0===n?void 0:n.map(function(e){return e.number}))||void 0===t?void 0:t.join(", ")},jobName:function(e){var n,t;return null===(t=null===(n=e.jobs)||void 0===n?void 0:n.map(function(e){return e.title}))||void 0===t?void 0:t.join(", ")},jobStatus:function(e){var n,t;return null===(t=null===(n=e.jobs)||void 0===n?void 0:n.map(function(e){return e.status}))||void 0===t?void 0:t.join(", ")},sublocation:function(e){var n;return null!==(o=null===(n=e.sublocation)||void 0===n?void 0:n.name)&&void 0!==o?o:"-"},assetCategoryName:function(e){var n;return null!==(r=null===(n=e.assetCategory)||void 0===n?void 0:n.name)&&void 0!==r?r:"-"},assetName:function(e){var n,t;return null===(t=null===(n=e.assets)||void 0===n?void 0:n.map(function(e){return e.asset.name}))||void 0===t?void 0:t.join(", ")},scheduleStart:function(e){return y()(e.scheduleStart).format("YYYY-MM-DD")},scheduleEnd:function(e){return y()(e.scheduleEnd).format("YYYY-MM-DD")}},t4={id:function(e){return"PM ".concat(e.number)},invoiceNumber:function(e){return(0,$.Z)(new Set(e.invoices.map(function(e){return e.invoiceNumber}))).join(", ")||"-"},service:function(e){var n;return null===(n=e.service)||void 0===n?void 0:n.name},type:function(e){return e.type},tags:function(e){var n,t;return null===(t=null===(n=e.tags)||void 0===n?void 0:n.map(function(e){return e.tag.name}))||void 0===t?void 0:t.join(", ")},supplier:function(e){var n;return null===(n=e.supplier)||void 0===n?void 0:n.name},manager:function(e){var n;return null===(n=e.manager)||void 0===n?void 0:n.fullName},sublocation:function(e){var n;return null===(n=e.sublocation)||void 0===n?void 0:n.name},customerManager:function(e){var n,t;return null===(n=e.customer)||void 0===n?void 0:null===(t=n.manager)||void 0===t?void 0:t.fullName},customer:function(e){var n;return null===(n=e.customer)||void 0===n?void 0:n.name},assetCategory:function(e){var n;return null===(n=e.assetCategory)||void 0===n?void 0:n.name},assets:function(e){var n,t;return null===(t=null===(n=e.assets)||void 0===n?void 0:n.map(function(e){return e.asset.name}))||void 0===t?void 0:t.join(", ")},description:function(e){var n,t,o;return null===(n=e.shortJobDesc)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:null===(o=t.taxonomy)||void 0===o?void 0:o.name},createdAt:function(e){return y()(e.timingStart).format("YYYY-MM-DD")},scheduled:function(e){return y()(e.createdAt).format("YYYY-MM-DD")},status:function(e){return e.status}},t9=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=[],r=e.map(function(e){return(0,i.Z)({},e,null!==(u=e.meta)&&void 0!==u?u:{})}),a=!0,l=!1,s=void 0;try{for(var u,d,c=r[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var p=d.value,m={},h=!0,v=!1,f=void 0;try{for(var x,g=n[Symbol.iterator]();!(h=(x=g.next()).done);h=!0){var b,y,j=x.value,Z=null;Z=t&&j.value in t?null!==(b=t[j.value](p))&&void 0!==b?b:"-":null!==(y=p[j.value])&&void 0!==y?y:"-",m[j.label]=Z}}catch(w){v=!0,f=w}finally{try{h||null==g.return||g.return()}finally{if(v)throw f}}o.push(m)}}catch(C){l=!0,s=C}finally{try{a||null==c.return||c.return()}finally{if(l)throw s}}return o},t7=function(e){var n,t,o,r,a,i,l,s,u,d,c=e.form,p=e.rruleMeta,m=e.dates,h=e.reportPassFailFeature,v=e.customerSignature,f=e.supplierSignature,x=e.startEndDates,g=e.adminId,b=e.customerId,j={};return j.meta={costCategoryId:null===(n=c.costCategory)||void 0===n?void 0:n.value,costCategoryName:null===(t=c.costCategory)||void 0===t?void 0:t.label,complianceSelect:c.complianceSelect,compliance:!!c.compliance,costCustomer:c.costCustomer,costSupplier:c.costSupplier,serviceId:c.service.value,serviceName:c.service.label,shortDescriptionId:c.shortDescription.value,shortDescriptionName:c.shortDescription.label,supplierId:null===(o=c.supplier)||void 0===o?void 0:o.value,supplierName:null===(r=c.supplier)||void 0===r?void 0:r.label,customerSignature:v,supplierSignature:f,reportPassFail:h.reportPassFail,reportPassFailTitle:h.reportPassFailTitle,requireReportRecommendations:h.requireReportRecommendations,rruleMeta:p},j.assetCategoryId=null===(a=c.assetCategory)||void 0===a?void 0:a.value,j.dates=m,j.locationId=null===(i=c.location)||void 0===i?void 0:i.value,j.sublocationId=null===(l=c.sublocation)||void 0===l?void 0:l.value,j.frequency=c.frequency,j.frequencyDescription=c.frequencyDescription,j.reference=c.reference,j.customerMonthlyCharge=c.customerMonthlyCharge,j.supplierMonthlyCharge=c.supplierMonthlyCharge,j.firstInvoiceDate=c.firstInvoiceDate,j.finalInvoiceDate=c.finalInvoiceDate,j.invoiceBasis=c.invoicingType,j.scheduleStart=x.scheduleStart,j.scheduleEnd=x.scheduleEnd,j.description=c.description,j.adminId=g,j.customerId=b,(null===(s=c.assets)||void 0===s?void 0:s.length)>0&&(j.Assets={data:c.assets.map(function(e){return{status:"active",entity:"JobSchedule",assetId:e.value}})}),(null===(u=c.tags)||void 0===u?void 0:u.length)>0&&(j.Taxonomy={data:null===(d=c.tags)||void 0===d?void 0:d.map(function(e){return{entity:"JobSchedule",taxonomyId:e.tag.id}})}),c.estimatedDuration&&c.estimatedDurationUnit&&(j.estimatedDuration=y().duration(c.estimatedDuration,c.estimatedDurationUnit).as("milliseconds"),j.estimatedDurationUnit=c.estimatedDurationUnit),j},t8=function(e){var n,t,o,r,a,i,l,s=e.form,u=e.rruleMeta,d=e.dates,c=e.reportPassFailFeature,p=e.customerSignature,m=e.supplierSignature,h=e.startEndDates,v={};return v.meta={costCategoryId:null===(n=s.costCategory)||void 0===n?void 0:n.value,costCategoryName:null===(t=s.costCategory)||void 0===t?void 0:t.label,complianceSelect:s.complianceSelect,compliance:!!s.compliance,costCustomer:s.costCustomer,costSupplier:s.costSupplier,serviceId:s.service.value,serviceName:s.service.label,shortDescriptionId:s.shortDescription.value,shortDescriptionName:s.shortDescription.label,supplierId:null===(o=s.supplier)||void 0===o?void 0:o.value,supplierName:null===(r=s.supplier)||void 0===r?void 0:r.label,customerSignature:p,supplierSignature:m,reportPassFail:c.reportPassFail,reportPassFailTitle:c.reportPassFailTitle,requireReportRecommendations:c.requireReportRecommendations,rruleMeta:u},v.assetCategoryId=null===(a=s.assetCategory)||void 0===a?void 0:a.value,v.dates=d,v.locationId=null===(i=s.location)||void 0===i?void 0:i.value,v.sublocationId=null===(l=s.sublocation)||void 0===l?void 0:l.value,v.frequency=s.frequency,v.frequencyDescription=s.frequencyDescription,v.reference=s.reference,v.customerMonthlyCharge=s.customerMonthlyCharge,v.supplierMonthlyCharge=s.supplierMonthlyCharge,v.firstInvoiceDate=s.firstInvoiceDate,v.finalInvoiceDate=s.finalInvoiceDate,v.invoiceBasis=s.invoicingType,v.assets=s.assets,v.scheduleStart=h.scheduleStart,v.scheduleEnd=h.scheduleEnd,v.description=s.description,s.estimatedDuration&&s.estimatedDurationUnit&&(v.estimatedDuration=y().duration(s.estimatedDuration,s.estimatedDurationUnit).as("milliseconds"),v.estimatedDurationUnit=s.estimatedDurationUnit),v},oe=function(e){var n,t,o,r,a,i,l,s,u,d,c,p,m,h,v,f,x,g,b,j,Z,w,C=e.jobSchedule;return{location:{value:C.location.id,label:C.location.name},sublocation:C.sublocation?{value:C.sublocation.id,label:C.sublocation.name}:null,frequency:C.frequency,frequencyDescription:C.frequencyDescription,reference:C.reference,customerMonthlyCharge:C.customerMonthlyCharge,supplierMonthlyCharge:C.supplierMonthlyCharge,firstInvoiceDate:C.firstInvoiceDate,finalInvoiceDate:C.finalInvoiceDate,invoicingType:C.invoiceBasis,estimatedDuration:C.estimatedDuration?y().duration(C.estimatedDuration,"milliseconds").as(C.estimatedDurationUnit):null,estimatedDurationUnit:C.estimatedDurationUnit,assetCategory:C.assetCategory?{value:null===(n=C.assetCategory)||void 0===n?void 0:n.id,label:null===(t=C.assetCategory)||void 0===t?void 0:t.name}:null,assets:(null===(o=C.assets)||void 0===o?void 0:o.map(function(e){var n=e.asset;return{value:n.id,label:n.name}}))||[],costCategory:(null===(r=C.meta)||void 0===r?void 0:r.costCategoryId)?{value:null===(a=C.meta)||void 0===a?void 0:a.costCategoryId,label:null===(i=C.meta)||void 0===i?void 0:i.costCategoryName}:null,complianceSelect:null===(l=C.meta)||void 0===l?void 0:l.complianceSelect,compliance:null===(s=C.meta)||void 0===s?void 0:s.compliance,costCustomer:null===(u=C.meta)||void 0===u?void 0:u.costCustomer,costSupplier:null===(d=C.meta)||void 0===d?void 0:d.costSupplier,description:C.description,service:{value:null===(c=C.meta)||void 0===c?void 0:c.serviceId,label:null===(p=C.meta)||void 0===p?void 0:p.serviceName},shortDescription:{value:null===(m=C.meta)||void 0===m?void 0:m.shortDescriptionId,label:null===(h=C.meta)||void 0===h?void 0:h.shortDescriptionName},supplier:(null===(v=C.meta)||void 0===v?void 0:v.supplierId)?{value:null===(f=C.meta)||void 0===f?void 0:f.supplierId,label:null===(x=C.meta)||void 0===x?void 0:x.supplierName}:null,customerSignature:null===(g=C.meta)||void 0===g?void 0:g.customerSignature,supplierSignature:null===(b=C.meta)||void 0===b?void 0:b.supplierSignature,reportPassFail:null===(j=C.meta)||void 0===j?void 0:j.reportPassFail,reportPassFailTitle:null===(Z=C.meta)||void 0===Z?void 0:Z.reportPassFailTitle,requireReportRecommendations:null===(w=C.meta)||void 0===w?void 0:w.requireReportRecommendations}},on=function(e){var n,t=e.oldData,o=e.data;if(!t.jobs.length)return{isConfirm:!1,isSupplierChanged:!1,isDatesChanged:!1};var r=ot(t.dates,o.dates)||t.frequency!==o.frequency,a=o.meta.supplierId!==(null===(n=t.meta)||void 0===n?void 0:n.supplierId);return a||r?{isConfirm:!0,isSupplierChanged:a,isDatesChanged:r}:{isConfirm:!1,isSupplierChanged:!1,isDatesChanged:!1}},ot=function(e,n){return Array.isArray(e)?!(e.length===n.length&&n.every(function(n,t){var o=n.date,r=n.selected;return e[t].selected===r&&y()(e[t].date).isSame(o)})):!n.every(function(e){return e.selected})},oo=t(62551),or=t(22927),oa=function(e){var n=e.onClose,t=e.onConfirm,o=(0,H.Z)("(max-width:600px)");return(0,l.jsx)(oi,{is600pxOrLess:o,children:(0,l.jsxs)(u.Z,{spacing:2,alignItems:"center",width:"100%",children:[(0,l.jsx)(or.Z,{color:"error",sx:{fontSize:32}}),(0,l.jsx)(S.Z,{variant:"h6",fontWeight:700,children:"Do you confirm to change frequency?"}),(0,l.jsxs)(u.Z,{direction:"row",justifyContent:"center",width:"100%",spacing:2,children:[(0,l.jsx)(k.Z,{variant:"outlined",color:"black",onClick:n,children:"Cancel"}),(0,l.jsx)(k.Z,{variant:"contained",color:"secondary",onClick:function(){n(),t()},children:"Confirm"})]})]})})};oa.propTypes={onClose:g().func.isRequired,onConfirm:g().func.isRequired},oa.defaultProps={onClose:function(){},onConfirm:function(){}};var oi=(0,c.ZP)(d.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"auto",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:"8px",overflowY:"auto"}}),ol=t(92321),os=t(96486),ou=t(11961),od=t(93362),oc=t(78462),op=t(18972),om=t(14564),oh=t(10166),ov=t(28864),of=t(51738),ox=t(11975),og=(0,od.D)(),ob=function(e){var n=e.entityId,t=e.entity,o=e.values,r=void 0===o?[]:o,a=e.name,d=void 0===a?"tags":a,c=e.setValue,p=e.followingEntity,m=e.followingEntityIds,h=void 0===m?[]:m,x=(0,eo.x)().user,g=(0,s.useState)(null),b=g[0],y=g[1],Z=(0,s.useState)(""),C=Z[0],S=Z[1],k=(0,s.useState)(""),D=k[0],P=k[1],O=(0,s.useState)(""),T=O[0],M=O[1],F=(0,j.a)(of.BU,{skip:!n,variables:{entityId:n,entity:t},onCompleted:function(e){c(d,e.tags)}}),A=F.data,E=(void 0===A?{tags:[]}:A).tags,R=F.loading,N=(0,j.a)(of.gI,{skip:!b,variables:{entityId:n,entity:t,q:""!==T?"%".concat(T,"%"):null}}),W=N.data,J=(void 0===W?{tags:[]}:W).tags,L=N.loading,Y=(0,f.Z)((0,w.D)(of.Zm,{refetchQueries:["GetAllTags"]}),2),B=Y[0],H=Y[1].loading,V=(0,f.Z)((0,w.D)(of.C3,{refetchQueries:["GetEntityTags"]}),2),G=V[0],Q=V[1].loading,z=(0,f.Z)((0,w.D)(of.cS,{refetchQueries:["GetEntityTags"]}),2),U=z[0],K=z[1].loading,X=(0,f.Z)((0,w.D)(of.Aw),1)[0],ee=(0,f.Z)((0,w.D)(of.g$,{refetchQueries:["GetAllTags"]}),2),en=ee[0],et=ee[1].loading;(0,s.useEffect)(function(){var e=setTimeout(function(){M(D)},500);return function(){return clearTimeout(e)}},[D]);var er,ea,ei,el,es=function(e){e.stopPropagation(),y(e.currentTarget)},eu=function(){y(null)},ed=(er=(0,nq.Z)(function(e,o){var a,i,l,s,u,m,v,g;return(0,nP.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof o)return[3,1];return S({label:o}),[3,7];case 1:if(!(o&&o.inputValue&&n))return[3,3];return[4,G({variables:{objects:[{entity:t,entityId:n,Taxonomy:{data:{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:x.adminId}}}]}})];case 2:return l=e.sent().data.insert_Taxonomy_Entity,u=(0,f.Z)(l.returning,1)[0].taxonomyId,h.length>0&&G({variables:{objects:h.map(function(e){return{entity:p,entityId:e,taxonomyId:u}})}}),S(null),[3,7];case 3:if(!(o&&o.value&&n))return[3,4];return G({variables:{objects:[{entity:t,entityId:n,taxonomyId:o.value}].concat((0,$.Z)(h.map(function(e){return{entity:p,entityId:e,taxonomyId:o.value}})))}}),S(null),[3,7];case 4:if(!(o&&o.inputValue))return[3,6];return[4,B({variables:{objects:[{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:x.adminId}]}})];case 5:return g=e.sent().data.insert_Taxonomy,c(d,(0,$.Z)(r).concat([{id:null,tag:{id:g.returning[0].id,name:g.returning[0].name,meta:g.returning[0].meta}}])),S(null),[3,7];case 6:o&&o.value&&(c(d,(0,$.Z)(r).concat([{id:null,tag:{id:o.value,name:o.label,meta:o.meta}}])),S(null)),e.label=7;case 7:return[2]}})}),function(e,n){return er.apply(this,arguments)}),ec=(0,s.useCallback)(function(e,n){var t=og(e,n),o=n.inputValue,r=e.some(function(e){return o===e.label});return""===o||r||t.push({inputValue:o,label:'Add "'.concat(o,'"')}),t},[]),ep=(0,s.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),em=(ea=(0,nq.Z)(function(e){var t,o,a,i;return(0,nP.__generator)(this,function(t){switch(t.label){case 0:if(!n)return[3,2];return[4,U({variables:{tagEntityId:e}})];case 1:return a=t.sent().data.delete_Taxonomy_Entity_by_pk.taxonomyId,h.length>0&&X({variables:{where:{taxonomyId:{_eq:a},entity:{_eq:p},entityId:{_in:h}}}}),[3,3];case 2:c(d,r.filter(function(n,t){return t!==e})),t.label=3;case 3:return[2]}})}),function(e){return ea.apply(this,arguments)}),eh=(ei=(0,nq.Z)(function(e){var n,t,o,a,l,s;return(0,nP.__generator)(this,function(t){switch(t.label){case 0:return[4,en({variables:{tagId:n=e.tagId,object:{meta:{color:e.color}}}})];case 1:return l=t.sent().data.update_Taxonomy_by_pk,c(d,r.map(function(e){return e.tag.id===n?(0,v.Z)((0,i.Z)({},e),{tag:(0,i.Z)({},l)}):e})),[2]}})}),function(e){return ei.apply(this,arguments)}),ev=(el=(0,nq.Z)(function(e){var n,t,o,a,l,s;return(0,nP.__generator)(this,function(o){switch(o.label){case 0:return[4,en({variables:{tagId:n=e.tagId,object:{name:t=e.name}}})];case 1:return l=o.sent().data.update_Taxonomy_by_pk,c(t,r.map(function(e){return e.tag.id===n?(0,v.Z)((0,i.Z)({},e),{tag:(0,i.Z)({},l)}):e})),[2]}})}),function(e){return el.apply(this,arguments)}),ef=Boolean(b),ex=(0,s.useMemo)(function(){return J.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[J]),eg=(0,s.useMemo)(function(){return os.uniqBy((0,$.Z)(E).concat((0,$.Z)(r)),function(e){var n;return null===(n=e.tag)||void 0===n?void 0:n.id})},[E,r]);return(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",children:[(0,l.jsx)(ox.P,{tags:eg,handleDeleteTagEntity:em}),(0,l.jsx)(oy,{id:ef?"tags-popover":void 0,open:ef,anchorEl:b,onClose:eu,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,l.jsxs)(I.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,l.jsx)(nw.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,$.Z)(ex),value:C,onChange:ed,onInputChange:function(e,n){P(n)},filterOptions:ec,getOptionLabel:ep,renderOption:function(e,n){return(0,l.jsx)(op.Z,(0,v.Z)((0,i.Z)({},e),{children:n.label}))},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,v.Z)((0,i.Z)({},e.InputProps),{endAdornment:(0,l.jsxs)(l.Fragment,{children:[L||H||Q?(0,l.jsx)(q.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),R||K||et?(0,l.jsx)(u.Z,{width:"100%",alignItems:"center",p:4,children:(0,l.jsx)(q.Z,{color:"secondary"})}):(0,l.jsx)(oc.Z,{children:null==eg?void 0:eg.map(function(e,n){var t;return(0,l.jsx)(ov.T,{tagEntityId:e.id||n,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,onDelete:em,onColorChange:eh,onNameChange:ev})})})]})}),(0,l.jsx)(_.Z,{color:"black",onClick:es,children:(0,l.jsx)(ou.Z,{sx:{height:"16px",width:"16px"}})})]})};ob.defaultProps={entityId:null},ob.propTypes={entityId:g().number,entity:g().string.isRequired,values:g().array,name:g().string,setValue:g().func.isRequired,followingEntity:g().string,followingEntityIds:g().array};var oy=(0,oh.Z)(om.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}}),oj=t(1691);t3()(y());var oZ={accordion:function(e){return{backgroundColor:"transparent",border:"1px solid ".concat(e?"#36CF57":"#9E9E9E")}},multilineTextField:{width:"100%",minHeight:"150px",textarea:{minHeight:"150px"}},adornment:{borderRadius:"50%",backgroundColor:"#9E9E9E",color:"#fff",padding:"0 7px",marginRight:"20px"},groupedSelector:{slotProps:{popper:{sx:{"& .MuiAutocomplete-groupLabel":{height:"30px",lineHeight:"30px",backgroundColor:"#f5f5f5",fontWeight:700}}}}}},ow=function(e){var n,t,o=e.jobScheduleId,r=e.locationId,a=e.locationName,d=e.edit,c=e.onClose,p=(0,s.useRef)(!0),m=(0,nJ.D)(),h=(0,f.Z)((0,oo.d)(),2),x=h[0],g=h[1],b=(0,eo.x)(),Z=b.hasRole,C=b.user,_=(0,s.useState)("onCompletion"),P=_[0],O=_[1],T=(0,s.useState)(!1),M=T[0],F=T[1],A=(0,H.Z)("(max-width: 600px)"),E=(0,nO.cI)({resolver:(0,nT.S)(nN),defaultValues:(0,v.Z)((0,i.Z)({},oC,r&&{location:{value:r,label:a}}),{estimatedDuration:y().duration(54e5,"milliseconds").as("minutes"),estimatedDurationUnit:"minutes",firstInvoiceDate:"fixedMonthlyAmount"===P?new Date:null})}),R=E.control,N=E.watch,W=E.register,$=E.setValue,L=E.handleSubmit,Y=E.errors,B=E.reset,V=N("location"),G=N("compliance"),Q=N("assetCategory"),z=N("tags"),U=N("frequency"),K=N("service"),X=N("firstInvoiceDate"),ee=N("finalInvoiceDate"),en=N(),et=t0({watchLocation:V,watchAssetsCategory:Q,watchService:K}),er=et.locationsProps,ea=et.assetsCategoryProps,ei=et.assetsProps,el=et.shortDescriptionProps,es=et.servicesProps,eu=et.sublocationsProps,ec=et.costCategoryProps,ep=et.supplierProps,em=et.compliancesProps,eh=et.customer,ev=(0,s.useState)([]),ef=ev[0],ex=ev[1],eg=(0,s.useState)({scheduleStart:null,scheduleEnd:null}),eb=eg[0],ey=eg[1],ej=(0,s.useState)(null),eZ=ej[0],ew=ej[1],eC=(0,s.useState)([]),eI=eC[0],eS=eC[1],e_=(0,s.useState)({reportPassFail:!1,reportPassFailTitle:null,requireReportRecommendations:!1}),ek=e_[0],eD=e_[1],eq=(0,s.useState)(!1),eP=eq[0],eO=eq[1],eT=(0,s.useState)(!1),eM=eT[0],eF=eT[1],eA=t2(eZ),eE=eA.isAnyTime,eR=eA.excludingWeekends,eN=(0,j.a)(eB,{skip:!o,variables:{jobScheduleId:o},onCompleted:function(e){var n,t,o=e.jobSchedule,r=oe({jobSchedule:o});B((0,i.Z)({},r)),ew(null===(n=o.meta)||void 0===n?void 0:n.rruleMeta),O(o.invoiceBasis),(null===(t=o.dates)||void 0===t?void 0:t.length)>0&&eS(o.dates)}}),eW=eN.data,e$=(void 0===eW?{jobSchedule:{}}:eW).jobSchedule,eJ=eN.loading,eL=(0,f.Z)((0,w.D)(e1,{refetchQueries:["GetJobSchedules"],onCompleted:function(){m.show({content:"Job schedule was added.",severity:"success"}),c()},onError:function(e){m.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eY=eL[0],eH=eL[1].loading,eV=(0,f.Z)((0,w.D)(e2,{refetchQueries:["GetJobSchedules"],onCompleted:function(){m.show({content:"Job schedule was updated.",severity:"success"}),c()},onError:function(e){m.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eG=eV[0],eQ=eV[1].loading;(0,s.useEffect)(function(){var e,n=(e={location:null==en?void 0:en.location,shortDescription:null==en?void 0:en.shortDescription,description:null==en?void 0:en.description,estimatedDuration:null==en?void 0:en.estimatedDuration,estimatedDurationUnit:null==en?void 0:en.estimatedDurationUnit,costCategory:null==en?void 0:en.costCategory,service:null==en?void 0:en.service,supplier:null==en?void 0:en.supplier,frequency:null==en?void 0:en.frequency,frequencyDescription:null==en?void 0:en.frequencyDescription,costCustomer:null==en?void 0:en.costCustomer,costSupplier:null==en?void 0:en.costSupplier,customerMonthlyCharge:null==en?void 0:en.customerMonthlyCharge,supplierMonthlyCharge:null==en?void 0:en.supplierMonthlyCharge,firstInvoiceDate:null==en?void 0:en.firstInvoiceDate,finalInvoiceDate:null==en?void 0:en.finalInvoiceDate,invoicingBasis:P},nS.map(function(n){return Object.entries(e).filter(function(t){var o=(0,f.Z)(t,2),r=o[0],a=o[1];return n.requiredFields(e).includes(r)&&!!a}).length===n.requiredFields(e).length?n.value:null}).filter(Boolean));ex(n)},[P,null==en?void 0:en.costCategory,null==en?void 0:en.costCustomer,null==en?void 0:en.costSupplier,null==en?void 0:en.customerMonthlyCharge,null==en?void 0:en.description,null==en?void 0:en.estimatedDuration,null==en?void 0:en.estimatedDurationUnit,null==en?void 0:en.finalInvoiceDate,null==en?void 0:en.firstInvoiceDate,null==en?void 0:en.frequency,null==en?void 0:en.frequencyDescription,null==en?void 0:en.location,null==en?void 0:en.service,null==en?void 0:en.shortDescription,null==en?void 0:en.supplier,null==en?void 0:en.supplierMonthlyCharge]),(0,s.useEffect)(function(){if(U){if(Array.isArray(null==e$?void 0:e$.dates)&&p.current){p.current=!1;return}var e=t1(U,eE,eR).slice(0,355).map(function(e){return{date:e,selected:!0}});eS(e)}},[U,eR,eE,e$.frequency,null==e$?void 0:e$.dates]);var ez=function(e){if(!M){var n=t7({form:(0,v.Z)((0,i.Z)({},e),{invoicingType:P}),rruleMeta:eZ,dates:eI,jobScheduleId:null,reportPassFailFeature:ek,customerSignature:eP,supplierSignature:eM,startEndDates:eb,adminId:C.adminId,customerId:eh.id});eY({variables:{objects:[n]}})}},eU=function(e){var n=t8({form:(0,v.Z)((0,i.Z)({},e),{invoicingType:P}),rruleMeta:eZ,dates:eI,jobScheduleId:o,reportPassFailFeature:ek,customerSignature:eP,supplierSignature:eM,startEndDates:eb});on({oldData:e$,data:n}).isConfirm?g({content:function(e){var t=e.onClose;return(0,l.jsx)(oa,{onClose:t,onConfirm:function(){eG({variables:{data:(0,v.Z)((0,i.Z)({},n),{id:o})}})}})}}):eG({variables:{data:(0,v.Z)((0,i.Z)({},n),{id:o})}})},eK=function(e,n){eS(function(t){return t.map(function(t,o){return o===n?(0,v.Z)((0,i.Z)({},t),{selected:e.target.checked}):t})})},eX=function(e){eS(function(n){return n.map(function(n){return(0,v.Z)((0,i.Z)({},n),{selected:e.target.checked})})})},e0=function(e){return function(){O(e)}},e5=function(e){var n;if("object"==typeof(null==e?void 0:null===(n=e.meta)||void 0===n?void 0:n.template)){var t=e.meta.template,o=t.description,r=t.costCategorySelected,a=t.serviceSelected,i=t.amount,l=t.supplierLabourAmount,s=t.tags,u=t.reportPassFail,c=t.reportPassFailTitle,p=t.requireReportRecommendations,m=t.customerSignature,h=t.supplierSignature;$("description",o),r&&$("costCategory",{value:r.value,label:r.label}),a&&$("service",{value:a.value,label:a.label}),"onCompletion"===P&&(i&&$("costCustomer",i),l&&$("costSupplier",l)),(null==s?void 0:s.length)>0&&!d&&$("tags",s),eD({reportPassFail:Boolean(u),reportPassFailTitle:c||null,requireReportRecommendations:Boolean(p)}),eO(Boolean(m)),eF(Boolean(h))}},e3=(0,s.useMemo)(function(){return eI.map(function(e,n){var t=e.date,o=e.selected;return{date:t,id:n,weekDay:y()(t).format("ddd"),day:y()(t).format("DD"),month:y()(t).format("MMM"),year:y()(t).format("YYYY"),selected:o}})},[eI]),e6=function(e){var n=e.step;return ef.includes(n)||d?(0,l.jsx)(nB.Z,{sx:{color:"#36CF57",marginRight:"20px"}}):(0,l.jsx)(I.Z,{sx:oZ.adornment,children:n})};return(0,l.jsxs)(l.Fragment,{children:[x,(0,l.jsx)(D.Z,{open:eJ||eH||eQ,sx:{zIndex:1e4},children:(0,l.jsx)(q.Z,{color:"secondary"})}),(0,l.jsxs)("form",{id:"addJobScheduleForm",onSubmit:L(d?eU:ez),children:[(0,l.jsxs)(J.ZP,{container:!0,columnSpacing:2,children:[(0,l.jsxs)(J.ZP,{item:!0,xs:12,md:6,children:[(0,l.jsx)(nU.s,{headerAdornment:function(){return(0,l.jsx)(e6,{step:1})},title:"Set location",accordionSummarySx:oZ.accordion(ef.includes(1)||d),children:(0,l.jsxs)(u.Z,{direction:"row",width:"100%",flexWrap:"wrap",rowGap:2,columnGap:2,mt:2,children:[(0,l.jsx)(nO.Qr,{name:"location",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({fullWidth:!0,disabled:d||r,sx:oZ.selector,value:n},er),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Location",error:null==Y?void 0:Y.location}}))}}),(0,l.jsx)(nO.Qr,{name:"sublocation",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({fullWidth:!0,value:n,sx:oZ.selector,disabled:!(null==V?void 0:V.value)},eu),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Sublocation"}}))}}),(0,l.jsx)(nO.Qr,{name:"assetCategory",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({fullWidth:!0,value:n,sx:oZ.selector},ea),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Asset category"}}))}}),(0,l.jsx)(nO.Qr,{name:"assets",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({fullWidth:!0,multiple:!0,value:n,sx:oZ.selector,disabled:!(null==Q?void 0:Q.value)},ei),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Asset information"}}))}})]})}),(0,l.jsx)(nU.s,{headerAdornment:function(){return(0,l.jsx)(e6,{step:2})},title:"Work description",accordionSummarySx:oZ.accordion(ef.includes(2)||d),children:(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",flexWrap:"wrap",columnGap:2,rowGap:2,mt:2,children:[(0,l.jsx)(nO.Qr,{name:"shortDescription",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({fullWidth:!0,value:n,sx:oZ.selector,onChange:function(e,n){t(n),e5(n)}},el),{textFieldProps:{color:"secondary",label:"Short job description",error:null==Y?void 0:Y.shortDescription}}))}}),(0,l.jsx)(nC.Z,{fullWidth:!0,color:"secondary",inputRef:W,name:"reference",sx:oZ.textField,placeholder:"Customer reference"}),(0,l.jsx)(nC.Z,{fullWidth:!0,multiline:!0,color:"secondary",inputRef:W,name:"description",sx:oZ.multilineTextField,error:null==Y?void 0:Y.description,placeholder:"Work description"}),(0,l.jsx)(nC.Z,{type:"number",color:"secondary",inputRef:W,name:"estimatedDuration",placeholder:"Estimated duration",error:null==Y?void 0:Y.estimatedDuration,sx:{width:"40%"}}),(0,l.jsx)(nO.Qr,{name:"estimatedDurationUnit",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ol.P,{formControl:{fullWidth:!0,variant:"outlined",color:"secondary",error:Y.estimatedDurationUnit,sx:{width:"calc(60% - 16px)"}},selectProps:{fullWidth:!0},label:"Duration unit",value:n,onChange:t,options:[{label:"Hours",value:"hours"},{label:"Minutes",value:"minutes"},{label:"Days",value:"days"}]})}}),(0,l.jsx)(nO.Qr,{control:R,name:"compliance",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nH.Z,{label:"Compliance",sx:{width:"100%"},control:(0,l.jsx)(nM.Z,{checked:n,color:"secondary",onChange:function(e){var n;return t(null===(n=e.target)||void 0===n?void 0:n.checked)}})})}}),G&&(null==V?void 0:V.value)&&(0,l.jsx)(nO.Qr,{control:R,name:"complianceSelect",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({fullWidth:!0,value:n},em,oZ.groupedSelector),{groupBy:function(e){return e.category.label},onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Compliances",error:null==Y?void 0:Y.complianceSelect}}))}}),Z("admin")&&(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",children:[(0,l.jsx)(S.Z,{mr:1,children:"Tags: "}),(0,l.jsx)(ob,{values:z,setValue:$,name:"tags",entity:"JobSchedule",entityId:o,followingEntity:"Job",followingEntityIds:null===(n=e$.jobs)||void 0===n?void 0:n.map(function(e){return e.id})})]})]})}),(0,l.jsx)(nU.s,{headerAdornment:function(){return(0,l.jsx)(e6,{step:3})},title:"Select service",accordionSummarySx:oZ.accordion(ef.includes(3)||d),children:(0,l.jsxs)(u.Z,{direction:"row",width:"100%",flexWrap:"wrap",rowGap:2,columnGap:2,mt:2,children:[(0,l.jsx)(nO.Qr,{name:"costCategory",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({fullWidth:!0,value:n,sx:oZ.selector},ec),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Cost category",error:null==Y?void 0:Y.costCategory}}))}}),(0,l.jsx)(nO.Qr,{fullWidth:!0,name:"service",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({fullWidth:!0,value:n,sx:oZ.selector},es),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Service",error:null==Y?void 0:Y.service}}))}}),(0,l.jsx)(nO.Qr,{name:"supplier",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({fullWidth:!0,disabled:!(null==K?void 0:K.value)||!(null==V?void 0:V.value),value:n},ep),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Supplier",error:null==Y?void 0:Y.supplier}}))}})]})}),(0,l.jsx)(nU.s,{headerAdornment:function(){return(0,l.jsx)(e6,{step:4})},title:"Set schedule",accordionSummarySx:oZ.accordion(ef.includes(4)||d),children:(0,l.jsxs)(u.Z,{rowGap:2,children:[(0,l.jsx)(tU,{disableStartEndValidation:d,setValueParent:$,setRRuleMeta:ew,setOuterStartEndDates:ey,setFrequencyError:F,rruleMeta:null===(t=e$.meta)||void 0===t?void 0:t.rruleMeta,frequency:null==e$?void 0:e$.frequency}),(0,l.jsx)(nC.Z,{multiline:!0,color:"secondary",variant:"filled",inputRef:W,name:"frequencyDescription",label:"Frequency description",sx:oZ.multilineTextField,InputProps:{readOnly:!0},InputLabelProps:{shrink:!0}})]})}),(0,l.jsxs)(nU.s,{headerAdornment:function(){return(0,l.jsx)(e6,{step:5})},title:"Invoicing",accordionSummarySx:oZ.accordion(ef.includes(5)||d),children:[(0,l.jsxs)(u.Z,{direction:"row",children:[(0,l.jsx)(nH.Z,{label:"On completion",control:(0,l.jsx)(nQ.Z,{color:"secondary",checked:"onCompletion"===P,onChange:e0("onCompletion")})}),(0,l.jsx)(nH.Z,{label:"Fixed monthly amount",control:(0,l.jsx)(nQ.Z,{color:"secondary",checked:"fixedMonthlyAmount"===P,onChange:e0("fixedMonthlyAmount")})})]}),"onCompletion"===P&&(0,l.jsxs)(u.Z,{rowGap:2,mt:2,children:[(0,l.jsx)(nC.Z,{inputRef:W,name:"costCustomer",color:"secondary",type:"number",label:"Customer cost per visit",inputProps:{min:0},InputProps:{startAdornment:(0,l.jsx)(nG.Z,{position:"start",children:"\xa3"}),endAdornment:(0,l.jsx)(nG.Z,{position:"end",children:"Ex VAT"})}}),(0,l.jsx)(nC.Z,{inputRef:W,name:"costSupplier",color:"secondary",type:"number",label:"Supplier cost per visit",inputProps:{min:0},InputProps:{startAdornment:(0,l.jsx)(nG.Z,{position:"start",children:"\xa3"}),endAdornment:(0,l.jsx)(nG.Z,{position:"end",children:"Ex VAT"})}})]}),"fixedMonthlyAmount"===P&&(0,l.jsxs)(u.Z,{spacing:2,mt:2,width:"100%",children:[d&&((null==e$?void 0:e$.firstInvoiceDate)!==X||(null==e$?void 0:e$.finalInvoiceDate)!==ee)&&(0,l.jsx)(oj.Z,{variant:"standard",severity:"info",color:"info",children:"Any changes to the monthly amount will be reflected only in future invoices."}),(0,l.jsxs)(u.Z,{direction:"row",width:"100%",spacing:1,children:[(0,l.jsx)(nO.Qr,{name:"firstInvoiceDate",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nz.M,{views:["year","month"],value:n,onChange:t,minDate:new Date,label:"Month of first invoice",renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{sx:{width:"100%"},color:"secondary"}))}})}}),(0,l.jsx)(nO.Qr,{name:"finalInvoiceDate",control:R,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nz.M,{views:["year","month"],value:n,onChange:t,minDate:new Date,label:"Month of final invoice",renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{sx:{width:"100%"},color:"secondary"}))}})}})]}),(0,l.jsx)(nC.Z,{inputRef:W,name:"customerMonthlyCharge",color:"secondary",type:"number",label:"Monthly customer charge",inputProps:{min:0},InputProps:{startAdornment:(0,l.jsx)(nG.Z,{position:"start",children:"\xa3"}),endAdornment:(0,l.jsx)(nG.Z,{position:"end",children:"Ex VAT"})}}),(0,l.jsx)(nC.Z,{inputRef:W,name:"supplierMonthlyCharge",color:"secondary",type:"number",label:"Monthly supplier charge",inputProps:{min:0},InputProps:{startAdornment:(0,l.jsx)(nG.Z,{position:"start",children:"\xa3"}),endAdornment:(0,l.jsx)(nG.Z,{position:"end",children:"Ex VAT"})}})]})]}),(0,l.jsx)(k.Z,{sx:{marginLeft:"calc(100% - 100px)",width:"100px",marginTop:"20px"},color:"secondary",type:"submit",variant:"contained",children:d?"Save":"Add item"})]}),(0,l.jsx)(J.ZP,{item:!0,xs:12,md:6,mt:A?3:0,children:(0,l.jsx)(nF.i,{width:"100%",getRowClassName:function(e){return e.row.id%2==0?"even":"odd"},columnHeaderHeight:35,rowHeight:35,columns:[{width:30,field:"date",renderHeader:function(){return(0,l.jsx)(nV.Z,{title:"To skip or remove jobs from the PPM schedule to be created,\n             deselect the relevant lines below",slotProps:{popper:{sx:{zIndex:1e4}}},children:(0,l.jsx)(nM.Z,{color:"secondary",checked:eI.every(function(e){return e.selected}),onChange:function(e){return eX(e)}})})},sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsx)(nM.Z,{color:"secondary",checked:n.selected,onChange:function(e){return eK(e,n.id)}})}},{flex:1,field:"id",headerName:"Id",sortable:!1,renderCell:function(e){return e.row.id+1}},{flex:1,field:"weekDay",headerName:"Day of week",sortable:!1},{flex:1,field:"day",headerName:"Day of month",sortable:!1},{flex:1,field:"month",headerName:"Month",sortable:!1},{flex:1,field:"year",headerName:"Year",sortable:!1}],rows:e3})})]}),(0,l.jsx)("input",(0,v.Z)((0,i.Z)({},W("tags")),{type:"hidden"})),(0,l.jsx)("input",(0,v.Z)((0,i.Z)({},W("frequency")),{type:"hidden"}))]})]})},oC={location:null,sublocation:null,frequency:null,frequencyDescription:"",reference:"",customerMonthlyCharge:null,supplierMonthlyCharge:null,firstInvoiceDate:null,finalInvoiceDate:null,estimatedDuration:null,estimatedDurationUnit:null,assetCategory:null,assets:[],costCategory:null,complianceSelect:null,compliance:!1,costCustomer:null,costSupplier:null,description:"",service:null,shortDescription:null,supplier:null,customerSignature:!1,supplierSignature:!1,reportPassFail:!1,reportPassFailTitle:null,requireReportRecommendations:null,tags:[]},oI=t(11994),oS=t(50459),o_=t(57179),ok=function(e){var n=e.locationIdWatch,t=e.assetCategoryIdWatch,o=e.locationId,r=e.accountId,a=(0,s.useState)(""),i=a[0],l=a[1],u=(0,s.useState)(""),d=u[0],c=u[1],p=(0,s.useState)(""),m=p[0],h=p[1],v=(0,s.useState)(""),x=v[0],g=v[1],b=(0,s.useState)(""),y=b[0],j=b[1],w=(0,s.useState)(""),C=w[0],I=w[1],S=(0,s.useState)(""),_=S[0],k=S[1],D=(0,s.useState)(""),q=D[0],P=D[1],O=(0,f.Z)((0,Z.t)(ns.SW,{variables:{q:""!==i?"%".concat(i,"%"):null,limit:50,offset:0}}),2),T=O[0],M=O[1],F=M.loading,A=M.data,E=(void 0===A?{items:[]}:A).items,R=(0,f.Z)((0,Z.t)(ns._d,{variables:{where:{name:{_ilike:""!==d?"%".concat(d,"%"):null},status:{_eq:"active"}},limit:50,offset:0}}),2),N=R[0],W=R[1],$=W.loading,J=W.data,L=(void 0===J?{items:[]}:J).items,Y=(0,f.Z)((0,Z.t)(ns.zR,{variables:{locationId:(null==n?void 0:n.value)||o,q:""!==m?"%".concat(m,"%"):null,limit:50,offset:0}}),2),B=Y[0],H=Y[1],V=H.loading,G=H.data,Q=(void 0===G?{items:[]}:G).items,z=(0,f.Z)((0,Z.t)(ns._f,{variables:{where:{type:{_eq:"assetCategory"},isGroup:{_eq:!1},status:{_eq:"active"},name:{_ilike:""!==x?"%".concat(x,"%"):null}},limit:50,offset:0,orderBy:{name:"asc"}}}),2),U=z[0],K=z[1],X=K.loading,ee=K.data,en=(void 0===ee?{items:[]}:ee).items,et=(0,f.Z)((0,Z.t)(ns.UH,{variables:{locationId:(null==n?void 0:n.value)||o,categoryId:null==t?void 0:t.value,q:""!==y?"%".concat(y,"%"):null,limit:50,offset:0}}),2),eo=et[0],er=et[1],ea=er.loading,ei=er.data,el=(void 0===ei?{items:[]}:ei).items,es=(0,f.Z)((0,Z.t)(ns.by,{variables:{where:{type:{_eq:"supplier"},name:{_ilike:""!==C?"%".concat(C,"%"):null}},limit:50,offset:0}}),2),eu=es[0],ed=es[1],ec=ed.loading,ep=ed.data,em=(void 0===ep?{items:[]}:ep).items,eh=(0,f.Z)((0,Z.t)(ns.K4,{variables:{accountId:r,limit:50,offset:0,q:""!==_?"%".concat(_,"%"):null}}),2),ev=eh[0],ef=eh[1],ex=ef.data,eg=(void 0===ex?{items:[]}:ex).items,eb=ef.loading,ey=(0,f.Z)((0,Z.t)(ns.yR,{variables:{accountId:r,q:""!==q?"%".concat(q,"%"):null,limit:50,offset:0}}),2),ej=ey[0],eZ=ey[1],ew=eZ.data,eC=(void 0===ew?{items:[]}:ew).items;return{customerProps:{onOpen:T,loading:F,options:E,setSearch:l},propertyProps:{onOpen:N,loading:$,options:L,setSearch:c},sublocationProps:{onOpen:B,loading:V,options:Q,setSearch:h},assetCategoryProps:{onOpen:U,loading:X,options:en,setSearch:g},assetProps:{onOpen:eo,loading:ea,options:el,setSearch:j},supplierProps:{onOpen:eu,loading:ec,options:em,setSearch:I},customerManagerProps:{onOpen:ev,loading:eb,options:eg,setSearch:k},userProps:{onOpen:ej,loading:eZ.loading,options:eC,setSearch:P}}},oD={search:"",year:y()(),status:null,tags:null,customerId:null,locationId:null,sublocationId:null,userId:null,assetCategoryId:null,assetId:null,supplierId:null,customerManagerId:null,allJobs:null,allItems:null,hideExpiredItems:!1};function oq(){var e=(0,ep.Z)(["Status is ",""]);return oq=function(){return e},e}var oP=function(e){var n={search:function(e){return!!e&&"Search is ".concat(e)},year:function(e){return!!e&&"".concat(y()(e).format("YYYY"))},status:function(e){return(null==e?void 0:e.length)>0&&e(oq(),null==e?void 0:e.map(function(e){return e.label}).join(", "))},tags:function(e){return(null==e?void 0:e.length)>0&&"Tags is ".concat(null==e?void 0:e.map(function(e){return e.label}).join(", "))},customerId:function(e){return null!=e&&!!e.label&&"Customer is ".concat(null==e?void 0:e.label)},locationId:function(e){return null!=e&&!!e.label&&"Location is ".concat(null==e?void 0:e.label)},sublocationId:function(e){return null!=e&&!!e.label&&"Sublocation is ".concat(null==e?void 0:e.label)},userId:function(e){return null!=e&&!!e.label&&"User is ".concat(null==e?void 0:e.label)},assetCategoryId:function(e){return null!=e&&!!e.label&&"Asset Category is ".concat(null==e?void 0:e.label)},assetId:function(e){return null!=e&&!!e.label&&"Asset is ".concat(null==e?void 0:e.label)},supplierId:function(e){return null!=e&&!!e.label&&"Supplier is ".concat(null==e?void 0:e.label)},customerManagerId:function(e){return null!=e&&!!e.label&&"Customer Manager is ".concat(null==e?void 0:e.label)},allJobs:function(e){return null!=e&&!!e.label&&"All Jobs is ".concat(null==e?void 0:e.label)},allItems:function(e){return null!=e&&!!e.label&&"All Items is ".concat(null==e?void 0:e.label)},hideExpiredItems:function(e){return!!e&&"Exclude expired items"}};return Object.entries(e).reduce(function(e,t){var o=(0,f.Z)(t,2),r=o[0],a=o[1];if(!a||!n[r])return e;var i=(0,n[r])(a);return i&&e.push({key:r,label:i}),e},[])},oO=function(e){var n=e.locationId,t=e.open,o=e.close,r=e.hideFilters,a=e.filtersFormData,d=e.setFiltersFormData,c=e.setFilters,p=e.setFiltersChips,m=(0,eo.x)(),h=m.user,f=m.hasRole,x=f("admin"),g=f(["customer","supplier"]),b=(0,H.Z)("(max-width: 600px)"),y=(0,nO.cI)({defaultValues:(0,i.Z)({},oD)}),j=y.control,Z=y.handleSubmit,w=y.reset,C=y.getValues,I=y.watch,S=I("locationId"),_=I("assetCategoryId"),D=ok({locationIdWatch:S,assetCategoryIdWatch:_,locationId:n,accountId:h.accountId}),q=D.customerProps,P=D.propertyProps,O=D.sublocationProps,T=D.assetCategoryProps,M=D.assetProps,F=D.supplierProps,A=D.customerManagerProps,E=D.userProps;(0,s.useEffect)(function(){var e,t,o,r,l,s,u,d,m,h,v,f,x,g,b={search:a.search?"%".concat(a.search,"%"):null,status:(null===(e=a.status)||void 0===e?void 0:e.length)>0?null===(t=a.status)||void 0===t?void 0:t.map(function(e){return e.value}):null,tags:(null===(o=a.tags)||void 0===o?void 0:o.length)>0?null===(r=a.tags)||void 0===r?void 0:r.map(function(e){return e.value}):null,customerId:null===(l=a.customerId)||void 0===l?void 0:l.value,locationId:n||(null===(s=a.locationId)||void 0===s?void 0:s.value),sublocationId:null===(u=a.sublocationId)||void 0===u?void 0:u.value,userId:null===(d=a.userId)||void 0===d?void 0:d.value,assetCategoryId:null===(m=a.assetCategoryId)||void 0===m?void 0:m.value,assetId:null===(h=a.assetId)||void 0===h?void 0:h.value,supplierId:null===(v=a.supplierId)||void 0===v?void 0:v.value,customerManagerId:null===(f=a.customerManagerId)||void 0===f?void 0:f.value,allJobs:null===(x=a.allJobs)||void 0===x?void 0:x.value,allItems:null===(g=a.allItems)||void 0===g?void 0:g.value,year:a.year||oD.year,hideExpiredItems:a.hideExpiredItems};w((0,i.Z)({},oD,a)),c(function(e){return(0,i.Z)({},e,b)}),p(oP((0,i.Z)({},oD,a)))},[a,n,w,c,p]);var R=function(e){try{var n=C();d(function(e){return(0,i.Z)({},e,n)})}finally{o()}},N=function(){var e=(0,i.Z)({},oD);d(e),o()};return(0,l.jsx)(oI.Z,{keepMounted:!0,open:t,onClose:o,children:(0,l.jsx)("form",{onSubmit:Z(R),children:(0,l.jsxs)(oT,{is600pxOrLess:b,children:[(0,l.jsxs)(J.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,l.jsx)(J.ZP,{item:!0,xs:12,children:(0,l.jsx)(nO.Qr,{control:j,name:"search",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nC.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search schedule or work order",value:n,onChange:t})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"status",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{multiple:!0,limitTags:1,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n||[],onChange:function(e,n){t(n)},options:(0,oS.lR)(),textFieldProps:{color:"secondary",variant:"standard",label:"Select status"}})}})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(o_.r,{control:j})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"customerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},q),{textFieldProps:{color:"secondary",variant:"standard",label:"Select customer"}}))}})}),!r.includes("location")&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"locationId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},P),{textFieldProps:{color:"secondary",variant:"standard",label:"Select location"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"sublocationId",control:j,render:function(e){var t=e.value,o=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({disabled:!(null==S?void 0:S.value)&&!n,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t,onChange:function(e,n){o(n)}},O),{textFieldProps:{color:"secondary",variant:"standard",label:"Select sublocation"}}))}})}),g&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"userId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},E),{textFieldProps:{color:"secondary",variant:"standard",label:"Select user"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"assetCategoryId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},T),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset category"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"assetId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},M),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset"}}))}})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"supplierId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},F),{textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"}}))}})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"customerManagerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},A),{textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"allJobs",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"compliance",label:"Compliance jobs only"},{value:"overduePPM",label:"Overdue jobs"},{value:"incompleteFollowOn",label:"Incomplete follow on works"},{value:"followOn",label:"Jobs with follow on works"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Jobs"}})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"allItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"complete",label:"with completed jobs"},{value:"incomplete",label:"with incomplete jobs"},{value:"all",label:"with jobs during period"}],textFieldProps:{color:"secondary",variant:"standard",label:"Show all items"}})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{control:j,name:"year",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nz.M,{views:["year"],inputFormat:"YYYY",value:n,onChange:function(e){e?t(e.toISOString()):t(e)},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{fullWidth:!0,label:"Select year",color:"secondary",variant:"standard"}))}})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"hideExpiredItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nH.Z,{control:(0,l.jsx)(nM.Z,{color:"secondary",checked:n,onChange:function(e,n){return t(n)}}),label:"Hide expired items"})}})})]}),(0,l.jsxs)(u.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,l.jsx)(k.Z,{variant:"contained",color:"danger",onClick:function(){return N()},children:"Cancel"}),(0,l.jsx)(k.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})};oO.defaultProps={open:!1,close:function(){},hideFilters:[],filtersFormData:{},setFiltersFormData:function(){},setFilters:function(){},setFiltersChips:function(){}},oO.propTypes={locationId:g().string,open:g().bool,close:g().func,hideFilters:g().array,filtersFormData:g().object,setFiltersFormData:g().func,setFilters:g().func,setFiltersChips:g().func};var oT=(0,oh.Z)(d.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:n?"0px":"8px",overflowY:"auto"}}),oM=t(9492),oF=t(64872),oA=t(86267),oE=function(e){var n=e.entityId,t=e.refetch;return(0,l.jsx)(oA.G,{entity:"JobSchedule",entityId:n,refetch:t})},oR=function(e){var n=e.locaitonId,t=(0,(0,eo.x)().hasRole)("tenant");return(0,l.jsx)(oA.G,{showItemActions:!t,category:"PPM",entity:"Location",entityId:n,expanded:!0,hideExpandIcon:!0})},oN=t(14924),oW=t(59938),o$=function(){var e=(0,f.Z)((0,oW.X)("ppm_item_view",{}),2),n=e[0],t=e[1];return{saveSessionData:function(e,o){t((0,v.Z)((0,i.Z)({},n),(0,oN.Z)({},e,o)))},getSessionDataByKey:function(e){var t=Object.entries(n).find(function(n){return(0,f.Z)(n,1)[0]===e.toString()});return t?t[1]:null}}},oJ=function(e,n,t){var o=new Date(e).getTime();return t?!e||n?"black":Date.now()+7889238e3<o?"success":Date.now()+7889238e3>o&&Date.now()<o?"info":Date.now()>o?"warning":void 0:"white"},oL=function(e){return null!==(a=e.some(function(e){var n=e.statusData;return!(null==n?void 0:n.completed)&&!(null==n?void 0:n.closed)}))&&void 0!==a?a:null},oY=(0,c.ZP)(I.Z)(function(e){var n=e.theme,t=e.backgroundColor,o=e.height;return(0,v.Z)((0,i.Z)({position:"absolute",left:-10,top:"calc(50% - ".concat(o/2,"px)"),backgroundColor:n.palette[t].main,width:"5px",height:"".concat(o,"px")},"white"===t&&{border:"1px solid black"}),{borderTopRightRadius:"".concat(o,"px"),borderBottomRightRadius:"".concat(o,"px")})}),oB=function(e,n){switch(e){case"compliance":return[{status:{_neq:"canceled"},Compliances:{}}];case"overduePPM":return[{_and:[{status:{_neq:"canceled"}},{timingStart:{_lte:n}},{_not:{statusData:{_has_key:"inProgress"}}},{_not:{statusData:{_has_key:"closed"}}}]}];case"incompleteFollowOn":return[{status:{_neq:"canceled"},Jobs:{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}}];case"followOn":return[{status:{_neq:"canceled"},Jobs:{}}];default:return[]}},oH=function(e){switch(e){case"complete":return[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]}];case"incomplete":return[{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}];default:return[]}},oV=function(e,n){switch(n){case"supplier":return{supplierUserId:{_eq:e}};case"customer":return{customerUserId:{_eq:e}};default:return{}}},oG=function(e,n){var t,o,r,a,l,s,u,d=e.search,c=e.status,p=e.tags,m=e.customerId,h=e.locationId,v=e.sublocationId,f=e.userId,x=e.assetCategoryId,g=e.assetId,b=e.supplierId,j=e.customerManagerId,Z=e.allJobs,w=e.allItems,C=(e.year,e.hideExpiredItems),I=y()().subtract(24,"hours").toISOString(),S=[];S.push(b?{_or:[{supplierId:{_eq:b}},{status:{_eq:"offered"},SupplierOffers:{accountId:{_eq:b},status:{_in:["offered","accepted"]}}}]}:{}),S.push(d?{_or:[{reference:{_ilike:d}},{description:{_ilike:d}},{_or:[{JobSchedule:{reference:{_ilike:d}}},{JobSchedule:{description:{_ilike:d}}}]}]}:{}),S.push((null==c?void 0:c.length)>0?{status:{_in:c}}:{}),S.push((null==p?void 0:p.length)>0?{Taxonomy:{entity:{_eq:"Job"},Taxonomy:{status:{_eq:"active"},type:{_eq:"tags"},id:{_in:p}}}}:{}),S.push(oV(f,n)),S.push(g?{Assets:{entity:{_eq:"JobSchedule"},assetId:{_eq:g}}}:{}),S.push(j?{Customer:{Manager:{id:{_eq:j}}}}:{}),S.push.apply(S,(0,$.Z)(oB(Z,I))),S.push.apply(S,(0,$.Z)(oH(w))),S.push(C?{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}:{});var _=S.filter(function(e){return!os.isEmpty(e)});return{where:(0,i.Z)({locationId:{_eq:h},sublocationId:{_eq:v}},(null==_?void 0:_.length)||x||m||"all"===w?{Jobs:(0,i.Z)({status:{_neq:"canceled"},_and:_},x?{assetCategoryId:{_eq:x}}:{},m?{customerId:{_eq:m}}:{})}:{})}},oQ=t(87918),oz=function(e){var n=e.filtersChips,t=e.onRemove;return(0,l.jsx)(u.Z,{direction:"row",sx:{overflowX:"auto"},alignItems:"center",spacing:1,children:n.map(function(e){return(0,l.jsx)(oQ.Z,{label:e.label,onDelete:function(){return t(e.key)}},e.key)})})};oz.propTypes={filtersChips:g().array,onRemove:g().func},oz.defaultProps={filters:[],onRemove:function(){}};var oU=t(75832),oK=t(23508),oX=t(98409),o0=t(91807),o1=t(86076),o2=t(34270),o5=function(e){var n=e.columns,t=e.rows,o=e.columnVisibilityModel,r=void 0===o?{}:o,a=e.renderIdentifierCell,d=void 0===a?null:a,c=e.renderValueCell,p=void 0===c?null:c,m=e.getDetailPanelContent,h=void 0===m?null:m,f=(0,s.useState)(null),x=f[0],g=f[1],b=(0,s.useMemo)(function(){return[{headerName:"",flex:1,field:"identifier",sortable:!1,renderCell:d?function(e){return d(e.row)}:function(e){var n=e.row;return(0,l.jsx)(u.Z,{sx:{fontWeight:"600",fontSize:"16px"},children:n.identifier})}},{headerName:"",flex:1,field:"valueCell",sortable:!1,renderCell:p?function(e){return p(e.row)}:"function"==typeof n[0].renderCell?n[0].renderCell:function(e){var t=e.row;return(0,l.jsx)(u.Z,{ml:2,children:"function"==typeof n[0].valueFormatter?n[0].valueFormatter({value:t[n[0].field]}):t[n[0].field]})}},(0,v.Z)((0,i.Z)({},oX.a),{renderCell:function(e){return(0,l.jsx)(o3,{setId:g,id:e.id,value:e.value})}})]},[n,d,p]),y=(0,s.useMemo)(function(){return null==t?void 0:t.map(function(e){return(0,v.Z)((0,i.Z)({},e),{identifier:n[0].headerName})})},[n,t]),j=(0,s.useMemo)(function(){return n.slice(1,n.length).filter(function(e){var n=e.field,t=e.isGridTogglePanel;return null!==r[n]&&!1!==r[n]&&!t}).map(function(e){return{identifier:{label:e.headerName},valueCell:{label:e.field,renderCell:"function"==typeof e.renderCell?e.renderCell:null,valueFormatter:"function"==typeof e.valueFormatter?e.valueFormatter:null}}})},[r,n]);return(0,l.jsx)(nF.i,(0,v.Z)((0,i.Z)({},e),{rows:y,columns:b,getRowClassName:function(e){return e.id===x?"odd":""},slots:{columnHeaders:function(){return null}},getDetailPanelHeight:function(){return"auto"},getDetailPanelContent:function(e){var n=e.row;return(0,l.jsx)(o6,{row:n,columns:j,getDetailPanelContent:h})}}))},o3=function(e){var n=e.id,t=e.value,o=e.setId,r=(0,o0.l)();(0,s.useEffect)(function(){t&&o(n)},[o,t,n]);var a=(0,o1.P)(r,o2.Z3),i=s.isValidElement(a[n]);return(0,l.jsx)(_.Z,{size:"small",tabIndex:-1,disabled:!i,"aria-label":t?"Close":"Open",children:(0,l.jsx)(oK.Z,{sx:function(e){return{transform:"rotateZ(".concat(t?180:0,"deg)"),transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})}},fontSize:"inherit"})})},o6=function(e){var n=e.columns,t=e.row,o=e.getDetailPanelContent;return(0,l.jsxs)(l.Fragment,{children:[o?o({row:t}):null,n.map(function(e){var n=e.identifier,o=e.valueCell;return(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{padding:"10px",marginTop:"10px",borderBottom:"1px solid #E0E0E0"},children:[(0,l.jsx)(u.Z,{width:"40%",sx:{fontWeight:"600",fontSize:"16px"},children:n.label}),(0,l.jsx)(u.Z,{width:"60%",ml:2,children:o.renderCell?o.renderCell({row:t}):o.valueFormatter?o.valueFormatter({value:t[o.label]}):t[o.label]})]})})]})},o4=(0,s.forwardRef)(function(e,n){return(0,H.Z)("(max-width: 600px)")?(0,l.jsx)(o5,(0,v.Z)((0,i.Z)({},e),{ref:n})):(0,l.jsx)(nF.i,(0,v.Z)((0,i.Z)({},e),{ref:n}))}),o9=t(67720),o7=function(e){var n=e.mainKey,t=e.open,o=e.close,r=e.columns,a=e.setColumns,d=e.submitBtnText,c=e.subtitle,p=e.onCompleted,m=(0,H.Z)("(max-width: 600px)"),h=(0,s.useState)(null),v=h[0],x=h[1],g=(0,s.useMemo)(function(){return r.filter(function(e){return e.defaultSelected})},[r]),b=(0,f.Z)((0,oW.X)("".concat(void 0===n?"scheduled_job_table_jobs_column_selector":n),{columns:g},"sessionStorage"),2),y=b[0],j=b[1],Z=(0,nO.cI)({defaultValues:{columns:g}}),w=Z.control,C=Z.handleSubmit,I=Z.reset;(0,s.useEffect)(function(){var e=(null==y?void 0:y.columns)||g||[];I({columns:e}),a((0,$.Z)(e))},[y,I,a,g]);var _=function(e){if(!e.columns.length){x("Please select at least one column");return}try{p(e),j(function(n){return(0,i.Z)({},n,e)})}finally{o(),x(null)}},D=function(){j({columns:g}),x(null),o()};return t&&(0,l.jsx)(oI.Z,{open:t,onClose:o,children:(0,l.jsx)("form",{onSubmit:C(_),children:(0,l.jsxs)(o8,{is600pxOrLess:m,children:[(0,l.jsxs)(u.Z,{spacing:2,children:[(0,l.jsx)(S.Z,{variant:"h6",children:"Column Selection"}),(0,l.jsx)(S.Z,{variant:"body2",color:"muiGray.main",children:c}),(0,l.jsx)(o9.Z,{}),(0,l.jsx)(nO.Qr,{control:w,name:"columns",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{multiple:!0,value:n,onChange:function(e,n){return t(n)},options:r,textFieldProps:{fullWidth:!0,label:"Columns",color:"secondary"}})}})]}),v&&(0,l.jsx)(oj.Z,{sx:{margin:"10px 0"},severity:"error",children:v}),(0,l.jsxs)(u.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,l.jsx)(k.Z,{variant:"contained",color:"danger",onClick:function(){return D()},children:"Cancel"}),(0,l.jsx)(k.Z,{variant:"contained",color:"secondary",type:"submit",children:d})]})]})})})};o7.defaultProps={open:!1,close:function(){},columns:[],setColumns:function(){},onCompleted:function(){},submitBtnText:"Apply",subtitle:"Select the columns you would like to see in the table."},o7.propTypes={open:g().bool,close:g().func,columns:g().array,setColumns:g().func,submitBtnText:g().string,subtitle:g().string,onCompleted:g().func};var o8=(0,oh.Z)(d.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:"8px",overflowY:"auto"}}),re=function(e){var n=e.isCustomer,t=e.isTenant;return[{label:"Item name",value:"shortDescriptionName",defaultSelected:!0},{label:"Job Description",value:"description",defaultSelected:!0},{label:"Service name",value:"serviceName",defaultSelected:!0},{hide:n||t,label:"Assigned to",value:"supplierName",defaultSelected:!0},{label:"Sublocation Name",value:"sublocation",defaultSelected:!0},{label:"Asset Category",value:"assetCategoryName",defaultSelected:!0},{label:"Assets name",value:"assetName",defaultSelected:!0},{label:"Start Date",value:"scheduleStart",defaultSelected:!0},{label:"End Date",value:"scheduleEnd",defaultSelected:!0},{label:"Frequency",value:"frequencyDescription",defaultSelected:!0},{label:"Job ID",value:"jobIds",defaultSelected:!0},{label:"Job name",value:"jobName",defaultSelected:!0},{label:"Job status",value:"jobStatus",defaultSelected:!0}].filter(function(e){return!e.hide})},rn=t(63139),rt={title:{color:"#323E4E"},subtitle:{color:"#323E4E",fontWeight:"300"},indicatorWrapper:{position:"relative"},indicator:{position:"absolute",left:-10,top:"calc(50% - 55px)",backgroundColor:"#000",width:"5px",height:"110px",borderTopRightRadius:"110px",borderBottomRightRadius:"110px"},zeroFrequencyJobScheduled:{backgroundColor:"#C1C1C1",color:"#000000",padding:"5px",borderRadius:"5px"},squaredIconButton:{backgroundColor:"#1E88E5",color:"#ffffff",borderRadius:"5px",height:"30px","&:hover":{opacity:.8,backgroundColor:"#1E88E5"}},actionsIcon:{color:"#000000"},smallButton:{height:"30px"}},ro=function(e){var n,t,o,r,a,d=e.locationId,c=e.locationName,p=e.initialFilters,m=e.columnVisibilityModel,h=e.tableHeight,x=e.containerHeight,g=e.hasHeader,b=void 0===g||g,R=e.hideFilters,$=(0,rn.s)(),J=(0,H.Z)("(max-width:1000px)"),L=(0,H.Z)("(max-width:600px)"),Y=(0,eo.x)(),B=Y.user,V=Y.hasRole,G=V("supplier"),Q=V("customer"),z=V("tenant"),U=V(["customer","supplier"]),K=(0,nJ.D)(),X=(0,s.useState)(p),ee=X[0],en=X[1],er=(0,nA.x)({filters:ee}),ea=er.initialData,ei=er.ref,el=(0,s.useState)(!1),es=el[0],eu=el[1],ed=(0,s.useState)(!1),ec=ed[0],ep=ed[1],em=(0,s.useState)([]),eh=em[0],ev=em[1],ef=o$(),ex=ef.getSessionDataByKey,eg=ef.saveSessionData,eb=(0,oF.a)(),ey=(0,f.Z)((0,oW.X)("scheduledjob_table_items_".concat(p.filterType),p,b?"network":"state"),2),ej=ey[0],eZ=ey[1],ew=(0,s.useMemo)(function(){return oG((0,i.Z)({},ee),B.accountType)},[ee,B.accountType]),eC=(0,j.a)(eH,{variables:(0,i.Z)({},ea,ew)}),eI=eC.data,eS=void 0===eI?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:eI,e_=eS.jobSchedule,ek=eS.meta,eD=eC.loading,eq=eC.refetch,eP=(0,f.Z)((0,Z.t)(eH,{variables:(0,i.Z)((0,v.Z)((0,i.Z)({},ea),{limit:null,offset:0}),ew)}),2),eO=eP[0],eT=eP[1].loading,eM=(0,f.Z)((0,w.D)(e5,{refetchQueries:["GetJobSchedules","GetCalendarJobs"],onCompleted:function(){K.show({content:"Job(s) were successfully deleted.",severity:"success"})},onError:function(e){K.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eF=eM[0],eA=eM[1].loading,eE=(0,f.Z)((0,w.D)(e3,{refetchQueries:["GetJobSchedules","GetCalendarJobs"],onCompleted:function(){K.show({content:"Job(s) were successfully created.",severity:"success"})},onError:function(e){K.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eR=eE[0],eN=eE[1].loading,eW=function(e){var n=e.columns;eO().then(function(e){var t=e.data,o=N().unparse(t9(null==t?void 0:t.jobSchedule,n,t6)),r="data:application/octet-stream,"+encodeURIComponent(o);(0,oM.S)(r,"Planned_Maintenance_".concat(y()().format("YYYY/MM/DD"),".csv"))})},e$=(0,s.useCallback)(function(e){eZ(function(n){var t=(0,i.Z)({},n);return delete t[e],t})},[eZ]),eJ=(0,s.useCallback)(function(){eb.show({title:"Add item by passing through stages below",content:(0,l.jsx)(ow,{locationId:d,locationName:c,onClose:eb.close}),submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"95vw",lg:"85vw",lg2:"85vw"})},[d,c,eb]),eL=(0,s.useCallback)(function(e){var n=e.jobScheduleId;eb.show({title:"Edit item",content:(0,l.jsx)(ow,{edit:!0,jobScheduleId:n,onClose:eb.close}),submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"95vw",lg:"85vw",lg2:"85vw"})},[eb]),eY=(0,s.useCallback)(function(e){var n=e.jobScheduleId,t=e.jobStatus,o=e.description;eb.show({content:(0,l.jsx)(nZ,{jobScheduleId:n,status:t?[t]:null,startDate:null,endDate:null,onClose:eb.close}),title:"Works orders (".concat(o,")"),xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[eb]),eB=(0,s.useCallback)(function(e){eF({variables:{id:e}})},[eF]),eV=(0,s.useCallback)(function(e){return function(){eb.show({title:"Media",content:(0,l.jsx)(oE,{entityId:e,refetch:eq})})}},[eb,eq]),eG=(0,s.useCallback)(function(e){eR({variables:{jobScheduleId:e.id}})},[eR]),eQ=function(e){var t;return(0,l.jsxs)(I.Z,{sx:rt.indicatorWrapper,children:[(0,l.jsx)(oY,{height:110,backgroundColor:oJ(e.scheduleEnd,!oL(null!==(n=e.jobs)&&void 0!==n?n:[]),!!(null===(t=e.jobs)||void 0===t?void 0:t.length))}),(0,l.jsx)(u.Z,{direction:"row",alignItems:"center",columnGap:2,sx:{fontWeight:"600",fontSize:"16px",marginLeft:"10px"},children:e.identifier})]})},ez=function(e){var n;return(0,l.jsx)(I.Z,{sx:rt.indicatorWrapper,children:(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",columnGap:2,sx:{overflow:"auto",height:"100%",width:"220px"},children:[e.compliance&&(0,l.jsx)(E.Z,{sx:{color:"info.main",marginLeft:"10px"}}),(0,l.jsxs)(u.Z,{ml:2,children:[(0,l.jsx)(S.Z,{typography:"subtitle1",sx:(0,v.Z)((0,i.Z)({},rt.title),{whiteSpace:"normal"}),children:(null===(n=e.shortDescription)||void 0===n?void 0:n.label)||e.shortDescription}),(0,l.jsx)(et.O,{sx:(0,v.Z)((0,i.Z)({},rt.subtitle),{whiteSpace:"normal"}),fontSize:"12px",maxLength:20,children:e.description})]})]})})},eU=(0,s.useMemo)(function(){return[{headerName:"Job",field:"job",sortable:!1,width:250,renderCell:function(e){var n,t,o=e.row,r=oJ(o.scheduleEnd,!oL(null!==(t=o.jobs)&&void 0!==t?t:[]),!!(null===(n=o.jobs)||void 0===n?void 0:n.length));return(0,l.jsxs)(I.Z,{sx:rt.indicatorWrapper,children:[(0,l.jsx)(oY,{height:110,backgroundColor:r}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",children:[o.compliance&&(0,l.jsx)(I.Z,{ml:1,children:(0,l.jsx)(E.Z,{sx:{color:"info.main"}})}),(0,l.jsxs)(u.Z,{ml:2,children:[(0,l.jsx)(S.Z,{typography:"subtitle1",sx:(0,i.Z)({},rt.title),children:o.shortDescription}),(0,l.jsx)(et.O,{sx:(0,v.Z)((0,i.Z)({},rt.subtitle),{whiteSpace:"normal"}),fontSize:"12px",maxLength:20,children:o.description})]})]})]})}},{headerName:"Service",field:"service",sortable:!1,width:250,renderCell:function(e){var n,t,o,r=e.row;return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(S.Z,{typography:"subtitle1",children:r.serviceName}),!Q&&!z&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:"Assigned to:"}),(0,l.jsx)(W.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(null===(n=r.supplier)||void 0===n?void 0:n.value),noWrap:!(null===(t=r.supplier)||void 0===t?void 0:t.value)||G,children:null===(o=r.supplier)||void 0===o?void 0:o.label})]})]})}},{headerName:"Details",field:"details",sortable:!1,width:250,renderCell:function(e){var n,r,a=e.row;return(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:["Sublocation: ",null!==(t=null===(n=a.sublocation)||void 0===n?void 0:n.label)&&void 0!==t?t:"-"]}),(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:["Asset category: ",null!==(o=a.assetCategory)&&void 0!==o?o:"-"]}),(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:["Assets:"," ",(null===(r=a.assets)||void 0===r?void 0:r.length)?a.assets.map(function(e){return e.asset.name}).join(", "):"-"]})]})}},{headerName:"Frequency",field:"frequency",sortable:!1,width:400,renderCell:function(e){var n,t,o=e.row;return(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:["Start date: ",y()(o.scheduleStart).format("DD-MM-YYYY")]}),(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:["End date: ",y()(o.scheduleEnd).format("DD-MM-YYYY")]}),(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:["Frequency:\xa0",o.frequencyDescription.charAt(0).toUpperCase()+o.frequencyDescription.slice(1)]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",columnGap:2,mt:1,children:[!(null===(n=o.jobs)||void 0===n?void 0:n.length)&&!U&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(I.Z,{sx:rt.zeroFrequencyJobScheduled,children:"0 jobs"}),(0,l.jsx)(k.Z,{variant:"contained",color:"success",sx:rt.smallButton,onClick:function(e){e.stopPropagation(),eG(o)},children:"Create job(s)"})]}),!!(null===(t=o.jobs)||void 0===t?void 0:t.length)&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(k.Z,{variant:"contained",color:"secondary",size:"small",sx:{height:"30px"},onClick:function(e){var n,t;e.stopPropagation(),eY({jobScheduleId:o.id,jobStatus:null,description:o.title,totalJobCount:null!==(t=null===(n=o.jobs)||void 0===n?void 0:n.length)&&void 0!==t?t:0})},children:[o.jobs.length," jobs scheduled"]})})]})]})}},{field:"invoicePeriod",headerName:"Invoice period",width:350,sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{columnGap:2,children:[(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:["Month of first invoice: ",null!==(r=n.firstInvoiceDate)&&void 0!==r?r:"-"]}),(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:["Month of final invoice: ",null!==(a=n.finalInvoiceDate)&&void 0!==a?a:"-"]})]})}},{field:"invoiceBasis",headerName:"Invoice basis",width:350,sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsx)(S.Z,{typography:"h6",children:n.invoiceBasis?n.invoiceBasis.match(/[A-Z][a-z]+/g).join(" "):"N/A"})}},{field:"invoiceAmount",headerName:"Invoice amount",width:350,sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{columnGap:2,children:[(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:["Customer amount:\xa0","onCompletion"===n.invoiceBasis?(0,oU.T)(n.costCustomer):(0,oU.T)(n.customerMonthlyCharge)]}),!Q&&!z&&(0,l.jsxs)(S.Z,{typography:"subtitle2",sx:rt.subtitle,children:["Supplier amount:\xa0","onCompletion"===n.invoiceBasis?(0,oU.T)(n.costSupplier):(0,oU.T)(n.supplierMonthlyCharge)]})]})}},{headerName:"Work orders",field:"workOrders",sortable:!1,width:350,renderCell:function(e){var n=e.row;return(0,l.jsx)(nD,{row:n,handleOpenJobsFromSchedule:eY,sessionData:ex(n.id),saveSessionData:eg})}},{headerName:"Actions",field:"actions",sortable:!1,width:150,renderCell:function(e){var n,t,o=e.row;return(0,l.jsxs)(u.Z,{direction:"row",justifyContent:"space-around",alignItems:"center",children:[(0,l.jsx)(_.Z,{onClick:eV(o.id),children:(0,l.jsx)(C.Z,{color:"success",variant:"dot",invisible:!(null===(n=o.media)||void 0===n?void 0:n.length),children:(0,l.jsx)(A.Z,{sx:rt.actionsIcon})})}),!U&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(_.Z,{children:(0,l.jsx)(M.Z,{sx:rt.actionsIcon,onClick:function(){return eL({jobScheduleId:o.id})}})}),!(null==o?void 0:null===(t=o.jobs)||void 0===t?void 0:t.length)&&(0,l.jsx)(_.Z,{onClick:function(){return eB(o.id)},children:(0,l.jsx)(O.Z,{sx:rt.actionsIcon})})]})]})}}]},[ex,eG,eB,eL,eY,eV,U,G,Q,z,eg]),eK=(0,s.useMemo)(function(){return e_.map(function(e){var n,t,o,r,a,i,l,s,u=e.jobs.filter(function(e){var n=e.statusData;return(null==n?void 0:n.completed)||(null==n?void 0:n.closed)}).length;return{id:e.id,serviceName:e.meta.serviceName,title:e.meta.shortDescriptionName,frequency:e.frequency,frequencyDescription:e.frequencyDescription,jobs:e.jobs,assets:(null===(n=e.assets)||void 0===n?void 0:n.length)?e.assets:[],completeCount:u,description:null!==(s=e.description)&&void 0!==s?s:e.meta.description,compliance:null===(t=e.meta)||void 0===t?void 0:t.compliance,location:e.location,scheduleStart:e.scheduleStart,scheduleEnd:e.scheduleEnd,media:e.media,firstInvoiceDate:e.firstInvoiceDate?y()(e.firstInvoiceDate).format("YYYY-MM-DD"):null,finalInvoiceDate:e.finalInvoiceDate?y()(e.finalInvoiceDate).format("YYYY-MM-DD"):null,invoiceBasis:e.invoiceBasis,customerMonthlyCharge:e.customerMonthlyCharge,supplierMonthlyCharge:e.supplierMonthlyCharge,costCustomer:null===(o=e.meta)||void 0===o?void 0:o.costCustomer,costSupplier:null===(r=e.meta)||void 0===r?void 0:r.costSupplier,assetCategory:null===(a=e.assetCategory)||void 0===a?void 0:a.name,sublocation:e.sublocation?{label:null===(i=e.sublocation)||void 0===i?void 0:i.name,value:null===(l=e.sublocation)||void 0===l?void 0:l.id}:null,costCategory:{value:e.meta.costCategoryId,label:e.meta.costCategoryName},shortDescription:e.meta.shortDescriptionName,supplier:e.meta.supplierId?{value:e.meta.supplierId,label:e.meta.supplierName}:null}})},[e_]),eX=function(){eb.show({content:(0,l.jsx)(nY,{locationId:null!=d?d:null}),xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"80vw",md2:"80vw",lg:"80vw",lg2:"80vw"})},e0=(0,s.useMemo)(function(){var e={};return!eK.length&&(null==ea?void 0:ea.q)?{title:"No results",subtitleFirstLine:"The filters you have applied have returned no results",subtitleSecondLine:"Please amend and try again if necessary."}:{title:"No ppm jobs found",subtitleFirstLine:"You currently have no ppm jobs set up",subtitleSecondLine:"Click add item to get started building.",buttonText:"Add item",onAction:eJ}},[eJ,null==ea?void 0:ea.q,eK]),e1=(0,i.Z)({},void 0===m?{}:m);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(oO,{locationId:d,open:es,close:function(){return eu(!1)},hideFilters:void 0===R?[]:R,filtersFormData:ej,setFiltersFormData:eZ,setFilters:en,setFiltersChips:ev}),(0,l.jsx)(o7,{mainKey:"scheduled_job_table_items_column_selector",open:ec,close:function(){return ep(!1)},columns:re({isCustomer:Q,isTenant:z}),onCompleted:function(e){return eW(e)},submitBtnText:"Export",subtitle:"Select the columns you would like to export in the csv file."}),(0,l.jsx)(D.Z,{sx:{zIndex:1e5},open:eN||eA||eT,children:(0,l.jsx)(q.Z,{color:"secondary"})}),(0,l.jsxs)(u.Z,{sx:{height:void 0===x?"calc(100vh - 100px)":x},children:[b&&(0,l.jsxs)(I.Z,{pl:2,pr:2,mb:1,mt:1,sx:{display:"grid",alignItems:"flex-start",height:"auto",gridTemplateAreas:J?'"filter-btn calendar-btn"\n                "filter-chip filter-chip"':'"filter-btn filter-chip calendar-btn"',gridTemplateColumns:J?"auto auto":"96px auto 250px",columnGap:J?0:2,rowGap:J?2:0},children:[(0,l.jsx)(I.Z,{sx:{gridArea:"filter-btn"},children:(0,l.jsx)(k.Z,{sx:{height:"35px"},variant:"contained",startIcon:(0,l.jsx)(F.Z,{}),onClick:function(){return eu(!0)},children:"Filters"})}),(0,l.jsx)(I.Z,{sx:{gridArea:"filter-chip",overflow:"hidden"},children:(0,l.jsx)(oz,{filtersChips:eh,onRemove:e$})}),(0,l.jsxs)(I.Z,{sx:{gridArea:"calendar-btn",justifySelf:"flex-end"},children:[d&&!U&&!$&&!L&&(0,l.jsx)(k.Z,{disableMinWidth:!0,color:"info",variant:"contained",sx:{height:"35px",marginRight:"10px!important"},onClick:eX,children:(0,l.jsx)(P.Z,{})}),!$&&!L&&(0,l.jsx)(k.Z,{disableMinWidth:!0,color:"info",variant:"contained",sx:{height:"35px",marginRight:"10px!important"},onClick:function(){return ep(!0)},children:(0,l.jsx)(T.Z,{})}),!U&&(0,l.jsx)(k.Z,{sx:{width:"100px"},variant:"contained",color:"success",onClick:eJ,children:"Add Item"})]})]}),(null==eK?void 0:eK.length)?(0,l.jsx)(o4,{rowHeight:120,ref:ei,loading:eD,columns:eU,rows:eK,columnVisibilityModel:e1,renderIdentifierCell:eQ,renderValueCell:ez,meta:ek,refetch:eq,autoHeight:!1,containerHeight:void 0===h?"calc(100% - 32px)":h}):!eD&&(0,l.jsx)(nb.C,(0,i.Z)({imageSrc:"/static/icons/no_locations_found.svg"},e0))]})]})};ro.propTypes={locationId:g().string,locationName:g().string,initialFilters:g().object,columnVisibilityModel:g().object,tableHeight:g().string,containerHeight:g().string,hasHeader:g().bool,hideFilters:g().array},ro.defaultProps={};var rr=t(53219),ra=t(41796),ri=function(e){var n=e.children,t=e.popover,o=e.onOpen,r=e.clickOnly,a=(0,s.useState)(null),i=a[0],u=a[1],d=function(e){r||u(e.currentTarget),o&&o(e)},c=function(){u(null)},p=Boolean(i),m=p?"ribbon-select-button-popover":void 0;return(0,l.jsxs)("div",{children:[(0,l.jsx)(rl,{"aria-describedby":m,onClick:d,children:n}),(0,l.jsx)(om.ZP,{id:m,open:p,anchorEl:i,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{zIndex:1200},children:t})]})};ri.defaultProps={popover:null,onOpen:null,clickOnly:!1},ri.propTypes={children:g().node.isRequired,popover:g().node,onOpen:g().func};var rl=(0,c.ZP)("button")(function(e){return{display:"flex",alignItems:"center",border:"none",borderRadius:"4px",color:e.theme.palette.white.main,backgroundColor:"#1394FF",fontSize:"0.875rem",lineHeight:1.25,padding:"2px 4px 2px 4px",cursor:"pointer","&:hover":{backgroundColor:(0,ra._j)("#1394FF",.1)}}}),rs=t(22154),ru=t(12282),rd=t(9489),rc=t(26936),rp=function(e){var n=e.locationId,t=e.monthlyAmount,o=e.close,r=(0,nJ.D)(),a=(0,nO.cI)({defaultValues:{monthlyAmount:t}}),i=a.errors,s=a.handleSubmit,u=a.control,d=(0,f.Z)((0,w.D)(nl,{refetchQueries:["GetLocationInfo"],onCompleted:function(){r.show({content:"Monthly billing figure updated",severity:"success"}),o&&o()},onError:function(e){r.show({content:"Error: ".concat(e.message),severity:"error"})}}),1)[0],c=function(e){d({variables:{locationId:n,monthlyAmount:e.monthlyAmount}})};return(0,l.jsxs)("form",{id:"offCanvasForm",onSubmit:s(c),children:[(0,l.jsx)(nO.Qr,{name:"monthlyAmount",control:u,render:function(e){var n,t=e.value,o=e.onChange;return(0,l.jsx)(rd.I,{fullWidth:!0,leftLabel:(0,l.jsx)(rc.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",type:"number",InputProps:{inputProps:{min:0,step:".01"}},value:t,onChange:o,error:i.monthlyAmount,helperText:null===(n=i.monthlyAmount)||void 0===n?void 0:n.message})}}),(0,l.jsx)(S.Z,{mt:1,children:"Updating the monthly billing figure will overide any per item customer billing"})]})},rm=t(36641);function rh(){return(rh=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let rv=e=>s.createElement("svg",rh({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 20"},e),s.createElement("path",{fill:"#FFF",d:"M2.667.07C1.196.07 0 1.341 0 2.906v14.187c0 1.565 1.196 2.837 2.667 2.837h18.666c1.471 0 2.667-1.272 2.667-2.837V2.907C24 1.342 22.804.069 21.333.069zM6 11.42h2.667c1.841 0 3.333 1.586 3.333 3.546 0 .39-.3.71-.667.71h-8c-.366 0-.666-.32-.666-.71 0-1.96 1.491-3.547 3.333-3.547M4.667 7.162c0-.753.28-1.474.78-2.006a2.59 2.59 0 0 1 1.886-.832c.708 0 1.386.3 1.886.832S10 6.41 10 7.163s-.281 1.474-.781 2.006S8.04 10 7.333 10a2.59 2.59 0 0 1-1.885-.83 2.93 2.93 0 0 1-.781-2.007m10.666-1.419h5.334c.366 0 .666.32.666.71s-.3.709-.666.709h-5.334c-.366 0-.666-.32-.666-.71s.3-.709.666-.709m0 2.838h5.334c.366 0 .666.319.666.709s-.3.71-.666.71h-5.334c-.366 0-.666-.32-.666-.71s.3-.71.666-.71m0 2.837h5.334c.366 0 .666.32.666.71s-.3.709-.666.709h-5.334c-.366 0-.666-.32-.666-.71s.3-.709.666-.709"}));var rf=t(71496),rx=function(e){var n=e.icon,t=e.children,o=e.expanded,r=e.onOpen;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(rg,{open:o,children:[(0,l.jsx)(rb,{onClick:r,children:n}),o&&(0,l.jsx)(rj,{children:(0,l.jsx)(rf.Z,{sx:{height:"32px",width:"32px",color:"#FFFFFF"}})})]}),(0,l.jsx)(I.Z,{sx:{height:"300px"},children:o&&(0,l.jsx)(ry,{open:o,children:t})})]})},rg=(0,c.ZP)(I.Z)(function(e){var n;return{display:"flex",alignItems:"center",borderRadius:"10px",flexDirection:"row",height:"fit-content",width:e.open?"80px":"42px",backgroundColor:e.theme.palette.secondary.main,transition:"width 400ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),rb=(0,c.ZP)(I.Z)(function(e){return{display:"flex",width:"42px",height:"42px",borderRadius:"8px",backgroundColor:e.theme.palette.secondary.main,justifyContent:"center",alignItems:"center"}}),ry=(0,c.ZP)(I.Z)(function(e){var n;return{position:"absolute",top:50,left:-2,borderRadius:"10px",display:e.open?"block":"none",marginTop:"15px",backgroundColor:e.theme.palette.secondary.main}}),rj=(0,c.ZP)(_.Z)(function(e){return{height:"36px",width:"36px",transform:e.open?"rotate(180deg)":"rotate(0deg)",transition:"transform 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),rZ=function(e){var n=(0,s.useRef)();return(0,s.useEffect)(function(){n.current=e}),n.current},rw=function(e){var n=e.icon,t=e.children,o=e.expanded,r=e.onOpen,a=e.spacing,i=(0,s.useState)(o),u=i[0],d=i[1],c=(0,s.useState)(!1),p=c[0],m=c[1],h=(0,s.useState)(!1),v=h[0],f=h[1],x=(0,s.useRef)(null),g=rZ(u);(0,s.useEffect)(function(){d(o),m(!1)},[o]);var b=function(){x.current&&f(x.current.scrollHeight>=69)};(0,s.useEffect)(function(){return b(),window.addEventListener("resize",b),function(){return window.removeEventListener("resize",b)}},[]);var y=function(){d(!0),r&&r()},j=function(){m(!p)},Z=function(){b()};return(0,l.jsxs)(rC,{open:u,children:[(0,l.jsx)(rI,{open:u,onClick:y,children:n}),(0,l.jsxs)(rS,{open:u,wasOpen:g,more:p,direction:"row",alignItems:"center",justifyContent:"space-between",onTransitionEnd:Z,children:[(0,l.jsx)(r_,{ref:x,open:u,more:p,direction:"row",spacebetween:a,children:t}),v&&(0,l.jsx)(rk,{open:p,color:"white",onClick:j,children:(0,l.jsx)(rf.Z,{sx:{height:"32px",width:"32px"}})})]})]})};rw.defaultProps={expanded:!1,spacing:2,onOpen:null},rw.propTypes={icon:g().node.isRequired,children:g().node.isRequired,expanded:g().bool,onOpen:g().func,spacing:g().number};var rC=(0,c.ZP)(I.Z)(function(e){return{display:"flex",flexDirection:"row",width:e.open?"100%":"42px",transition:"width 400ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),rI=(0,c.ZP)(I.Z)(function(e){var n;return{display:e.open?"none":"flex",width:"42px",height:"42px",borderRadius:"8px",backgroundColor:e.theme.palette.secondary.main,justifyContent:"center",alignItems:"center"}}),rS=(0,c.ZP)(u.Z)(function(e){var n=e.open,t=e.wasOpen,o=e.more,r=e.theme;return(0,i.Z)({width:n?"100%":"0px",overflow:"hidden",display:!n&&t?"none":"flex",height:o?"100%":"42px",borderRadius:"8px",backgroundColor:r.palette.secondary.main,transition:"width 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms,\n  height 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"},n&&{paddingLeft:"8px",paddingRight:"8px"})}),r_=(0,c.ZP)(u.Z)(function(e){var n=e.open,t=e.more,o=e.spacebetween;return(0,i.Z)({alignItems:"center",flexWrap:"wrap",height:t?"auto":"42px",overflow:"hidden"},n&&{paddingTop:"10px",paddingBottom:"10px",rowGap:"10px","&>:not(style):not(style)":{marginRight:8*o+"px"}})}),rk=(0,c.ZP)(_.Z)(function(e){return{height:"36px",width:"36px",transform:e.open?"rotate(180deg)":"rotate(0deg)",transition:"transform 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),rD=function(e){return(0,H.Z)("(max-width: 600px)")?(0,l.jsx)(rx,(0,i.Z)({},e)):(0,l.jsx)(rw,(0,i.Z)({},e))},rq={mobileItem:function(e){return e?{width:"calc(100vw - 40px)",padding:"6px",borderBottom:"1px solid #FFFFFF"}:{}}},rP=function(e){var n,t,o,r,a,i,s,d,c,p=e.expanded,m=e.handleOpen,h=e.locationId,v=(0,eo.x)().hasRole,f=v("admin"),x=v("customer"),g=v("tenant"),b=(0,H.Z)("(max-width: 600px)"),y=(0,oF.a)(),Z=(0,j.a)(e0,{skip:!h||!p,variables:{id:h}}),w=Z.data,C=(void 0===w?{location:{}}:w).location,I=Z.refetch,k=null==C?void 0:null===(n=C.addresses)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.address,D=function(e){e.stopPropagation(),y.show({content:(0,l.jsx)(rp,{locationId:h,monthlyAmount:C.monthlyAmount||0,close:y.close}),submit:!0,title:"Billing"})},q=function(e){var n,t;e.stopPropagation(),y.show({content:(0,l.jsx)(rm.H,{addressId:(null==k?void 0:k.id)||null,entity:"Location",entityId:h,id:(null==C?void 0:null===(n=C.addresses)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.id)||null,onSubmit:I,type:"invoice"}),submit:!1,title:"Manage addresses"})},P=function(e){e.stopPropagation(),y.show({content:(0,l.jsx)(oR,{locaitonId:h}),submit:!1,title:"Upload Documents"})};return(0,l.jsx)(rD,{icon:(0,l.jsx)(rr.Z,{component:rv,inheritViewBox:!0,sx:{"& path":{fill:"#82E1FF"}}}),expanded:p,onOpen:m,spacing:1,children:h?(0,l.jsxs)(l.Fragment,{children:[(f||x||g)&&(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:rq.mobileItem(b),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Customer:"}),(0,l.jsx)(S.Z,{color:"white.main",children:null===(o=C.customer)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:null===(a=r.account)||void 0===a?void 0:a.name})]}),(f||x||g)&&(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:rq.mobileItem(b),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Asigned to:"}),(0,l.jsx)(S.Z,{color:"white.main",children:(null===(i=C.customer)||void 0===i?void 0:null===(s=i[0])||void 0===s?void 0:null===(d=s.account)||void 0===d?void 0:null===(c=d.manager)||void 0===c?void 0:c.fullName)||"Not assigned"})]}),(f||x)&&(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:rq.mobileItem(b),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Monthly Amount:"}),(0,l.jsx)(S.Z,{color:"white.main",children:C.monthlyAmount?(0,oU.T)(C.monthlyAmount):(0,oU.T)(0)}),(0,l.jsx)(_.Z,{color:"white",sx:{ml:1,height:"16px",width:"16px"},onClick:D,children:(0,l.jsx)(ru.Z,{sx:{height:"16px"}})})]}),(f||x||g)&&(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",spacing:1,sx:rq.mobileItem(b),children:[(0,l.jsx)(S.Z,{fontWeight:700,children:"Invoice Address:"}),(0,l.jsx)(oQ.Z,{color:"white",size:"small",label:null==k?void 0:k.postCode,sx:{height:"18px",borderRadius:1}}),(0,l.jsxs)(S.Z,{color:"white.main",children:[(null==k?void 0:k.addressLine1)?k.addressLine1+", ":"",(null==k?void 0:k.addressLine2)?k.addressLine2+", ":"",(null==k?void 0:k.addressLine3)?k.addressLine3+", ":"",(null==k?void 0:k.city)?k.city+", ":"",(null==k?void 0:k.county)?k.county+", ":""]}),(f||x)&&(0,l.jsx)(_.Z,{color:"white",sx:{ml:1,height:"16px",width:"16px"},onClick:q,children:(0,l.jsx)(ru.Z,{sx:{height:"16px"}})})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:rq.mobileItem(b),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Documentation:"}),(0,l.jsx)(rs.Z,{color:"white",sx:{height:"16px"}}),(0,l.jsx)(ri,{clickOnly:!0,sx:{pl:2},onOpen:P,children:"Add media"})]})]}):(0,l.jsx)(S.Z,{fontWeight:700,fontSize:16,sx:b?{height:"100px",padding:"10px",width:"calc(100vw - 40px)"}:{},children:"Please select a location to get details"})})},rO=t(97212),rT=t(98619),rM=t(58533),rF=function(e){var n=e.jobs,t=e.hasMore,o=e.handleFetchMore,r=e.onItemClick,a=(0,H.Z)("(max-width:600px)");return(0,l.jsx)(I.Z,{id:"scrollableDiv",sx:{display:"flex",flexDirection:"column",pt:1,overflowY:"scroll",maxHeight:a?"80vh":"50vh",width:"200px"},children:(0,l.jsx)(rM.Z,{dataLength:n.length,next:o,hasMore:t,loader:(0,l.jsx)(q.Z,{color:"secondary"}),scrollableTarget:"scrollableDiv",children:n.map(function(e){return(0,l.jsx)(rO.ZP,{component:"div",disablePadding:!0,onClick:function(n){return r(n,e)},children:(0,l.jsxs)(rT.Z,{sx:{flexDirection:"column",alignItems:"flex-start"},children:[(0,l.jsxs)(u.Z,{direction:"row",width:"100%",spacing:2,children:[(0,l.jsx)(oQ.Z,{label:e.number,color:"primary",size:"small",sx:{borderRadius:1}}),(0,l.jsx)(ec.B,{value:e.status,sx:{borderRadius:1}})]}),e.title&&(0,l.jsx)(S.Z,{mt:1,children:e.title})," "]})},e.number)})})})};rF.defaultProps={jobs:[],hasMore:!1,handleFetchMore:function(){},onItemClick:function(){}},rF.propTypes={jobs:g().array,hasMore:g().bool,handleFetchMore:g().func,onItemClick:g().func};var rA=function(e){var n=e.fetchMore,t=e.offset,o=e.limit,r=e.setOffset;n({variables:{offset:t,limit:o},updateQuery:function(e,n){var t=n.fetchMoreResult;return t?{jobs:(0,$.Z)(e.jobs).concat((0,$.Z)(t.jobs))}:e}}),r(t+o)},rE=t(22713);function rR(){return(rR=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let rN=e=>s.createElement("svg",rR({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 18 20"},e),s.createElement("path",{fill:"#FFF",d:"M5.143 0c.711 0 1.286.559 1.286 1.25V2.5h5.142V1.25c0-.691.575-1.25 1.286-1.25s1.286.559 1.286 1.25V2.5h1.928C17.136 2.5 18 3.34 18 4.375V6.25H0V4.375C0 3.34.864 2.5 1.929 2.5h1.928V1.25C3.857.559 4.432 0 5.143 0M0 7.5h18v10.625C18 19.16 17.136 20 16.071 20H1.93C.864 20 0 19.16 0 18.125zm2.571 3.125v1.25c0 .344.29.625.643.625H4.5a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 4.5 10H3.214a.636.636 0 0 0-.643.625m5.143 0v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 9.643 10H8.357a.636.636 0 0 0-.643.625M13.5 10a.636.636 0 0 0-.643.625v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25a.636.636 0 0 0-.643-.625zM2.571 15.625v1.25c0 .344.29.625.643.625H4.5a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 4.5 15H3.214a.636.636 0 0 0-.643.625M8.357 15a.636.636 0 0 0-.643.625v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 9.643 15zm4.5.625v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25a.636.636 0 0 0-.643-.625H13.5a.636.636 0 0 0-.643.625"}));var rW={jobs:{aggregate:{count:0}}},r$={mobileItem:function(e){return e?{width:"calc(100vw - 40px)",padding:"6px",borderBottom:"1px solid #FFFFFF"}:{}}},rJ=function(e){var n,t=e.expanded,o=e.handleOpen,r=e.locationId,a=(0,oF.a)(),i=(0,s.useMemo)(function(){return y()().toISOString()},[]),d=(0,s.useMemo)(function(){return y()().add(7,"days").toISOString()},[]),c=(0,s.useMemo)(function(){return y()().subtract(24,"hours").toISOString()},[]),p=(0,s.useState)(0),m=p[0],h=p[1],v=(0,s.useState)(0),x=v[0],g=v[1],b=(0,s.useState)(0),w=b[0],C=b[1],I=(0,s.useState)(0),_=I[0],k=I[1],D=(0,H.Z)("(max-width: 600px)"),q=(0,j.a)(eU,{skip:!t,variables:{where:{type:{_eq:"ppm"},locationId:{_eq:r}}}}).data,P=(void 0===q?rW:q).jobs.aggregate.count,O=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},locationId:{_eq:r}}}}),2),T=O[0],M=O[1],F=M.data,A=(void 0===F?{jobs:[]}:F).jobs,E=M.fetchMore,R=(0,j.a)(eX,{skip:!t,variables:{locationId:r,now:i}}).data,N=(void 0===R?{nextJob:[]}:R).nextJob,W=(0,j.a)(eU,{skip:!t,variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},timingStart:{_gte:i,_lte:d}}}}).data,$=(void 0===W?rW:W).jobs.aggregate.count,J=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},timingStart:{_gte:i,_lte:d}}}}),2),L=J[0],Y=J[1],B=Y.data,V=(void 0===B?{jobs:[]}:B).jobs,G=Y.fetchMore,Q=(0,j.a)(eU,{skip:!t,variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},Compliances:{},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:c}}}}).data,z=(void 0===Q?rW:Q).jobs.aggregate.count,U=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},Compliances:{},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:c}}}}),2),K=U[0],X=U[1],ee=X.data,en=(void 0===ee?{jobs:[]}:ee).jobs,et=X.fetchMore,eo=(0,j.a)(eU,{skip:!t,variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:c}}}}).data,er=(void 0===eo?rW:eo).jobs.aggregate.count,ea=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:c}}}}),2),ei=ea[0],el=ea[1],es=el.data,eu=(void 0===es?{jobs:[]}:es).jobs,ed=el.fetchMore,ec=function(e,n){var t=n.id;e.stopPropagation(),a.show({content:(0,l.jsx)(rE.g,{jobId:t,toggleShow:a.close}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})},ep=function(e){e({variables:{offset:0,limit:50}})};return(0,l.jsxs)(rD,{icon:(0,l.jsx)(rr.Z,{component:rN,inheritViewBox:!0,sx:{"& path":{fill:"#82E1FF"}}}),expanded:t,onOpen:o,children:[(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(D),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Total jobs:"}),(0,l.jsx)(S.Z,{color:"white.main",mr:1,children:P}),(0,l.jsx)(ri,{onOpen:function(){return ep(T)},popover:(0,l.jsx)(rF,{onItemClick:ec,jobs:A,hasMore:A.length<P,handleFetchMore:function(){return rA({fetchMore:E,offset:m,limit:50,setOffset:h})}}),children:(0,l.jsx)(rf.Z,{sx:{height:"14px"}})})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(D),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Next Job:"}),(0,l.jsx)(S.Z,{color:"white.main",mr:1,children:(null===(n=N[0])||void 0===n?void 0:n.title)||"N/A"}),(0,l.jsx)(ri,{popover:(0,l.jsx)(rF,{onItemClick:ec,jobs:N}),children:(0,l.jsx)(rf.Z,{sx:{height:"14px"}})})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(D),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Next 7 Days Jobs:"}),(0,l.jsx)(S.Z,{color:"white.main",mr:1,children:$}),(0,l.jsx)(ri,{onOpen:function(){return ep(L)},popover:(0,l.jsx)(rF,{onItemClick:ec,jobs:V,hasMore:V.length<$,handleFetchMore:function(){return rA({fetchMore:G,offset:x,limit:50,setOffset:g})}}),children:(0,l.jsx)(rf.Z,{sx:{height:"14px"}})})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(D),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Overdue Compliance Jobs:"}),(0,l.jsx)(S.Z,{color:"white.main",mr:1,children:z}),(0,l.jsx)(ri,{onOpen:function(){return ep(K)},popover:(0,l.jsx)(rF,{onItemClick:ec,jobs:en,hasMore:en.length<z,handleFetchMore:function(){return rA({fetchMore:et,offset:w,limit:50,setOffset:C})}}),children:(0,l.jsx)(rf.Z,{sx:{height:"14px"}})})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:r$.mobileItem(D),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Overdue PPM Jobs:"}),(0,l.jsx)(S.Z,{color:"white.main",mr:1,children:er}),(0,l.jsx)(ri,{onOpen:function(){return ep(ei)},popover:(0,l.jsx)(rF,{onItemClick:ec,jobs:eu,hasMore:eu.length<er,handleFetchMore:function(){return rA({fetchMore:ed,offset:_,limit:50,setOffset:k})}}),children:(0,l.jsx)(rf.Z,{sx:{height:"14px"}})})]})]})};function rL(){return(rL=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}rJ.defaultProps={expanded:!1,handleOpen:function(){}},rJ.propTypes={expanded:g().bool,handleOpen:g().func};let rY=e=>s.createElement("svg",rL({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 20 20"},e),s.createElement("path",{fill:"#FFF",d:"M7.54 8.964c.05 0 .1-.014.141-.04a.25.25 0 0 0 .094-.107c.105-.437.35-.832.703-1.13.057-.035.08-.111.08-.183a.2.2 0 0 0-.03-.085.2.2 0 0 0-.068-.062l-5.511-3.05 3.52-1.941a.46.46 0 0 0 .169-.156.39.39 0 0 0 .005-.432.4.4 0 0 0-.174-.153l-1.057-.571a.48.48 0 0 0-.449 0L.236 3.643a.46.46 0 0 0-.17.156.4.4 0 0 0-.066.214v5.139a.4.4 0 0 0 .062.217.4.4 0 0 0 .174.153l1.052.572c.071.04.153.058.236.053a.46.46 0 0 0 .311-.111.47.47 0 0 0 .137-.313V5.915l5.473 3.031q.045.02.095.018m7.152 6.469a.6.6 0 0 0-.236.053l-3.515 1.924v-5.986c0-.13-.136-.26-.292-.205-.446.126-.92.132-1.368.017a.24.24 0 0 0-.2.035.2.2 0 0 0-.067.075.2.2 0 0 0-.026.096v5.95l-3.515-1.924a.43.43 0 0 0-.236-.053.47.47 0 0 0-.315.125.42.42 0 0 0-.133.299v1.165a.4.4 0 0 0 .061.217.4.4 0 0 0 .175.154l4.727 2.57q.107.06.232.055a.54.54 0 0 0 .235-.054l4.728-2.571a.46.46 0 0 0 .17-.157.4.4 0 0 0 .066-.214v-1.165c-.043-.201-.26-.406-.49-.406m-1.76-13.38c.215 0 .425-.06.603-.173.179-.112.318-.273.4-.46a.98.98 0 0 0 .062-.594A1 1 0 0 0 13.7.301a1.1 1.1 0 0 0-.556-.281c-.21-.04-.429-.02-.627.058s-.368.21-.487.378a1 1 0 0 0-.183.57 1 1 0 0 0 .318.727c.204.192.48.3.767.3m3.001-.45c-.215 0-.424.06-.603.173a1.04 1.04 0 0 0-.4.46.98.98 0 0 0-.061.594c.042.199.145.382.297.525s.345.242.555.281.429.02.627-.058c.199-.078.368-.21.487-.378a1 1 0 0 0 .183-.57 1 1 0 0 0-.318-.727c-.203-.192-.48-.3-.767-.3m2.982 3.736c.215 0 .424-.06.603-.173a1.04 1.04 0 0 0 .4-.46.98.98 0 0 0 .061-.594 1 1 0 0 0-.297-.526 1.1 1.1 0 0 0-.555-.28c-.211-.04-.43-.02-.627.058-.199.078-.368.21-.487.378a.99.99 0 0 0 .134 1.296c.204.193.48.301.768.301m-2.982-.41c-.215 0-.424.06-.603.172a1.04 1.04 0 0 0-.4.461.98.98 0 0 0-.061.594c.042.199.145.382.297.525s.345.242.555.281.429.02.627-.058c.199-.078.368-.21.487-.378a1 1 0 0 0 .183-.57 1 1 0 0 0-.318-.727c-.203-.192-.48-.3-.767-.3m-3 3.714c.214 0 .424-.06.602-.173.179-.113.318-.274.4-.461a.98.98 0 0 0 .062-.593 1 1 0 0 0-.297-.526 1.1 1.1 0 0 0-.556-.281c-.21-.04-.429-.02-.627.058s-.368.21-.487.378a1 1 0 0 0-.183.57 1 1 0 0 0 .318.727c.204.192.48.3.767.3m-2.93 1.625c.214 0 .424-.06.602-.173.179-.113.318-.274.4-.461a.98.98 0 0 0 .062-.593 1 1 0 0 0-.297-.526 1.1 1.1 0 0 0-.556-.281c-.21-.04-.429-.02-.627.058s-.368.21-.487.378a1 1 0 0 0-.183.57 1 1 0 0 0 .318.727c.204.192.48.3.767.3m8.912-3.679c-.215 0-.425.06-.603.173a1.04 1.04 0 0 0-.4.461.98.98 0 0 0-.061.593c.041.2.145.382.297.526.151.143.345.241.555.28s.429.02.627-.058c.198-.077.368-.209.487-.378a.99.99 0 0 0-.135-1.296c-.203-.193-.48-.3-.767-.3m0 3.228c-.215 0-.425.06-.603.173a1.04 1.04 0 0 0-.4.46.98.98 0 0 0-.061.594c.041.199.145.382.297.525.151.144.345.242.555.281s.429.02.627-.058.368-.21.487-.378a.99.99 0 0 0-.135-1.297c-.203-.192-.48-.3-.767-.3"}));var rB={jobs:{aggregate:{count:0}}},rH={mobileItem:function(e){return e?{width:"calc(100vw - 40px)",padding:"6px",borderBottom:"1px solid #FFFFFF"}:{}}},rV=function(e){var n=e.expanded,t=e.handleOpen,o=e.locationId,r=(0,oF.a)(),a=(0,s.useState)(0),d=a[0],c=a[1],p=(0,s.useState)(0),m=p[0],h=p[1],x=(0,s.useState)(0),g=x[0],b=x[1],y=(0,s.useState)(0),w=y[0],C=y[1],I=(0,s.useState)(0),_=I[0],k=I[1],D=(0,s.useState)(0),q=D[0],P=D[1],O=(0,s.useState)(0),T=O[0],M=O[1],F=(0,H.Z)("(max-width: 600px)"),A=(0,j.a)(eU,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"raised"},locationId:{_eq:o}}}}).data,E=(void 0===A?rB:A).jobs.aggregate.count,R=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"raised"},locationId:{_eq:o}}}}),2),N=R[0],W=R[1],$=W.data,J=(void 0===$?{jobs:[]}:$).jobs,L=W.fetchMore,Y=(0,j.a)(eU,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"offered"},locationId:{_eq:o}}}}).data,B=(void 0===Y?rB:Y).jobs.aggregate.count,V=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"offered"},locationId:{_eq:o}}}}),2),G=V[0],Q=V[1],z=Q.data,U=(void 0===z?{jobs:[]}:z).jobs,K=Q.fetchMore,X=(0,j.a)(eU,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"accepted"},locationId:{_eq:o}}}}).data,ee=(void 0===X?rB:X).jobs.aggregate.count,en=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"accepted"},locationId:{_eq:o}}}}),2),et=en[0],eo=en[1],er=eo.data,ea=(void 0===er?{jobs:[]}:er).jobs,ei=eo.fetchMore,el=(0,j.a)(eU,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"inProgress"},locationId:{_eq:o}}}}).data,es=(void 0===el?rB:el).jobs.aggregate.count,eu=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"inProgress"},locationId:{_eq:o}}}}),2),ed=eu[0],ec=eu[1],ep=ec.data,em=(void 0===ep?{jobs:[]}:ep).jobs,eh=ec.fetchMore,ev=(0,j.a)(eU,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"completed"},locationId:{_eq:o}}}}).data,ef=(void 0===ev?rB:ev).jobs.aggregate.count,ex=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"completed"},locationId:{_eq:o}}}}),2),eg=ex[0],eb=ex[1],ey=eb.data,ej=(void 0===ey?{jobs:[]}:ey).jobs,eZ=eb.fetchMore,ew=(0,j.a)(eU,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"reportSent"},locationId:{_eq:o}}}}).data,eC=(void 0===ew?rB:ew).jobs.aggregate.count,eI=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"reportSent"},locationId:{_eq:o}}}}),2),eS=eI[0],e_=eI[1],ek=e_.data,eD=(void 0===ek?{jobs:[]}:ek).jobs,eq=e_.fetchMore,eP=(0,j.a)(eU,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"closed"},locationId:{_eq:o}}}}).data,eO=(void 0===eP?rB:eP).jobs.aggregate.count,eT=(0,f.Z)((0,Z.t)(eK,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"closed"},locationId:{_eq:o}}}}),2),eM=eT[0],eF=eT[1],eA=eF.data,eE=(void 0===eA?{jobs:[]}:eA).jobs,eR=eF.fetchMore,eN=function(e,n){var t=n.id;e.stopPropagation(),r.show({content:(0,l.jsx)(rE.g,{jobId:t,toggleShow:r.close}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})},eW=function(e){e({variables:{offset:0,limit:50}})};return(0,l.jsxs)(rD,{icon:(0,l.jsx)(rr.Z,{component:rY,inheritViewBox:!0,sx:{"& path":{fill:"#82E1FF"}}}),expanded:n,onOpen:t,spacing:3,children:[(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:rH.mobileItem(F),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Job raised"}),(0,l.jsxs)(ri,{onOpen:function(){return eW(N)},popover:(0,l.jsx)(rF,{onItemClick:eN,jobs:J,hasMore:J.length<E,handleFetchMore:function(){return rA({fetchMore:L,offset:d,limit:50,setOffset:c})}}),children:[E,(0,l.jsx)(rf.Z,{sx:{height:"14px"}})]})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:rH.mobileItem(F),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Job offered"}),(0,l.jsxs)(ri,{onOpen:function(){return eW(G)},popover:(0,l.jsx)(rF,{onItemClick:eN,jobs:U,hasMore:U.length<B,handleFetchMore:function(){return rA({fetchMore:K,offset:m,limit:50,setOffset:h})}}),children:[B,(0,l.jsx)(rf.Z,{sx:{height:"14px"}})]})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:rH.mobileItem(F),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Job accepted"}),(0,l.jsxs)(ri,{onOpen:function(){return eW(et)},popover:(0,l.jsx)(rF,{onItemClick:eN,jobs:ea,hasMore:ea.length<ee,handleFetchMore:function(){return rA({fetchMore:ei,offset:g,limit:50,setOffset:b})}}),children:[ee,(0,l.jsx)(rf.Z,{sx:{height:"14px"}})]})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:rH.mobileItem(F),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"In progress"}),(0,l.jsxs)(ri,{onOpen:function(){return eW(ed)},popover:(0,l.jsx)(rF,{onItemClick:eN,jobs:em,hasMore:em.length<es,handleFetchMore:function(){return rA({fetchMore:eh,offset:w,limit:50,setOffset:C})}}),children:[es,(0,l.jsx)(rf.Z,{sx:{height:"14px"}})]})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:rH.mobileItem(F),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Complete"}),(0,l.jsxs)(ri,{onOpen:function(){return eW(eg)},popover:(0,l.jsx)(rF,{onItemClick:eN,jobs:ej,hasMore:ej.length<ef,handleFetchMore:function(){return rA({fetchMore:eZ,offset:_,limit:50,setOffset:k})}}),children:[ef,(0,l.jsx)(rf.Z,{sx:{height:"14px"}})]})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:rH.mobileItem(F),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Report sent"}),(0,l.jsxs)(ri,{onOpen:function(){return eW(eS)},popover:(0,l.jsx)(rF,{onItemClick:eN,jobs:eD,hasMore:eD.length<eC,handleFetchMore:function(){return rA({fetchMore:eq,offset:q,limit:50,setOffset:P})}}),children:[eC,(0,l.jsx)(rf.Z,{sx:{height:"14px"}})]})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",sx:(0,v.Z)((0,i.Z)({},rH.mobileItem(F)),{width:F?"100%":"auto"}),children:[(0,l.jsx)(S.Z,{fontWeight:700,mr:1,children:"Closed"}),(0,l.jsxs)(ri,{onOpen:function(){return eW(eM)},popover:(0,l.jsx)(rF,{onItemClick:eN,jobs:eE,hasMore:eE.length<eO,handleFetchMore:function(){return rA({fetchMore:eR,offset:T,limit:50,setOffset:M})}}),children:[eO,(0,l.jsx)(rf.Z,{sx:{height:"14px"}})]})]})]})},rG=function(e){var n=e.defaultExpanded,t=e.locationId,o=(0,s.useState)(n),r=o[0],a=o[1],i=(0,H.Z)("(max-width: 600px)"),u=function(e){a(e)};return(0,l.jsxs)(rQ,{direction:"row",justifyContent:i?"flex-start":"flex-end",width:"100%",spacing:1,children:[(0,l.jsx)(rP,{expanded:"info"===r,handleOpen:function(){return u("info")},locationId:t}),(0,l.jsx)(rJ,{expanded:"jobs"===r,handleOpen:function(){return u("jobs")},locationId:t}),(0,l.jsx)(rV,{expanded:"event"===r,handleOpen:function(){return u("event")},locationId:t})]})};rG.defaultProps={defaultExpanded:null},rG.propTypes={defaultExpanded:g().string,locationId:g().string};var rQ=(0,c.ZP)(u.Z)(function(){return{position:"relative",color:"#BEEFFF"}}),rz=t(97824),rU=t(39474),rK=t(45416),rX=t(18586),r0=t(15843),r1=t(48381),r2=t(5336),r5={search:"",year:y()(),status:null,tags:null,customerId:null,locationId:null,sublocationId:null,userId:null,assetCategoryId:null,assetId:null,supplierId:null,customerManagerId:null,allJobs:null,allItems:null,hideExpiredItems:!1};function r3(){var e=(0,ep.Z)(["Status is ",""]);return r3=function(){return e},e}var r6=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return(0,i.Z)({},e.reduce(function(e,o){var r=n.find(function(e){return e.value===o.field&&!t.includes(o.field)});return(0,v.Z)((0,i.Z)({},e),(0,oN.Z)({},o.field,Boolean(r)))},{}))},r4=function(e){var n={search:function(e){return!!e&&"Search is ".concat(e)},year:function(e){return!!e&&"".concat(y()(e).format("YYYY"))},status:function(e){return(null==e?void 0:e.length)>0&&e(r3(),null==e?void 0:e.map(function(e){return e.label}).join(", "))},tags:function(e){return(null==e?void 0:e.length)>0&&"Tags is ".concat(null==e?void 0:e.map(function(e){return e.label}).join(", "))},customerId:function(e){return null!=e&&!!e.label&&"Customer is ".concat(null==e?void 0:e.label)},locationId:function(e){return null!=e&&!!e.label&&"Location is ".concat(null==e?void 0:e.label)},sublocationId:function(e){return null!=e&&!!e.label&&"Sublocation is ".concat(null==e?void 0:e.label)},userId:function(e){return null!=e&&!!e.label&&"User is ".concat(null==e?void 0:e.label)},assetCategoryId:function(e){return null!=e&&!!e.label&&"Asset Category is ".concat(null==e?void 0:e.label)},assetId:function(e){return null!=e&&!!e.label&&"Asset is ".concat(null==e?void 0:e.label)},supplierId:function(e){return null!=e&&!!e.label&&"Supplier is ".concat(null==e?void 0:e.label)},customerManagerId:function(e){return null!=e&&!!e.label&&"Customer Manager is ".concat(null==e?void 0:e.label)},allJobs:function(e){return null!=e&&!!e.label&&"All Jobs is ".concat(null==e?void 0:e.label)},allItems:function(e){return null!=e&&!!e.label&&"All Items is ".concat(null==e?void 0:e.label)},hideExpiredItems:function(e){return!!e&&"Exclude expired items"}};return Object.entries(e).reduce(function(e,t){var o=(0,f.Z)(t,2),r=o[0],a=o[1];if(!a||!n[r])return e;var i=(0,n[r])(a);return i&&e.push({key:r,label:i}),e},[])},r9=function(e){var n=e.locationId,t=e.open,o=e.close,r=e.hideFilters,a=e.filtersFormData,d=e.setFiltersFormData,c=e.setFilters,p=e.setFiltersChips,m=(0,eo.x)(),h=m.user,f=m.hasRole,x=f("admin"),g=f(["customer","supplier"]),b=(0,H.Z)("(max-width: 600px)"),y=(0,nO.cI)({defaultValues:(0,i.Z)({},r5)}),j=y.control,Z=y.handleSubmit,w=y.reset,C=y.getValues,I=y.watch,S=I("locationId"),_=I("assetCategoryId"),D=ok({locationIdWatch:S,assetCategoryIdWatch:_,locationId:n,accountId:h.accountId}),q=D.customerProps,P=D.propertyProps,O=D.sublocationProps,T=D.assetCategoryProps,M=D.assetProps,F=D.supplierProps,A=D.customerManagerProps,E=D.userProps;(0,s.useEffect)(function(){var e,t,o,r,l,s,u,d,m,h,v,f,x,g,b={search:a.search?"%".concat(a.search,"%"):null,status:(null===(e=a.status)||void 0===e?void 0:e.length)>0?null===(t=a.status)||void 0===t?void 0:t.map(function(e){return e.value}):null,tags:(null===(o=a.tags)||void 0===o?void 0:o.length)>0?null===(r=a.tags)||void 0===r?void 0:r.map(function(e){return e.value}):null,customerId:null===(l=a.customerId)||void 0===l?void 0:l.value,locationId:n||(null===(s=a.locationId)||void 0===s?void 0:s.value),sublocationId:null===(u=a.sublocationId)||void 0===u?void 0:u.value,userId:null===(d=a.userId)||void 0===d?void 0:d.value,assetCategoryId:null===(m=a.assetCategoryId)||void 0===m?void 0:m.value,assetId:null===(h=a.assetId)||void 0===h?void 0:h.value,supplierId:null===(v=a.supplierId)||void 0===v?void 0:v.value,customerManagerId:null===(f=a.customerManagerId)||void 0===f?void 0:f.value,allJobs:null===(x=a.allJobs)||void 0===x?void 0:x.value,allItems:null===(g=a.allItems)||void 0===g?void 0:g.value,year:a.year||r5.year,hideExpiredItems:a.hideExpiredItems};w((0,i.Z)({},r5,a)),c(function(e){return(0,i.Z)({},e,b)}),p(r4((0,i.Z)({},r5,a)))},[a,n,w,c,p]);var R=function(e){try{var n=C();d(function(e){return(0,i.Z)({},e,n)})}finally{o()}},N=function(){var e=(0,i.Z)({},r5);d(e),o()};return(0,l.jsx)(oI.Z,{keepMounted:!0,open:t,onClose:o,children:(0,l.jsx)("form",{onSubmit:Z(R),children:(0,l.jsxs)(r7,{is600pxOrLess:b,children:[(0,l.jsxs)(J.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,l.jsx)(J.ZP,{item:!0,xs:12,children:(0,l.jsx)(nO.Qr,{control:j,name:"search",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nC.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search schedule or work order",value:n,onChange:t})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"status",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{multiple:!0,limitTags:1,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n||[],onChange:function(e,n){t(n)},options:(0,oS.lR)(),textFieldProps:{color:"secondary",variant:"standard",label:"Select status"}})}})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(o_.r,{control:j})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"customerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},q),{textFieldProps:{color:"secondary",variant:"standard",label:"Select customer"}}))}})}),!r.includes("location")&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"locationId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},P),{textFieldProps:{color:"secondary",variant:"standard",label:"Select location"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"sublocationId",control:j,render:function(e){var t=e.value,o=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({disabled:!S&&!n,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t,onChange:function(e,n){o(n)}},O),{textFieldProps:{color:"secondary",variant:"standard",label:"Select sublocation"}}))}})}),g&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"userId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},E),{textFieldProps:{color:"secondary",variant:"standard",label:"Select user"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"assetCategoryId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},T),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset category"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"assetId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},M),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset"}}))}})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"supplierId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},F),{textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"}}))}})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"customerManagerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},A),{textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"allJobs",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"compliance",label:"Compliance jobs only"},{value:"overduePPM",label:"Overdue jobs"},{value:"incompleteFollowOn",label:"Incomplete follow on works"},{value:"followOn",label:"Jobs with follow on works"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Jobs"}})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"allItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"complete",label:"with completed jobs"},{value:"incomplete",label:"with incomplete jobs"},{value:"all",label:"with jobs during period"}],textFieldProps:{color:"secondary",variant:"standard",label:"Show all items"}})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{control:j,name:"year",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nz.M,{views:["year"],inputFormat:"YYYY",value:n,onChange:function(e){e?t(e.toISOString()):t(e)},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{fullWidth:!0,label:"Select year",color:"secondary",variant:"standard"}))}})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"hideExpiredItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nH.Z,{control:(0,l.jsx)(nM.Z,{color:"secondary",checked:n,onChange:function(e,n){return t(n)}}),label:"Hide expired items"})}})})]}),(0,l.jsxs)(u.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,l.jsx)(k.Z,{variant:"contained",color:"danger",onClick:function(){return N()},children:"Cancel"}),(0,l.jsx)(k.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})};r9.defaultProps={open:!1,close:function(){},hideFilters:[],filtersFormData:{},setFiltersFormData:function(){},setFilters:function(){},setFiltersChips:function(){}},r9.propTypes={locationId:g().string,open:g().bool,close:g().func,hideFilters:g().array,filtersFormData:g().object,setFiltersFormData:g().func,setFilters:g().func,setFiltersChips:g().func};var r7=(0,oh.Z)(d.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:n?"0px":"8px",overflowY:"auto"}}),r8=t(83178),ae=function(e){var n=y()(e).startOf("year").toISOString(),t=y()(e).endOf("year").toISOString();return{timingStart:{_gte:n,_lte:t}}},an=function(e,n){switch(e){case"compliance":return[{status:{_neq:"canceled"},Compliances:{}}];case"overduePPM":return[{_and:[{status:{_neq:"canceled"}},{timingStart:{_lte:n}},{_not:{statusData:{_has_key:"inProgress"}}},{_not:{statusData:{_has_key:"closed"}}}]}];case"incompleteFollowOn":return[{status:{_neq:"canceled"},Jobs:{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}}];case"followOn":return[{status:{_neq:"canceled"},Jobs:{}}];default:return[]}},at=function(e){switch(e){case"complete":return[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]}];case"incomplete":return[{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}];default:return[]}},ao=function(e,n){switch(n){case"supplier":return{supplierUserId:{_eq:e}};case"customer":return{customerUserId:{_eq:e}};default:return{}}},ar=function(e,n){var t,o,r,a,i,l,s,u=e.search,d=e.status,c=e.tags,p=e.customerId,m=e.locationId,h=e.sublocationId,v=e.userId,f=e.assetCategoryId,x=e.assetId,g=e.supplierId,b=e.customerManagerId,j=e.allJobs,Z=e.allItems,w=e.year,C=e.hideExpiredItems,I=y()().subtract(24,"hours").toISOString(),S=[];return S.push(ae(w)),S.push(g?{_or:[{supplierId:{_eq:g}},{status:{_eq:"offered"},SupplierOffers:{accountId:{_eq:g},status:{_in:["offered","accepted"]}}}]}:{}),S.push(u?{_or:[{reference:{_ilike:u}},{description:{_ilike:u}},{_or:[{JobSchedule:{reference:{_ilike:u}}},{JobSchedule:{description:{_ilike:u}}}]}]}:{}),S.push((null==d?void 0:d.length)>0?{status:{_in:d}}:{}),S.push((null==c?void 0:c.length)>0?{Taxonomy:{entity:{_eq:"Job"},Taxonomy:{status:{_eq:"active"},type:{_eq:"tags"},id:{_in:c}}}}:{}),S.push(ao(v,n)),S.push(x?{Assets:{entity:{_eq:"JobSchedule"},assetId:{_eq:x}}}:{}),S.push(b?{Customer:{Manager:{id:{_eq:b}}}}:{}),S.push.apply(S,(0,$.Z)(an(j,I))),S.push.apply(S,(0,$.Z)(at(Z))),S.push(C?{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}:{}),{where:{type:{_eq:"ppm"},locationId:{_eq:m},sublocationId:{_eq:h},assetCategoryId:{_eq:f},customerId:{_eq:p},_and:S.filter(function(e){return!os.isEmpty(e)})}}},aa=function(e){var n,t,o=e.locationId,r=e.initialFilters,a=e.hideFilters,d=e.containerHeight,c=e.tableHeight,p=e.onViewChange,m=(0,eo.x)(),h=m.user,x=m.hasRole,g=x("supplier"),b=x("customer"),w=x("tenant"),C=(0,rn.s)(),S=(0,H.Z)("(max-width: 600px)"),D=(0,H.Z)("(max-width: 1000px)"),q=(0,rX.q)().admin,P=null==q?void 0:null===(n=q.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,O=null==q?void 0:null===(t=q.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,M=(0,f.Z)((0,oW.X)("scheduledjob_table_jobs".concat(r.filterType),r,"network"),2),F=M[0],A=M[1],E=(0,s.useState)(r),R=E[0],J=E[1],L=(0,s.useState)([]),Y=L[0],B=L[1],V=(0,s.useState)(!1),Q=V[0],z=V[1],U=(0,s.useState)([]),K=U[0],X=U[1],ee=(0,s.useState)(!1),en=ee[0],et=ee[1],er=(0,s.useState)(!1),ea=er[0],ei=er[1],el=(0,nA.x)({filters:R}),es=el.ref,eu=el.initialData,ed=(0,s.useMemo)(function(){return ar((0,i.Z)({},R),h.accountType)},[R,h.accountType]),ep=(0,j.a)(e6,{variables:(0,i.Z)({},eu,ed)}),em=ep.data,eh=void 0===em?{jobs:[],meta:{aggregate:{totalCount:0}}}:em,ev=eh.jobs,ef=eh.meta,ex=ep.loading,eg=ep.refetch,eb=(0,f.Z)((0,Z.t)(e6,{variables:(0,i.Z)((0,v.Z)((0,i.Z)({},eu),{limit:null,offset:0}),ed)}),1)[0],ey=(0,s.useCallback)(function(e){var n=[];return b||g||n.push({context:"secondary",icon:"edit",onClick:function(n){return G().push("/dashboard/issues/manage?id=".concat(e.number))},tooltip:"Edit"}),n.push({context:"secondary",icon:"info",onClick:function(n){return G().push("/dashboard/issues/view?id=".concat(e.number))},tooltip:"Info"}),n},[b,g]),ej=(0,s.useMemo)(function(){return[{defaultSelected:!0,minWidth:60,field:"id",headerName:"Job ID",renderCell:function(e){var n=e.row;return(0,l.jsx)(rK.D,{id:n.id,number:n.number,openCanvas:!0,type:n.type,numberPrefix:P,numberSuffix:O})}},{defaultSelected:!0,minWidth:60,field:"invoiceNumber",headerName:"Invoice ID",renderCell:function(e){return e.row.invoiceNumber},sortable:!1},{defaultSelected:!0,minWidth:200,field:"service",headerName:"Service",sortName:'{"Service": {"name": "ORDER"}}'},{width:60,field:"type",headerName:"Type",sortable:!1},{minWidth:300,field:"tags",headerName:"Tags",sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsx)(r1.K,{row:n,refetchQueries:["GetScheduledJobs"],entity:"Job"})}},{defaultSelected:!0,minWidth:200,flex:1,field:"description",headerName:"Description",sortable:!1},{defaultSelected:!0,minWidth:130,flex:1,field:"manager",headerName:"Assigned to",sortName:'{"Manager": {"nameFirst": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,l.jsx)(W.r,{noWrap:!n.managerId||g,color:"secondary",href:"/dashboard/users/view?id=".concat(n.managerId),children:n.manager})}},{minWidth:130,flex:1,field:"sublocation",headerName:"Sub Location",sortName:'{"Sublocation": {"name": "ORDER"}}',renderCell:function(e){return e.row.sublocation}},{minWidth:130,flex:1,field:"customer",headerName:"Customer",sortName:'{"Customer": {"name": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,l.jsx)(W.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(n.customerId),noWrap:b||w,children:n.customer})}},{defaultSelected:!0,minWidth:180,flex:1,field:"customerManager",headerName:"Account Manager",sortName:'{"Customer": {"Manager": {"fullName": "ORDER"}}}',renderCell:function(e){var n=e.row;return(0,l.jsx)(W.r,{noWrap:!n.customerManagerId,color:"secondary",href:"/dashboard/users/view?id=".concat(n.customerManagerId),children:n.customerManager})}},{defaultSelected:!0,minWidth:140,flex:1,field:"supplier",headerName:"Supplier",sortName:'{"Supplier": {"name": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,l.jsx)(W.r,{noWrap:!n.supplierId||g,color:"secondary",href:"/dashboard/suppliers/view?id=".concat(n.supplierId),children:n.supplier})}},{minWidth:140,flex:1,field:"assetCategory",headerName:"Asset Category",sortName:'{"AssetCategory": {"name": "ORDER"}}',renderCell:function(e){return e.row.assetCategory}},{minWidth:140,flex:1,field:"assets",headerName:"Assets Name",sortable:!1,renderCell:function(e){return e.row.assets}},{defaultSelected:!0,minWidth:100,flex:1,field:"scheduled",headerName:"Scheduled",sortName:"timingStart",renderCell:function(e){var n=e.row;return y()(n.timingStart).format("YYYY-MM-DD")}},{minWidth:100,flex:1,field:"createdAt",headerName:"Created",sortName:"createdAt",renderCell:function(e){var n=e.row;return y()(n.createdAt).format("YYYY-MM-DD")}},{defaultSelected:!0,minWidth:140,flex:1,field:"status",headerName:"Status",sortName:"status",renderCell:function(e){var n=e.row;return(0,l.jsx)(ec.B,{value:n.status})}},{defaultSelected:!0,width:50,field:"actions",headerName:"Actions",sortable:!1,renderCell:function(e){var n=e.row;return S?(0,l.jsxs)(u.Z,{direction:"row",rowGap:2,children:[(0,l.jsx)(_.Z,{onClick:function(e){return G().push("/dashboard/issues/manage?id=".concat(n.number))},children:(0,l.jsx)(ru.Z,{sx:{color:"#000000"}})}),(0,l.jsx)(_.Z,{onClick:function(e){return G().push("/dashboard/issues/view?id=".concat(n.number))},children:(0,l.jsx)(or.Z,{sx:{color:"#000000"}})})]}):(0,l.jsx)(r2.C,{actionsData:ey,row:n})}}]},[P,O,g,b,w,S,ey]),eZ=(0,s.useMemo)(function(){return ev.map(function(e){var n,t,o,r,a,i,l,s,u,d,c,p,m,h,v,f,x;return{id:e.id,type:e.type,number:e.number,invoiceNumber:(0,$.Z)(new Set(e.invoices.map(function(e){return e.invoiceNumber}))).join(", ")||"-",service:(null===(n=e.service)||void 0===n?void 0:n.name)||"-",description:(null===(t=e.shortJobDesc)||void 0===t?void 0:null===(o=t[0])||void 0===o?void 0:null===(r=o.taxonomy)||void 0===r?void 0:r.name)||"-",manager:(null===(a=e.manager)||void 0===a?void 0:a.fullName)||"-",managerId:null===(i=e.manager)||void 0===i?void 0:i.id,sublocation:(null===(l=e.sublocation)||void 0===l?void 0:l.name)||"-",customer:null===(s=e.customer)||void 0===s?void 0:s.name,customerId:null===(u=e.customer)||void 0===u?void 0:u.id,customerManager:(null===(d=e.customer)||void 0===d?void 0:null===(c=d.manager)||void 0===c?void 0:c.fullName)||"-",customerManagerId:null===(p=e.customer)||void 0===p?void 0:null===(m=p.manager)||void 0===m?void 0:m.id,supplier:(null===(h=e.supplier)||void 0===h?void 0:h.name)||"-",supplierId:null===(v=e.supplier)||void 0===v?void 0:v.id,assetCategory:(null===(f=e.assetCategory)||void 0===f?void 0:f.name)||"-",assets:(null===(x=e.assets)||void 0===x?void 0:x.map(function(e){return e.asset.name}).join(", "))||"-",timingStart:e.timingStart,createdAt:e.createdAt,status:e.status,tags:e.tags}})},[ev]),ew=(0,s.useMemo)(function(){return b?["manager","supplier","tags"]:g?["customer","customerManager","tags"]:w?["manager","supplier","tags"]:[]},[b,g,w]),eC=(0,s.useMemo)(function(){return b?["manager","supplier","tags","actions"]:g?["customer","customerManager","tags","actions"]:w?["manager","supplier","actions"]:["actions"]},[b,g,w]),eI=function(e){var n=e.columns;eb().then(function(e){var t=e.data,o=N().unparse(t9(null==t?void 0:t.jobs,n,t4)),r="data:application/octet-stream,"+encodeURIComponent(o);(0,oM.S)(r,"Planned_Maintenance_".concat(y()().format("YYYY/MM/DD"),".csv"))})},eS=(0,s.useMemo)(function(){return r6(ej,K,ew)},[ej,K,ew]),e_=(0,s.useCallback)(function(e){A(function(n){var t=(0,i.Z)({},n);return delete t[e],t})},[A]),ek=(0,s.useMemo)(function(){return ej.map(function(e){var n,t=e.headerName;return{label:t,value:e.field,defaultSelected:e.defaultSelected}}).filter(function(e){return!ew.includes(e.value)})},[ej,ew]),eD=(0,s.useMemo)(function(){return ej.map(function(e){var n,t=e.headerName;return{label:t,value:e.field,defaultSelected:e.defaultSelected}}).filter(function(e){return!eC.includes(e.value)})},[ej,eC]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r9,{locationId:o,open:Q,close:function(){return z(!1)},hideFilters:a,filtersFormData:F,setFiltersFormData:A,setFilters:J,setFiltersChips:B}),(0,l.jsx)(o7,{mainKey:"scheduled_job_table_jobs_column_selector",open:en,close:function(){return et(!1)},columns:ek,setColumns:X,submitBtnText:"Apply",subtitle:"Select the columns you would like to see in the table."}),(0,l.jsx)(o7,{mainKey:"scheduled_job_table_jobs_column_export",open:ea,close:function(){return ei(!1)},onCompleted:function(e){return eI(e)},columns:eD,submitBtnText:"Export",subtitle:"Select the columns you would like to export in the csv file."}),(0,l.jsxs)(u.Z,{sx:{height:d},children:[(0,l.jsxs)(I.Z,{pl:2,pr:2,mb:1,mt:1,sx:{display:"grid",alignItems:"flex-start",minHeight:"auto",gridTemplateAreas:D?'"filter-btn calendar-btn"\n                  "filter-chip filter-chip"':'"filter-btn filter-chip calendar-btn"',gridTemplateColumns:D?"auto auto":"206px auto 180px",columnGap:D?0:2,rowGap:D?2:0},children:[(0,l.jsx)(I.Z,{sx:{gridArea:"filter-btn"},children:(0,l.jsxs)(rU.Z,{variant:"contained",children:[(0,l.jsx)(k.Z,{startIcon:(0,l.jsx)(r8.Z,{}),onClick:function(){return et(!0)},children:"Columns"}),(0,l.jsx)(k.Z,{startIcon:(0,l.jsx)(r0.Z,{}),onClick:function(){return z(!0)},children:"Filters"})]})}),(0,l.jsx)(I.Z,{sx:{gridArea:"filter-chip",overflow:"hidden"},children:(0,l.jsx)(oz,{filtersChips:Y,onRemove:e_})}),(0,l.jsxs)(I.Z,{sx:{gridArea:"calendar-btn",justifySelf:"flex-end"},children:[!C&&!S&&(0,l.jsx)(k.Z,{onClick:function(){return ei(!0)},disableMinWidth:!0,color:"info",variant:"contained",sx:{height:"36.5px"},children:(0,l.jsx)(T.Z,{})}),(0,l.jsx)(k.Z,{variant:"contained",color:"info",startIcon:(0,l.jsx)(rr.Z,{component:rN,inheritViewBox:!0}),onClick:function(e){return p("calendar")},sx:{minWidth:"110px",marginLeft:"10px!important"},children:"Calendar"})]})]}),(0,l.jsx)(o4,{autoHeight:!1,ref:es,loading:ex,columns:ej,rows:eZ,meta:ef,refetch:eg,containerHeight:c,columnVisibilityModel:eS})]})]})};aa.defaultProps={initialFilters:{},containerHeight:"calc(100vh - 190px)",tableHeight:"calc(100% - 32px)"};var ai=t(99534),al=t(48999);function as(){return(as=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let au=e=>s.createElement("svg",as({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),s.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957A11.5 11.5 0 1 0 21.007 5.03c-.31-.457-.944-.518-1.372-.169l-6.503 5.307a1 1 0 0 1-1.632-.775z"}),s.createElement("path",{fill:"#E9175E",d:"M18.472 4.944c.318-.267.446-.708.258-1.079-.49-.97-1.293-1.791-2.43-2.365a9 9 0 0 0-3.314-.963C12.44.489 12 .94 12 1.487V8.24a1 1 0 0 0 1.644.765z"}));function ad(){return(ad=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let ac=e=>s.createElement("svg",ad({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),s.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957A11.5 11.5 0 1 0 22.957 12.5c.047-.55-.405-.999-.957-.999h-9.5a1 1 0 0 1-1-1z"}),s.createElement("path",{fill:"#E9175E",d:"M21.399 10.31a1 1 0 0 0 1-1v-.332a9.56 9.56 0 0 0-5.159-7.202 9.7 9.7 0 0 0-3.506-.988c-.55-.048-.993.41-.985.963l.108 7.574a1 1 0 0 0 1 .985h7.542"}));function ap(){return(ap=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let am=e=>s.createElement("svg",ap({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),s.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957a11.5 11.5 0 1 0 9.804 18.854c.355-.423.243-1.05-.21-1.367l-8.17-5.731a1 1 0 0 1-.425-.819z"}),s.createElement("path",{fill:"#E9175E",d:"M20.395 16.094c.461.319 1.107.189 1.37-.316a10.8 10.8 0 0 0 1.207-4.395 10.55 10.55 0 0 0-1.14-5.41A9.9 9.9 0 0 0 18.15 2.01a9.6 9.6 0 0 0-4.17-1.348c-.55-.045-.996.417-.995.968l.018 8.842c0 .323.157.623.421.805z"}));function ah(){return(ah=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let av=e=>s.createElement("svg",ah({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 23"},e),s.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957a11.5 11.5 0 0 0 0 22.914c.55.047.999-.405.999-.957V1"}),s.createElement("path",{fill:"#E9175E",d:"M12 1c0-.552.448-1.004.999-.96 2.817.225 5.472 1.398 7.486 3.328C22.735 5.525 24 8.45 24 11.5s-1.264 5.975-3.515 8.132c-2.014 1.93-4.67 3.103-7.486 3.328-.55.044-.999-.408-.999-.96V1"}));function af(){return(af=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let ax=e=>s.createElement("svg",af({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),s.createElement("path",{fill:"#E9175E",d:"M11.5 1c0-.552.449-1.005.999-.957a11.5 11.5 0 1 1-9.804 18.854c-.356-.423-.243-1.05.21-1.367l8.17-5.731a1 1 0 0 0 .425-.819z"}),s.createElement("path",{fill:"#1AB43B",d:"M2.963 16.078c-.463.326-1.117.194-1.379-.318a10.95 10.95 0 0 1-1.178-4.377 10.7 10.7 0 0 1 1.121-5.41A9.85 9.85 0 0 1 5.151 2.01 9.3 9.3 0 0 1 9.237.663c.548-.046.995.416.994.967l-.018 8.846a.98.98 0 0 1-.415.801z"}));function ag(){return(ag=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let ab=e=>s.createElement("svg",ag({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),s.createElement("path",{fill:"#E9175E",d:"M11.5 1c0-.552.449-1.005.999-.957A11.5 11.5 0 1 1 .043 12.5c-.048-.55.405-.999.957-.999h9.5a1 1 0 0 0 1-1z"}),s.createElement("path",{fill:"#1AB43B",d:"M1.601 10.31a1 1 0 0 1-1-1v-.332A9.56 9.56 0 0 1 5.76 1.776 9.7 9.7 0 0 1 9.266.788c.55-.048.993.41.985.963l-.108 7.574a1 1 0 0 1-1 .985H1.601"}));function ay(){return(ay=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let aj=e=>s.createElement("svg",ay({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),s.createElement("path",{fill:"#E9175E",d:"M11.5 1c0-.552.449-1.005.999-.957A11.5 11.5 0 1 1 1.993 5.03c.31-.457.944-.518 1.372-.169l6.503 5.307a1 1 0 0 0 1.632-.775z"}),s.createElement("path",{fill:"#1AB43B",d:"M4.528 4.944c-.318-.267-.446-.708-.258-1.079.49-.97 1.293-1.791 2.43-2.365a9 9 0 0 1 3.314-.963c.545-.048.985.404.985.95V8.24a1 1 0 0 1-1.644.765z"}));function aZ(){return(aZ=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let aw=e=>s.createElement("svg",aZ({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),s.createElement("circle",{cx:11.5,cy:11.5,r:11.5,fill:"#1AB43B",transform:"rotate(-90 11.5 11.5)"}));var aC=function(e){var n,t,o=e.data,r=o[0]||0,a=r+(o[1]||0),i=r/a*100;return 0===a?(0,l.jsx)(aI,{component:aw,inheritViewBox:!0,color:"gray"}):(0,l.jsx)("div",{children:(0===i?(n=aw,t="danger"):i>0&&i<=12.5?n=aj:i>12.5&&i<=25?n=ab:i>25&&i<50?n=ax:50===i?n=av:i>50&&i<=62.5?n=am:i>62.5&&i<=75?n=ac:i>75&&i<100?n=au:100===i&&(n=aw,t="success"),(0,l.jsx)(aI,{component:n,inheritViewBox:!0,color:t}))})};aC.defaultProps={data:[]},aC.propTypes={data:g().array};var aI=(0,c.ZP)(rr.Z)(function(e){var n=e.theme,t=e.color;return{"& path, circle":(0,i.Z)({},"success"===t&&{fill:n.palette.success.main},"danger"===t&&{fill:n.palette.danger.main},"gray"===t&&{fill:"#BFBFBF"})}});function aS(e){var n=e.title,t=e.month,o=e.year,r=e.complete,a=e.inComplete,i=e.followOn,s=e.inCompleteCompliance;return(0,l.jsx)(I.Z,{sx:{padding:"8px 16px"},children:(0,l.jsxs)(u.Z,{spacing:1,children:[(t||o)&&(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",spacing:.5,children:[t&&(0,l.jsxs)(S.Z,{variant:"h6",children:[t," "]}),o&&(0,l.jsx)(S.Z,{variant:"h6",sx:{opacity:"0.54"},children:o})]}),n&&(0,l.jsx)(S.Z,{variant:"h6",children:n}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",children:[(0,l.jsx)(a_,{mr:1,bgcolor:"success.main"})," ",(0,l.jsxs)(S.Z,{children:["Complete: ",r]})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",children:[(0,l.jsx)(a_,{mr:1,bgcolor:"danger.main"})," ",(0,l.jsxs)(S.Z,{children:["Incomplete: ",a]})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",children:[(0,l.jsx)(a_,{mr:1,bgcolor:"info.main"})," ",(0,l.jsxs)(S.Z,{children:["Follow on jobs: ",i]})]}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",children:[(0,l.jsx)(E.Z,{sx:{height:"14px",width:"14px",marginRight:"8px",color:"danger.main"}}),(0,l.jsxs)(S.Z,{children:["Incomplete compliance jobs: ",s]})]})]})})}aS.defaultProps={month:"",year:"",complete:0,inComplete:0,followOn:0,inCompleteCompliance:0},aS.propTypes={month:g().string,year:g().string,complete:g().number,inComplete:g().number,followOn:g().number,inCompleteCompliance:g().number};var a_=(0,c.ZP)(I.Z)(function(e){return e.theme,{width:14,height:14,borderRadius:"50%"}}),ak=function(e){var n=e.year,t=e.month,o=e.total,r=e.complete,a=e.inComplete,i=e.followOn,s=e.inCompleteCompliance,d=e.onClick,c=[0,0];return y()().isSameOrAfter(y()().month(t).year(n))&&(c[0]=r,c[1]=a),(0,l.jsx)(aD,{followCursor:!0,title:(0,l.jsx)(aS,{year:n,month:t,complete:r,inComplete:a,followOn:i,inCompleteCompliance:s}),children:(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",justifyContent:"center",spacing:2,sx:{height:"92px",padding:"0px 12px",borderRadius:1,backgroundColor:"#F2F2F2"},onClick:d,children:[(0,l.jsx)(C.Z,{color:"info",variant:"dot",invisible:0===i,children:(0,l.jsx)(I.Z,{sx:{padding:"2px 6px",borderRadius:1,backgroundColor:"#FFFFFF"},children:(0,l.jsx)(S.Z,{fontWeight:600,children:o})})}),(0,l.jsx)("div",{children:(0,l.jsx)(aC,{data:c})})]})})};ak.defaultProps={year:"",month:"",total:0,complete:0,inComplete:0,followOn:0,inCompleteCompliance:0,onClick:function(){}},ak.propTypes={year:g().string,month:g().string,total:g().number,complete:g().number,inComplete:g().number,followOn:g().number,inCompleteCompliance:g().number,onClick:g().func};var aD=(0,c.ZP)(function(e){var n=e.className,t=(0,ai.Z)(e,["className"]);return(0,l.jsx)(nV.Z,(0,v.Z)((0,i.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,oN.Z)({},"& .".concat(al.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),aq=function(e){var n=e.children,t=e.selected,o=(0,H.Z)("(max-width: 600px)");return(0,l.jsx)(aP,{selected:t,isWidth600PxOrLess:o,children:(0,l.jsx)(S.Z,{children:n})})};aq.defaultProps={selected:!1},aq.propTypes={children:g().node,selected:g().bool};var aP=(0,c.ZP)(I.Z)(function(e){var n=e.theme,t=e.selected,o=e.isWidth600PxOrLess;return{display:"flex",justifyContent:"center",alignItems:"center",padding:"4px 20px",borderRadius:"8px",backgroundColor:t&&!o?n.palette.secondary.main:"none","& .MuiTypography-root":{fontWeight:t?400:700,color:t?n.palette.secondary.contrastText:n.palette.black.main}}}),aO=function(e){var n=e.jobs,t=e.timePeriods,o=e.year,r={},a={count:0,completeCount:0,inCompleteCount:0,followOnCount:0,inCompleteComplianceCount:0};return t.forEach(function(e){var t=e.value,i={count:0,completeCount:0,inCompleteCount:0,followOnCount:0,inCompleteComplianceCount:0},l=y()().month(t).year(o).startOf("month"),s=y()().month(t).year(o).endOf("month"),u=aT(n,l,s);i.count=u.count,i.completeCount=u.completeCount,i.inCompleteCount=u.inCompleteCount,i.followOnCount=u.followOnCount,i.inCompleteComplianceCount=u.inCompleteComplianceCount,a.count+=i.count,a.completeCount+=i.completeCount,a.inCompleteCount+=i.inCompleteCount,a.followOnCount+=i.followOnCount,a.inCompleteComplianceCount+=i.inCompleteComplianceCount,r[t]=i}),{countByPeriod:r,totalCount:a}},aT=function(e,n,t){var o={count:0,completeCount:0,inCompleteCount:0,followOnCount:0,inCompleteComplianceCount:0};return e.forEach(function(e){var r;y()(e.timingStart).isBetween(n,t)&&((null===(r=e.statusData)||void 0===r?void 0:r.completed)?o.completeCount++:(o.inCompleteCount++,e.hasCompliance&&o.inCompleteComplianceCount++),o.count++)}),o},aM=function(e){var n=e.year,t=e.total,o=e.complete,r=e.inComplete,a=e.followOn,i=e.inCompleteCompliance;return(0,l.jsx)(aF,{followCursor:!0,title:(0,l.jsx)(aS,{year:n,complete:o,inComplete:r,followOn:a,inCompleteCompliance:i}),children:(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",justifyContent:"center",spacing:2,sx:{height:"92px",padding:"0px 12px",borderRadius:1,border:"1px solid #BFBFBF"},children:[(0,l.jsx)(C.Z,{color:"info",variant:"dot",invisible:0===a,children:(0,l.jsx)(I.Z,{sx:{padding:"2px 6px",borderRadius:1,backgroundColor:"#F2F2F2"},children:(0,l.jsx)(S.Z,{fontWeight:600,children:t})})}),(0,l.jsx)("div",{children:(0,l.jsx)(aC,{data:[o,r]})})]})})};aM.defaultProps={year:"",month:"",total:0,complete:0,inComplete:0,followOn:0,inCompleteCompliance:0,chartColors:[],chartRotation:0},aM.propTypes={year:g().string,total:g().number,complete:g().number,inComplete:g().number,followOn:g().number,inCompleteCompliance:g().number};var aF=(0,c.ZP)(function(e){var n=e.className,t=(0,ai.Z)(e,["className"]);return(0,l.jsx)(nV.Z,(0,v.Z)((0,i.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,oN.Z)({},"& .".concat(al.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),aA=function(e){var n=e.locationId,t=e.year,o=e.month,r=(0,s.useMemo)(function(){return y()().month(o).year(t).startOf("month").toISOString()},[o,t]),a=(0,s.useMemo)(function(){return y()().month(o).year(t).endOf("month").toISOString()},[o,t]),i=(0,j.a)(e7,{variables:{whereComplete:{type:{_eq:"ppm"},status:{_neq:"canceled"},statusData:{_has_key:"completed"},locationId:{_eq:n},timingStart:{_gte:r,_lte:a}},whereIncomplete:{type:{_eq:"ppm"},status:{_neq:"canceled"},_not:{statusData:{_has_key:"completed"}},locationId:{_eq:n},timingStart:{_gte:r,_lte:a}},whereFollowOn:{type:{_eq:"ppm"},status:{_neq:"canceled"},Jobs:{},locationId:{_eq:n},timingStart:{_gte:r,_lte:a}},whereIncompleteCompliance:{type:{_eq:"ppm"},status:{_neq:"canceled"},_not:{statusData:{_has_key:"completed"}},Jobs:{},locationId:{_eq:n},timingStart:{_gte:r,_lte:a}}}}),u=i.data,d=void 0===u?{jobsCompleteCount:{aggregate:{count:0}},jobsIncompleteCount:{aggregate:{count:0}},jobsFollowOnCount:{aggregate:{count:0}},jobsIncompleteComplianceCount:{aggregate:{count:0}}}:u,c=d.jobsCompleteCount.aggregate.count,p=d.jobsIncompleteCount.aggregate.count,m=d.jobsFollowOnCount.aggregate.count,h=d.jobsIncompleteComplianceCount.aggregate.count,v=i.loading,f=c+p;return v?null:(0,l.jsx)(aR,{followCursor:!0,title:(0,l.jsx)(aS,{year:t,month:o,complete:c,inComplete:p,followOn:m,inCompleteCompliance:h}),children:(0,l.jsxs)(J.ZP,{container:!0,width:"100%",justifyContent:"center",alignItems:"center",children:[(0,l.jsx)(J.ZP,{item:!0,xs:12,order:{xs:2,md:1,lg:1},sx:{textAlign:"center"},children:(0,l.jsxs)(S.Z,{color:"#323E4E",children:[f," ",f>1?"jobs":"job"]})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,order:{xs:1,md:2,lg:2},sx:{display:"flex",width:"100%",alignItems:"center",height:"4px"},children:0!==f&&y()().isAfter(r)?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(aE,{percentage:c/f*100,color:"success"}),(0,l.jsx)(aE,{percentage:p/f*100,color:"danger"})]}):(0,l.jsx)(aE,{percentage:100,color:"gray"})})]})})};aA.defaultProps={year:"",month:""},aA.propTypes={locationId:g().string,year:g().string,month:g().string};var aE=(0,c.ZP)(I.Z)(function(e){var n=e.theme,t=e.percentage,o=e.color;return(0,i.Z)({width:"".concat(t,"%"),height:"100%"},"success"===o&&(0,v.Z)((0,i.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"4px 0 0 4px"}),{backgroundColor:n.palette.success.main}),"danger"===o&&(0,v.Z)((0,i.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"0px 4px 4px 0px"}),{backgroundColor:n.palette.danger.main}),"gray"===o&&{borderRadius:"4px",backgroundColor:"#BFBFBF"})}),aR=(0,c.ZP)(function(e){var n=e.className,t=(0,ai.Z)(e,["className"]);return(0,l.jsx)(nV.Z,(0,v.Z)((0,i.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,oN.Z)({},"& .".concat(al.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),aN=t(44844),aW=function(e){var n=e.locationIdWatch,t=e.assetCategoryIdWatch,o=e.locationId,r=e.accountId,a=(0,s.useState)(""),i=a[0],l=a[1],u=(0,s.useState)(""),d=u[0],c=u[1],p=(0,s.useState)(""),m=p[0],h=p[1],v=(0,s.useState)(""),x=v[0],g=v[1],b=(0,s.useState)(""),y=b[0],j=b[1],w=(0,s.useState)(""),C=w[0],I=w[1],S=(0,s.useState)(""),_=S[0],k=S[1],D=(0,s.useState)(""),q=D[0],P=D[1],O=(0,f.Z)((0,Z.t)(ns.SW,{variables:{q:""!==i?"%".concat(i,"%"):null,limit:50,offset:0}}),2),T=O[0],M=O[1],F=M.loading,A=M.data,E=(void 0===A?{items:[]}:A).items,R=(0,f.Z)((0,Z.t)(ns._d,{variables:{where:{name:{_ilike:""!==d?"%".concat(d,"%"):null},status:{_eq:"active"}},limit:50,offset:0}}),2),N=R[0],W=R[1],$=W.loading,J=W.data,L=(void 0===J?{items:[]}:J).items,Y=(0,f.Z)((0,Z.t)(ns.zR,{variables:{locationId:n||o,q:""!==m?"%".concat(m,"%"):null,limit:50,offset:0}}),2),B=Y[0],H=Y[1],V=H.loading,G=H.data,Q=(void 0===G?{items:[]}:G).items,z=(0,f.Z)((0,Z.t)(ns._f,{variables:{where:{type:{_eq:"assetCategory"},isGroup:{_eq:!1},status:{_eq:"active"},name:{_ilike:""!==x?"%".concat(x,"%"):null}},limit:50,offset:0,orderBy:{name:"asc"}}}),2),U=z[0],K=z[1],X=K.loading,ee=K.data,en=(void 0===ee?{items:[]}:ee).items,et=(0,f.Z)((0,Z.t)(ns.UH,{variables:{locationId:(null==n?void 0:n.value)||o,categoryId:null==t?void 0:t.value,q:""!==y?"%".concat(y,"%"):null,limit:50,offset:0}}),2),eo=et[0],er=et[1],ea=er.loading,ei=er.data,el=(void 0===ei?{items:[]}:ei).items,es=(0,f.Z)((0,Z.t)(ns.by,{variables:{where:{type:{_eq:"supplier"},name:{_ilike:""!==C?"%".concat(C,"%"):null}},limit:50,offset:0}}),2),eu=es[0],ed=es[1],ec=ed.loading,ep=ed.data,em=(void 0===ep?{items:[]}:ep).items,eh=(0,f.Z)((0,Z.t)(ns.K4,{variables:{accountId:r,limit:50,offset:0,q:""!==_?"%".concat(_,"%"):null}}),2),ev=eh[0],ef=eh[1],ex=ef.data,eg=(void 0===ex?{items:[]}:ex).items,eb=ef.loading,ey=(0,f.Z)((0,Z.t)(ns.yR,{variables:{accountId:r,q:""!==q?"%".concat(q,"%"):null,limit:50,offset:0}}),2),ej=ey[0],eZ=ey[1],ew=eZ.data,eC=(void 0===ew?{items:[]}:ew).items;return{customerProps:{onOpen:T,loading:F,options:E,setSearch:l},propertyProps:{onOpen:N,loading:$,options:L,setSearch:c},sublocationProps:{onOpen:B,loading:V,options:Q,setSearch:h},assetCategoryProps:{onOpen:U,loading:X,options:en,setSearch:g},assetProps:{onOpen:eo,loading:ea,options:el,setSearch:j},supplierProps:{onOpen:eu,loading:ec,options:em,setSearch:I},customerManagerProps:{onOpen:ev,loading:eb,options:eg,setSearch:k},userProps:{onOpen:ej,loading:eZ.loading,options:eC,setSearch:P}}},a$={search:"",year:y()(),status:null,tags:null,customerId:null,locationId:null,sublocationId:null,userId:null,assetCategoryId:null,assetId:null,supplierId:null,customerManagerId:null,allJobs:null,allItems:null,hideExpiredItems:!1};function aJ(){var e=(0,ep.Z)(["Status is ",""]);return aJ=function(){return e},e}var aL=function(e){var n={search:function(e){return!!e&&"Search is ".concat(e)},year:function(e){return!!e&&"".concat(y()(e).format("YYYY"))},status:function(e){return(null==e?void 0:e.length)>0&&e(aJ(),null==e?void 0:e.map(function(e){return e.label}).join(", "))},tags:function(e){return(null==e?void 0:e.length)>0&&"Tags is ".concat(null==e?void 0:e.map(function(e){return e.label}).join(", "))},customerId:function(e){return null!=e&&!!e.label&&"Customer is ".concat(null==e?void 0:e.label)},locationId:function(e){return null!=e&&!!e.label&&"Location is ".concat(null==e?void 0:e.label)},sublocationId:function(e){return null!=e&&!!e.label&&"Sublocation is ".concat(null==e?void 0:e.label)},userId:function(e){return null!=e&&!!e.label&&"User is ".concat(null==e?void 0:e.label)},assetCategoryId:function(e){return null!=e&&!!e.label&&"Asset Category is ".concat(null==e?void 0:e.label)},assetId:function(e){return null!=e&&!!e.label&&"Asset is ".concat(null==e?void 0:e.label)},supplierId:function(e){return null!=e&&!!e.label&&"Supplier is ".concat(null==e?void 0:e.label)},customerManagerId:function(e){return null!=e&&!!e.label&&"Customer Manager is ".concat(null==e?void 0:e.label)},allJobs:function(e){return null!=e&&!!e.label&&"All Jobs is ".concat(null==e?void 0:e.label)},allItems:function(e){return null!=e&&!!e.label&&"All Items is ".concat(null==e?void 0:e.label)},hideExpiredItems:function(e){return!!e&&"Exclude expired items"}};return Object.entries(e).reduce(function(e,t){var o=(0,f.Z)(t,2),r=o[0],a=o[1];if(!a||!n[r])return e;var i=(0,n[r])(a);return i&&e.push({key:r,label:i}),e},[])},aY=function(e){var n=e.locationId,t=e.open,o=e.close,r=e.hideFilters,a=e.filtersFormData,d=e.setFiltersFormData,c=e.setFilters,p=e.setFiltersChips,m=(0,eo.x)(),h=m.user,f=m.hasRole,x=f("admin"),g=f(["customer","supplier"]),b=(0,H.Z)("(max-width: 600px)"),y=(0,nO.cI)({defaultValues:(0,i.Z)({},a$)}),j=y.control,Z=y.handleSubmit,w=y.reset,C=y.getValues,I=y.watch,S=I("locationId"),_=I("assetCategoryId"),D=aW({locationIdWatch:S,assetCategoryIdWatch:_,locationId:n,accountId:h.accountId}),q=D.customerProps,P=D.propertyProps,O=D.sublocationProps,T=D.assetCategoryProps,M=D.assetProps,F=D.supplierProps,A=D.customerManagerProps,E=D.userProps;(0,s.useEffect)(function(){var e,t,o,r,l,s,u,d,m,h,v,f,x,g,b={search:a.search?"%".concat(a.search,"%"):null,status:(null===(e=a.status)||void 0===e?void 0:e.length)>0?null===(t=a.status)||void 0===t?void 0:t.map(function(e){return e.value}):null,tags:(null===(o=a.tags)||void 0===o?void 0:o.length)>0?null===(r=a.tags)||void 0===r?void 0:r.map(function(e){return e.value}):null,customerId:null===(l=a.customerId)||void 0===l?void 0:l.value,locationId:n||(null===(s=a.locationId)||void 0===s?void 0:s.value),sublocationId:null===(u=a.sublocationId)||void 0===u?void 0:u.value,userId:null===(d=a.userId)||void 0===d?void 0:d.value,assetCategoryId:null===(m=a.assetCategoryId)||void 0===m?void 0:m.value,assetId:null===(h=a.assetId)||void 0===h?void 0:h.value,supplierId:null===(v=a.supplierId)||void 0===v?void 0:v.value,customerManagerId:null===(f=a.customerManagerId)||void 0===f?void 0:f.value,allJobs:null===(x=a.allJobs)||void 0===x?void 0:x.value,allItems:null===(g=a.allItems)||void 0===g?void 0:g.value,year:a.year||a$.year,hideExpiredItems:a.hideExpiredItems};w((0,i.Z)({},a$,a)),c(function(e){return(0,i.Z)({},e,b)}),p(aL((0,i.Z)({},a$,a)))},[a,n,w,c,p]);var R=function(e){try{var n=C();d(function(e){return(0,i.Z)({},e,n)})}finally{o()}},N=function(){var e=(0,i.Z)({},a$);d(e),o()};return(0,l.jsx)(oI.Z,{keepMounted:!0,open:t,onClose:o,children:(0,l.jsx)("form",{onSubmit:Z(R),children:(0,l.jsxs)(aB,{is600pxOrLess:b,children:[(0,l.jsxs)(J.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,l.jsx)(J.ZP,{item:!0,xs:12,children:(0,l.jsx)(nO.Qr,{control:j,name:"search",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nC.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search schedule or work order",value:n,onChange:t})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"status",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{multiple:!0,limitTags:1,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n||[],onChange:function(e,n){t(n)},options:(0,oS.lR)(),textFieldProps:{color:"secondary",variant:"standard",label:"Select status"}})}})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(o_.r,{control:j})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"customerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},q),{textFieldProps:{color:"secondary",variant:"standard",label:"Select customer"}}))}})}),!r.includes("location")&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"locationId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},P),{textFieldProps:{color:"secondary",variant:"standard",label:"Select location"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"sublocationId",control:j,render:function(e){var t=e.value,o=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({disabled:!S&&!n,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t,onChange:function(e,n){o(n)}},O),{textFieldProps:{color:"secondary",variant:"standard",label:"Select sublocation"}}))}})}),g&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"userId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},E),{textFieldProps:{color:"secondary",variant:"standard",label:"Select user"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"assetCategoryId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},T),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset category"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"assetId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},M),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset"}}))}})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"supplierId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},F),{textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"}}))}})}),x&&(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"customerManagerId",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},A),{textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}}))}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"allJobs",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"compliance",label:"Compliance jobs only"},{value:"overduePPM",label:"Overdue jobs"},{value:"incompleteFollowOn",label:"Incomplete follow on works"},{value:"followOn",label:"Jobs with follow on works"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Jobs"}})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"allItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(ed.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"complete",label:"with completed jobs"},{value:"incomplete",label:"with incomplete jobs"},{value:"all",label:"with jobs during period"}],textFieldProps:{color:"secondary",variant:"standard",label:"Show all items"}})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{control:j,name:"year",render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nz.M,{views:["year"],inputFormat:"YYYY",value:n,onChange:function(e){e?t(e.toISOString()):t(e)},renderInput:function(e){return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{fullWidth:!0,label:"Select year",color:"secondary",variant:"standard"}))}})}})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,sm:6,children:(0,l.jsx)(nO.Qr,{name:"hideExpiredItems",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nH.Z,{control:(0,l.jsx)(nM.Z,{color:"secondary",checked:n,onChange:function(e,n){return t(n)}}),label:"Hide expired items"})}})})]}),(0,l.jsxs)(u.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,l.jsx)(k.Z,{variant:"contained",color:"danger",onClick:function(){return N()},children:"Cancel"}),(0,l.jsx)(k.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})};aY.defaultProps={open:!1,close:function(){},hideFilters:[],filtersFormData:{},setFiltersFormData:function(){},setFilters:function(){},setFiltersChips:function(){}},aY.propTypes={locationId:g().string,open:g().bool,close:g().func,hideFilters:g().array,filtersFormData:g().object,setFiltersFormData:g().func,setFilters:g().func,setFiltersChips:g().func};var aB=(0,oh.Z)(d.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:n?"0px":"8px",overflowY:"auto"}}),aH=function(e){var n=e.locationId,t=e.year,o=(0,s.useMemo)(function(){return y()().year(t).startOf("year").toISOString()},[t]),r=(0,s.useMemo)(function(){return y()().year(t).endOf("year").toISOString()},[t]),a=(0,j.a)(e7,{variables:{whereComplete:{type:{_eq:"ppm"},status:{_neq:"canceled"},statusData:{_has_key:"completed"},locationId:{_eq:n},timingStart:{_gte:o,_lte:r}},whereIncomplete:{type:{_eq:"ppm"},status:{_neq:"canceled"},_not:{statusData:{_has_key:"completed"}},locationId:{_eq:n},timingStart:{_gte:o,_lte:r}},whereFollowOn:{type:{_eq:"ppm"},status:{_neq:"canceled"},Jobs:{},locationId:{_eq:n},timingStart:{_gte:o,_lte:r}},whereIncompleteCompliance:{type:{_eq:"ppm"},status:{_neq:"canceled"},_not:{statusData:{_has_key:"completed"}},Jobs:{},locationId:{_eq:n},timingStart:{_gte:o,_lte:r}}}}),i=a.data,d=void 0===i?{jobsCompleteCount:{aggregate:{count:0}},jobsIncompleteCount:{aggregate:{count:0}},jobsFollowOnCount:{aggregate:{count:0}},jobsIncompleteComplianceCount:{aggregate:{count:0}}}:i,c=d.jobsCompleteCount.aggregate.count,p=d.jobsIncompleteCount.aggregate.count,m=d.jobsFollowOnCount.aggregate.count,h=d.jobsIncompleteComplianceCount.aggregate.count,v=a.loading,f=c+p;return v?null:(0,l.jsx)(aG,{followCursor:!0,title:(0,l.jsx)(aS,{year:t,complete:c,inComplete:p,followOn:m,inCompleteCompliance:h}),children:(0,l.jsxs)(u.Z,{width:"100%",alignItems:"center",children:[(0,l.jsxs)(S.Z,{color:"#323E4E",children:[f," ",f>1?"jobs":"job"]}),(0,l.jsx)(I.Z,{sx:{display:"flex",width:"100%",height:"4px"},children:0!==f&&y()().isAfter(o)?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(aV,{percentage:c/f*100,color:"success"}),(0,l.jsx)(aV,{percentage:p/f*100,color:"danger"})]}):(0,l.jsx)(aV,{percentage:100,color:"gray"})})]})})};aH.defaultProps={year:""},aH.propTypes={locationId:g().string,year:g().string};var aV=(0,c.ZP)(I.Z)(function(e){var n=e.theme,t=e.percentage,o=e.color;return(0,i.Z)({width:"".concat(t,"%"),height:"100%"},"success"===o&&(0,v.Z)((0,i.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"4px 0 0 4px"}),{backgroundColor:n.palette.success.main}),"danger"===o&&(0,v.Z)((0,i.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"0px 4px 4px 0px"}),{backgroundColor:n.palette.danger.main}),"gray"===o&&{borderRadius:"4px",backgroundColor:"#BFBFBF"})}),aG=(0,c.ZP)(function(e){var n=e.className,t=(0,ai.Z)(e,["className"]);return(0,l.jsx)(nV.Z,(0,v.Z)((0,i.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,oN.Z)({},"& .".concat(al.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),aQ=function(e){var n=y()(e).startOf("year").toISOString(),t=y()(e).endOf("year").toISOString();return{status:{_neq:"canceled"},timingStart:{_gte:n,_lte:t}}},az=function(e,n){switch(e){case"compliance":return[{status:{_neq:"canceled"},Compliances:{}}];case"overduePPM":return[{_and:[{status:{_neq:"canceled"}},{timingStart:{_lte:n}},{_not:{statusData:{_has_key:"inProgress"}}},{_not:{statusData:{_has_key:"closed"}}}]}];case"incompleteFollowOn":return[{status:{_neq:"canceled"},Jobs:{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}}];case"followOn":return[{status:{_neq:"canceled"},Jobs:{}}];default:return[]}},aU=function(e){switch(e){case"complete":return[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]}];case"incomplete":return[{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}];default:return[]}},aK=function(e,n){switch(n){case"supplier":return{supplierUserId:{_eq:e}};case"customer":return{customerUserId:{_eq:e}};default:return{}}},aX=function(e,n){var t,o,r,a,l,s,u,d,c=e.search,p=e.status,m=e.tags,h=e.customerId,v=e.locationId,f=e.sublocationId,x=e.userId,g=e.assetCategoryId,b=e.assetId,j=e.supplierId,Z=e.customerManagerId,w=e.allJobs,C=e.allItems,I=e.year,S=e.hideExpiredItems,_=y()().subtract(24,"hours").toISOString(),k=[],D=[],q=[];(c||(null==p?void 0:p.length)>0||(null==m?void 0:m.length)>0||x||b||h||j||Z||w||C)&&D.push(aQ(I)),q.push.apply(q,(0,$.Z)(j?[{supplierId:{_eq:j}},{status:{_eq:"offered"},SupplierOffers:{accountId:{_eq:j},status:{_in:["offered","accepted"]}}}]:[])),D.push((null==p?void 0:p.length)>0?{status:{_in:p}}:{}),D.push((null==m?void 0:m.length)>0?{Taxonomy:{entity:{_eq:"Job"},Taxonomy:{status:{_eq:"active"},type:{_eq:"tags"},id:{_in:m}}}}:{}),D.push(aK(x,n)),D.push(b?{Assets:{entity:{_eq:"JobSchedule"},assetId:{_eq:b}}}:{}),D.push(h?{customerId:{_eq:h}}:{}),D.push(Z?{Customer:{Manager:{id:{_eq:Z}}}}:{}),D.push.apply(D,(0,$.Z)(az(w,_))),D.push.apply(D,(0,$.Z)(aU(C))),D.push(S?{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}:{}),k.push.apply(k,(0,$.Z)(c?[{reference:{_ilike:c}},{description:{_ilike:c}},{_or:[{Jobs:{reference:{_ilike:c}}},{Jobs:{description:{_ilike:c}}}]}]:[]));var P=k.filter(function(e){return!os.isEmpty(e)}),O=D.filter(function(e){return!os.isEmpty(e)}),T=q.filter(function(e){return!os.isEmpty(e)});return{jobWhere:{status:{_neq:"canceled"},timingStart:{_gte:y()(I).startOf("year").toISOString(),_lte:y()(I).endOf("year").toISOString()}},where:(0,i.Z)({locationId:{_eq:v},sublocationId:{_eq:f},assetCategoryId:{_eq:g}},P.length>0?{_or:P}:{},O.length>0||T.length>0||"all"===C?{Jobs:(0,i.Z)({},T.length>0&&{_or:T},O.length>0&&{_and:O})}:{})}},a0={monthHeaderWrapper:function(e){return{padding:"5px",borderRadius:"10px",border:"2px solid #F2F2F2",backgroundColor:e?"#F2F2F2":"inherit"}}},a1=(0,s.forwardRef)(function(e,n){var t=e.rows,o=e.meta,r=e.refetch,a=e.loading,i=e.locationId,d=e.yearDate,c=(0,oF.a)(),p=(0,s.useState)(tB[0]),m=p[0],h=p[1],v=(0,s.useCallback)(function(e){var n=e.id,t=(e.total,e.year),o=e.month,r=y()().year(t).month(o).startOf("month").toISOString(),a=y()().year(t).month(o).endOf("month").toISOString();c.show({content:(0,l.jsx)(nZ,{jobScheduleId:n,status:null,startDate:r,endDate:a,onClose:c.close}),title:"Works orders",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[c]),f=(0,s.useMemo)(function(){return[{flex:1,minWidth:220,field:"id",headerName:"",sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{justifyContent:"center",sx:{height:"100%"},children:[(0,l.jsx)(S.Z,{color:"secondary",fontWeight:600,children:n.serviceName}),(0,l.jsx)(S.Z,{fontWeight:600,mt:2,children:n.title}),(0,l.jsx)(et.O,{fontSize:"12px",maxLength:20,children:n.description})]})}},{flex:1,minWidth:120,field:"count",headerName:"Count",headerAlign:"center",sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsx)(ak,{year:d.year(),month:m.label,total:n[m.value].count,complete:n[m.value].completeCount,inComplete:n[m.value].inCompleteCount,followOn:n[m.value].followOnCount,inCompleteCompliance:n[m.value].inCompleteComplianceCount,onClick:function(){return v({id:n.id,total:n[m.value].count,year:d.year(),month:m.label})}})}}]},[v,m.label,m.value,d]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(u.Z,{direction:"row",flexWrap:"wrap",justifyContent:"space-between",rowGap:2,p:3,children:tB.map(function(e){var n=e.label,t=e.value;return(0,l.jsxs)(u.Z,{width:"90px",sx:a0.monthHeaderWrapper(m.value===t),onClick:function(){return h({label:n,value:t})},children:[(0,l.jsx)(aq,{children:n}),(0,l.jsx)(aA,{locationId:i,year:d.year(),month:n})]})})}),(null==t?void 0:t.length)?(0,l.jsx)(nF.i,{autoHeight:!1,ref:n,slots:{columnHeaders:function(){return null}},rowHeight:120,columns:f,rows:t,meta:o,refetch:r,loading:a,containerHeight:"calc(100% - 120px)"}):(0,l.jsx)(nb.C,{imageSrc:"/static/icons/no_locations_found.svg",title:"No scheduled item",subtitleFirstLine:"Selected month <".concat(m.label,"> has no items with jobs"),subtitleSecondLine:"Please select another and try again if necessary."})]})}),a2=function(e){var n=e.initialFilters,t=e.hideFilters,o=e.locationId,r=e.onViewChange,a=(0,H.Z)("(max-width: 600px)"),d=(0,eo.x)().user,c=(0,oF.a)(),p=(0,f.Z)((0,oW.X)("scheduledjob_calendar_".concat(n.filterType),n,"network"),2),m=p[0],h=p[1],v=(0,s.useState)({}),x=v[0],g=v[1],b=(0,s.useState)([]),Z=b[0],w=b[1],C=(0,s.useState)(!1),_=C[0],D=C[1],q=(0,nA.x)({filters:x}),P=q.initialData,O=q.ref,T=y()(x.year),M=(0,s.useMemo)(function(){return aX((0,i.Z)({},x),d.accountType)},[x,d.accountType]),F=(0,j.a)(e4,{variables:(0,i.Z)({},P,M)}),A=F.data,E=void 0===A?{jobSchedules:[],meta:{aggregate:{totalCount:0}}}:A,R=E.jobSchedules,N=E.meta,W=F.loading,J=F.refetch,L=(0,s.useCallback)(function(e){var n=e.id,t=(e.total,e.year),o=e.month,r=y()().year(t).month(o).startOf("month").toISOString(),a=y()().year(t).month(o).endOf("month").toISOString();c.show({content:(0,l.jsx)(nZ,{jobScheduleId:n,status:null,startDate:r,endDate:a,onClose:c.close}),title:"Works orders",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[c]),Y=(0,s.useMemo)(function(){return[{flex:1,minWidth:220,field:"id",headerName:"",sortable:!1,renderHeader:function(){return""},renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{justifyContent:"center",sx:{height:"100%"},children:[(0,l.jsx)(S.Z,{color:"secondary",fontWeight:600,children:n.serviceName}),(0,l.jsx)(S.Z,{fontWeight:600,mt:2,children:n.title}),(0,l.jsx)(et.O,{fontSize:"12px",maxLength:20,children:n.description})]})}}].concat((0,$.Z)(tB.map(function(e,n){var t=e.label,r=e.value;return{flex:1,minWidth:120,field:r,headerName:t,headerAlign:"center",sortable:!1,renderHeader:function(){return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(aq,{selected:y()().month()===n,children:t}),(0,l.jsx)(aA,{locationId:o,year:T.year(),month:t})]})},renderCell:function(e){var n=e.row;return(0,l.jsx)(ak,{year:T.year(),month:t,total:n[r].count,complete:n[r].completeCount,inComplete:n[r].inCompleteCount,followOn:n[r].followOnCount,inCompleteCompliance:n[r].inCompleteComplianceCount,onClick:function(){return L({id:n.id,total:n[r].count,year:T.year(),month:t})}})}}})),[{minWidth:120,field:"count",headerName:"Count",sortable:!1,renderHeader:function(){return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(aq,{children:"Count"}),(0,l.jsx)(aH,{locationId:o,year:T.year()})]})},renderCell:function(e){var n=e.row;return(0,l.jsx)(aM,{year:T.year(),total:n.totalCount.count,complete:n.totalCount.completeCount,inComplete:n.totalCount.inCompleteCount,followOn:n.totalCount.followOnCount,inCompleteCompliance:n.totalCount.inCompleteComplianceCount})}}])},[L,o,T]),B=(0,s.useMemo)(function(){return R.map(function(e){var n=aO({jobs:e.jobs,timePeriods:tB,year:T.year()}),t=n.countByPeriod,o=n.totalCount;return(0,i.Z)({id:e.id,serviceName:e.serviceName,title:e.title,description:e.description,totalCount:o},t)})},[R,T]),V=(0,s.useCallback)(function(e){h(function(n){var t=(0,i.Z)({},n);return delete t[e],t})},[h]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(aY,{locationId:o,open:_,close:function(){return D(!1)},filtersFormData:m,setFiltersFormData:h,hideFilters:t,setFilters:g,setFiltersChips:w}),(0,l.jsxs)(I.Z,{sx:{height:"calc(100vh + 100px)",width:"100%"},children:[(0,l.jsxs)(I.Z,{pl:2,pr:2,mb:1,mt:1,sx:{display:"grid",alignItems:"flex-start",height:"auto",gridTemplateAreas:a?'"filter-btn table-btn"\n                  "filter-chip filter-chip"':'"filter-btn filter-chip table-btn"',gridTemplateColumns:a?"auto auto":"96px auto 96px",columnGap:a?0:2,rowGap:a?2:0},children:[(0,l.jsx)(I.Z,{sx:{gridArea:"filter-btn"},children:(0,l.jsx)(k.Z,{variant:"contained",startIcon:(0,l.jsx)(r0.Z,{}),onClick:function(){return D(!0)},children:"Filters"})}),(0,l.jsx)(I.Z,{sx:{gridArea:"filter-chip",overflow:"hidden"},children:(0,l.jsx)(oz,{filtersChips:Z,onRemove:V})}),(0,l.jsx)(I.Z,{sx:{gridArea:"table-btn",justifySelf:"flex-end"},children:(0,l.jsx)(k.Z,{variant:"contained",color:"info",startIcon:(0,l.jsx)(aN.Z,{}),onClick:function(e){return r("table")},children:"Table"})})]}),a?(0,l.jsx)(a1,{ref:O,meta:N,loading:W,refetch:J,locationId:o,yearDate:T,rows:B}):(0,l.jsx)(a5,{disableSelectionOnClick:!0,autoHeight:!1,ref:O,rows:B,columns:Y,loading:W,meta:N,refetch:J,rowHeight:140,containerHeight:"calc(100% - 140px)"})]})]})};a2.defaultProps={initialFilters:{},onViewChange:function(){}},a2.propTypes={initialFilters:g().object,onViewChange:g().func};var a5=(0,c.ZP)(nF.i)(function(e){var n;return e.theme,n={},(0,oN.Z)(n,"& .MuiDataGrid-columnHeaders",{border:"none"}),(0,oN.Z)(n,"& .MuiDataGrid-columnHeader",{padding:"0px"}),(0,oN.Z)(n,"& .MuiDataGrid-cell--withRenderer",{justifyContent:"center"}),(0,oN.Z)(n,'& .MuiDataGrid-cell--withRenderer[aria-colindex="1"]',{justifyContent:"flex-start"}),(0,oN.Z)(n,"& .MuiDataGrid-columnHeaderTitleContainer",{width:"100%",justifyContent:"center"}),(0,oN.Z)(n,"& .MuiDataGrid-row:hover, .MuiDataGrid-row.Mui-hovered",{backgroundColor:"unset"}),n}),a3=function(e){var n=e.calendarInitialFilters,t=e.hideCalendarFilters,o=e.tableInitialFilters,r=e.hideTableFilters,a=e.locationId,i=(0,V.useRouter)(),d=(0,H.Z)("(max-width: 600px)"),c=(0,s.useState)(i.query.scheduledTab||"calendar"),p=c[0],m=c[1];(0,s.useEffect)(function(){var e=i.query;delete e.scheduledTab,e.scheduledTab=p,G().push({pathname:i.pathname,query:e,shallow:!0})},[p]);var h=function(e){m(e)};return(0,l.jsxs)(u.Z,{children:["table"===p&&(0,l.jsx)(aa,{initialFilters:o,hideFilters:r,locationId:a,onViewChange:h,containerHeight:d?"calc(100vh - 100px)":void 0,tableHeight:d?"calc(100% - 160px)":void 0}),"calendar"===p&&(0,l.jsx)(a2,{initialFilters:n,hideFilters:t,locationId:a,onViewChange:h})]})};a3.propTypes={calendarInitialFilters:g().object,hideCalendarFilters:g().array,locationId:g().string};var a6,a4=t(72852),a9=t(63441),a7=t(78840),a8=t.n(a7),ie=t(75708),it=t.n(ie),io=t(40656),ir=function(e){var n=e.items,t=e.dates,o=e.type,r=e.color;return t.map(function(e){var t=n.filter(function(n){return y()(n.month).format("MM.YYYY")===e}).reduce(function(e,n){return e+n[o]},0),a=y()(e,"MM.YYYY").isAfter(y()());return{name:e,y:t,color:a?io.Q.COLOUR.muiGray:r}})},ia=function(e){var n=e.locationId;t(18393)(a8());var o=(0,eo.x)(),r=o.user,a=(0,o.hasRole)("customer")?r.accountId:null,i=(0,s.useMemo)(function(){return y()().startOf("year")},[]),u=(0,s.useMemo)(function(){return y()().endOf("year")},[]),d=(0,j.a)(na,{variables:{locationId:n,customerId:a,startDate:i,endDate:u}}).data,c=(void 0===d?{items:[]}:d).items,p=(0,s.useMemo)(function(){return Array(12).fill("").map(function(e,n){return y()().startOf("year").add(n,"month").format("MM.YYYY")})},[]),m=(0,s.useMemo)(function(){return ir({dates:p,items:c,type:"totalPaid",color:io.Q.COLOUR.success})},[p,c]),h=(0,s.useMemo)(function(){return ir({dates:p,items:c,type:"totalUnpaid",color:io.Q.COLOUR.danger})},[p,c]),v=(0,s.useMemo)(function(){return ir({dates:p,items:c,type:"totalPartial",color:io.Q.COLOUR.pink})},[p,c]);return(0,l.jsx)(it(),{callback:function(e){e.reflow()},constructorType:"chart",Highcharts:a8(),options:{chart:{type:"column"},title:{text:null},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1}}},series:[{name:"Paid",color:io.Q.COLOUR.success,data:m},{name:"Partially paid",color:io.Q.COLOUR.pink,data:v},{name:"Unpaid",color:io.Q.COLOUR.danger,data:h}],xAxis:{title:null,categories:p},yAxis:{title:null,formatter:function(){return"\xa3".concat(this.value)}}}})},ii=t(13777),il=(a6=(0,nq.Z)(function(e){var n;return(0,nP.__generator)(this,function(t){switch(t.label){case 0:return(0,rn.a)()||(n=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws-pre-prod.cleverly.works","/pdf/invoice/ppmNew/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){var t,o,r;null==n||null===(t=n.location)||void 0===t||t.assign("".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)),(null==window?void 0:null===(o=window.Capacitor)||void 0===o?void 0:null===(r=o.Plugins)||void 0===r?void 0:r.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)})}).catch(function(e){(0,ii.Tb)({message:e,section:"fetch"})})];case 1:return t.sent(),[2]}})}),function(e){return a6.apply(this,arguments)}),is=function(e){var n=e.status;return(0,l.jsx)(oQ.Z,{color:{paid:"success",unpaid:"danger",partial:"pink"}[n],label:{paid:"Paid",unpaid:"Unpaid",partial:"Partially paid"}[n],sx:{borderRadius:2,height:"26px",width:"fit-content"}})};is.propTypes={status:g().oneOf(["paid","unpaid","partial"])};var iu={squaredIconButton:{backgroundColor:"#1E88E5",color:"#ffffff",borderRadius:"5px",height:"30px","&:hover":{opacity:.8,backgroundColor:"#1E88E5"}},statusBox:{width:"fit-content",padding:"2px 10px",borderRadius:"5px",color:"#fff"}},id=function(e){var n=e.locationId,t=e.locationName,o=(0,H.Z)("(max-width:600px)"),r=(0,nA.x)({filters:{locationId:n}}),a=r.initialData,d=r.ref,c=(0,j.a)(e9,{variables:(0,i.Z)({},a)}),p=c.data,m=void 0===p?{invoices:[]}:p,h=m.invoices,v=m.meta,f=c.loading,x=c.refetch,g=(0,s.useMemo)(function(){return[{minWidth:130,field:"invoiceNumber",headerName:"Invoice number",valueFormatter:function(e){var n=e.value;return"PM ".concat(n)},flex:1,sortable:!1},{minWidth:130,flex:1,field:"createdAt",headerName:"Date invoiced",valueFormatter:function(e){var n=e.value;return y()(n).format("YYYY-MM-DD")},sortable:!1},{minWidth:130,flex:1,field:"debit",headerName:"Invoice total",valueFormatter:function(e){var n=e.value;return n>=0?(0,oU.T)(n):"N/A"},sortable:!1},{minWidth:100,flex:1,field:"status",headerName:"Status",renderCell:function(e){var n=e.row;return(0,l.jsx)(is,{status:n.status})},sortable:!1},{minWidth:100,flex:1,field:"outstandingAmount",headerName:"Amount outstanding",valueFormatter:function(e){var n=e.value;return n>=0?(0,oU.T)(n):"N/A"},sortable:!1},{minWidth:100,flex:1,field:"outstandingdays",headerName:"Days outstanding",valueFormatter:function(e){var n=e.value;return null!=n?n:"N/A"},sortable:!1},{minWidth:100,flex:1,field:"actions",headerName:"Actions",renderCell:function(e){var n,t=e.row;return(0,l.jsx)(u.Z,{direction:"row",children:(0,l.jsx)(_.Z,{sx:iu.squaredIconButton,onClick:function(){il(t.meta)},children:(0,l.jsx)(a9.Z,{})})})},sortable:!1}]},[]),b=(0,s.useMemo)(function(){return h.map(function(e){return{id:e.id,invoiceNumber:e.invoiceNumber,createdAt:e.createdAt,debit:e.debit,status:e.paymentStatus,outstandingAmount:e.outstandingAmount,outstandingdays:e.outstandingdays,meta:e.meta}})},[h]);return(0,l.jsxs)(u.Z,{children:[(0,l.jsxs)(J.ZP,{container:!0,alignItems:"center",sx:{height:"50%"},children:[(0,l.jsx)(J.ZP,{item:!0,xs:12,md:7,sx:{padding:"0px 16px"},children:(0,l.jsx)(o4,{columns:g,rows:b,loading:f,ref:d,meta:v,refetch:x,autoHeight:!1,containerHeight:"450px"})}),(0,l.jsx)(J.ZP,{item:!0,xs:12,md:5,sx:{padding:"0px 16px"},children:(0,l.jsx)(ia,{locationId:n})})]}),(0,l.jsx)(I.Z,{sx:{padding:"0px 16px",mt:2},children:(0,l.jsx)(ro,{locationId:n,locationName:t,columnVisibilityModel:{workOrders:!1,actions:!1},hasHeader:!1,initialFilters:{locationId:n,filterType:"customer_fin_".concat(location.id)},hideFilters:["location"],containerHeight:o?"calc(100vh - 40px)":void 0,tableHeight:o?"calc(100% - 60px)":void 0})})]})};id.propTypes={locationId:g().string,locationName:g().string};var ic=function(e){var n=e.items,t=e.dates,o=e.type,r=e.color;return t.map(function(e){var t=n.filter(function(n){return y()(n.month).format("MM.YYYY")===e}).reduce(function(e,n){return e+n[o]},0),a=y()(e,"MM.YYYY").isAfter(y()());return{name:e,y:t,color:a?io.Q.COLOUR.muiGray:r}})},ip=function(e){var n=e.locationId;t(18393)(a8());var o=(0,eo.x)(),r=o.user,a=(0,o.hasRole)("supplier")?r.accountId:null,i=(0,s.useMemo)(function(){return y()().startOf("year")},[]),u=(0,s.useMemo)(function(){return y()().endOf("year")},[]),d=(0,j.a)(nr,{variables:{locationId:n,supplierId:a,startDate:i,endDate:u}}).data,c=(void 0===d?{items:[]}:d).items,p=(0,s.useMemo)(function(){return Array(12).fill("").map(function(e,n){return y()().startOf("year").add(n,"month").format("MM.YYYY")})},[]),m=(0,s.useMemo)(function(){return ic({dates:p,items:c,type:"totalPaid",color:io.Q.COLOUR.success})},[p,c]),h=(0,s.useMemo)(function(){return ic({dates:p,items:c,type:"totalUnpaid",color:io.Q.COLOUR.danger})},[p,c]),v=(0,s.useMemo)(function(){return ic({dates:p,items:c,type:"totalPartial",color:io.Q.COLOUR.pink})},[p,c]);return(0,l.jsx)(it(),{callback:function(e){e.reflow()},constructorType:"chart",Highcharts:a8(),options:{chart:{type:"column"},title:{text:null},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1}}},series:[{name:"Paid",color:io.Q.COLOUR.success,data:m},{name:"Partially paid",color:io.Q.COLOUR.pink,data:v},{name:"Unpaid",color:io.Q.COLOUR.danger,data:h}],xAxis:{title:null,categories:p},yAxis:{title:null,formatter:function(){return"\xa3".concat(this.value)}}}})},im=t(94054),ih=t(40476),iv=t(97432),ix=function(e){var n=e.id,t=e.description,o=e.quantity,r=e.rate,a=e.vatType,i=e.vatPercentage,d=e.onSubmit,c=(0,o0.l)(),p=(0,nO.cI)({defaultValues:{description:t,quantity:o,rate:r,vatType:void 0===a?"default":a,vatPercentage:i},resolver:(0,nT.S)(n$)}),m=p.control,h=p.errors,v=p.watch,f=p.handleSubmit,x=v("vatType"),g=v("quantity"),b=v("rate"),y=v("vatPercentage"),j=g*b||0,Z=j*(y/100)||0,w=j+Z||0,C=function(e){var t={id:n,description:e.description,quantity:e.quantity,rate:(0,iv.l)(e.rate,2),net:(0,iv.l)(j,2),vatPercentage:e.vatPercentage,vatType:e.vatType,vat:(0,iv.l)(Z,2),gross:(0,iv.l)(w,2)};d(t),c.current.toggleDetailPanel(n)},I=(0,s.useCallback)(function(e){e.stopPropagation(),c.current.toggleDetailPanel(n)},[c,n]);return(0,l.jsx)("form",{children:(0,l.jsxs)(u.Z,{width:"100%",spacing:2,p:1,sx:{backgroundColor:"muiLight.main"},children:[(0,l.jsx)(nO.Qr,{name:"description",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,l.jsx)(nC.Z,{minRows:3,multiline:!0,fullWidth:!0,variant:"filled",color:"secondary",label:"Description",value:t,onChange:o,error:h.description,helperText:null===(n=h.description)||void 0===n?void 0:n.message})}}),(0,l.jsxs)(u.Z,{width:"100%",direction:"row",justifyContent:"space-between",spacing:2,children:[(0,l.jsxs)(u.Z,{width:"100%",children:[(0,l.jsx)(S.Z,{children:"Rate"}),(0,l.jsx)(nO.Qr,{name:"rate",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,l.jsx)(rd.I,{leftLabel:(0,l.jsx)(rc.Z,{sx:{height:"18px"}}),rightLabel:"Ex Vat",sx:{width:"100%"},type:"number",InputProps:{inputProps:{min:0}},value:t,onChange:o,error:h.rate,helperText:null===(n=h.rate)||void 0===n?void 0:n.message})}})]}),(0,l.jsxs)(u.Z,{width:"100%",children:[(0,l.jsx)(S.Z,{children:"Quantity"}),(0,l.jsx)(nO.Qr,{name:"quantity",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,l.jsx)(rd.I,{sx:{width:"100%"},type:"number",InputProps:{inputProps:{min:0,step:"1"}},value:t,onChange:o,error:h.quantity,helperText:null===(n=h.quantity)||void 0===n?void 0:n.message})}})]})]}),(0,l.jsx)(u.Z,{width:"100%",children:(0,l.jsx)(nO.Qr,{name:"vatType",control:m,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsxs)(im.Z,{color:"secondary",children:[(0,l.jsx)(ih.Z,{children:"VAT %"}),(0,l.jsxs)(tW.Z,{row:!0,value:n,onChange:function(e,n){return t(n)},color:"secondary",children:[(0,l.jsx)(nH.Z,{value:"default",control:(0,l.jsx)(nQ.Z,{color:"secondary"}),label:"Default (".concat(i,"%)")}),(0,l.jsx)(nH.Z,{value:"custom",control:(0,l.jsx)(nQ.Z,{color:"secondary"}),label:"Custom"})]})]})}})}),(0,l.jsx)(u.Z,{width:"100%",children:(0,l.jsx)(nO.Qr,{name:"vatPercentage",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,l.jsx)(nC.Z,{fullWidth:!0,type:"number",variant:"standard",color:"secondary",label:"Custom VAT %",value:t,onChange:o,error:h.vatAmount,helperText:null===(n=h.vatAmount)||void 0===n?void 0:n.message,sx:{display:"custom"===x?"block":"none"}})}})}),(0,l.jsxs)(u.Z,{width:"100%",children:[(0,l.jsxs)(S.Z,{children:["Net: ",(0,oU.T)(j)]}),(0,l.jsxs)(S.Z,{children:["VAT: ",(0,oU.T)(Z)]}),(0,l.jsxs)(S.Z,{children:["Gross: ",(0,oU.T)(w)]})]}),(0,l.jsxs)(u.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,l.jsx)(k.Z,{color:"danger",variant:"contained",size:"small",onClick:I,children:"Cancel"}),(0,l.jsx)(k.Z,{color:"secondary",variant:"contained",size:"small",type:"submit",onClick:f(C),children:"Save"})]})]})})};ix.propTypes={id:g().number,description:g().string,quantity:g().number,rate:g().number,vatType:g().oneOf(["default","custom"]),vatPercentage:g().number,onSubmit:g().func};var ig=t(83395),ib=t(85412),iy=t(25934),ij=function(e){var n=e.values,t=e.setValues,o=e.name,r=e.vatId,a=(0,s.useState)([]),d=a[0],c=a[1],p=(0,s.useCallback)(function(){var e=(0,ig.b)(r),n=(0,iy.Z)();t(function(t){return(0,$.Z)(t).concat([{id:n,description:"",quantity:0,rate:0,net:0,vatPercentage:e?20:0,vatType:"default",vat:0,gross:0}])}),c(function(e){return(0,$.Z)(e).concat([n])})},[t,r]),m=(0,s.useCallback)(function(e){t(function(n){return n.filter(function(n){return n.id!==e})})},[t]),h=(0,s.useCallback)(function(e){t(function(n){return n.map(function(n){return n.id===e.id?(0,i.Z)({},e):n})})},[t]),v=(0,s.useCallback)(function(e){c((0,$.Z)(e))},[]),f=(0,s.useMemo)(function(){return[{field:"description",headerName:"Description",minWidth:120,sortable:!1,flex:1},{field:"quantity",headerName:"Qty",sortable:!1,flex:1},{field:"rate",headerName:"Rate",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,oU.T)(n)}},{field:"net",headerName:"Net",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,oU.T)(n)}},{field:"vatPercentage",headerName:"Vat %",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return"".concat(n,"%")}},{field:"vat",headerName:"Vat",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,oU.T)(n)}},{field:"gross",headerName:"Gross",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,oU.T)(n)}},{field:oX.u,headerName:"",sortable:!1,width:40,minWidth:40,renderCell:function(){return(0,l.jsx)(_.Z,{children:(0,l.jsx)(ru.Z,{})})}},{field:"delete",headerName:"",sortable:!1,width:40,minWidth:40,renderCell:function(e){var n=e.id;return(0,l.jsx)(_.Z,{onClick:function(){return m(n)},children:(0,l.jsx)(ib.Z,{})})}}]},[m]),x=n.reduce(function(e,n){return e+n.gross},0);return(0,l.jsxs)(u.Z,{width:"100%",children:[(0,l.jsxs)(u.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,l.jsx)(S.Z,{fontSize:22,sx:{opacity:.46},children:o}),(0,l.jsxs)(k.Z,{color:"secondary",variant:"contained",onClick:p,children:["Insert ",o.toLowerCase()," item"]})]}),(0,l.jsx)(nF.i,{columns:f,rows:n,loading:!1,detailPanelExpandedRowIds:d,onDetailPanelExpandedRowIdsChange:v,getDetailPanelHeight:function(){return"auto"},getDetailPanelContent:function(e){var n=e.row;return(0,l.jsx)(ix,{id:n.id,description:n.description,quantity:n.quantity,rate:n.rate,vatType:n.vatType,vatPercentage:n.vatPercentage,onSubmit:h})}}),(0,l.jsx)(u.Z,{width:"100%",alignItems:"flex-end",children:(0,l.jsxs)(S.Z,{children:["Subtotal - ",o.toLowerCase(),": ",(0,oU.T)(x)]})})]})};ij.defaultProps={values:[],setValues:function(){}},ij.propTypes={values:g().array,setValues:g().func,name:g().string,vatId:g().string};var iZ=function(e){var n=e.jobScheduleId,t=(0,s.useState)(""),o=t[0],r=t[1],a=(0,f.Z)((0,Z.t)(ns.by,{variables:{where:{type:{_eq:"supplier"},status:{_eq:"active"},name:{_ilike:""!==o?"%".concat(o,"%"):null},_or:[{SupplierJobs:{status:{_neq:"canceled"},jobScheduleId:{_eq:n}}},{SupplierOffers:{status:{_eq:"offered"},Job:{status:{_neq:"canceled"},jobScheduleId:{_eq:n}}}}]},limit:50,offset:0}}),2),i=a[0],l=a[1],u=l.loading,d=l.data;return{supplierProps:{onOpen:i,loading:u,options:(void 0===d?{items:[]}:d).items,setSearch:r}}},iw=t(13262),iC=t(60185),iI=function(e){var n=parseInt(e.adminDueDate)||30,t=new Date().getTime()+864e5*n;return new Date(t)},iS=function(e){var n,t,o=e.id,r=e.edit,a=e.supplierId,d=e.supplierName,c=e.locationId,p=e.jobScheduleId,m=e.vatId,h=e.close,x=(0,nJ.D)(),g=(0,rX.q)().admin,b=(0,eo.x)(),y=b.user,Z=b.hasRole,C=(0,iC.z)("AccountEntry",y.adminId,y.id),I=C.createMediaInput,_=C.loadingAddMedia,P=null==g?void 0:null===(n=g.meta)||void 0===n?void 0:null===(t=n.finance)||void 0===t?void 0:t.invoiceDueDate,O=Z("supplier"),T=(0,s.useState)([]),M=T[0],F=T[1],A=(0,s.useState)([]),E=A[0],R=A[1],N=(0,nO.cI)({defaultValues:(0,v.Z)((0,i.Z)({},i_),{dueDate:iI({adminDueDate:P}),supplier:{value:a,label:d}}),resolver:(0,nT.S)(nW),context:{isSupplier:O}}),W=N.control,$=N.errors,J=N.register,L=N.setValue,Y=N.watch,B=N.reset,H=N.handleSubmit,V=Y("attachments"),G=(0,j.a)(nn,{skip:!r,variables:{id:o},onCompleted:function(e){var n=e.invoice,t=n.items,o=n.dueDate,r=n.meta,a=n.account,i=t.filter(function(e){return"Labour"===e.type}),l=t.filter(function(e){return"Materials"===e.type});F(i),R(l),B({supplier:{value:a.id,label:a.name},dueDate:o,reference:null==r?void 0:r.reference,description:null==r?void 0:r.description})}}).loading,Q=(0,f.Z)((0,w.D)(nt,{refetchQueries:["GetJobSchedules","GetSupplierPpmInvoices","SupplierInvoiceTotalByMonth"],onCompleted:function(){x.show({content:"Supplier invoice saved",color:"success"}),h()},onError:function(e){x.show({content:"Error: ".concat(e.message),color:"error"})}}),2),z=Q[0],U=Q[1].loading,K=iZ({jobScheduleId:p}).supplierProps,X=(0,s.useCallback)(function(e){var n;return n=(0,nq.Z)(function(n){var t,o,r,a,i,l;return(0,nP.__generator)(this,function(a){switch(a.label){case 0:if(0===M.length&&0===E.length)return[2,x.show({content:"Please add at least one item",color:"error"})];if(!(M.reduce(function(e,n){return e+n.quantity*n.rate},0)+E.reduce(function(e,n){return e+n.quantity*n.rate},0)>0))return[2,x.show({content:"Gross should be greater than 0",color:"error"})];return[4,I(n.attachments)];case 1:return i=a.sent(),l={labours:M,materials:E,supplierId:null===(t=n.supplier)||void 0===t?void 0:t.value,locationId:c,jobScheduleId:p,dueDate:n.dueDate,reference:n.reference,description:n.description,submit:e,attachments:null==i?void 0:null===(o=i.Media_Entity)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.map(function(e){return{caption:e.Medium.data.caption,extension:e.Medium.data.extension,filename:e.Medium.data.filename,type:e.Medium.data.type,meta:e.Medium.data.meta}})},z({variables:{data:l}}),[2]}})}),function(e){return n.apply(this,arguments)}},[I,p,M,c,E,x,z]),ee=(0,s.useCallback)(function(e){return function(n){if(0===M.length&&0===E.length)return x.show({content:"Please add at least one item",color:"error"});if(!(M.reduce(function(e,n){return e+n.quantity*n.rate},0)+E.reduce(function(e,n){return e+n.quantity*n.rate},0)>0))return x.show({content:"Gross should be greater than 0",color:"error"});var t,r={id:o,labours:M,materials:E,supplierId:null===(t=n.supplier)||void 0===t?void 0:t.value,locationId:c,jobScheduleId:p,dueDate:n.dueDate,reference:n.reference,description:n.description,submit:e};z({variables:{data:r}})}},[o,p,M,c,E,x,z]),en=M.reduce(function(e,n){return e+n.net},0)+E.reduce(function(e,n){return e+n.net},0),et=M.reduce(function(e,n){return e+n.vat},0)+E.reduce(function(e,n){return e+n.vat},0),er=M.reduce(function(e,n){return e+n.gross},0)+E.reduce(function(e,n){return e+n.gross},0);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(D.Z,{open:G||U||_,sx:{zIndex:1e4},children:(0,l.jsx)(q.Z,{color:"secondary"})}),(0,l.jsx)("form",{children:(0,l.jsxs)(u.Z,{width:"100%",spacing:4,children:[(0,l.jsx)(ij,{values:M,setValues:F,name:"Labour",vatId:m}),(0,l.jsx)(ij,{values:E,setValues:R,name:"Materials",vatId:m}),(0,l.jsxs)(u.Z,{width:"100%",alignItems:"flex-end",children:[(0,l.jsxs)(S.Z,{children:["Net Total: ",(0,oU.T)(en)]}),(0,l.jsxs)(S.Z,{children:["VAT Total: ",(0,oU.T)(et)]}),(0,l.jsxs)(S.Z,{children:["Gross Total: ",(0,oU.T)(er)]})]}),r?(0,l.jsx)(u.Z,{width:"100%",children:(0,l.jsx)(oA.G,{carousel:!1,elevation:0,accordionSx:{"& .MuiAccordionSummary-root":{paddingLeft:0,"& .MuiTypography-root":{fontSize:22,opacity:.46}}},expanded:!0,hideExpandIcon:!0,entityId:o,entity:"AccountEntry",columnVisibilityModel:{name:!1},mediaFormProps:{showSubmitButton:!0},offCanvasProps:{submit:!1}})}):(0,l.jsxs)(u.Z,{width:"100%",children:[(0,l.jsx)(iw.f,{title:"Media",name:"attachments",titleSx:{fontSize:22,opacity:.46},values:V,setValue:L}),(0,l.jsx)("input",(0,v.Z)((0,i.Z)({},J("attachments")),{type:"hidden"}))]}),(0,l.jsxs)(u.Z,{width:"100%",spacing:2,children:[!O&&(0,l.jsx)(nO.Qr,{name:"supplier",control:W,render:function(e){var n,t=e.value,o=e.onChange;return(0,l.jsx)(ed.q,(0,v.Z)((0,i.Z)({},K),{value:t,onChange:function(e,n){return o(n)},textFieldProps:{label:"Supplier",fullWidth:!0,color:"secondary",variant:"standard"},sx:{width:"300px"},error:$.supplier,helperText:null===(n=$.supplier)||void 0===n?void 0:n.message}))}}),!O&&(0,l.jsx)(nO.Qr,{name:"dueDate",control:W,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(nz.M,{inputFormat:"Do MMM YYYY",value:n,onChange:t,label:"Due Date",renderInput:function(e){var n;return(0,l.jsx)(nC.Z,(0,v.Z)((0,i.Z)({},e),{sx:{width:"300px"},color:"secondary",variant:"standard",error:$.dueDate,helperText:null===(n=$.dueDate)||void 0===n?void 0:n.message}))}})}}),(0,l.jsx)(nO.Qr,{name:"reference",control:W,render:function(e){var n,t=e.value,o=e.onChange;return(0,l.jsx)(nC.Z,{color:"secondary",variant:"standard",label:"Reference",value:t,onChange:o,error:$.reference,helperText:null===(n=$.reference)||void 0===n?void 0:n.message})}}),(0,l.jsx)(nO.Qr,{name:"description",control:W,render:function(e){var n,t=e.value,o=e.onChange;return(0,l.jsx)(nC.Z,{multiline:!0,minRows:3,color:"secondary",variant:"filled",label:"Description",value:t,onChange:o,error:$.description,helperText:null===(n=$.description)||void 0===n?void 0:n.message})}})]}),(0,l.jsxs)(u.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,l.jsx)(k.Z,{variant:"contained",color:"info",type:"submit",onClick:H(r?ee(!1):X(!1)),children:"Save"}),!O&&(0,l.jsx)(k.Z,{variant:"contained",color:"success",type:"submit",onClick:H(r?ee(!0):X(!0)),children:"Generate Invoice"})]})]})})]})};iS.propTypes={id:g().string,edit:g().bool,supplierId:g().string,supplierName:g().string,locationId:g().string,vatId:g().string,close:g().func},iS.defaultProps={};var i_={supplier:null,dueDate:new Date,description:"",reference:""},ik=t(66252),iD=t(84193),iq=t(2173),iP=function(e){var n=e.jobScheduleId,t=e.supplierId,o=e.locationId,r=(0,oF.a)(),a=(0,ik.x)(),i=(0,nA.x)({filters:{jobScheduleId:n,locationId:o}}),d=i.initialData,c=i.ref,p=(0,j.a)(e8,{variables:{supplierId:t}}),m=p.data,h=(void 0===m?{supplier:{}}:m).supplier,v=p.loading,f=(0,j.a)(ne,{variables:d}),x=f.data,g=void 0===x?{invoices:[],meta:{aggregate:{totalCount:0}}}:x,b=g.invoices,Z=g.meta,w=f.loading,C=f.refetch,I=(0,s.useCallback)(function(e){e.stopPropagation(),r.show({content:(0,l.jsx)(iS,{supplierId:h.id,supplierName:h.name,locationId:o,jobScheduleId:n,vatId:h.vatId,close:r.close}),submit:!1,title:"Add supplier invoice",xs3:"100vw",sm:"100vw",sm2:"85vw",sm3:"70vw",md2:"70vw",lg:"65vw",lg2:"65vw"})},[n,o,r,h.id,h.name,h.vatId]),S=(0,s.useCallback)(function(e){r.show({content:(0,l.jsx)(iS,{edit:!0,id:e,supplierId:h.id,supplierName:h.name,locationId:o,jobScheduleId:n,vatId:h.vatId,close:r.close}),submit:!1,title:"Edit supplier invoice",xs3:"100vw",sm:"100vw",sm2:"85vw",sm3:"70vw",md2:"70vw",lg:"65vw",lg2:"65vw"})},[n,o,r,h.id,h.name,h.vatId]),_=(0,s.useCallback)(function(e){(0,iq.W)({client:a,accountEntryId:e})},[a]),D=(0,s.useMemo)(function(){return[{field:"invoiceNumber",headerName:"Invoice number",sortable:!1,flex:1,valueFormatter:function(e){return e.value||"Draft"}},{field:"dateInvoiced",headerName:"Date invoiced",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.dateInvoiced?y()(n.dateInvoiced).format("YYYY-MM-DD"):"N/A"}},{field:"invoiceTotal",headerName:"Invoice Total",sortable:!1,flex:1},{field:"status",headerName:"Status",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?(0,l.jsx)(is,{status:n.status}):"N/A"}},{field:"amountOutstanding",headerName:"Amount outstanding",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?n.amountOutstanding:"N/A"}},{field:"daysOutstanding",headerName:"Days outstanding",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?n.daysOutstanding:"N/A"}},{field:"actions",headerName:"Actions",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?(0,l.jsx)(k.Z,{disableMinWidth:!0,color:"secondary",variant:"contained",size:"small",sx:{width:"fit-content"},onClick:function(e){e.stopPropagation(),_(n.id)},children:(0,l.jsx)(iD.Z,{})}):(0,l.jsx)(k.Z,{disableMinWidth:!0,color:"info",variant:"contained",size:"small",onClick:function(e){e.stopPropagation(),S(n.id)},children:(0,l.jsx)(ru.Z,{})})}}]},[_,S]),q=(0,s.useMemo)(function(){return b.map(function(e){return{id:e.id,invoiceNumber:e.invoiceNumber,dateInvoiced:e.invoicedDate,invoiceTotal:(0,oU.T)(e.debit),status:e.paymentStatus,amountOutstanding:(0,oU.T)(e.outstandingAmount),daysOutstanding:e.outstandingdays}})},[b]);return(0,l.jsxs)(u.Z,{width:"100%",sx:{backgroundColor:"muiLight.main"},p:1,children:[(0,l.jsx)(o4,{ref:c,loading:w||v,columns:D,rows:q,meta:Z,refetch:C}),(0,l.jsx)(u.Z,{width:"100%",alignItems:"flex-end",mt:1,children:(0,l.jsx)(k.Z,{disabled:v||!(null==h?void 0:h.id),color:"secondary",variant:"contained",onClick:I,children:"Add supplier invoice"})})]})};iP.propTypes={jobScheduleId:g().number.isRequired,supplierId:g().number.isRequired,locationId:g().number.isRequired};var iO=t(52122),iT=function(e){var n=e.percentage,t=e.reverse,o=null;return t?n<100&&n>0?o="info":n>=100?o="danger":0===n&&(o="success"):n<100&&n>0?o="info":0===n?o="danger":n>=100&&(o="success"),(0,l.jsx)(I.Z,{sx:{borderRadius:"5px",padding:"2px 4px",backgroundColor:"".concat(o,".main"),color:"".concat(o,".contrastText")},children:(0,l.jsxs)(S.Z,{children:[n,"%"]})})};iT.propTypes={percentage:g().number.isRequired,reverse:g().bool};var iM=t(32320),iF={title:{color:"#323E4E"},subtitle:{color:"#323E4E",fontWeight:"300"},indicatorWrapper:{position:"relative"},jobsBadge:{display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"5px",minWidth:"50px"}},iA=function(e){var n=e.locationId,t=(0,(0,eo.x)().hasRole)("supplier"),o=(0,oF.a)(),r=(0,nA.x)({filters:{locationId:n}}),a=r.initialData,d=r.ref,c=(0,j.a)(no,{variables:a}),p=c.data,m=void 0===p?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:p,h=m.jobSchedule,f=m.meta,x=c.loading,g=c.refetch,b=(0,s.useCallback)(function(e){var n=e.jobScheduleId,r=e.jobStatuses,a=e.description;o.show({content:(0,l.jsx)(nZ,{jobScheduleId:n,status:r,startDate:null,endDate:null,onClose:o.close,hideFilters:t}),title:"Works orders (".concat(a,")"),xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[o,t]),Z=(0,s.useMemo)(function(){return[{field:"title",headerName:"Job",minWidth:250,renderCell:function(e){var n,t=e.row,o=oJ(t.scheduleEnd,!oL(t.jobs),!!(null===(n=t.jobs)||void 0===n?void 0:n.length));return(0,l.jsxs)(I.Z,{sx:iF.indicatorWrapper,children:[(0,l.jsx)(oY,{height:110,backgroundColor:o}),(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",children:[t.compliance&&(0,l.jsx)(I.Z,{ml:1,children:(0,l.jsx)(E.Z,{sx:{color:"info.main"}})}),(0,l.jsxs)(u.Z,{ml:2,children:[(0,l.jsx)(S.Z,{typography:"subtitle1",sx:(0,i.Z)({},iF.title),children:t.title}),(0,l.jsx)(et.O,{sx:(0,v.Z)((0,i.Z)({},iF.subtitle),{whiteSpace:"normal"}),fontSize:"12px",maxLength:20,children:t.description})]})]})]})},sortable:!1,flex:1},{headerName:"Service",field:"service",sortable:!1,width:250,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{children:[(0,l.jsx)(S.Z,{typography:"subtitle1",children:n.serviceName}),(0,l.jsx)(S.Z,{typography:"subtitle2",sx:(0,i.Z)({},iF.subtitle),children:"Assigned to:"}),(0,l.jsx)(W.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(n.supplierId),noWrap:!n.supplierId,children:n.supplierName||"No supplier assigned"})]})}},{field:"numberOfJobs",headerName:"Number of jobs",minWidth:130,sortable:!1,flex:1},{field:"lastJob",headerName:"Last job",minWidth:100,renderCell:function(e){var n=e.row;return n.lastJob?y()(n.lastJob).format("YYYY-MM-DD"):"-"},sortable:!1,flex:1},{field:"totalInvoiceDue",headerName:"Total invoice due",minWidth:100,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,l.jsx)(S.Z,{children:(0,oU.T)(n.totalInvoiceDue)}),(0,l.jsx)(nV.Z,{title:"Including VAT",children:(0,l.jsx)(or.Z,{color:"secondary"})})]})},sortable:!1,flex:1},{field:"totalInvoiceReceived",headerName:"Total invoice received",minWidth:130,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{direction:"row",spacing:1,children:[(0,l.jsx)(S.Z,{children:(0,oU.T)(n.totalInvoiceReceived)}),(0,l.jsx)(iT,{reverse:!0,percentage:n.totalInvoiceReceivedPercentage})]})},sortable:!1,flex:1},{field:"totalInvoicePaid",headerName:"Total invoice paid",minWidth:130,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{direction:"row",spacing:1,children:[(0,l.jsx)(S.Z,{children:(0,oU.T)(n.totalInvoicePaid)}),(0,l.jsx)(iT,{reverse:!0,percentage:n.totalInvoicePaidPercentage})]})},sortable:!1,flex:1},{field:"amountLeftToPay",headerName:"Amount left to pay",minWidth:130,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{direction:"row",spacing:1,children:[(0,l.jsx)(S.Z,{children:(0,oU.T)(n.amountLeftToPay)}),(0,l.jsx)(iT,{percentage:n.amountLeftToPayPercentage})]})},sortable:!1,flex:1},{field:"numberOfIncompleteJobs",headerName:"Number of incomplete jobs",minWidth:160,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{direction:"row",spacing:1,children:[(0,l.jsxs)(I.Z,{sx:(0,v.Z)((0,i.Z)({},iF.jobsBadge),{color:"info.contrastText",backgroundColor:"info.main"}),children:[n.numberOfIncompleteJobs," jobs"]}),(0,l.jsx)(k.Z,{disableMinWidth:!0,color:"info",variant:"contained",size:"small",onClick:function(){return b({jobScheduleId:n.id,jobStatuses:["raised","offered","accepted","inProgress","onHold","continued","paused"],description:n.title})},children:(0,l.jsx)(iO.Z,{})})]})},sortable:!1,flex:1},{field:"numberOfCompleteJobs",headerName:"Number of complete jobs",minWidth:160,renderCell:function(e){var n=e.row;return(0,l.jsxs)(u.Z,{direction:"row",spacing:1,children:[(0,l.jsxs)(I.Z,{sx:(0,v.Z)((0,i.Z)({},iF.jobsBadge),{color:"success.contrastText",backgroundColor:"success.main"}),children:[n.numberOfCompleteJobs," jobs"]}),(0,l.jsx)(k.Z,{disableMinWidth:!0,color:"success",variant:"contained",size:"small",onClick:function(){return b({jobScheduleId:n.id,jobStatuses:["completed","reportSent","invoiceSent","customerPaid","supplierPaid","closed"],description:n.title})},children:(0,l.jsx)(iO.Z,{})})]})},sortable:!1,flex:1},(0,v.Z)((0,i.Z)({},oX.a),{isGridTogglePanel:!0,renderCell:function(e){return(0,l.jsx)(iE,{id:e.id,value:e.value})}})]},[b]),w=(0,s.useMemo)(function(){return null==h?void 0:h.map(function(e){var n,t,o=null===(n=e.jobs)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.timingStart,r=0,a=e.jobs.length,i=e.jobs.filter(function(e){var n,t;return!(null===(n=e.statusData)||void 0===n?void 0:n.completed)&&!(null===(t=e.statusData)||void 0===t?void 0:t.closed)}).length;if("fixedMonthlyAmount"===e.invoiceBasis){var l=y()(e.finalInvoiceDate).endOf("month").add(1,"millisecond"),s=y()(e.firstInvoiceDate).startOf("month"),u=l.diff(s,"months");r=e.supplierMonthlyCharge*u}else"onCompletion"===e.invoiceBasis&&(r=e.jobs.reduce(function(e,n){return e+(n.supplierGross||0)},0));var d=(0,iM.lt)(r>0?e.invoicesReceived/r*100:0,0),c=(0,iM.lt)(r>0?e.invoicesPaid/r*100:0,0),p=(0,iM.lt)(r-e.invoicesPaid>0?(r-e.invoicesPaid)/r*100:0,0);return{id:e.id,compliance:e.meta.compliance,title:e.meta.shortDescriptionName,description:e.description,serviceName:e.meta.serviceName,supplierName:e.meta.supplierName,supplierId:e.meta.supplierId,jobs:e.jobs,numberOfJobs:a,lastJob:y()(o).format("YYYY-MM-DD"),totalInvoiceDue:r,totalInvoiceReceived:e.invoicesReceived,totalInvoiceReceivedPercentage:d,totalInvoicePaid:e.invoicesPaid,totalInvoicePaidPercentage:c,amountLeftToPay:r-e.invoicesPaid,amountLeftToPayPercentage:p,numberOfIncompleteJobs:i,numberOfCompleteJobs:a-i,scheduleStart:e.scheduleStart,scheduleEnd:e.scheduleEnd}})},[h]),C=function(e){var n;return(0,l.jsxs)(I.Z,{sx:iF.indicatorWrapper,children:[(0,l.jsx)(oY,{height:90,backgroundColor:oJ(e.scheduleEnd,!oL(e.jobs),!!(null===(n=e.jobs)||void 0===n?void 0:n.length))}),(0,l.jsx)(u.Z,{direction:"row",alignItems:"center",columnGap:2,sx:{fontWeight:"600",fontSize:"16px",marginLeft:"10px"},children:e.identifier})]})},_=function(e){return(0,l.jsx)(I.Z,{sx:iF.indicatorWrapper,children:(0,l.jsxs)(u.Z,{direction:"row",alignItems:"center",columnGap:2,children:[(0,l.jsx)(I.Z,{sx:{width:"24px",marginLeft:"8px"},children:e.compliance&&(0,l.jsx)(E.Z,{sx:{color:"info.main"}})}),(0,l.jsxs)(u.Z,{ml:.5,children:[(0,l.jsx)(S.Z,{fontWeight:500,children:e.title}),(0,l.jsx)(S.Z,{typography:"subtitle2",fontWeight:300,children:e.description})]})]})})};return(0,l.jsxs)(J.ZP,{container:!0,sx:{height:"100%"},children:[(0,l.jsx)(J.ZP,{item:!0,xs:12,md:6,lg:6,children:(0,l.jsx)(ip,{locationId:n})}),(0,l.jsx)(J.ZP,{xs:12,p:2,children:(0,l.jsx)(o4,{columns:Z,renderIdentifierCell:C,renderValueCell:_,getDetailPanelHeight:function(){return"auto"},getDetailPanelContent:function(e){var t=e.row;return(0,l.jsx)(iP,{jobScheduleId:t.id,supplierId:t.supplierId,supplierName:t.supplierName,locationId:n})},rows:w,loading:x,ref:d,meta:f,refetch:g,autoHeight:!1,containerHeight:"calc(100vh - 120px)",rowHeight:120})})]})},iE=function(e){var n=e.id,t=e.value,o=(0,o0.l)(),r=(0,o1.P)(o,o2.Z3),a=s.isValidElement(r[n]);return(0,l.jsx)(_.Z,{size:"small",tabIndex:-1,disabled:!a,"aria-label":t?"Close":"Open",children:(0,l.jsx)(oK.Z,{sx:function(e){return{transform:"rotateZ(".concat(t?180:0,"deg)"),transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})}},fontSize:"inherit"})})},iR=function(e){var n=e.isSupplier,t=e.isCustomer,o=e.financeTab;return n?"supplier":t?"customer":o||"customer"},iN=function(e){var n=e.locationId,t=e.locationName,o=(0,eo.x)().hasRole,r=o("supplier"),a=o("customer"),i=(0,V.useRouter)(),d=iR({isSupplier:r,isCustomer:a,financeTab:i.query.financeTab}),c=(0,s.useState)(d),p=c[0],m=c[1];(0,s.useEffect)(function(){var e=i.query;delete e.financeTab,e.financeTab=p,G().push({pathname:i.pathname,query:e,shallow:!0})},[p]);var h=function(e){return function(){m(e)}},v=(0,s.useMemo)(function(){switch(p){case"customer":return(0,l.jsx)(id,{locationId:n,locationName:t});case"supplier":return(0,l.jsx)(iA,{locationId:n})}},[p,n,t]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(u.Z,{direction:"row",columnGap:2,p:3,children:[!r&&(0,l.jsx)(nH.Z,{label:"Customer",control:(0,l.jsx)(a4.Z,{color:"secondary",checked:"customer"===p,onChange:h("customer")})}),!a&&(0,l.jsx)(nH.Z,{label:"Supplier",control:(0,l.jsx)(a4.Z,{color:"secondary",checked:"supplier"===p,onChange:h("supplier")})})]}),v]})};iN.propTypes={locationId:g().string.isRequired,locationName:g().string};var iW=function(e){var n=e.showLocationSelector,t=e.locationId,o=e.locationName,r=e.calendarInitialFilters,a=e.hideCalendarFilters,d=e.tableInitialFilters,c=e.hideTableFilters,p=e.itemsInitialFilters,v=e.hideItemsFilters,f=e.hideFinances,x=e.hideItems,g=(0,H.Z)("(max-width:600px)"),b=(0,V.useRouter)(),y=(0,s.useState)(b.query.viewTab||"schedules"),j=y[0],Z=y[1];(0,s.useEffect)(function(){var e=b.query;delete e.viewTab,e.viewTab=j,G().push({pathname:b.pathname,query:e,shallow:!0})},[j]);var w=function(e,n){Z(n)};return(0,l.jsxs)(u.Z,{children:[n&&(0,l.jsx)(h.c,{fullWidth:g,locationId:t,locationName:o}),(0,l.jsxs)(u.Z,{sx:(0,i.Z)({},n&&{paddingTop:"25px"}),children:[(0,l.jsx)(rG,{defaultExpanded:"info",locationId:t}),(0,l.jsxs)(iJ,{value:j,is600pxOrLess:g,children:[(0,l.jsxs)(i$,{value:j,onChange:w,"aria-label":"basic tabs example",textColor:"black.main",children:[(0,l.jsx)(m.Z,{label:"Schedules",value:"schedules"}),!x&&(0,l.jsx)(m.Z,{label:"Items",value:"items"})," ",t&&!f&&(0,l.jsx)(m.Z,{label:"Finances",value:"finances"})]}),(0,l.jsx)(rz.x,{value:j,index:"schedules",boxSx:{padding:"0px 0px 0px 0px"},children:(0,l.jsx)(a3,{locationId:t,calendarInitialFilters:r,hideCalendarFilters:a,tableInitialFilters:d,hideTableFilters:c})}),!x&&(0,l.jsx)(rz.x,{value:j,index:"items",boxSx:{padding:"0px 0px 0px 0px"},children:(0,l.jsx)(ro,{locationId:t,locationName:o,initialFilters:p,hideFilters:v,columnVisibilityModel:{invoicePeriod:!1,invoiceBasis:!1,invoiceAmount:!1},containerHeight:g?"calc(100vh - 100px)":void 0,tableHeight:g?"calc(100% - 120px)":void 0})}),t&&!f&&(0,l.jsx)(rz.x,{value:j,index:"finances",boxSx:{padding:"0px 0px 0px 0px"},children:(0,l.jsx)(iN,{locationId:t})})]})]})]})},i$=(0,c.ZP)(p.Z)(function(e){return{"&.MuiTabs-root":{paddingLeft:"16px",minHeight:"auto"},"& .MuiTabs-scroller":{minHeight:"auto"},"& .MuiTab-root":{fontSize:"18px",textTransform:"none",padding:"12px 0px",minWidth:"auto",minHeight:"auto",marginRight:"60px"},"& .MuiTabs-indicator":{bottom:"8px",backgroundColor:e.theme.palette.black.main}}}),iJ=(0,c.ZP)(d.Z)(function(e){e.theme;var n=e.value,t=e.is600pxOrLess;return(0,i.Z)({marginTop:"25px"},"schedules"===n&&!t&&{height:"calc(100vh + 100px)"},"schedules"===n&&t&&{height:"calc(100vh + 500px)"},"items"===n&&{height:"calc(100vh - 22px)"},"overview"===n&&{height:"calc(100vh - 22px)"})})},2388:function(e,n,t){t.d(n,{v:function(){return Z}});var o=t(14924),r=t(85893),a=t(45697),i=t.n(a),l=t(60888),s=t(59462),u=t(5616),d=t(11057),c=t(19370),p=t(51233),m=t(44472),h=t(14621),v=t(57249),f=t(10556),x=t(70490),g=t(66647),b=t(1698),y=t(15861),j=t(90948),Z=function(e){var n=e.steps,t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(function(e){return!!e.active})},o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(function(e){var n=e.active,t=e.data;return!!n&&!!t})};return(0,r.jsx)(u.Z,{children:(0,r.jsx)(c.Z,{orientation:"vertical",connector:(0,r.jsx)(w,{}),children:n.filter(function(e){var n=e.active;return void 0===n||n}).map(function(e,n){var a=e.id,i=e.label,c=e.info,h=e.date,v=e.content,f=e.actions,x=!!h,g=o(v),b=t(f),j=x?(0,r.jsx)(l.Z,{color:"primary"}):(0,r.jsx)(s.Z,{color:"primary"});return(0,r.jsxs)(m.Z,{completed:x,expanded:!0,children:[(0,r.jsxs)(I,{icon:j,children:[(0,r.jsx)(y.Z,{sx:{fontSize:"13px",fontWeight:600},children:i}),(0,r.jsx)(y.Z,{sx:{fontSize:"10px",fontWeight:400,ml:3,opacity:.6},children:h})]}),(0,r.jsxs)(C,{children:[(0,r.jsx)(u.Z,{children:x||(null==g?void 0:g.length)>0?g.map(function(e){return"function"==typeof e.data?e.data():(0,r.jsx)(y.Z,{sx:{fontSize:"10px"},children:e.data})}):(0,r.jsx)(y.Z,{sx:{fontSize:"10px",fontStyle:"italic"},children:c})}),(null==b?void 0:b.length)>0&&(0,r.jsx)(p.Z,{mt:.5,spacing:.5,children:b.map(function(e){return"button"!==e.type?null:(0,r.jsx)(u.Z,{children:(0,r.jsx)(d.Z,{color:e.context,variant:"contained",size:"small",onClick:e.handleClick,children:e.content})})})})]})]},"".concat(i,"-").concat(a))})})})};Z.propTypes={steps:i().arrayOf(i().shape({id:i().number,label:i().string,info:i().string,date:i().oneOfType([i().string,i().bool]),active:i().bool,content:i().arrayOf(i().shape({id:i().number,active:i().bool,data:i().oneOfType([i().string,i().element])})),actions:i().arrayOf(i().shape({id:i().number,active:i().bool,content:i().string,context:i().string,handleClick:i().func,type:"button"}))}))};var w=(0,j.ZP)(h.Z)(function(e){var n,t=e.theme;return n={},(0,o.Z)(n,"&.".concat(v.Z.active),(0,o.Z)({},"& .".concat(v.Z.line),{borderColor:t.palette.primary.main})),(0,o.Z)(n,"&.".concat(v.Z.completed),(0,o.Z)({},"& .".concat(v.Z.line),{borderColor:t.palette.primary.main})),(0,o.Z)(n,"& .".concat(v.Z.line),{borderColor:t.palette.primary.main,borderLeftWidth:4,borderRadius:1,marginLeft:"-2px"}),n}),C=(0,j.ZP)(f.Z)(function(e){var n=e.theme;return(0,o.Z)({},"&.".concat(x.Z.root),{borderColor:n.palette.primary.main,borderLeftWidth:4,marginLeft:"10px"})}),I=(0,j.ZP)(g.Z)(function(e){var n;return e.theme,n={},(0,o.Z)(n,"&.".concat(b.Z.root),{padding:0}),(0,o.Z)(n,"& .".concat(b.Z.labelContainer),{color:"inherit"}),(0,o.Z)(n,"& .".concat(b.Z.label),{display:"flex",alignItems:"center",color:"inherit"}),n})},97824:function(e,n,t){t.d(n,{x:function(){return u}});var o=t(26042),r=t(69396),a=t(99534),i=t(85893),l=t(90948),s=t(5616),u=function(e){var n=e.children,t=e.value,l=e.index,u=e.boxProps,c=e.boxSx,p=(0,a.Z)(e,["children","value","index","boxProps","boxSx"]);return(0,i.jsx)(d,(0,r.Z)((0,o.Z)({role:"tabpanel",hidden:t!==l,id:"simple-tabpanel-".concat(l),"aria-labelledby":"simple-tab-".concat(l)},p),{children:t===l&&(0,i.jsx)(s.Z,(0,r.Z)((0,o.Z)({},u),{sx:(0,o.Z)({padding:"25px 0"},c),children:n}))}))};u.defaultProps={boxProps:{},boxSx:{}};var d=(0,l.ZP)(s.Z)(function(){return{"& .MuiTabs-root":{}}})},32320:function(e,n,t){t.d(n,{lt:function(){return o},pv:function(){return r}});var o=function(e,n){var t=Math.pow(10,n);return Math.round(e*t)/t},r=function(e){return parseInt(e).toLocaleString("en-GB",{minimumIntegerDigits:2,useGrouping:!1})}},60185:function(e,n,t){t.d(n,{z:function(){return p}});var o=t(47568),r=t(828),a=t(29815),i=t(97582),l=t(6812),s=t(50319),u=t(52824),d=t(24043),c=t(67294),p=function(e,n,t,p){var m,h,v,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"media",x=(0,c.useState)(!1),g=x[0],b=x[1],y=(0,l.a)(u.O,{variables:{entity:e,entityId:p,category:f,adminId:n},skip:!p}),j=y.data,Z=(void 0===j?{items:[]}:j).items,w=y.loading,C=(0,r.Z)((0,s.D)(d.CI),2),I=C[0],S=C[1].loading,_=(0,r.Z)((0,s.D)(d.xM,{refetchQueries:["MEDIAS"]}),1)[0],k=function(e){I({variables:{mediaId:e}})},D=function(){var e="cleverly-pre-prod-media";return JSON.stringify([{width:32,height:32,bucket:e,sizeName:"vSmall",fit:"inside"},{width:200,height:200,bucket:e,sizeName:"small",fit:"inside"},{width:600,height:600,bucket:e,sizeName:"medium",fit:"inside"},{width:1200,height:1200,bucket:e,sizeName:"large",fit:"inside"}])},q=(m=(0,o.Z)(function(o,r){var a,l;return(0,i.__generator)(this,function(i){switch(i.label){case 0:if(i.trys.push([0,,4,5]),b(!0),!r)return[3,3];return[4,O(r)];case 1:return a=i.sent(),l={adminId:n,caption:r.caption,expiryAt:null,extension:r.media.name.split(".").pop(),userId:t,filename:a.key,type:r.type,Media_Entities:{data:[{entity:e,entityId:o}]}},[4,_({variables:{objects:l}})];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:return b(!1),[7];case 5:return[2]}})}),function(e,n){return m.apply(this,arguments)}),P=(h=(0,o.Z)(function(){var o,r,l,s,u,d,c,p,m,h,v,f,x,g,y,j,Z,w,C=arguments;return(0,i.__generator)(this,function(i){switch(i.label){case 0:o=C.length>0&&void 0!==C[0]?C[0]:[],r=C.length>1&&void 0!==C[1]?C[1]:"media",i.label=1;case 1:i.trys.push([1,,10,11]),b(!0),l=null,s=!0,u=!1,d=void 0,i.label=2;case 2:i.trys.push([2,7,8,9]),c=o[Symbol.iterator](),i.label=3;case 3:if(s=(p=c.next()).done)return[3,6];if((m=p.value).mediaId)return[3,5];return[4,O(m)];case 4:v=i.sent(),f=null,x=null,"image"===m.type?(g=v.key,f=(y=v.data.find(function(e){return"large"===e.name}))?y.relativePath:g,x={original:{relativePath:g},thumbnails:v.data||null}):f=v.key,l={Media_Entity:{data:(0,a.Z)(null!==(j=null==l?void 0:null===(h=l.Media_Entity)||void 0===h?void 0:h.data)&&void 0!==j?j:[]).concat([{entity:e,Medium:{data:{adminId:n,caption:null!==(Z=null==m?void 0:m.caption)&&void 0!==Z?Z:null,expiryAt:null,extension:m.media.name.split(".").pop(),userId:t,category:r,filename:f,type:m.type,meta:x}}}])}},i.label=5;case 5:return s=!0,[3,3];case 6:return[3,9];case 7:return w=i.sent(),u=!0,d=w,[3,9];case 8:try{s||null==c.return||c.return()}finally{if(u)throw d}return[7];case 9:return[2,l];case 10:return b(!1),[7];case 11:return[2]}})}),function(){return h.apply(this,arguments)}),O=(v=(0,o.Z)(function(e){var n,t,o,r,a;return(0,i.__generator)(this,function(a){switch(a.label){case 0:switch(n="cleverly-pre-prod-media",t="https://aws-pre-prod.cleverly.works/aws/s3/upload",(o=new window.FormData).append("file",e.media,e.media.name),e.type){case"image":r="https://aws-pre-prod.cleverly.works/image/process",o.append("sizes",D());break;case"document":case"audio":o.append("bucket",n),o.append("folder","".concat(e.type,"s")),r=t}return[4,window.fetch(r,{method:"POST",body:o})];case 1:return[2,a.sent().json()]}})}),function(e){return v.apply(this,arguments)});return{uploadMedia:q,uploadMediaToS3:O,createMediaInput:P,deleteMediaByEntity:k,loadingAddMedia:g,loadingDeleteMedia:S,preloadedMediaLoading:w,preloadedMedia:(null==Z?void 0:Z.length)?Z:[]}}},83395:function(e,n,t){t.d(n,{b:function(){return o}});var o=function(e){return String(e).toLowerCase().replace("gb","").length>=9}},82749:function(e,n,t){t.d(n,{O:function(){return r},y:function(){return o}});var o=[{area:"AB",name:"Aberdeen"},{area:"AL",name:"St. Albans"},{area:"B",name:"Birmingham"},{area:"BA",name:"Bath"},{area:"BB",name:"Blackburn"},{area:"BD",name:"Bradford"},{area:"BH",name:"Bournemouth"},{area:"BL",name:"Bolton"},{area:"BN",name:"Brighton"},{area:"BR",name:"Bromley"},{area:"BS",name:"Bristol"},{area:"BT",name:"Belfast"},{area:"CA",name:"Carlisle"},{area:"CB",name:"Cambridge"},{area:"CF",name:"Cardiff"},{area:"CH",name:"Chester"},{area:"CM",name:"Chelmsford"},{area:"CO",name:"Colchester"},{area:"CR",name:"Croydon"},{area:"CT",name:"Canterbury"},{area:"CV",name:"Coventry"},{area:"CW",name:"Crewe"},{area:"DA",name:"Dartford"},{area:"DD",name:"Dundee"},{area:"DE",name:"Derby"},{area:"DG",name:"Dumfries"},{area:"DH",name:"Durham"},{area:"DL",name:"Darlington"},{area:"DN",name:"Doncaster"},{area:"DT",name:"Dorchester"},{area:"DY",name:"Dudley"},{area:"E",name:"London E"},{area:"EC",name:"London EC"},{area:"EH",name:"Edinburgh"},{area:"EN",name:"Enfield"},{area:"EX",name:"Exeter"},{area:"FK",name:"Falkirk"},{area:"FY",name:"Blackpool"},{area:"G",name:"Glasgow"},{area:"GL",name:"Gloucester"},{area:"GU",name:"Guildford"},{area:"GY",name:"Guernsey"},{area:"HA",name:"Harrow"},{area:"HD",name:"Huddersfield"},{area:"HG",name:"Harrogate"},{area:"HP",name:"Hemel Hempstead"},{area:"HR",name:"Hereford"},{area:"HS",name:"Western Isles"},{area:"HU",name:"Hull"},{area:"HX",name:"Halifax"},{area:"IG",name:"Ilford"},{area:"IM",name:"Isle Of Man"},{area:"IP",name:"Ipswich"},{area:"IV",name:"Inverness"},{area:"JE",name:"Jersey"},{area:"KA",name:"Kilmarnock"},{area:"KT",name:"Kingston Upon Thames"},{area:"KW",name:"Kirkwall"},{area:"KY",name:"Kirkcaldy"},{area:"L",name:"Liverpool"},{area:"LA",name:"Lancaster"},{area:"LD",name:"Llandrindod Wells"},{area:"LE",name:"Leicester"},{area:"LL",name:"Llandudno"},{area:"LN",name:"Lincoln"},{area:"LS",name:"Leeds"},{area:"LU",name:"Luton"},{area:"M",name:"Manchester"},{area:"ME",name:"Medway"},{area:"MK",name:"Milton Keynes"},{area:"ML",name:"Motherwell"},{area:"N",name:"London N"},{area:"NE",name:"Newcastle Upon Tyne"},{area:"NG",name:"Nottingham"},{area:"NN",name:"Northampton"},{area:"NP",name:"Newport"},{area:"NR",name:"Norwich"},{area:"NW",name:"London NW"},{area:"OL",name:"Oldham"},{area:"OX",name:"Oxford"},{area:"PA",name:"Paisley"},{area:"PE",name:"Peterborough"},{area:"PH",name:"Perth"},{area:"PL",name:"Plymouth"},{area:"PO",name:"Portsmouth"},{area:"PR",name:"Preston"},{area:"RG",name:"Reading"},{area:"RH",name:"Redhill"},{area:"RM",name:"Romford"},{area:"S",name:"Sheffield"},{area:"SA",name:"Swansea"},{area:"SE",name:"London SE"},{area:"SG",name:"Stevenage"},{area:"SK",name:"Stockport"},{area:"SL",name:"Slough"},{area:"SM",name:"Sutton"},{area:"SN",name:"Swindon"},{area:"SO",name:"Southampton"},{area:"SP",name:"Salisbury"},{area:"SR",name:"Sunderland"},{area:"SS",name:"Southend-On-Sea"},{area:"ST",name:"Stoke-On-Trent"},{area:"SW",name:"London SW"},{area:"SY",name:"Shrewsbury"},{area:"TA",name:"Taunton"},{area:"TD",name:"Galashiels"},{area:"TF",name:"Telford"},{area:"TN",name:"Tonbridge"},{area:"TQ",name:"Torquay"},{area:"TR",name:"Truro"},{area:"TS",name:"Cleveland"},{area:"TW",name:"Twickenham"},{area:"UB",name:"Southall"},{area:"W",name:"London W"},{area:"WA",name:"Warrington"},{area:"WC",name:"London WC"},{area:"WD",name:"Watford"},{area:"WF",name:"Wakefield"},{area:"WN",name:"Wigan"},{area:"WR",name:"Worcester"},{area:"WS",name:"Walsall"},{area:"WV",name:"Wolverhampton"},{area:"YO",name:"York"},{area:"ZE",name:"Lerwick"}],r=new Map([["UK",/([A-Z]+)([0-9]+).*?[A-Z0-9]{3}/i],["GB",/([A-Z]+)([0-9]+).*?[A-Z0-9]{3}/i],["JE",/^JE\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}$/],["GG",/^GY\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}$/],["IM",/^IM\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}$/],["US",/^([0-9]{5})(?:-([0-9]{4}))?$/],["CA",/^([ABCEGHJKLMNPRSTVXY][0-9][ABCEGHJKLMNPRSTVWXYZ])\s*([0-9][ABCEGHJKLMNPRSTVWXYZ][0-9])$/i],["IE",/^([AC-FHKNPRTV-Y]\d{2}|D6W)\s[0-9AC-FHKNPRTV-Y]{4}$/],["DE",/^\d{5}$/],["JP",/^\d{3}-\d{4}$/],["FR",/^\d{2}[ ]?\d{3}$/],["AU",/^\d{4}$/],["IT",/^\d{5}$/],["CH",/^\d{4}$/],["AT",/^(?!0)\d{4}$/],["ES",/^(?:0[1-9]|[1-4]\d|5[0-2])\d{3}$/],["NL",/^\d{4}[ ]?[A-Z]{2}$/],["BE",/^\d{4}$/],["DK",/^\d{4}$/],["SE",/^(SE-)?\d{3}[ ]?\d{2}$/],["NO",/^\d{4}$/],["FI",/^(FI-|AX-)?\d{5}$/],["AX",/^22\d{3}$/],["KR",/^\d{5}$/],["CN",/^\d{6}$/],["TW",/^\d{3}(\d{2})?$/],["SG",/^\d{6}$/],["DZ",/^\d{5}$/],["AD",/^AD\d{3}$/],["AR",/^([A-HJ-NP-Z])?\d{4}([A-Z]{3})?$/],["AM",/^(37)?\d{4}$/],["AZ",/^\d{4}$/],["BH",/^((1[0-2]|[2-9])\d{2})?$/],["BD",/^\d{4}$/],["BB",/^(BB\d{5})?$/],["BY",/^\d{6}$/],["BM",/^[A-Z]{2}[ ]?[A-Z0-9]{2}$/],["BA",/^\d{5}$/],["IO",/^BBND 1ZZ$/],["BN",/^[A-Z]{2}[ ]?\d{4}$/],["BG",/^\d{4}$/],["KH",/^\d{5}$/],["CV",/^\d{4}$/],["CL",/^\d{7}$/],["CR",/^(\d{4,5}|\d{3}-\d{4})$/],["HR",/^(HR-)?\d{5}$/],["CY",/^\d{4}$/],["CZ",/^\d{3}[ ]?\d{2}$/],["DO",/^\d{5}$/],["EC",/^([A-Z]\d{4}[A-Z]|(?:[A-Z]{2})?\d{6})?$/],["EG",/^\d{5}$/],["EE",/^\d{5}$/],["FO",/^\d{3}$/],["GE",/^\d{4}$/],["GR",/^\d{3}[ ]?\d{2}$/],["GL",/^39\d{2}$/],["GT",/^\d{5}$/],["HT",/^\d{4}$/],["HN",/^(?:\d{5})?$/],["HU",/^\d{4}$/],["IS",/^\d{3}$/],["IN",/^\d{6}$/],["ID",/^\d{5}$/],["IL",/^\d{5,7}$/],["JO",/^\d{5}$/],["KZ",/^\d{6}$/],["KE",/^\d{5}$/],["KW",/^\d{5}$/],["LA",/^\d{5}$/],["LV",/^(LV-)?\d{4}$/],["LB",/^(\d{4}([ ]?\d{4})?)?$/],["LI",/^(948[5-9])|(949[0-7])$/],["LT",/^(LT-)?\d{5}$/],["LU",/^(L-)?\d{4}$/],["MK",/^\d{4}$/],["MY",/^\d{5}$/],["MV",/^\d{5}$/],["MT",/^[A-Z]{3}[ ]?\d{2,4}$/],["MU",/^((\d|[A-Z])\d{4})?$/],["MX",/^\d{5}$/],["MD",/^\d{4}$/],["MC",/^980\d{2}$/],["MA",/^\d{5}$/],["NP",/^\d{5}$/],["NZ",/^\d{4}$/],["NI",/^((\d{4}-)?\d{3}-\d{3}(-\d{1})?)?$/],["NG",/^(\d{6})?$/],["OM",/^(PC )?\d{3}$/],["PK",/^\d{5}$/],["PY",/^\d{4}$/],["PH",/^\d{4}$/],["PL",/^\d{2}-\d{3}$/],["RO",/^\d{6}$/],["RU",/^\d{6}$/],["SM",/^4789\d$/],["SA",/^\d{5}$/],["SN",/^\d{5}$/],["SK",/^\d{3}[ ]?\d{2}$/],["SI",/^(SI-)?\d{4}$/],["ZA",/^\d{4}$/],["LK",/^\d{5}$/],["TJ",/^\d{6}$/],["TH",/^\d{5}$/],["TN",/^\d{4}$/],["TR",/^\d{5}$/],["TM",/^\d{6}$/],["UA",/^\d{5}$/],["UY",/^\d{5}$/],["UZ",/^\d{6}$/],["VA",/^00120$/],["VE",/^\d{4}$/],["ZM",/^\d{5}$/],["AS",/^96799$/],["CC",/^6799$/],["CK",/^\d{4}$/],["RS",/^\d{5,6}$/],["ME",/^8\d{4}$/],["CS",/^\d{5}$/],["YU",/^\d{5}$/],["CX",/^6798$/],["ET",/^\d{4}$/],["FK",/^FIQQ 1ZZ$/],["NF",/^2899$/],["PN",/^PCRN 1ZZ$/],["PW",/^96940$/],["RE",/^9[78]4\d{2}$/],["SH",/^(ASCN|STHL) 1ZZ$/],["SJ",/^\d{4}$/],["SO",/^\d{5}$/],["SZ",/^[HLMS]\d{3}$/],["TC",/^TKCA 1ZZ$/],["WF",/^986\d{2}$/],["XK",/^\d{5}$/],["YT",/^976\d{2}$/],["INTL",/^(?:[A-Z0-9]+([- ]?[A-Z0-9]+)*)?$/i]])}}]);