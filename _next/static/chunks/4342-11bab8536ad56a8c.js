"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4342],{17974:function(e,n,t){t.d(n,{E:function(){return W}});var i=t(26042),o=t(85893),a=t(11163),r=t.n(a),s=t(45697),l=t.n(s),c=t(64872),d=t(15033),u=t(20705),m=t(68957),p=t(6812),f=t(30381),h=t.n(f),v=t(11994),x=t(11057),g=t(90629),b=t(51233),y=t(15861),Z=t(12547),j=t(81261),w=t(35656),C=t(5336),I=t(69396),q=t(828),A=t(86886),S=t(50135),k=t(61730),N=t(59938),_=t(42283),P=t(73359),R=t(67294),T=t(78232),F=t(4972),V=t(10166),D=function(e){var n,t=e.open,a=e.setOpen,r=e.initialFilters,s=e.filters,l=e.setFilters,c=(0,k.Z)("(max-width: 400px)")?4:0,d=(0,q.Z)((0,N.X)("form_data_".concat(r.filterType),r),2),u=d[0],m=d[1],p=(0,_.cI)({defaultValues:u}),f=p.control,h=p.handleSubmit,v=p.register,g=p.reset,y=(0,p.watch)(),Z=(0,q.Z)((0,P.t)(F.SW),2),j=Z[0],w=Z[1],C=w.loading,V=w.data,D=(void 0===V?{items:[]}:V).items,W=(0,q.Z)((0,P.t)(F._d,{variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:null===(n=y.customer)||void 0===n?void 0:n.value}}}}}),2),M=W[0],O=W[1],z=O.loading,H=O.data,G=(void 0===H?{items:[]}:H).items,Q=(0,q.Z)((0,P.t)(F.UM),2),B=Q[0],U=Q[1],$=U.loading,Y=U.data,J=(void 0===Y?{items:[]}:Y).items;(0,R.useEffect)(function(){t&&g(u)},[t]),(0,R.useEffect)(function(){m((0,I.Z)((0,i.Z)({},y),{filterType:r.filterType}))},[s]);var X=function(e){try{var n,t,o,r={customerId:null===(n=e.customer)||void 0===n?void 0:n.value,locationId:null===(t=e.location)||void 0===t?void 0:t.value,categoryId:null===(o=e.assetCategory)||void 0===o?void 0:o.value,q:e.search?"%".concat(e.search,"%"):null};l(function(e){return(0,i.Z)({},e,r)})}finally{a(!1)}},K=function(){l(r),g(r),a(!1)};return(0,o.jsx)(E,{keepMounted:!0,open:t,onClose:function(){return a(!1)},children:(0,o.jsx)("form",{onSubmit:h(X),children:(0,o.jsx)(L,{children:(0,o.jsxs)(A.ZP,{container:!0,rowGap:4,children:[(0,o.jsx)(A.ZP,{container:!0,children:(0,o.jsx)(A.ZP,{item:!0,xs:12,children:(0,o.jsx)(S.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search...",name:"search",inputRef:v})})}),(0,o.jsxs)(A.ZP,{container:!0,columnSpacing:4,rowGap:c,children:[(0,o.jsx)(A.ZP,{item:!0,xs:12,xs2:6,children:(0,o.jsx)(_.Qr,{name:"customer",control:f,render:function(e){var n=e.value,t=e.onChange;return(0,o.jsx)(T.F,{value:n,onChange:function(e,n){return t(n)},label:"Select customer",loading:C,onOpen:function(){return j()},options:D})}})}),(0,o.jsx)(A.ZP,{item:!0,xs:12,xs2:6,children:(0,o.jsx)(_.Qr,{name:"location",control:f,render:function(e){var n=e.value,t=e.onChange;return(0,o.jsx)(T.F,{value:n,onChange:function(e,n){return t(n)},label:"Select location",loading:z,onOpen:function(){return M()},options:G})}})})]}),(0,o.jsx)(A.ZP,{container:!0,columnSpacing:4,rowGap:c,children:(0,o.jsx)(A.ZP,{item:!0,xs:12,xs2:6,children:(0,o.jsx)(_.Qr,{name:"assetCategory",control:f,render:function(e){var n=e.value,t=e.onChange;return(0,o.jsx)(T.F,{value:n,onChange:function(e,n){return t(n)},label:"Select asset category",loading:$,onOpen:function(){return B()},options:J})}})})}),(0,o.jsx)(A.ZP,{container:!0,item:!0,xs:12,children:(0,o.jsxs)(b.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,o.jsx)(x.Z,{variant:"contained",color:"danger",onClick:function(){return K()},children:"Cancel"}),(0,o.jsx)(x.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})})]})})})})};D.defaultProps={open:!1,setOpen:function(){},initialFilters:{},filters:{},setFilters:function(){}},D.propTypes={open:l().bool,setOpen:l().func,initialFilters:l().object,filters:l().object,setFilters:l().func};var E=(0,V.Z)(v.Z)(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}}),L=(0,V.Z)(g.Z)(function(){return{padding:"24px",maxWidth:"700px",maxHeight:"100vh",overflowY:"scroll"}}),W=function(e){var n,t=e.hideLink,a=e.hideCustomerInfo,s=e.hideLocationInfo,l=e.showHeader,f=e.initialFilters,I=e.editable,q=e.createFormDefaultValues,A=(0,c.a)(),S=(0,R.useState)(!1),k=S[0],N=S[1],_=(0,R.useState)(null),P=_[0],T=_[1],F=(0,R.useState)((0,i.Z)({},f)),V=F[0],E=F[1],L=(0,u.x)({filters:V}),W=L.initialData,M=L.ref,O=(0,p.a)(m.tG,{variables:(0,i.Z)({},W)}),z=O.data,H=void 0===z?{assets:[],meta:{aggregate:{totalCount:0}}}:z,G=H.assets,Q=H.meta,B=O.loading,U=O.refetch,$=function(){A.show({content:(0,o.jsx)(w.R,{offCanvas:A,defaultValues:q}),title:"Add Asset",submit:!0})},Y=function(e){A.show({content:(0,o.jsx)(w.R,{assetId:e.id,offCanvas:A,defaultValues:q}),title:"Edit Asset",submit:!0})},J=function(e){var n=[];return I&&n.push({icon:"edit",onClick:function(n){n.stopPropagation(),Y(e)},tooltip:"Edit"}),n.push({icon:"info",onClick:function(n){n.stopPropagation(),r().push("/dashboard/assets/view?id=".concat(e.id))},tooltip:"Info"}),n},X=function(e){var n=e.row;r().push("/dashboard/assets/view?id=".concat(n.id))};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(b.Z,{width:"100%",spacing:2,sx:{height:"calc(100% - 58px)"},children:[l&&(0,o.jsxs)(b.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,o.jsx)(x.Z,{variant:"contained",startIcon:(0,o.jsx)(j.Z,{}),onClick:function(){return N(!0)},children:"Filters"}),I&&(0,o.jsx)(b.Z,{direction:"row",spacing:2,children:(0,o.jsx)(x.Z,{variant:"contained",color:"secondary",onClick:$,children:"Create Asset"})})]}),(0,o.jsxs)(g.Z,{sx:{paddingTop:"16px",paddingBottom:"16px",height:"100%"},children:[(0,o.jsxs)(b.Z,{direction:"row",justifyContent:"space-between",children:[(0,o.jsx)(y.Z,{ml:2,variant:"h5",sx:{fontWeight:600},children:"Assets"}),I&&!l&&(0,o.jsx)(x.Z,{sx:{mr:2},variant:"contained",color:"secondary",onClick:$,children:"Create Asset"})]}),l&&(0,o.jsx)(D,{initialFilters:f,filters:V,setFilters:E,open:k,setOpen:N}),(0,o.jsx)(d.i,{autoHeight:!1,loading:B,ref:M,columns:[{field:"mainPhoto",headerName:"Main photo",minWidth:120,sortable:!1,renderCell:function(e){var n,t=e.row;return t.mainPhoto?(0,o.jsx)("img",{loading:"lazy",onClick:function(e){var n;e.stopPropagation(),T("".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(null===(n=t.mainPhoto)||void 0===n?void 0:n.filename))},style:{width:"70px",height:"50px"},alt:"mainPhoto",src:"".concat("https://cleverly-pre-prod-media.s3.eu-west-2.amazonaws.com","/").concat(null===(n=t.mainPhoto)||void 0===n?void 0:n.filename)}):null}},{minWidth:80,flex:1,field:"name",headerName:"Name",sortable:!1},{minWidth:100,flex:1,field:"description",headerName:"Description",sortable:!1},{minWidth:80,flex:1,field:"categoryName",headerName:"Category",sortable:!1},{minWidth:120,flex:1,field:"locationName",headerName:"Location",sortable:!1,renderCell:function(e){var n=e.row;return(0,o.jsx)(Z.r,{color:"secondary",href:"/dashboard/properties/view?id=".concat(n.locationId),children:n.locationName})}},{minWidth:80,flex:1,field:"sublocationName",headerName:"Sublocation",sortable:!1,renderCell:function(e){var n=e.row;return(0,o.jsx)(Z.r,{noWrap:t,color:"secondary",href:"/dashboard/properties/view?id=".concat(n.locationId,"&tab=sublocations"),children:n.sublocationName})}},{minWidth:120,flex:1,field:"customerName",headerName:"Customer",sortable:!1,renderCell:function(e){var n=e.row;return(0,o.jsx)(Z.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(n.customerId),children:n.customerName})}},{minWidth:60,flex:1,field:"type",headerName:"Type",sortable:!1},{minWidth:60,flex:1,field:"status",headerName:"Status",sortable:!1},{minWidth:100,flex:1,field:"createdAt",headerName:"Created",sortable:!0,sortName:"createdAt"},{width:50,field:"actions",headerName:"Actions",sortable:!1,renderCell:function(e){var n=e.row;return(0,o.jsx)(C.C,{row:n,actionsData:J})}}],rows:G.map(function(e){var t,i,o,a,r,s,l,c,d,u,m,p,f,v,x,g,b,y,Z;return{id:e.id,customer:{label:null===(t=e.customer)||void 0===t?void 0:t.name,value:null===(i=e.customer)||void 0===i?void 0:i.id},assetCategory:{label:null===(o=e.category)||void 0===o?void 0:o.name,value:null===(a=e.category)||void 0===a?void 0:a.id},description:e.description,name:e.name,location:{label:null===(r=e.location)||void 0===r?void 0:r.name,value:null===(s=e.location)||void 0===s?void 0:s.id},sublocation:{label:null===(l=e.sublocation)||void 0===l?void 0:l.name,value:null===(c=e.sublocation)||void 0===c?void 0:c.id},parent:{label:null===(d=e.parentId)||void 0===d?void 0:d.label,value:null===(u=e.parentId)||void 0===u?void 0:u.value},status:e.status,mainPhoto:null!==(n=null===(m=e.mainPhoto)||void 0===m?void 0:null===(p=m[0])||void 0===p?void 0:p.item)&&void 0!==n?n:null,locationId:null===(f=e.location)||void 0===f?void 0:f.id,customerId:null===(v=e.customer)||void 0===v?void 0:v.id,categoryName:null===(x=e.category)||void 0===x?void 0:x.name,locationName:null===(g=e.location)||void 0===g?void 0:g.name,sublocationName:null===(b=e.sublocation)||void 0===b?void 0:b.name,type:(null===(y=e.parentId)||void 0===y?void 0:y.value)?"Child":"Parent",customerName:null===(Z=e.customer)||void 0===Z?void 0:Z.name,createdAt:h()(e.createdAt).format("YYYY-MM-DD")}}),meta:Q,refetch:U,onRowClick:X,containerHeight:"calc(100% - 32px)",columnVisibilityModel:{locationName:!s,customerName:!a}})]})]}),P&&(0,o.jsx)(v.Z,{open:!!P,onClose:function(){return T(null)},sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},children:(0,o.jsx)("img",{style:{width:"500px",height:"500px"},alt:"mainPhoto",src:P})})]})};W.defaultProps={initialFilters:{},hideLink:!1,hideCustomerInfo:!1,hideLocationInfo:!1,showHeader:!0,editable:!0},W.propTypes={initialFilters:l().shape({filterType:l().string.isRequired}),hideLink:l().bool,hideCustomerInfo:l().bool,hideLocationInfo:l().bool,showHeader:l().bool,editable:l().bool,createFormDefaultValues:l().object}},66854:function(e,n,t){t.d(n,{F:function(){return O}});var i=t(47568),o=t(26042),a=t(69396),r=t(99534),s=t(29815),l=t(97582),c=t(85893),d=t(67294),u=t(45697),m=t(11163),p=t(66252),f=t(28852),h=t(78289),v=t(11585),x=t(9270),g=t(62140),b=t(13625),y=function(e){var n=e.dateClick,t=e.events,i=e.eventClick,o=e.eventContent,a=(e.hasLoading,e.height),r=e.initialView;return(0,c.jsx)(b.Z,{dateClick:n,eventClick:i,eventContent:o,events:t,hasLoading:!0,height:a,headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:r})};y.propTypes={dateClick:u.func,events:u.func,eventClick:u.func,eventContent:u.func,hasLoading:u.bool,height:u.number,initialView:(0,u.oneOf)(["listWeek","timeGridWeek","timeGridDay"])},y.defaultProps={initialView:"listWeek",hasLoading:!0,height:550};var Z=t(11383),j=t(2845),w=t(18586),C=t(22713),I=t(22244),q=t(7297),A=t(10367);function S(){var e=(0,q.Z)(["\n  ul {\n    list-style: none;\n    float: left;\n    padding-top: 15px;\n  }\n  ul li {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    float: left;\n    width: 120px;\n    font-size: 90%;\n    list-style: none;\n  }\n  li span {\n    display: block;\n    float: left;\n    height: 12px;\n    width: 12px;\n    margin-right: 5px;\n  }\n"]);return S=function(){return e},e}var k=function(e){var n=e.status;return(0,c.jsx)(N,{children:(0,c.jsx)("ul",{children:n.map(function(e,n){return(0,c.jsxs)("li",{children:[(0,c.jsx)("span",{style:{backgroundColor:e.colour}}),e.text]},"legend".concat(n))})})})},N=A.ZP.div.withConfig({displayName:"legend__StyledContainer",componentId:"sc-19e2194e-0"})(S()),_=t(62047),P=t(55843),R=t(51466),T=t(58594),F=t(66812),V=t(42283),D=t(92148);function E(){var e=(0,q.Z)(["\n  align-items: center;\n  display: flex;\n"]);return E=function(){return e},e}var L=function(e){var n=e.setTypes,t=e.setFilters,i=e.setSiteVisit,r=e.types,l=(0,j.x)().hasRole,u=(0,V.cI)({defaultValues:M}),m=u.control,p=u.errors,f=u.register,h=(0,u.watch)("userId");(0,d.useEffect)(function(){t(function(e){return(0,a.Z)((0,o.Z)({},e),{userId:(null==h?void 0:h.value)||null})})},[h]);var v=function(e,t){t?n((0,s.Z)(r).concat([e])):n(r.filter(function(n){return n!==e}))},b=function(e){i(e.target.checked)};return(0,c.jsxs)(x.Z,{children:[(0,c.jsxs)(W,{md:3,children:[(0,c.jsx)(_.Z,{onToggle:function(e){return v("reactive",e)},size:"sm",toggled:r.includes("reactive")}),(0,c.jsx)(P.Z,{marginLeft:"sm"}),(0,c.jsx)(R.Z,{size:"sm",children:"Reactive"})]}),(0,c.jsxs)(W,{md:3,children:[(0,c.jsx)(_.Z,{onToggle:function(e){return v("ppm",e)},size:"sm",toggled:r.includes("ppm")}),(0,c.jsx)(P.Z,{marginLeft:"sm"}),(0,c.jsx)(R.Z,{size:"sm",children:"PPM"})]}),(0,c.jsxs)(W,{md:3,children:[(0,c.jsx)(_.Z,{onToggle:function(e){return v("quote",e)},size:"sm",toggled:r.includes("quote")}),(0,c.jsx)(P.Z,{marginLeft:"sm"}),(0,c.jsx)(R.Z,{size:"sm",children:"Quote"})]}),(0,c.jsxs)(W,{md:3,children:[(0,c.jsx)(_.Z,{onToggle:function(e){return v("cppm",e)},size:"sm",toggled:r.includes("cppm")}),(0,c.jsx)(P.Z,{marginLeft:"sm"}),(0,c.jsx)(R.Z,{size:"sm",children:"Compliance"})]}),(0,c.jsxs)(x.Z,{style:{width:"100%",margin:0},children:[l(D.n)&&(0,c.jsx)(g.Z,{md:6,children:(0,c.jsx)(F.P,(0,a.Z)((0,o.Z)({},{control:m,errors:p,register:f}),{errors:(0,o.Z)({},p),label:"",name:"userId",placeholder:"Select user",type:"user"}))}),(0,c.jsx)(g.Z,{md:6,style:{display:"flex",alignItems:"center"},children:(0,c.jsx)(T.Z,{data:[{label:"Only show site visits",id:"siteVisit",value:"yes"}],name:"siteVisit",onClick:b})})]})]})},W=(0,A.ZP)(g.Z).withConfig({displayName:"filters__StyledColumn",componentId:"sc-d03bcdda-0"})(E());L.propTypes={setTypes:u.func,setSiteVisit:u.func,types:u.array};var M={userId:null},O=function(e){var n,t,u,b,q=e.defaultFilters,A=e.defaultView,S=e.locationId,N=e.showCompliance,_=e.showFilters,P=e.showSiteVisits,R=e.supplierId,T=(0,m.useRouter)().query,F=(0,d.useContext)(h.Z),V=(0,w.q)(),D=null===(n=V.admin)||void 0===n?void 0:null===(t=n.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,E=null===(u=V.admin)||void 0===u?void 0:null===(b=u.jobSetting)||void 0===b?void 0:b.jobNumberSuffix,W=(0,j.x)().user,M=(0,p.x)(),O=!1,z=!1;switch(W.accountType){case"supplier":z=!0;break;case"customer":O=!0}var H,G=(0,d.useState)(T.type?["".concat(T.type)]:q),Q=G[0],B=G[1],U=(0,d.useState)(P),$=U[0],Y=U[1],J=(0,d.useState)(null),X=J[0],K=J[1],ee="scheduled"===T.type?"PPM":"Bookings";(0,d.useEffect)(function(){return T.type?["".concat(T.type)]:z?B(["ppm"]):B(q)},[q]);var en=(H=(0,i.Z)(function(e,n){var t,i,c,d,u;return(0,l.__generator)(this,function(i){switch(i.label){case 0:return t={type:{_in:Q},_or:[{_and:[{timingStart:{_gte:e.start}},{timingStart:{_lte:e.end}}]},{_and:[{scheduledAt:{_gte:e.start}},{scheduledAt:{_lte:e.end}}]},{_and:[{siteVisitStart:{_gte:e.start}},{siteVisitStart:{_lte:e.end}}]}]},z&&(t.supplierId={_eq:W.accountId}),R&&(t.supplierId={_eq:R}),O&&(t.customerId={_eq:W.accountId}),S&&(t.locationId={_eq:S}),(N||S)&&(t.Compliances={complianceId:{_is_null:!1}}),X&&(t.customerUserId={_eq:null==X?void 0:X.userId}),$&&(t.siteVisitStart={_is_null:!1}),[4,M.query({query:f.f,variables:{where:t}})];case 1:return d=(void 0===(c=i.sent().data)?{events:[]}:c).events,u=[],d.map(function(e){var n,t=e.supplierQuotes,i=(0,r.Z)(e,["supplierQuotes"]),l=(null===(n=null==i?void 0:i.shortJobDesc[0])||void 0===n?void 0:n.taxonomy.name)||i.title;return u=(0,s.Z)(u).concat([(0,a.Z)((0,o.Z)({},e),{title:l})]),t.length>0&&t.map(function(e){return u=(0,s.Z)(u).concat([(0,a.Z)((0,o.Z)({},i),{start:e.siteVisitAt,end:e.siteVisitAt,title:"".concat(l," ").concat(e.quoteNumber),siteVisit:!0})])}),u}),n(u.map(function(e){var n=(0,o.Z)({},e);return n.start=n.scheduledAt||n.start,n.end=n.scheduledAt||n.end||n.start,n.color=n.siteVisit?"rgb(182, 79, 200)":(0,Z.t)(n.status),n})),[2]}})}),function(e,n){return H.apply(this,arguments)}),et=function(e){F.show({content:(0,c.jsx)(C.g,{jobId:parseInt(e.event.id),toggleShow:F.close,numberPrefix:D,numberSuffix:E}),title:"Job details",submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,c.jsxs)(v.Z,{fitParentHeight:!0,open:!0,title:ee,children:[_&&(0,c.jsx)(L,{setTypes:B,setFilters:K,setSiteVisit:Y,types:Q}),(0,c.jsx)(y,{eventClick:et,events:en,initialView:"day"===T.show?"timeGridDay":A}),(0,c.jsx)(x.Z,{children:(0,c.jsx)(g.Z,{md:12,children:(0,c.jsx)(k,{status:I.yW})})})]})};O.propTypes={showCompliance:u.bool,showSiteVisits:u.bool,locationId:u.number,showFilters:u.bool},O.defaultProps={dateClick:!1,defaultFilters:["reactive","ppm","quote","cppm"],showFilters:!0,showSiteVisits:!1}},28852:function(e,n,t){t.d(n,{f:function(){return s}});var i=t(7297),o=t(75063),a=t(66312);function r(){var e=(0,i.Z)(['\n  query GetEvents($where: Job_bool_exp) {\n    events: Job(where: $where) {\n      id\n      number\n      type\n      description\n      end: timingEnd\n      scheduledAt\n      siteVisitStart\n      start: timingStart\n      status\n      title\n      quoteDue\n      estimatedDuration\n      estimatedDurationUnit\n      anyTimeOption\n      hourStart\n      hourEnd\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      supplierQuotes: SupplierQuotes(\n        where: {\n          siteVisitAt: { _is_null: false }\n          status: { _neq: "cancelled" }\n          type: { _eq: "quote" }\n        }\n      ) {\n        siteVisitAt\n        quoteNumber\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n              code\n            }\n          }\n        }\n      }\n      supplier: Supplier {\n        addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n  ',"\n  ","\n"]);return r=function(){return e},e}var s=(0,o.Ps)(r(),a.WW,a.MR)},8059:function(e,n,t){t.d(n,{M:function(){return W}});var i=t(828),o=t(85893),a=t(67294),r=t(45697),s=t(11163),l=t(6812),c=t(50319),d=t(12872),u=t(11640),m=t(78289),p=t(68956),f=t(77439),h=t(11585),v=t(16540),x=t(30430),g=t(35418),b=t(26042),y=t(69396),Z=t(42283),j=t(79665),w=t(7739),C=t.n(w),I=t(76600),q=t(49501),A=t(84043),S=t(55563),k=t(28497),N=t(74231),_=(0,N.Ry)().shape({complianceId:(0,N.Ry)().required(),expiryAt:(0,N.hT)().required(),insuranceAmount:(0,N.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),regNum:(0,N.Z_)().required()}),P=t(21300),R=t(14272),T=t(2845),F=function(e){e.complianceType;var n,t,i=e.defaultValues,r=e.onSubmit,s=(0,T.x)().user,c=(0,Z.cI)({defaultValues:(0,b.Z)({},i,(null==i?void 0:i.meta)||{}),resolver:(0,j.S)(_)}),u=c.control,m=c.errors,p=c.handleSubmit,f=c.register,h=(0,c.watch)("complianceId",{hasInsuranceAmount:null==i?void 0:i.hasInsuranceAmount,regNumExample:null==i?void 0:i.regNumExample,questions:null==i?void 0:i.questions}),v=h&&h.questions,x=(0,l.a)(d.kU,{variables:{adminId:s.adminId}}),g=x.loading,w=x.data,N=(void 0===w?{compliance:[]}:w).compliances,F={control:u,errors:m,register:f};return!g&&(0,o.jsxs)(I.Z,{id:"offCanvasForm",handleSubmit:p(r),children:[(0,o.jsx)(q.Z,{label:"Compliance",children:(0,o.jsx)(A.Z,(0,y.Z)((0,b.Z)({},F),{name:"complianceId",options:(n=C()(N,function(e){return e.category.name}),t=[],Object.keys(n).forEach(function(e){t.push({label:e,options:n[e]})}),t)}))}),(0,o.jsx)(q.Z,{label:"Registration Number",children:(0,o.jsx)(S.Z,(0,y.Z)((0,b.Z)({},F),{name:"regNum",placeholder:h.regNumExample&&"eg ".concat(h.regNumExample)}))}),(0,o.jsx)(q.Z,{label:"Expiry"}),(0,o.jsx)(P.M,(0,y.Z)((0,b.Z)({},F),{name:"expiryAt",placeholderText:"Click to select date"})),h.hasInsuranceAmount&&(0,o.jsx)(q.Z,{label:"Insurance Amount",children:(0,o.jsx)(k.Z,(0,y.Z)((0,b.Z)({},F),{name:"insuranceAmount"}))}),null==v?void 0:v.map(function(e){var n,t,i,o;return(0,a.createElement)(R.f,(0,y.Z)((0,b.Z)({},F),{input:null===(n=e.meta)||void 0===n?void 0:n.input,inputType:null===(t=e.meta)||void 0===t?void 0:t.inputType,key:e.id,label:null===(i=e.meta)||void 0===i?void 0:i.label,name:e.name,options:null===(o=e.meta)||void 0===o?void 0:o.options}))}),(null==i?void 0:i.id)&&(0,o.jsx)(S.Z,(0,y.Z)((0,b.Z)({},F),{name:"id",type:"hidden"}))]})};F.propTypes={complianceType:r.string,defaultValues:r.object,onSubmit:r.func.isRequired};var V=function(e){var n=e.entity,t=e.entityId,i=e.form,o={complianceId:i.complianceId.value,entityId:t,entity:n,expiryAt:i.expiryAt,insuranceAmount:i.insuranceAmount,regNum:i.regNum};return delete i.complianceId,delete i.expiryAt,delete i.insuranceAmount,delete i.regNum,o.meta=i,o},D=t(36769),E=new Date,L=(0,u.Z)(E,1),W=function(e){var n,t,r=e.entity,u=e.entityId,b=(0,s.useRouter)().query,y=(0,a.useContext)(m.Z),Z=(0,T.x)().hasRole,j=Z("supplier"),w=Z("tenant"),C=Z("customer"),I=(0,l.a)(d.Au,{variables:{entity:r,entityId:u}}),q=I.loading,A=I.data,S=(void 0===A?{job:null}:A).compliances,k=I.refetch,N=(0,i.Z)((0,c.D)(d.FD,{onCompleted:function(e){y.close(),k()}}),1)[0],_=(0,i.Z)((0,c.D)(d.YW,{onCompleted:function(e){y.close(),k()}}),1)[0],P=(0,i.Z)((0,c.D)(d.tC,{onCompleted:function(e){k()}}),1)[0],R=function(e){var n=V({entity:r,entityId:u,form:e});e.id?_({variables:{id:e.id,changes:n}}):N({variables:{objects:n}})},W=function(e){var n=e.row;y.show({content:(0,o.jsx)(g.G,{entity:"Compliance_Entity",entityId:null==n?void 0:n.id}),submit:!1,title:"Media"})},M=function(e){var n=e.e,t=e.row;n.stopPropagation(),y.show({content:(0,o.jsx)(F,{complianceType:"Account"===r?null:"regulatory",defaultValues:t,onSubmit:R}),title:"Compliance"})},O=function(e){P({variables:{id:e.row.id}})},z=[{hidden:!0},{hidden:!0},{text:"Name"},{text:"Registration number"},{formatter:x.FT,text:"Expiry date"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!!j,formatter:p.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:(n={editClick:function(e,n){return M({e:e,row:n})},mediaClick:function(e,n){return W({row:n})},deleteClick:function(e,n){return O({row:n})}}).editClick,tooltip:"Edit"},{context:"info",icon:["fas","file-upload"],onClick:n.mediaClick,tooltip:"Media"},{context:"danger",icon:["fas","trash"],onClick:n.deleteClick,tooltip:"Delete"}],text:"Actions"}],H=(0,o.jsx)(f.Z,{content:"Add Compliance",context:"secondary",onClick:function(e){return M({e:e})},size:"sm"});return!q&&(0,o.jsxs)(h.Z,{open:!0,title:"Compliances",toolbar:!j&&!w&&!C&&H,children:["Location"===r&&(0,o.jsx)(D.p,{locationId:u,hideFinance:w}),(0,o.jsx)(v.Z,{columns:z,rows:(t=S,b.overdue&&(t=S.filter(function(e){return new Date(e.expiryAt)<E})),b.upcoming&&(t=S.filter(function(e){return new Date(e.expiryAt)>E&&new Date(e.expiryAt)<L})),null==t?void 0:t.map(function(e){return{id:e.id,complianceId:{label:e.compliance.name,value:e.compliance.id,hasInsuranceAmount:e.compliance.hasInsuranceAmount,insuranceAmount:e.insuranceAmount,questions:e.compliance.questions,regNumExample:e.compliance.regNumExample},name:e.compliance.name,regNum:e.regNum,expiry:e.expiryAt,expiryAt:e.expiryAt?new Date(e.expiryAt):"",insuranceAmount:e.insuranceAmount,hasInsuranceAmount:e.compliance.hasInsuranceAmount,regNumExample:e.compliance.regNumExample,meta:e.meta,actions:""}}))})]})};W.propTypes={entity:r.string,entityId:r.number.isRequired}},98571:function(e,n,t){t.d(n,{eI:function(){return k},UH:function(){return y},Pd:function(){return C}});var i=t(85893),o=t(84059),a=t(45697),r=t.n(a),s=t(51233),l=t(11057),c=t(86532),d=t(22797),u=t(38895),m=t(15861),p=t(5616),f=t(27434),h=t(63441),v=t(63139),x=t(67294),g=function(e){var n=e.id,t=e.value,a=e.isExpandedByDefault,r=e.collapsible,g=(0,v.a)(),y=(0,x.useState)(a),Z=y[0],j=y[1],w=function(){return j(function(e){return!e})},C=function(e){e.stopPropagation();var t=document.querySelector("#qr-".concat(n," > canvas")).toDataURL(),i=document.createElement("a");i.href=t,i.download="".concat(n,".png"),document.body.appendChild(i),i.click(),document.body.removeChild(i)},I=(0,x.useMemo)(function(){var e={Main:s.Z,Header:s.Z,Body:s.Z};return r&&(e={Main:c.Z,Header:u.Z,Body:d.Z}),e},[r]);return(0,i.jsx)(p.Z,{children:(0,i.jsxs)(I.Main,{expanded:Z,onChange:w,children:[(0,i.jsx)(I.Header,{expandIcon:(0,i.jsx)(f.Z,{}),children:(0,i.jsxs)(s.Z,{width:"100%",direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,i.jsx)(m.Z,{variant:"h6",children:"QR Code"}),(0,i.jsx)(l.Z,{disabled:g,disableMinWidth:!0,size:"small",color:"info",variant:"contained",onClick:C,sx:b.downloadButton,children:(0,i.jsx)(h.Z,{sx:b.downloadIcon})})]})}),(0,i.jsx)(I.Body,{sx:b.body,children:(0,i.jsx)(s.Z,{id:"qr-".concat(n),alignItems:"center",children:(0,i.jsx)(o.Qd,{bgColor:"#ffffff",fgColor:"#000000",value:t,level:"H",size:256})})})]})})},b={downloadIcon:{height:"17px",width:"17px"},downloadButton:{mr:2},body:{marginTop:"20px"}};g.propTypes={id:r().string,value:r().string,isExpandedByDefault:r().bool,collapsible:r().bool},g.defaultProps={id:"new-qr-code",isExpandedByDefault:!1,collapsible:!0};var y=g,Z=t(93946),j=t(78394),w=function(e){var n=e.id,t=e.value,a=function(e){e.stopPropagation();var t=document.querySelector("#qr-".concat(n," > canvas")).toDataURL(),i=document.createElement("a");i.href=t,i.download="".concat(n,".png"),document.body.appendChild(i),i.click(),document.body.removeChild(i)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Z.Z,{onClick:a,size:"large",sx:{borderRadius:"10px!important",width:"130px"},children:(0,i.jsxs)(s.Z,{alignItems:"center",children:[(0,i.jsx)(j.Z,{sx:{width:"50px",height:"50px"},color:"secondary"}),(0,i.jsx)(m.Z,{children:"Qr Code"})]})}),(0,i.jsx)(s.Z,{id:"qr-".concat(n),alignItems:"center",display:"none",children:(0,i.jsx)(o.Qd,{style:{display:"none"},bgColor:"#ffffff",fgColor:"#000000",value:t,level:"H",size:256})})]})};w.propTypes={id:r().string,value:r().string},w.defaultProps={id:"new-qr-code",isExpandedByDefault:!1,collapsible:!0};var C=w,I=t(78566),q=t.n(I),A=t(28842),S=function(e){var n=e.id,t=e.value,o=function(e){e.stopPropagation();var t=document.querySelector("#barcode-".concat(n," > svg")).outerHTML,i=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(i),a=document.createElement("a");a.href=o,a.download="".concat(n,".svg"),document.body.appendChild(a),a.click(),document.body.removeChild(a)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Z.Z,{onClick:o,size:"large",sx:{borderRadius:"10px!important",width:"130px"},children:(0,i.jsxs)(s.Z,{alignItems:"center",children:[(0,i.jsx)(A.Z,{sx:{width:"50px",height:"50px"},color:"secondary"}),(0,i.jsx)(m.Z,{children:"Barcode"})]})}),(0,i.jsx)(s.Z,{id:"barcode-".concat(n),alignItems:"center",display:"none",children:(0,i.jsx)(q(),{value:"".concat(t),style:{display:"none"}})})]})};S.defaultProps={id:"asset",value:""},S.propTypes={id:r().string.isRequired,value:r().string.isRequired};var k=S},66264:function(e,n,t){t.d(n,{E:function(){return $}});var i=t(26042),o=t(69396),a=t(29815),r=t(85893),s=t(67294),l=t(45697),c=t.n(l),d=t(6812),u=t(42283),m=t(51233),p=t(90629),f=t(15861),h=t(11057),v=t(15033),x=t(12547),g=t(48580),b=t(828),y=t(79665),Z=t(50319),j=t(76600),w=t(55563),C=t(49501),I=t(95103),q=t(6710),A=t(21789),S=t(74231),k=S.Ry({id:S.Rx(),name:S.Z_(),description:S.Z_(),active:S.Z_().oneOf(["active","inactive"]).required(),locationId:S.Rx().required(),customerId:S.Rx().required()}),N=t(7297),_=t(75063);function P(){var e=(0,N.Z)(["\n  query GetSublocations($locationId: Int!, $active: Boolean) {\n    sublocations: Sublocation(\n      where: { locationId: { _eq: $locationId }, active: { _eq: $active } }\n    ) {\n      id\n      name\n      description\n      active\n      createdAt\n      updatedAt\n      location: Location {\n        id\n        name\n      }\n    }\n    meta: Sublocation_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return P=function(){return e},e}function R(){var e=(0,N.Z)(['\n  query GetSublocationDataForQrCode($locationId: Int!) {\n    sublocation: Sublocation(where: { locationId: { _eq: $locationId }, active: { _eq: true } }) {\n      id\n      name\n      location: Location {\n        id\n        name\n        customer: Account_Locations(where: { Account: { type: { _eq: "customer" } } }) {\n          account: Account {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n']);return R=function(){return e},e}function T(){var e=(0,N.Z)(["\n  mutation UpsertSublocation($objects: [Sublocation_insert_input!]!) {\n    insert_Sublocation(\n      objects: $objects\n      on_conflict: {\n        constraint: Sublocation_pkey\n        update_columns: [name, description, active, locationId]\n      }\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return T=function(){return e},e}var F=(0,_.Ps)(P()),V=(0,_.Ps)(R()),D=(0,_.Ps)(T()),E=t(5616),L=t(98456),W=function(e){var n=e.defaultValues,t=e.offCanvas,a=(0,u.cI)({defaultValues:n,resolver:(0,y.S)(k)}),s=a.control,l=a.errors,c=a.register,d=a.handleSubmit,m=(0,b.Z)((0,Z.D)(D,{refetchQueries:["GetSublocations"],onCompleted:function(){t&&t.close()}}),2),p=m[0],f=m[1].loading,h=function(e){var n=(0,o.Z)((0,i.Z)({},e),{active:"active"===e.active});delete n.customerId,p({variables:{objects:[n]}})},v={control:s,errors:l,register:c};return f?(0,r.jsx)(E.Z,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:(0,r.jsx)(L.Z,{})}):(0,r.jsxs)(j.Z,{id:"offCanvasForm",handleSubmit:d(h),children:[n.id&&(0,r.jsx)(w.Z,(0,o.Z)((0,i.Z)({},v),{name:"id",type:"hidden"})),(0,r.jsx)(C.Z,{label:"Customer",children:(0,r.jsx)(I.Z,(0,o.Z)((0,i.Z)({},v),{name:"customerId",options:n.customerOptions}))}),(0,r.jsx)(C.Z,{label:"Property",children:(0,r.jsx)(I.Z,(0,o.Z)((0,i.Z)({},v),{name:"locationId",options:n.locationOptions}))}),(0,r.jsx)(C.Z,{label:"Name",children:(0,r.jsx)(w.Z,(0,o.Z)((0,i.Z)({},v),{name:"name"}))}),(0,r.jsx)(C.Z,{label:"Description",children:(0,r.jsx)(q.Z,(0,o.Z)((0,i.Z)({},v),{name:"description",rows:3}))}),(0,r.jsx)(C.Z,{label:"Status",children:(0,r.jsx)(I.Z,(0,o.Z)((0,i.Z)({},v),{name:"active",options:A.bg}))})]})};W.defaultProps={defaultValues:{}},W.propTypes={defaultValues:c().shape({id:c().number,locationId:c().number.isRequired,customerId:c().number.isRequired,locationOptions:c().shape({text:c().string.isRequired,value:c().number.isRequired}).isRequired,customerOptions:c().shape({text:c().string.isRequired,value:c().number.isRequired}).isRequired,name:c().string,description:c().string,status:c().oneOf(["active","inactive"])})};var M=t(93884),O=t(20705),z=t(64872),H=t(5336),G=t(98571),Q=t(46003),B=function(e){var n=e.locationId,t=(0,d.a)(V,{variables:{locationId:n}}),i=t.data,o=(void 0===i?{sublocation:[]}:i).sublocation,a=t.loading,l=(0,s.useMemo)(function(){var e,n,t,i,r,s,l,c=null!==(l=null==o?void 0:o[0])&&void 0!==l?l:{};return c&&!a?"".concat(Q.C1.issueReportUrl,"?locationId=").concat(null==c?void 0:null===(e=c.location)||void 0===e?void 0:e.id,"&locationName=").concat(null==c?void 0:null===(n=c.location)||void 0===n?void 0:n.name,"&sublocationId=").concat(c.id,"&sublocationName=").concat(c.name,"&customerId=").concat(null==c?void 0:null===(t=c.location)||void 0===t?void 0:null===(i=t.customer)||void 0===i?void 0:i[0].account.id,"&customerName=").concat(null==c?void 0:null===(r=c.location)||void 0===r?void 0:null===(s=r.customer)||void 0===s?void 0:s[0].account.name):""},[a,o]);return(0,r.jsx)(m.Z,{children:(0,r.jsx)(G.UH,{id:"new-firstSublocation-qr-".concat(n),value:l,collapsible:!1})})};B.propTypes={locationId:c().string},B.defaultProps={};var U=t(18586),$=function(e){var n,t=e.location,l=e.customer,c=(0,s.useRef)(),b=(0,z.a)(),y=(0,U.q)(),Z=(0,u.cI)({defaultValues:{status:{label:"Active",value:"active"}}}),j=Z.control,w=Z.watch,C=(0,s.useState)({active:!0}),I=C[0],q=C[1],A=(0,O.x)({filters:I}).initialData,S=w("status"),k=(0,d.a)(F,{variables:(0,o.Z)((0,i.Z)({},A),{locationId:t.id})}),N=k.data,_=void 0===N?{sublocations:[],meta:{aggregate:{totalCount:0}}}:N,P=_.sublocations,R=_.meta,T=k.loading,V=k.refetch;(0,s.useEffect)(function(){q({active:(null==S?void 0:S.value)==="active"})},[null==S?void 0:S.value]);var D=function(e){e.stopPropagation();var n={customerOptions:[{value:l.id,text:l.name}],locationOptions:[{value:t.id,text:t.name}],customerId:l.id,locationId:t.id};b.show({content:(0,r.jsx)(W,{defaultValues:n,offCanvas:b}),title:"Add sublocation"})},E=function(e,n){e.stopPropagation();var i={id:n.id,name:n.name,description:n.description,active:n.item.active?"active":"inactive",customerOptions:[{value:l.id,text:l.name}],locationOptions:[{value:t.id,text:t.name}],customerId:l.id,locationId:t.id};b.show({content:(0,r.jsx)(W,{defaultValues:i,offCanvas:b}),title:"Edit sublocation"})},L=function(e){e.stopPropagation(),b.show({content:(0,r.jsx)(B,{locationId:t.id}),title:"Sublocation info",submit:!1})},G=function(e){var n,t;return[{context:"secondary",icon:"edit",onClick:function(n){return E(n,e)},tooltip:"Edit"}].concat((0,a.Z)((null==y?void 0:null===(n=y.admin)||void 0===n?void 0:null===(t=n.modules)||void 0===t?void 0:t.nonLoggedUser)?[{context:"secondary",icon:"info",onClick:L,tooltip:"Info"}]:[]))},Q=function(){return P.map(function(e){return{name:e.name,locationName:e.location.name,description:e.description,status:e.active?"Active":"Inactive",actions:"",id:e.id,locationId:e.location.id,item:e}})};return(0,r.jsxs)(m.Z,{width:"100%",spacing:2,sx:{height:"100%"},children:[(0,r.jsxs)(m.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,r.jsx)(u.Qr,{name:"status",control:j,render:function(e){var n=e.value,t=e.onChange;return(0,r.jsx)(g.q,{value:n,disableClearable:!0,textFieldProps:{color:"secondary",variant:"standard",label:"Select status"},sx:{width:"200px"},onChange:function(e,n){return t(n)},options:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}]})}}),(0,r.jsx)(h.Z,{variant:"contained",color:"secondary",onClick:D,children:"Create Sublocation"})]}),(0,r.jsxs)(p.Z,{sx:{padding:"16px 0px",height:"calc(90vh - 52px)"},children:[(0,r.jsx)(f.Z,{ml:2,variant:"h5",sx:{fontWeight:600,marginBottom:"15px"},children:"Sublocations"}),(null===(n=Q())||void 0===n?void 0:n.length)?(0,r.jsx)(v.i,{ref:c,loading:T,columns:[{headerName:"Name",field:"name",flex:1},{headerName:"Location",field:"locationName",flex:1,minWidth:200,renderCell:function(e){var n=e.row;return(0,r.jsx)(x.r,{color:"secondary",noWrap:!(null==n?void 0:n.locationId),children:(null==n?void 0:n.locationName)||"-"})}},{headerName:"Description",field:"description",flex:1},{headerName:"Status",field:"status",flex:1},{headerName:"Actions",field:"actions",flex:1,renderCell:function(e){var n=e.row;return(0,r.jsx)(H.C,{row:n,actionsData:G})}}],rows:Q(),meta:R,refetch:V,autoHeight:!1,containerHeight:"calc(100% - 52px)"}):!T&&(0,r.jsx)(M.C,{imageSrc:"/static/icons/no_locations_found.svg",title:"No sublocations",subtitleFirstLine:"You currently have no sublocations set up in the system",subtitleSecondLine:"Click\xa0create sublocation\xa0to get started building.",buttonText:"Create sublocation",onAction:D})]})]})};$.defaultProps={customer:{},location:{}},$.propTypes={customer:c().object.isRequired,location:c().object.isRequired}},14272:function(e,n,t){t.d(n,{f:function(){return j}});var i=t(26042),o=t(69396),a=t(85893),r=t(67294),s=t(45697),l=t(58594),c=t(28497),d=t(55563),u=t(90951),m=t(95103),p=t(6710),f=t(78289),h=t(23233),v=t(49501),x=t(77439),g=t(40826),b=t(21300),y=t(35418),Z={checkbox:l.Z,currencyInput:c.Z,datepicker:b.M,input:d.Z,radio:u.Z,select:m.Z,textArea:p.Z,selectRange:m.Z},j=function(e){var n=e.control,t=e.entity,s=e.entityId,l=e.errors,c=e.input,d=e.inputType,u=e.key,m=e.label,p=e.mediaMeta,b=e.name,j=e.options,w=e.register,C=(0,r.useContext)(f.Z),I="select"===c&&j.length>0,q=["checkbox","radio"].includes(c)&&j.length>0,A=(0,o.Z)((0,i.Z)({control:n},q&&{data:j},I&&{options:j.map(function(e){return(0,o.Z)((0,i.Z)({},e),{text:e.label})})},"selectRange"===c&&{range:[10,0]}),{errors:l,key:u,label:h.Z.camelize(m),name:b,register:w,type:q?c:d,minDate:"2020-04-19T08:29:04.839Z"}),S=function(){C.show({content:t&&s&&(0,a.jsx)(y.G,{entity:t,entityId:s,mediaMeta:p,category:"supplierQuestion"}),submit:!1,title:m})},k=Z[c];return(0,a.jsx)(a.Fragment,{children:"currencyInput"===c?(0,a.jsx)(v.Z,{label:m,children:(0,a.jsx)(k,(0,o.Z)((0,i.Z)({},A),{label:""}))}):(0,a.jsx)(a.Fragment,{children:"media"===c?(0,a.jsx)(v.Z,{label:m,children:(0,a.jsx)(x.Z,{context:"info",content:(0,a.jsx)(g.Z,{icon:"file-upload"}),onClick:S,size:"sm"})}):(0,a.jsx)(v.Z,{label:m,children:(0,a.jsx)(k,(0,i.Z)({},A))})})})};j.propTypes={control:s.object.isRequired,entity:s.string,entityId:s.number,errors:s.object.isRequired,input:s.string,inputType:s.string,key:s.string,label:s.string.isRequired,mediaMeta:s.object,name:s.string.isRequired,options:s.array,register:s.func.isRequired},j.defaultProps={input:"input",options:[],inputType:"text",label:"label"}}}]);