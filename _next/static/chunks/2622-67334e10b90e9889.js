"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2622],{13304:function(n,e,t){var a=t(64836);e.Z=void 0;var r=a(t(64938)),i=t(85893);e.Z=(0,r.default)((0,i.jsx)("path",{d:"M18 16v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1zm-5 0h-2v-2h2zm0-4h-2V8h2zm-1 10c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2"}),"NotificationImportant")},6054:function(n,e,t){var a=t(67294),r=function(n){var e=(0,a.useRef)();return(0,a.useEffect)(function(){e.current=n}),e.current};e.Z=r},24262:function(n,e,t){t.d(e,{Z:function(){return a}});function a(n){var e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return e.setUTCFullYear(n.getFullYear()),n.getTime()-e.getTime()}},83946:function(n,e,t){t.d(e,{Z:function(){return a}});function a(n){if(null===n||!0===n||!1===n)return NaN;var e=Number(n);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}},11640:function(n,e,t){t.d(e,{Z:function(){return o}});var a=t(83946),r=t(19013),i=t(13882);function o(n,e){(0,i.Z)(2,arguments);var t=(0,r.Z)(n),o=(0,a.Z)(e);if(isNaN(o))return new Date(NaN);if(!o)return t;var u=t.getDate(),s=new Date(t.getTime());return(s.setMonth(t.getMonth()+o+1,0),u>=s.getDate())?s:(t.setFullYear(s.getFullYear(),s.getMonth(),u),t)}},83894:function(n,e,t){t.d(e,{Z:function(){return i}});var a=t(19013),r=t(13882);function i(n){(0,r.Z)(1,arguments);var e=(0,a.Z)(n);return e.setHours(23,59,59,999),e}},23855:function(n,e,t){t.d(e,{Z:function(){return d}});var a=t(83946),r=t(13882),i={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},o=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,u=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,s=/^([+-])(\d{2})(?::?(\d{2}))?$/;function d(n,e){(0,r.Z)(1,arguments);var t,d,f=e||{},v=null==f.additionalDigits?2:(0,a.Z)(f.additionalDigits);if(2!==v&&1!==v&&0!==v)throw RangeError("additionalDigits must be 0, 1 or 2");if(!("string"==typeof n||"[object String]"===Object.prototype.toString.call(n)))return new Date(NaN);var g=function(n){var e,t={},a=n.split(i.dateTimeDelimiter);if(a.length>2)return t;if(/:/.test(a[0])?(t.date=null,e=a[0]):(t.date=a[0],e=a[1],i.timeZoneDelimiter.test(t.date)&&(t.date=n.split(i.timeZoneDelimiter)[0],e=n.substr(t.date.length,n.length))),e){var r=i.timezone.exec(e);r?(t.time=e.replace(r[1],""),t.timezone=r[1]):t.time=e}return t}(n);if(g.date){var y=function(n,e){var t=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),a=n.match(t);if(!a)return{year:null};var r=a[1]&&parseInt(a[1]),i=a[2]&&parseInt(a[2]);return{year:null==i?r:100*i,restDateString:n.slice((a[1]||a[2]).length)}}(g.date,v);t=function(n,e){if(null===e)return null;var t=n.match(o);if(!t)return null;var a=!!t[4],r=c(t[1]),i=c(t[2])-1,u=c(t[3]),s=c(t[4]),d=c(t[5])-1;if(a){return(l=e,f=s,v=d,f>=1&&f<=53&&v>=0&&v<=6)?(g=e,y=s,_=d,h=new Date(0),h.setUTCFullYear(g,0,4),I=h.getUTCDay()||7,h.setUTCDate(h.getUTCDate()+((y-1)*7+_+1-I)),h):new Date(NaN)}var l,f,v,g,y,_,h,I,b,$,q,Z,x,S=new Date(0);return(b=e,$=i,q=u,$>=0&&$<=11&&q>=1&&q<=(m[$]||(p(b)?29:28))&&(Z=e,x=r,x>=1&&x<=(p(Z)?366:365)))?(S.setUTCFullYear(e,i,Math.max(r,u)),S):new Date(NaN)}(y.restDateString,y.year)}if(isNaN(t)||!t)return new Date(NaN);var _=t.getTime(),h=0;if(g.time&&(isNaN(h=function(n){var e=n.match(u);if(!e)return null;var t,a,r,i=l(e[1]),o=l(e[2]),s=l(e[3]);return(t=i,a=o,r=s,24===t?0===a&&0===r:r>=0&&r<60&&a>=0&&a<60&&t>=0&&t<25)?36e5*i+6e4*o+1e3*s:NaN}(g.time))||null===h))return new Date(NaN);if(g.timezone){if(isNaN(d=function(n){if("Z"===n)return 0;var e=n.match(s);if(!e)return 0;var t,a,r="+"===e[1]?-1:1,i=parseInt(e[2]),o=e[3]&&parseInt(e[3])||0;return(t=i,a=o,a>=0&&a<=59)?r*(36e5*i+6e4*o):NaN}(g.timezone)))return new Date(NaN)}else{var I=new Date(_+h),b=new Date(0);return b.setFullYear(I.getUTCFullYear(),I.getUTCMonth(),I.getUTCDate()),b.setHours(I.getUTCHours(),I.getUTCMinutes(),I.getUTCSeconds(),I.getUTCMilliseconds()),b}return new Date(_+h+d)}function c(n){return n?parseInt(n):1}function l(n){return n&&parseFloat(n.replace(",","."))||0}var m=[31,null,31,30,31,30,31,31,30,31,30,31];function p(n){return n%400==0||n%4==0&&n%100}},43703:function(n,e,t){t.d(e,{Z:function(){return i}});var a=t(19013),r=t(13882);function i(n){(0,r.Z)(1,arguments);var e=(0,a.Z)(n);return e.setDate(1),e.setHours(0,0,0,0),e}},38148:function(n,e,t){t.d(e,{Z:function(){return i}});var a=t(19013),r=t(13882);function i(n){(0,r.Z)(1,arguments);var e=(0,a.Z)(n),t=new Date(0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}},25993:function(n,e,t){t.d(e,{V:function(){return J}});var a=t(47568),r=t(26042),i=t(69396),o=t(828),u=t(97582),s=t(85893),d=t(67294),c=t(45697),l=t(6812),m=t(50319),p=t(51809),f=t(11163),v=t.n(f),g=t(42283),y=t(79665),_=t(76600),h=t(15214),I=t(9270),b=t(62140),$=t(49501),q=t(55563),Z=t(6710),x=t(95103),S=t(84043),A=t(11057),D=t(69368),w=t(50480),j=t(6054),C=t(66812),N=function(n){var e=n.accountId,t=n.accountName,a=n.canSelectAccount,o=n.control,u=n.errors,c=n.setValue,l=n.watch,m=e?{value:e,label:t}:l("propertyOwner"),p=(0,j.Z)(m),f=function(n){c("contactUser",null)};(0,d.useEffect)(function(){m!==p&&p&&f(m)},[m]);var v={control:o,errors:u};return(0,s.jsxs)(I.Z,{children:[(0,s.jsx)(b.Z,{md:6,children:(0,s.jsx)(C.P,(0,i.Z)((0,r.Z)({},v),{defaultValue:e&&{value:e,label:t},errors:(0,r.Z)({},u),isDisabled:!a,label:"Client",name:"propertyOwner",placeholder:"Select",type:"customer"}))}),(0,s.jsx)(b.Z,{md:6,children:(0,s.jsx)(C.P,(0,i.Z)((0,r.Z)({},v),{accountId:(null==m?void 0:m.value)||null,errors:(0,r.Z)({},u),isDisabled:!m,label:"Contact Name",name:"contactUser",placeholder:m?"Select":"Select the location owner",type:"user"}))})]})};N.propTypes={accountId:c.number,accountName:c.string,canSelectAccount:c.bool.isRequired,control:c.func.isRequired,errors:c.object.isRequired,setValue:c.func.isRequired,watch:c.func.isRequired};var k=t(22595),T=function(n,e){var t=n.propertyOwner,a=n.contactUser;return n.Account_Locations={data:{accountId:t.value}},delete n.propertyOwner,n.contactUserId=(null==a?void 0:a.value)||null,delete n.contactUser,e&&delete n.Account_Locations,n},U=function(n,e,t,a){var r={location:T(n,!0),locationId:e.locationId,accountId:e.accountId,newAccountId:e.newAccountId,hasChanged:e.hasChanged};a({variables:r})},F=t(74231),L=t(46602),R=t(21789),M=t(2845),P=t(64872),E="/dashboard/properties/",J=function(n){var e,t,c,f,j=n.accountId,C=n.accountName,J=n.entity,z=n.data,O=n.refetch,Q=n.onAddressCreated,V=n.isPropsComponent,H=n.initialValues,W=n.xeroContactId,B=n.displayXeroContacts,Y=n.xeroContacts,G=n.displaySignin,X=n.handleXeroAuthorize,K=n.onClose,nn=(0,P.a)(),ne=(0,M.x)().hasRole,nt=(0,d.useState)(!1),na=nt[0],nr=nt[1],ni=null==Y?void 0:Y.find(function(n){return n.value===W}),no=(0,i.Z)((0,r.Z)({},z?(location.propertyOwner={label:z.customer[0].account.name,value:z.customer[0].account.id},location.contactUser=(null==z?void 0:z.user)&&z.customer[0].account.id&&{label:z.user.fullName,value:z.user.id},location.access=z.access,location.name=z.name,location.status=z.status,location.permitsRequired=z.permitsRequired,location):{},H),{xeroContact:ni})||{},nu=(0,g.cI)({defaultValues:no,resolver:(0,y.S)((0,F.Ry)().shape({access:(0,F.Z_)().required(),contactUser:(0,F.Ry)().required(),name:(0,F.Z_)().required(),propertyOwner:(0,F.Ry)().required(),status:ne("admin")&&(0,F.Z_)().required(),permitsRequired:(0,F.O7)()}))}),ns=nu.control,nd=nu.errors,nc=nu.handleSubmit,nl=nu.register,nm=nu.setValue,np=nu.getValues,nf=nu.watch,nv=(0,l.a)(p.yf,{variables:{id:null==z?void 0:z.id},skip:!(null==z?void 0:z.id)}).data,ng=(void 0===nv?{property:{}}:nv).property,ny=(c=(0,a.Z)(function(n){var e,t,a,i,o,s,d,c,l,m,p;return(0,u.__generator)(this,function(o){switch(o.label){case 0:var u,d;return e=n.addressFormData,t=n.outerFormData,a={Addresses:{data:{Address:{data:(0,r.Z)({},e)},entity:J}}},i=(0,r.Z)({},np(),a,t),ne("customer")&&(i.status="active"),[4,nI({variables:{objects:[T(u=i)]}})];case 1:return p=void 0===(m=(void 0===(c=(void 0===(s=o.sent().data)?{}:s).insert_Location)?{}:c).returning)?{}:m,Q&&Q(p),nn.close(),[2]}})}),function(n){return c.apply(this,arguments)}),n_=(f=(0,a.Z)(function(n){return(0,u.__generator)(this,function(e){return nn.show({title:"Add new address",content:(0,s.jsx)(L.k,{onCancel:function(){},onSubmit:function(e){ny({addressFormData:e,outerFormData:n})},type:"text"}),submit:!1}),[2]})}),function(n){return f.apply(this,arguments)}),nh=(0,o.Z)((0,m.D)(p.A1,{onCompleted:function(n){if(!V){var e=n.insert_Location.returning[0].id;nn.close(),O?O():v().push("".concat(E,"view?id=").concat(e))}}}),2),nI=nh[0],nb=nh[1].loading,n$=(0,o.Z)((0,m.D)(p.$A,{onCompleted:function(n){var e=n.update_Location_by_pk.id;nn.close(),O?O():v().push("".concat(E,"view?id=").concat(e))}}),2),nq=n$[0],nZ=n$[1].loading,nx=(0,o.Z)((0,m.D)(p.$E),1)[0],nS=function(n){if(nr(!1),z){if("inactive"===n.status&&!(e=ng.jobs).every(function(n){return!!(0,k.E)(n,["completed","closed"])})){nr(!0);return}n.xeroContact&&nx({variables:{id:null===(u=null==z?void 0:z.customer[0])||void 0===u?void 0:u.account.id,changes:{meta:(0,i.Z)((0,r.Z)({},null===(s=null==z?void 0:z.customer[0])||void 0===s?void 0:s.account.meta),{xeroContactId:n.xeroContact.value})}}});var e,t,a,o,u,s,d={locationId:null==z?void 0:z.id,accountId:null===(t=null==z?void 0:z.customer[0])||void 0===t?void 0:t.account.id,newAccountId:null==n?void 0:null===(a=n.propertyOwner)||void 0===a?void 0:a.value,hasChanged:(null===(o=null==z?void 0:z.customer[0])||void 0===o?void 0:o.account.id)!==(null==n?void 0:n.propertyOwner.value)};U((0,i.Z)((0,r.Z)({},n),{xeroContact:void 0}),d,z.id,nq),K()}else n_(n),K()},nA={control:ns,errors:nd,register:nl};return(0,s.jsxs)(_.Z,{disabled:nb||nZ,id:"offCanvasForm",handleSubmit:nc(nS),children:[na&&(0,s.jsx)(h.Z,{context:"info",content:" This location cannot be made inactive, it has active jobs."}),(0,s.jsx)(I.Z,{children:(0,s.jsx)(b.Z,{md:12,children:(0,s.jsx)(N,(0,i.Z)((0,r.Z)({},nA),{accountId:j,accountName:C,canSelectAccount:!j,setValue:nm,watch:nf}))})}),(0,s.jsx)($.Z,{label:"Name",children:(0,s.jsx)(q.Z,(0,i.Z)((0,r.Z)({},nA),{name:"name"}))}),(0,s.jsx)($.Z,{label:"Access information",children:(0,s.jsx)(Z.Z,(0,i.Z)((0,r.Z)({},nA),{name:"access",rows:4}))}),ne("admin")&&(0,s.jsx)($.Z,{label:"Status",children:(0,s.jsx)(x.Z,(0,i.Z)((0,r.Z)({},nA),{name:"status",options:R.bg}))}),(0,s.jsx)(g.Qr,{name:"permitsRequired",control:ns,render:function(n){var e=n.value,t=n.onChange;return(0,s.jsx)(w.Z,{control:(0,s.jsx)(D.Z,{color:"secondary",checked:e||!1,onChange:function(n){return t(n.target.checked)}}),label:"Permits required"})}}),ne("admin")&&void 0!==B&&B&&(0,s.jsx)($.Z,{label:"Xero Contact",children:G?(0,s.jsx)(A.Z,{variant:"contained",onClick:function(){X()},children:"Connect to Xero to select Contact"}):(0,s.jsx)(S.Z,(0,i.Z)((0,r.Z)({options:Y},nA),{name:"xeroContact"}))})]})};N.propTypes={accountId:c.number,accountName:c.string,data:c.object,refetch:c.func,offCanvas:c.func}},51809:function(n,e,t){t.d(e,{$A:function(){return v},$E:function(){return g},A1:function(){return f},Un:function(){return p},yf:function(){return y}});var a=t(7297),r=t(75063);function i(){var n=(0,a.Z)(["\n  query GetProperty($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      contactUserId\n      name\n      access\n      contactUser: User {\n        id\n        nameFirst\n        nameLast\n      }\n      propertyOwner: Account_Locations {\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return i=function(){return n},n}function o(){var n=(0,a.Z)(['\n  query GetMapProperties {\n    properties: Location {\n      id\n      access\n      createdAt\n      name\n      contactUserId\n      addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      bookings: Jobs {\n        id\n        title\n        createdAt\n        customerId\n        amount\n        locationId\n        managerId\n        quoteNumber\n        reference\n        status\n        serviceId\n        meta\n        customer: Customer {\n          id\n          name\n        }\n        location: Location {\n          id\n          name\n          addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n            id\n            registered\n            operating\n            trading\n            invoice\n            status\n            createdAt\n            address: Address {\n              id\n              name\n              addressLine1\n              addressLine2\n              addressLine3\n              city\n              county\n              geo\n              postCode\n              country: Country {\n                id\n                name\n              }\n            }\n          }\n        }\n        manager: Manager {\n          id\n          nameFirst\n          nameLast\n        }\n        sla: SLA {\n          id\n          name\n          notes\n        }\n        supplier: Supplier {\n          id\n          companyNumber\n          createdAt\n          name\n          status\n          type\n          updatedAt\n          website\n          clientType\n          managerId\n          vatId\n          meta\n          media: Media {\n            id\n            medium: Medium {\n              id\n              category\n              filename\n              meta\n              type\n            }\n          }\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n        supplierOffers: SupplierOffers {\n          status\n          rate\n          supplier: Supplier {\n            id\n            companyNumber\n            createdAt\n            name\n            status\n            type\n            updatedAt\n            website\n            clientType\n            managerId\n            vatId\n            meta\n            media: Media {\n              id\n              medium: Medium {\n                id\n                category\n                filename\n                meta\n                type\n              }\n            }\n            manager: Manager {\n              id\n              fullName\n            }\n          }\n        }\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n']);return o=function(){return n},n}function u(){var n=(0,a.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return u=function(){return n},n}function s(){var n=(0,a.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]);return s=function(){return n},n}function d(){var n=(0,a.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return d=function(){return n},n}function c(){var n=(0,a.Z)(["\n  mutation UpdateLocation($id: Int!, $changes: Location_set_input) {\n    update_Location_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return c=function(){return n},n}function l(){var n=(0,a.Z)(["\n  query GetAccountName($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n    }\n  }\n"]);return l=function(){return n},n}function m(){var n=(0,a.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]);return m=function(){return n},n}(0,r.Ps)(i());var p=(0,r.Ps)(o()),f=(0,r.Ps)(u()),v=(0,r.Ps)(s()),g=(0,r.Ps)(d());(0,r.Ps)(c()),(0,r.Ps)(l());var y=(0,r.Ps)(m())},6924:function(n,e,t){t.d(e,{r:function(){return $}});var a=t(26042),r=t(69396),i=t(828),o=t(7297),u=t(85893),s=t(67294),d=t(45697),c=t(52019),l=t(9270),m=t(62140),p=t(49501),f=t(84043),v=t(22244),g=t(66812),y=t(21300),_=t(83894),h=t(10367),I=t(92148);function b(){var n=(0,o.Z)(["\n  div > div > div {\n    background: ",";\n  }\n  div > div {\n    background: ",";\n  }\n"]);return b=function(){return n},n}var $=function(n){var e=n.control,t=n.errors,o=n.initialValues,d=n.register,f=n.setFilters,h=n.setValue,b=n.watch,$=(0,s.useContext)(c.Z).hasRole,Z={control:e,errors:t,register:d},x=b("customerId"),S=b("supplierId"),A=b("startDate"),D=b("userId"),w=!o.customerId;(0,s.useEffect)(function(){var n=(0,i.Z)(j.filter(function(n){return"quoteOffered"===n.value}),1)[0];f(function(e){return(0,r.Z)((0,a.Z)({},e),{status:A?[n.value]:null})}),h("status",A?[n]:null)},[A]);var j=v.iz.map(function(n){return $("supplier")?{label:n.supplierText,value:n.value}:$("customer")?{label:n.customerText,value:n.value}:{label:n.text,value:n.value}}).filter(function(n){return null!==n.label});(0,s.useEffect)(function(){w&&f(function(n){return(0,r.Z)((0,a.Z)({},n),{customerId:(null==x?void 0:x.value)||null})})},[x]),(0,s.useEffect)(function(){w&&f(function(n){return(0,r.Z)((0,a.Z)({},n),{supplierId:(null==S?void 0:S.value)||null})})},[S]),(0,s.useEffect)(function(){f(function(n){return(0,r.Z)((0,a.Z)({},n),{userId:"number"==typeof D?D:(null==D?void 0:D.value)||null})})},[D]);var C=function(n){var e=n.map(function(n){return n.value});f(function(n){return(0,r.Z)((0,a.Z)({},n),{status:e.length>0?e:null})}),h("status",n)};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(l.Z,{children:[(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(y.M,(0,r.Z)((0,a.Z)({},Z),{name:"startDate",onChange:function(n){f(function(e){return(0,r.Z)((0,a.Z)({},e),{startDate:n||null})}),h("startDate",n)},placeholder:"Quote offered date"}))}),(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(y.M,(0,r.Z)((0,a.Z)({},Z),{name:"endDate",onChange:function(n){var e=n?(0,_.Z)(n):n;f(function(n){return(0,r.Z)((0,a.Z)({},n),{endDate:e})}),h("endDate",e)},placeholder:"Quote due date"}))})]}),(0,u.jsxs)(l.Z,{align:"baseline",children:[(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(p.Z,{label:null,children:(0,u.jsx)(q,(0,r.Z)((0,a.Z)({},Z),{isDisabled:Boolean(A),placeholder:"Select status",name:"status",isMulti:Boolean(!A),onChange:C,options:j}))})}),!$(["customer","supplier"])&&(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(g.P,(0,r.Z)((0,a.Z)({},Z),{label:"",name:"customerId",placeholder:"Select customer",isClearable:!0,type:"customer"}))}),$(I.n)&&(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(g.P,(0,r.Z)((0,a.Z)({},Z),{errors:(0,a.Z)({},t),label:"",userId:o.userId,name:"userId",placeholder:"Select user",type:"user"}))})]}),!$(["supplier","customer"])&&!A&&(0,u.jsx)(l.Z,{children:(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(g.P,(0,r.Z)((0,a.Z)({},Z),{label:"",name:"supplierId",isClearable:!0,placeholder:"Select supplier",type:"supplier"}))})})]})},q=(0,h.ZP)(f.Z).withConfig({displayName:"filter__StyledSelect",componentId:"sc-285617a5-0"})(b(),function(n){return n.isDisabled&&"#dddddd"},function(n){return n.isDisabled&&"#dddddd"});$.propTypes={errors:d.object.isRequired,register:d.func.isRequired,setFilters:d.func.isRequired}},26576:function(n,e,t){t.d(e,{w:function(){return v},L:function(){return f}});var a=t(7297),r=t(75063),i=t(45815),o=t(85488),u=t(66312);function s(){var n=(0,a.Z)(["\n  fragment QuoteFields on Job {\n    quoteNumber\n    quoteDue\n    quoteCharge\n  }\n"]);return s=function(){return n},n}function d(){var n=(0,a.Z)(["\n  query Quote($id: Int!) {\n    job: Job_by_pk(id: $id) {\n      id\n      title\n      description\n      costCategory\n      status\n      workStatus\n      scheduledAt\n      createdAt\n      customerId\n      customerUserId\n      locationId\n      managerId\n      parentId\n      serviceId\n      slaId\n      tenantId\n      reference\n      amount\n      accountByTenantid {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customer: Account {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        vat\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n      }\n      messages: Messages {\n        id\n        message\n        priority\n        taskId\n        jobId\n        locationId\n        description\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n      }\n      supplier: Suplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      manager: Manager {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return d=function(){return n},n}var c=(0,r.Ps)(s());(0,r.Ps)(d());var l=t(75327);function m(){var n=(0,a.Z)(["\n  query GetQuotes(\n    $endDate: timestamptz\n    $limit: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $type: String\n  ) {\n    quotes: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobSupplierFields\n      ...QuoteFields\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      timings: JobTimings {\n        id\n        status\n        notes\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return m=function(){return n},n}function p(){var n=(0,a.Z)(["\n  query GetQuotes(\n    $customerId: Int\n    $date: timestamptz\n    $endDate: timestamptz\n    $limit: Int\n    $locationId: Int\n    $managerId: Int\n    $customerManagerId: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $supplierId: Int\n    $type: String\n    $userId: Int\n  ) {\n    quotes: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        ",'\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        type: { _eq: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        Customer: { managerId: { _eq: $customerManagerId } }\n        supplierId: { _eq: $supplierId }\n        quoted: { _eq: true }\n        customerUserId: { _eq: $userId }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobAdminFields\n      ...QuoteFields\n      statusLog\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n        lineItems: SupplierQuoteLineItems {\n          id\n          qty\n          total\n        }\n      }\n      supplier: Supplier {\n        ...AccountFields\n      }\n      admin: Admin {\n        id\n        name\n      }\n      customer: Customer {\n        ...AccountFields\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      service: Service {\n        id\n        name\n      }\n      timings: JobTimings {\n        id\n        status\n        notes\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: {\n            _and: [\n              {status: { _eq: "active" }}\n              {type: { _eq: "tags" }}\n            ]\n          }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        ',"\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        Customer: { managerId: { _eq: $customerManagerId } }\n        supplierId: { _eq: $supplierId }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n        customerUserId: { _eq: $userId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return p=function(){return n},n}var f=(0,r.Ps)(m(),i.z,o.aL,c,o.H_,l.Px),v=function(n){var e=n.tagsWhere;return(0,r.Ps)(p(),e,e,i.z,u.WW,o.aL,o.wd,c,l.Px)}},93243:function(n,e,t){t.d(e,{v:function(){return X}});var a=t(26042),r=t(69396),i=t(828),o=t(7297),u=t(29815),s=t(85893),d=t(67294),c=t(45697),l=t(11163),m=t.n(l),p=t(6812),f=t(73359),v=t(57460),g=t.n(v),y=t(78289),_=t(62466),h=t(11082),I=t(26186),b=t(68956),$=t(16551),q=t(55843),Z=t(77439),x=t(40826),S=t(11585),A=t(26576),D=t(42608),w=t(83894),j=t(23855),C=function(n,e,t,r){var i=n.limit,o=n.offset,u=n.orderBy,s=n.q,d=n.status,c=n.tagsWhere;return t.hasOwnProperty("tileName")?{query:D.Z,variables:(0,a.Z)({q:null,accountId:null,userId:null,currentUserId:null==e?void 0:e.id,asAt:(0,w.Z)((0,j.Z)(r.asAt)),tileName:null==t?void 0:t.tileName,limit:50,offset:0,orderBy:{jobId:"desc"},monthStart:r.monthStart,dayStart:r.todayStart,yearStart:r.yearStart,adminId:null==e?void 0:e.adminId},n)}:"supplier"===e.accountType?{query:A.L,variables:(0,a.Z)({limit:i,offset:o,orderBy:u,q:s,status:d},n)}:{query:(0,A.w)({tagsWhere:c}),variables:(0,a.Z)({},n)}},N=t(91272),k=t(22244),T=t(97768),U=t(45416),F=t(2845),L=t(18586),R=t(9492),M=t(20705),P=t(63139),E=t(95465),J=t(43703),z=t(69119),O=t(38148),Q=function(n){var e=(0,J.Z)(n),t=(0,z.Z)(n),a=(0,w.Z)(n),r=(0,O.Z)(n);return{monthStart:e,todayEnd:a,todayStart:t,yearStart:r}},V=t(13304),H=t(66137),W=t(10367);function B(){var n=(0,o.Z)(["\n  cursor: pointer;\n  margin: 2px 0px;\n  padding: 8px 5px;\n  color: rgb(41, 41, 204);\n  background-color: transparent;\n  border: none;\n  &:hover {\n    background-color: #dddddd;\n    border-radius: 5px;\n  }\n"]);return B=function(){return n},n}function Y(){var n=(0,o.Z)(["\n  line-height: 1.5em;\n  height: 3em;\n  overflow: hidden;\n"]);return Y=function(){return n},n}function G(){var n=(0,o.Z)(["\n  white-space: nowrap;\n"]);return G=function(){return n},n}var X=function(n){var e,t,o,c,v,A=n.filters,D=(0,d.useContext)(y.Z),w=(0,L.q)(),j=(0,l.useRouter)().query,J=(0,d.useState)(!1),z=J[0],O=J[1],W=null===(e=w.admin)||void 0===e?void 0:null===(t=e.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,B=null===(o=w.admin)||void 0===o?void 0:null===(c=o.jobSetting)||void 0===c?void 0:c.jobNumberSuffix,Y=(0,F.x)(),G=Y.hasRole,X=Y.user,nt=(0,M.x)({filters:A}),na=nt.initialData,nr=nt.ref,ni=(0,r.Z)((0,a.Z)({},na),{managerId:A.managerId?X.id:null,tagsWhere:(0,H.Y)(na.tags)}),no=new Date(j.asAt),nu=(0,d.useState)({monthStart:Q(no).monthStart,todayEnd:Q(no).todayEnd,todayStart:Q(no).todayStart,yearStart:Q(no).yearStart,asAt:j.asAt}),ns=nu[0],nd=nu[1];(0,d.useEffect)(function(){var n,e=Q(no),t=e.monthStart,a=e.todayEnd;nd({monthStart:t,todayEnd:a,todayStart:e.todayStart,yearStart:e.yearStart,asAt:j.asAt})},[null==A?void 0:A.asAt]);var nc=C(ni,X,j,ns),nl=nc.query,nm=nc.variables;"Accepted"===nm.status?(nm.type="reactive",delete nm.status):delete nm.type;var np=(0,p.a)(nl,{variables:nm}),nf=np.data,nv=void 0===nf?{quotes:[],meta:{aggregate:{totalCount:0}}}:nf,ng=nv.quotes,ny=nv.meta,n_=np.loading,nh=np.refetch,nI=(0,i.Z)((0,f.t)(nl,{variables:(0,r.Z)((0,a.Z)({},nm),{limit:(null==ny?void 0:null===(v=ny.aggregate)||void 0===v?void 0:v.totalCount)||150}),onCompleted:function(n){var e=n.quotes;if(z){var t=g().unparse(nU(e,!0)),a="data:application/octet-stream,"+encodeURIComponent(t);(0,R.S)(a,"quotes.csv"),O(!1)}},skip:!0}),2),nb=nI[0],n$=nI[1].loading,nq=void 0===n$||n$,nZ=function(){nh(),D.close()},nx=function(n){n.stopPropagation(),nb(),O(!0)},nS=function(n){var e=n.e,t=n.row;e.stopPropagation(),D.show({content:(0,s.jsx)(E.m,{onSuccess:nZ,quotationId:t.quotationsId}),title:"Quotation",width:"50%"})},nA={content:"Edit",context:"secondary",icon:["fas","edit"],onClick:function(n,e){n.stopPropagation(),m().push("/dashboard/issues/manage?id=".concat(e.number,"&quoted=1"))},tooltip:"Edit"},nD={context:"info",icon:["fas","receipt"],onClick:function(n,e){return nS({e:n,row:e})},tooltip:"Fill quotation"},nw={context:"secondary",icon:["fas","receipt"],onClick:function(n,e){return m().push("/dashboard/issues/view?id=".concat(e.number))},tooltip:"info"},nj=[{sortable:!0,text:"ID",sortName:"id",formatter:function(n){var e=n.row;return(0,s.jsx)(U.D,{id:e.id,number:e.number,numberPrefix:W,numberSuffix:B,status:e.status,openCanvas:!0,type:e.type,isQuote:e.quoted})}},{text:"Creator"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(n){var e=n.row;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(nn,{children:e.type})})},text:"Type",sortName:"type"},{formatter:function(n){var e=n.row;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(nn,{children:e.description})})},text:"Description"},{sortable:!0,hidden:!G("admin"),formatter:(0,_.Z)("/dashboard/users/view","managerId","manager"),sortName:'{"Manager": {"nameFirst": "ORDER"}}',text:"Assigned to"},{sortable:!0,hidden:!G(["admin","customer"]),formatter:(0,_.Z)("/dashboard/properties/view","propertyId","location"),text:"Location",sortName:'{"Location": {"name": "ORDER"}}'},{sortable:!0,hidden:G(["admin","customer"]),text:"Location",sortName:'{"Location": {"name": "ORDER"}}'},{sortable:!0,hidden:!G("admin"),formatter:(0,_.Z)("/dashboard/customers/view","customerId","customer"),text:"Customer",sortName:'{"Customer": {"name": "ORDER"}}'},{sortable:!0,hidden:!G("admin")&&!G("supplier"),formatter:(0,_.Z)("/dashboard/suppliers/view","supplierId","acceptSupplier"),text:"Accepted Supplier",sortName:'{"Supplier": {"name": "ORDER"}}'},{sortable:!0,hidden:!G("admin")&&!G("supplier"),formatter:function(n){var e,t=n.row;return n.data,(0,s.jsx)(s.Fragment,{children:(null==t?void 0:null===(e=t.offeredSupplier)||void 0===e?void 0:e.length)>0?(0,s.jsx)(s.Fragment,{children:((null==t?void 0:t.offeredSupplier)||[]).map(function(n){var e;return(0,s.jsx)(K,{onClick:function(e){var t;return nC(e,null==n?void 0:null===(t=n.supplier)||void 0===t?void 0:t.id)},children:null==n?void 0:null===(e=n.supplier)||void 0===e?void 0:e.name})})}):"-"})},text:"Offered Supplier",sortName:'{"Supplier": {"name": "ORDER"}}'},{hidden:!G("admin"),text:"Quotations"},{hidden:!G("admin")&&!G("supplier"),text:"Received"},{hidden:!G("admin"),text:"Quotations Range (if multiple)",formatter:function(n){var e=n.row.range;return e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(ne,{children:["high: ",(0,h.Z)(e.high)]}),(0,s.jsxs)(ne,{children:["low:\xa0 ",(0,h.Z)(e.low)]})]}):"N/A"}},{sortable:!0,text:"Quote Due",sortName:"quoteDue",formatter:function(n){var e=n.row,t=(0,I.Z)(new Date),a="Quote"===e.type,r=e.status.includes("quoteSent");return a&&e.due<t&&!r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(V.Z,{color:"error"})," ",e.due]}):e.due}},{text:"Scheduled",sortable:!0,sortName:"scheduledAt"},{text:"Created",sortable:!0,sortName:"createdAt"},{formatter:function(n){var e=n.row;return(null==e?void 0:e.offeredSupplier.length)>0&&(null==e?void 0:e.offeredSupplier.every(function(n){return"quotationRejected"===n.status}))?"Rejected":e.statusText},text:"Status",sortable:!0,sortName:"status"},{hidden:!0},{hidden:!0},{formatter:b.Z,formatterData:function(n){var e=[];return G("admin")&&e.push(nA),G("admin")&&e.push(nw),(G("admin")||G("supplier"))&&"quoteOffered"===n.status&&e.push(nD),e},text:"Actions"}],nC=function(n,e){n.stopPropagation(),m().push("/dashboard/suppliers/view?id=".concat(e))},nN=function(n){m().push("/dashboard/issues/view?id=".concat(n.number))},nk=function(n){n.stopPropagation(),m().push("/dashboard/issues/manage?quoted=1")},nT=function(n){var e=null;if(n.length>1){var t,a,r=n.map(function(n){var e;return null===(e=n.lineItems)||void 0===e?void 0:e.reduce(function(n,e){return n+(e.total||0)*e.qty},0)});e={high:(t=Math).max.apply(t,(0,u.Z)(r||[])),low:(a=Math).min.apply(a,(0,u.Z)(r||[]))}}return e},nU=function(n,e){return n.map(function(n){var t,a,r,i,o,s,d,c,l,m,p,f,v,g,y,_=(0,u.Z)(k.iz).find(function(e){return e.value===n.status})||{text:"Accepted"},h=_.text,b=_.supplierText,$=_.customerText,q=((0,u.Z)(T.x).find(function(e){return e.value===n.type})||{text:"Quote"}).text,Z=n.manager?"".concat(n.manager.nameFirst," ").concat(n.manager.nameLast):"Unassigned",x=n.scheduledAt?(0,I.Z)(n.scheduledAt,!0):"-",S=(null==n?void 0:null===(t=n.quotations)||void 0===t?void 0:t.length)>0?n.quotations:[];return{id:n.id,creator:(null===(a=null==n?void 0:n.timings[0])||void 0===a?void 0:null===(r=a.user)||void 0===r?void 0:r.fullName)||"-",description:(null==n?void 0:n.description)?null==n?void 0:n.description:"-",number:n.number,type:q,status:n.status,propertyId:null===(i=n.location)||void 0===i?void 0:i.id,managerId:null===(o=n.manager)||void 0===o?void 0:o.id,customerId:null===(s=n.customer)||void 0===s?void 0:s.id,supplierId:n.supplier?n.supplier.id:"",siteVisitStart:n.siteVisitStart,siteVisitEnd:n.siteVisitEnd,siteVisitWeekends:n.siteVisitWeekends,service:(null===(d=n.service)||void 0===d?void 0:d.name)||"-",manager:Z,location:(null===(c=n.location)||void 0===c?void 0:c.name)||"-",property:(null===(l=n.location)||void 0===l?void 0:l.name)||"-",customer:(null===(m=n.customer)||void 0===m?void 0:m.name)||"-",acceptSupplier:n.supplier?n.supplier.name:"-",offeredSupplier:(null==n?void 0:null===(p=n.quotations)||void 0===p?void 0:p.length)>0?(y=n.quotations,e?y.map(function(n){var e;return null==n?void 0:null===(e=n.supplier)||void 0===e?void 0:e.name}).join(" / "):y):[],quotations:"".concat((null===(f=n.quotations)||void 0===f?void 0:f.length)||0,"/").concat(n.quoteNumber),received:"".concat(null===(v=n.quotations||[])||void 0===v?void 0:v.reduce(function(n,e){return"supplierQuoteComplete"===e.status?n+1:n},0),"/").concat((null===(g=n.quotations)||void 0===g?void 0:g.length)||0),range:nT(n.quotations),due:(0,I.Z)(n.quoteDue),scheduleDate:x,date:(0,I.Z)(n.createdAt),statusText:function(){if(S.every(function(n){return"quotationRejected"===n.status}))return"Quotation Rejected";if(G("admin"));else if(G("supplier"))return b||"Accepted";else if(G("customer"))return $||"Accepted";return h}(),quoted:n.quoted||!1,quotationsId:n.quotations[0]&&n.quotations[0].id,actions:""}})},nF=function(){return(0,s.jsxs)($.Z,{children:[(0,s.jsx)(q.Z,{marginRight:"xs",children:!(0,P.s)()&&(0,s.jsx)(Z.Z,{content:"Export to excel",context:"secondary",size:"sm",disabled:nq,onClick:nx,children:(0,s.jsx)(x.Z,{context:"white",icon:"file-csv",size:"lg"})})}),G("admin")&&(0,s.jsx)(Z.Z,{context:"secondary",content:"Add Quote",onClick:nk,size:"sm"})]})};return(0,s.jsx)(S.Z,{toolbar:(0,s.jsx)(nF,{}),open:!0,title:"Quotes",children:(0,s.jsx)(N.t,{columns:nj,loading:n_,meta:ny,ref:nr,refetch:nh,rowClick:nN,rows:nU(ng)})})},K=W.ZP.button.withConfig({displayName:"table__LinkWrapper",componentId:"sc-fdeb0f25-0"})(B()),nn=W.ZP.div.withConfig({displayName:"table__StyledLink",componentId:"sc-fdeb0f25-1"})(Y()),ne=W.ZP.div.withConfig({displayName:"table__DivWrapper",componentId:"sc-fdeb0f25-2"})(G());X.propTypes={filters:c.object},X.defaultProps={filters:{customerId:null,date:null,managerId:!1,q:null,status:null,supplierId:null,filterType:"quotes_table"}}},42608:function(n,e,t){var a=t(7297),r=t(75063),i=t(45815),o=t(85488),u=t(66312),s=t(75327);function d(){var n=(0,a.Z)(["\n  query GetDashboardList(\n    $accountId: Int\n    $adminId: Int\n    $customerId: Int\n    $supplierId: Int\n    $locationId: Int\n    $managerId: Int\n    $number: String\n    $asAt: timestamptz\n    $jobHoldReasonId: Int\n    $limit: Int\n    $monthStart: timestamptz\n    $offset: Int\n    $orderBy: dashboard_home_details_order_by!\n    $q: String\n    $tileName: String\n    $dayStart: timestamptz\n    $userId: Int\n    $status: [String!]\n    $yearStart: timestamptz\n    $type: String\n  ) {\n    quotes: getDashboard_HomeTile_Details(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n        locationId: $locationId\n        managerId: $managerId\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { number: { _eq: $number } }\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        ",'\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        status: { _in: $status }\n        Job: { type: { _eq: $type } }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n      }\n      order_by: [$orderBy]\n      limit: $limit\n      offset: $offset\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n        __typename\n      }\n      ...JobFields\n      ...JobAdminFields\n      admin: Admin {\n        id\n        name\n        __typename\n      }\n      customer: Customer {\n        ...AccountFields\n        __typename\n      }\n      location: Location {\n        id\n        name\n        __typename\n      }\n      manager: Manager {\n        ...UserFields\n        __typename\n      }\n      service: Service {\n        id\n        name\n        __typename\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          __typename\n        }\n        __typename\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: {\n            _and: [\n              {status: { _eq: "active" }}\n              {type: { _eq: "tags" }}\n            ]\n          }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n      sla: SLA {\n        id\n        name\n        __typename\n      }\n      supplier: Supplier {\n        ...AccountFields\n        __typename\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n          __typename\n        }\n        __typename\n      }\n      job: Job {\n        type\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n          __typename\n        }\n        __typename\n      }\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      id: jobId\n      number\n      # location\n      priority\n      scheduledAt\n      assignedTo\n      jobHoldReason\n      locationId\n      meta\n      managerId\n      description\n      customerName\n      customerId\n      reference\n      serviceName\n      status\n      supplierId\n      supplierName\n      timingStart\n      type\n      quoteNumber\n      quoteDue\n      createdAt\n    }\n    meta: getDashboard_HomeTile_Details_aggregate(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        ',"\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        number: { _eq: $number }\n        status: { _in: $status }\n        Job: { type: { _eq: $type } }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n        __typename\n      }\n      __typename\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return d=function(){return n},n}var c=function(n){var e=n.tagsWhere;return(0,r.Ps)(d(),e,e,i.z,u.WW,o.aL,o.wd,s.Px)};e.Z=c}}]);